var a_=Object.defineProperty;var l_=(n,e,t)=>e in n?a_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var dB=(n,e,t)=>l_(n,typeof e!="symbol"?e+"":e,t);function g_(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in n)){const o=Object.getOwnPropertyDescriptor(i,s);o&&Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function Bw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function c_(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var r9={exports:{}},J0={},a9={exports:{}},qt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qh=Symbol.for("react.element"),u_=Symbol.for("react.portal"),I_=Symbol.for("react.fragment"),d_=Symbol.for("react.strict_mode"),C_=Symbol.for("react.profiler"),h_=Symbol.for("react.provider"),A_=Symbol.for("react.context"),p_=Symbol.for("react.forward_ref"),m_=Symbol.for("react.suspense"),f_=Symbol.for("react.memo"),b_=Symbol.for("react.lazy"),Yx=Symbol.iterator;function y_(n){return n===null||typeof n!="object"?null:(n=Yx&&n[Yx]||n["@@iterator"],typeof n=="function"?n:null)}var l9={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g9=Object.assign,c9={};function ed(n,e,t){this.props=n,this.context=e,this.refs=c9,this.updater=t||l9}ed.prototype.isReactComponent={};ed.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ed.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function u9(){}u9.prototype=ed.prototype;function Gw(n,e,t){this.props=n,this.context=e,this.refs=c9,this.updater=t||l9}var vw=Gw.prototype=new u9;vw.constructor=Gw;g9(vw,ed.prototype);vw.isPureReactComponent=!0;var Kx=Array.isArray,I9=Object.prototype.hasOwnProperty,ww={current:null},d9={key:!0,ref:!0,__self:!0,__source:!0};function C9(n,e,t){var i,s={},o=null,r=null;if(e!=null)for(i in e.ref!==void 0&&(r=e.ref),e.key!==void 0&&(o=""+e.key),e)I9.call(e,i)&&!d9.hasOwnProperty(i)&&(s[i]=e[i]);var a=arguments.length-2;if(a===1)s.children=t;else if(1<a){for(var l=Array(a),g=0;g<a;g++)l[g]=arguments[g+2];s.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)s[i]===void 0&&(s[i]=a[i]);return{$$typeof:Qh,type:n,key:o,ref:r,props:s,_owner:ww.current}}function B_(n,e){return{$$typeof:Qh,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Zw(n){return typeof n=="object"&&n!==null&&n.$$typeof===Qh}function G_(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var _x=/\/+/g;function CB(n,e){return typeof n=="object"&&n!==null&&n.key!=null?G_(""+n.key):e.toString(36)}function Ym(n,e,t,i,s){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var r=!1;if(n===null)r=!0;else switch(o){case"string":case"number":r=!0;break;case"object":switch(n.$$typeof){case Qh:case u_:r=!0}}if(r)return r=n,s=s(r),n=i===""?"."+CB(r,0):i,Kx(s)?(t="",n!=null&&(t=n.replace(_x,"$&/")+"/"),Ym(s,e,t,"",function(g){return g})):s!=null&&(Zw(s)&&(s=B_(s,t+(!s.key||r&&r.key===s.key?"":(""+s.key).replace(_x,"$&/")+"/")+n)),e.push(s)),1;if(r=0,i=i===""?".":i+":",Kx(n))for(var a=0;a<n.length;a++){o=n[a];var l=i+CB(o,a);r+=Ym(o,e,t,l,s)}else if(l=y_(n),typeof l=="function")for(n=l.call(n),a=0;!(o=n.next()).done;)o=o.value,l=i+CB(o,a++),r+=Ym(o,e,t,l,s);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return r}function lp(n,e,t){if(n==null)return n;var i=[],s=0;return Ym(n,i,"","",function(o){return e.call(t,o,s++)}),i}function v_(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var _s={current:null},Km={transition:null},w_={ReactCurrentDispatcher:_s,ReactCurrentBatchConfig:Km,ReactCurrentOwner:ww};function h9(){throw Error("act(...) is not supported in production builds of React.")}qt.Children={map:lp,forEach:function(n,e,t){lp(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return lp(n,function(){e++}),e},toArray:function(n){return lp(n,function(e){return e})||[]},only:function(n){if(!Zw(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};qt.Component=ed;qt.Fragment=I_;qt.Profiler=C_;qt.PureComponent=Gw;qt.StrictMode=d_;qt.Suspense=m_;qt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=w_;qt.act=h9;qt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=g9({},n.props),s=n.key,o=n.ref,r=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,r=ww.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)I9.call(e,l)&&!d9.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var g=0;g<l;g++)a[g]=arguments[g+2];i.children=a}return{$$typeof:Qh,type:n.type,key:s,ref:o,props:i,_owner:r}};qt.createContext=function(n){return n={$$typeof:A_,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:h_,_context:n},n.Consumer=n};qt.createElement=C9;qt.createFactory=function(n){var e=C9.bind(null,n);return e.type=n,e};qt.createRef=function(){return{current:null}};qt.forwardRef=function(n){return{$$typeof:p_,render:n}};qt.isValidElement=Zw;qt.lazy=function(n){return{$$typeof:b_,_payload:{_status:-1,_result:n},_init:v_}};qt.memo=function(n,e){return{$$typeof:f_,type:n,compare:e===void 0?null:e}};qt.startTransition=function(n){var e=Km.transition;Km.transition={};try{n()}finally{Km.transition=e}};qt.unstable_act=h9;qt.useCallback=function(n,e){return _s.current.useCallback(n,e)};qt.useContext=function(n){return _s.current.useContext(n)};qt.useDebugValue=function(){};qt.useDeferredValue=function(n){return _s.current.useDeferredValue(n)};qt.useEffect=function(n,e){return _s.current.useEffect(n,e)};qt.useId=function(){return _s.current.useId()};qt.useImperativeHandle=function(n,e,t){return _s.current.useImperativeHandle(n,e,t)};qt.useInsertionEffect=function(n,e){return _s.current.useInsertionEffect(n,e)};qt.useLayoutEffect=function(n,e){return _s.current.useLayoutEffect(n,e)};qt.useMemo=function(n,e){return _s.current.useMemo(n,e)};qt.useReducer=function(n,e,t){return _s.current.useReducer(n,e,t)};qt.useRef=function(n){return _s.current.useRef(n)};qt.useState=function(n){return _s.current.useState(n)};qt.useSyncExternalStore=function(n,e,t){return _s.current.useSyncExternalStore(n,e,t)};qt.useTransition=function(){return _s.current.useTransition()};qt.version="18.3.1";a9.exports=qt;var z=a9.exports;const uf=Bw(z),Z_=g_({__proto__:null,default:uf},[z]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S_=z,R_=Symbol.for("react.element"),x_=Symbol.for("react.fragment"),V_=Object.prototype.hasOwnProperty,W_=S_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,M_={key:!0,ref:!0,__self:!0,__source:!0};function A9(n,e,t){var i,s={},o=null,r=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(r=e.ref);for(i in e)V_.call(e,i)&&!M_.hasOwnProperty(i)&&(s[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:R_,type:n,key:o,ref:r,props:s,_owner:W_.current}}J0.Fragment=x_;J0.jsx=A9;J0.jsxs=A9;r9.exports=J0;var j=r9.exports,p9={exports:{}},Ro={},m9={exports:{}},f9={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(k,ee){var $=k.length;k.push(ee);e:for(;0<$;){var ae=$-1>>>1,be=k[ae];if(0<s(be,ee))k[ae]=ee,k[$]=be,$=ae;else break e}}function t(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var ee=k[0],$=k.pop();if($!==ee){k[0]=$;e:for(var ae=0,be=k.length,me=be>>>1;ae<me;){var ce=2*(ae+1)-1,Be=k[ce],He=ce+1,Fe=k[He];if(0>s(Be,$))He<be&&0>s(Fe,Be)?(k[ae]=Fe,k[He]=$,ae=He):(k[ae]=Be,k[ce]=$,ae=ce);else if(He<be&&0>s(Fe,$))k[ae]=Fe,k[He]=$,ae=He;else break e}}return ee}function s(k,ee){var $=k.sortIndex-ee.sortIndex;return $!==0?$:k.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var r=Date,a=r.now();n.unstable_now=function(){return r.now()-a}}var l=[],g=[],c=1,u=null,C=3,h=!1,p=!1,b=!1,m=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(k){for(var ee=t(g);ee!==null;){if(ee.callback===null)i(g);else if(ee.startTime<=k)i(g),ee.sortIndex=ee.expirationTime,e(l,ee);else break;ee=t(g)}}function w(k){if(b=!1,G(k),!p)if(t(l)!==null)p=!0,se(N);else{var ee=t(g);ee!==null&&Ie(w,ee.startTime-k)}}function N(k,ee){p=!1,b&&(b=!1,A(S),S=-1),h=!0;var $=C;try{for(G(ee),u=t(l);u!==null&&(!(u.expirationTime>ee)||k&&!x());){var ae=u.callback;if(typeof ae=="function"){u.callback=null,C=u.priorityLevel;var be=ae(u.expirationTime<=ee);ee=n.unstable_now(),typeof be=="function"?u.callback=be:u===t(l)&&i(l),G(ee)}else i(l);u=t(l)}if(u!==null)var me=!0;else{var ce=t(g);ce!==null&&Ie(w,ce.startTime-ee),me=!1}return me}finally{u=null,C=$,h=!1}}var M=!1,R=null,S=-1,F=5,Z=-1;function x(){return!(n.unstable_now()-Z<F)}function Y(){if(R!==null){var k=n.unstable_now();Z=k;var ee=!0;try{ee=R(!0,k)}finally{ee?T():(M=!1,R=null)}}else M=!1}var T;if(typeof B=="function")T=function(){B(Y)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,ue=ne.port2;ne.port1.onmessage=Y,T=function(){ue.postMessage(null)}}else T=function(){m(Y,0)};function se(k){R=k,M||(M=!0,T())}function Ie(k,ee){S=m(function(){k(n.unstable_now())},ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){p||h||(p=!0,se(N))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return C},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(k){switch(C){case 1:case 2:case 3:var ee=3;break;default:ee=C}var $=C;C=ee;try{return k()}finally{C=$}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,ee){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var $=C;C=k;try{return ee()}finally{C=$}},n.unstable_scheduleCallback=function(k,ee,$){var ae=n.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?ae+$:ae):$=ae,k){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=$+be,k={id:c++,callback:ee,priorityLevel:k,startTime:$,expirationTime:be,sortIndex:-1},$>ae?(k.sortIndex=$,e(g,k),t(l)===null&&k===t(g)&&(b?(A(S),S=-1):b=!0,Ie(w,$-ae))):(k.sortIndex=be,e(l,k),p||h||(p=!0,se(N))),k},n.unstable_shouldYield=x,n.unstable_wrapCallback=function(k){var ee=C;return function(){var $=C;C=ee;try{return k.apply(this,arguments)}finally{C=$}}}})(f9);m9.exports=f9;var N_=m9.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F_=z,Zo=N_;function Te(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b9=new Set,sh={};function eu(n,e){XI(n,e),XI(n+"Capture",e)}function XI(n,e){for(sh[n]=e,n=0;n<e.length;n++)b9.add(e[n])}var Da=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fv=Object.prototype.hasOwnProperty,H_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Lx={},kx={};function X_(n){return fv.call(kx,n)?!0:fv.call(Lx,n)?!1:H_.test(n)?kx[n]=!0:(Lx[n]=!0,!1)}function T_(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function E_(n,e,t,i){if(e===null||typeof e>"u"||T_(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ls(n,e,t,i,s,o,r){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=r}var Qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Qi[n]=new Ls(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Qi[e]=new Ls(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Qi[n]=new Ls(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Qi[n]=new Ls(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Qi[n]=new Ls(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Qi[n]=new Ls(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Qi[n]=new Ls(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Qi[n]=new Ls(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Qi[n]=new Ls(n,5,!1,n.toLowerCase(),null,!1,!1)});var Sw=/[\-:]([a-z])/g;function Rw(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Sw,Rw);Qi[e]=new Ls(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Sw,Rw);Qi[e]=new Ls(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Sw,Rw);Qi[e]=new Ls(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Qi[n]=new Ls(n,1,!1,n.toLowerCase(),null,!1,!1)});Qi.xlinkHref=new Ls("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Qi[n]=new Ls(n,1,!1,n.toLowerCase(),null,!0,!0)});function xw(n,e,t,i){var s=Qi.hasOwnProperty(e)?Qi[e]:null;(s!==null?s.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(E_(e,t,s,i)&&(t=null),i||s===null?X_(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):s.mustUseProperty?n[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,i=s.attributeNamespace,t===null?n.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var nl=F_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gp=Symbol.for("react.element"),tI=Symbol.for("react.portal"),nI=Symbol.for("react.fragment"),Vw=Symbol.for("react.strict_mode"),bv=Symbol.for("react.profiler"),y9=Symbol.for("react.provider"),B9=Symbol.for("react.context"),Ww=Symbol.for("react.forward_ref"),yv=Symbol.for("react.suspense"),Bv=Symbol.for("react.suspense_list"),Mw=Symbol.for("react.memo"),Vl=Symbol.for("react.lazy"),G9=Symbol.for("react.offscreen"),zx=Symbol.iterator;function Ld(n){return n===null||typeof n!="object"?null:(n=zx&&n[zx]||n["@@iterator"],typeof n=="function"?n:null)}var Jn=Object.assign,hB;function GC(n){if(hB===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);hB=e&&e[1]||""}return`
`+hB+n}var AB=!1;function pB(n,e){if(!n||AB)return"";AB=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(g){var i=g}Reflect.construct(n,[],e)}else{try{e.call()}catch(g){i=g}n.call(e.prototype)}else{try{throw Error()}catch(g){i=g}n()}}catch(g){if(g&&i&&typeof g.stack=="string"){for(var s=g.stack.split(`
`),o=i.stack.split(`
`),r=s.length-1,a=o.length-1;1<=r&&0<=a&&s[r]!==o[a];)a--;for(;1<=r&&0<=a;r--,a--)if(s[r]!==o[a]){if(r!==1||a!==1)do if(r--,a--,0>a||s[r]!==o[a]){var l=`
`+s[r].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=r&&0<=a);break}}}finally{AB=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?GC(n):""}function Y_(n){switch(n.tag){case 5:return GC(n.type);case 16:return GC("Lazy");case 13:return GC("Suspense");case 19:return GC("SuspenseList");case 0:case 2:case 15:return n=pB(n.type,!1),n;case 11:return n=pB(n.type.render,!1),n;case 1:return n=pB(n.type,!0),n;default:return""}}function Gv(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case nI:return"Fragment";case tI:return"Portal";case bv:return"Profiler";case Vw:return"StrictMode";case yv:return"Suspense";case Bv:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case B9:return(n.displayName||"Context")+".Consumer";case y9:return(n._context.displayName||"Context")+".Provider";case Ww:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Mw:return e=n.displayName||null,e!==null?e:Gv(n.type)||"Memo";case Vl:e=n._payload,n=n._init;try{return Gv(n(e))}catch{}}return null}function K_(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gv(e);case 8:return e===Vw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ql(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function v9(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function __(n){var e=v9(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return s.call(this)},set:function(r){i=""+r,o.call(this,r)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(r){i=""+r},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function cp(n){n._valueTracker||(n._valueTracker=__(n))}function w9(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=v9(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function If(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function vv(n,e){var t=e.checked;return Jn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Dx(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=ql(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Z9(n,e){e=e.checked,e!=null&&xw(n,"checked",e,!1)}function wv(n,e){Z9(n,e);var t=ql(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Zv(n,e.type,t):e.hasOwnProperty("defaultValue")&&Zv(n,e.type,ql(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function Px(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Zv(n,e,t){(e!=="number"||If(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var vC=Array.isArray;function GI(n,e,t,i){if(n=n.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<n.length;t++)s=e.hasOwnProperty("$"+n[t].value),n[t].selected!==s&&(n[t].selected=s),s&&i&&(n[t].defaultSelected=!0)}else{for(t=""+ql(t),e=null,s=0;s<n.length;s++){if(n[s].value===t){n[s].selected=!0,i&&(n[s].defaultSelected=!0);return}e!==null||n[s].disabled||(e=n[s])}e!==null&&(e.selected=!0)}}function Sv(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Te(91));return Jn({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function Ux(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Te(92));if(vC(t)){if(1<t.length)throw Error(Te(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:ql(t)}}function S9(n,e){var t=ql(e.value),i=ql(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function Jx(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function R9(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Rv(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?R9(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var up,x9=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,s){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,s)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(up=up||document.createElement("div"),up.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=up.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function oh(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var MC={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},L_=["Webkit","ms","Moz","O"];Object.keys(MC).forEach(function(n){L_.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),MC[e]=MC[n]})});function V9(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||MC.hasOwnProperty(n)&&MC[n]?(""+e).trim():e+"px"}function W9(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,s=V9(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,s):n[t]=s}}var k_=Jn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xv(n,e){if(e){if(k_[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Te(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Te(62))}}function Vv(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wv=null;function Nw(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Mv=null,vI=null,wI=null;function Ox(n){if(n=$h(n)){if(typeof Mv!="function")throw Error(Te(280));var e=n.stateNode;e&&(e=$0(e),Mv(n.stateNode,n.type,e))}}function M9(n){vI?wI?wI.push(n):wI=[n]:vI=n}function N9(){if(vI){var n=vI,e=wI;if(wI=vI=null,Ox(n),e)for(n=0;n<e.length;n++)Ox(e[n])}}function F9(n,e){return n(e)}function H9(){}var mB=!1;function X9(n,e,t){if(mB)return n(e,t);mB=!0;try{return F9(n,e,t)}finally{mB=!1,(vI!==null||wI!==null)&&(H9(),N9())}}function rh(n,e){var t=n.stateNode;if(t===null)return null;var i=$0(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Te(231,e,typeof t));return t}var Nv=!1;if(Da)try{var kd={};Object.defineProperty(kd,"passive",{get:function(){Nv=!0}}),window.addEventListener("test",kd,kd),window.removeEventListener("test",kd,kd)}catch{Nv=!1}function z_(n,e,t,i,s,o,r,a,l){var g=Array.prototype.slice.call(arguments,3);try{e.apply(t,g)}catch(c){this.onError(c)}}var NC=!1,df=null,Cf=!1,Fv=null,D_={onError:function(n){NC=!0,df=n}};function P_(n,e,t,i,s,o,r,a,l){NC=!1,df=null,z_.apply(D_,arguments)}function U_(n,e,t,i,s,o,r,a,l){if(P_.apply(this,arguments),NC){if(NC){var g=df;NC=!1,df=null}else throw Error(Te(198));Cf||(Cf=!0,Fv=g)}}function tu(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function T9(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Qx(n){if(tu(n)!==n)throw Error(Te(188))}function J_(n){var e=n.alternate;if(!e){if(e=tu(n),e===null)throw Error(Te(188));return e!==n?null:n}for(var t=n,i=e;;){var s=t.return;if(s===null)break;var o=s.alternate;if(o===null){if(i=s.return,i!==null){t=i;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===t)return Qx(s),n;if(o===i)return Qx(s),e;o=o.sibling}throw Error(Te(188))}if(t.return!==i.return)t=s,i=o;else{for(var r=!1,a=s.child;a;){if(a===t){r=!0,t=s,i=o;break}if(a===i){r=!0,i=s,t=o;break}a=a.sibling}if(!r){for(a=o.child;a;){if(a===t){r=!0,t=o,i=s;break}if(a===i){r=!0,i=o,t=s;break}a=a.sibling}if(!r)throw Error(Te(189))}}if(t.alternate!==i)throw Error(Te(190))}if(t.tag!==3)throw Error(Te(188));return t.stateNode.current===t?n:e}function E9(n){return n=J_(n),n!==null?Y9(n):null}function Y9(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Y9(n);if(e!==null)return e;n=n.sibling}return null}var K9=Zo.unstable_scheduleCallback,jx=Zo.unstable_cancelCallback,O_=Zo.unstable_shouldYield,Q_=Zo.unstable_requestPaint,ui=Zo.unstable_now,j_=Zo.unstable_getCurrentPriorityLevel,Fw=Zo.unstable_ImmediatePriority,_9=Zo.unstable_UserBlockingPriority,hf=Zo.unstable_NormalPriority,q_=Zo.unstable_LowPriority,L9=Zo.unstable_IdlePriority,O0=null,qr=null;function $_(n){if(qr&&typeof qr.onCommitFiberRoot=="function")try{qr.onCommitFiberRoot(O0,n,void 0,(n.current.flags&128)===128)}catch{}}var vr=Math.clz32?Math.clz32:nL,eL=Math.log,tL=Math.LN2;function nL(n){return n>>>=0,n===0?32:31-(eL(n)/tL|0)|0}var Ip=64,dp=4194304;function wC(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Af(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,s=n.suspendedLanes,o=n.pingedLanes,r=t&268435455;if(r!==0){var a=r&~s;a!==0?i=wC(a):(o&=r,o!==0&&(i=wC(o)))}else r=t&~s,r!==0?i=wC(r):o!==0&&(i=wC(o));if(i===0)return 0;if(e!==0&&e!==i&&!(e&s)&&(s=i&-i,o=e&-e,s>=o||s===16&&(o&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-vr(e),s=1<<t,i|=n[t],e&=~s;return i}function iL(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sL(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,s=n.expirationTimes,o=n.pendingLanes;0<o;){var r=31-vr(o),a=1<<r,l=s[r];l===-1?(!(a&t)||a&i)&&(s[r]=iL(a,e)):l<=e&&(n.expiredLanes|=a),o&=~a}}function Hv(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function k9(){var n=Ip;return Ip<<=1,!(Ip&4194240)&&(Ip=64),n}function fB(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function jh(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-vr(e),n[e]=t}function oL(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var s=31-vr(t),o=1<<s;e[s]=0,i[s]=-1,n[s]=-1,t&=~o}}function Hw(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-vr(t),s=1<<i;s&e|n[i]&e&&(n[i]|=e),t&=~s}}var yn=0;function z9(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var D9,Xw,P9,U9,J9,Xv=!1,Cp=[],El=null,Yl=null,Kl=null,ah=new Map,lh=new Map,Ml=[],rL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function qx(n,e){switch(n){case"focusin":case"focusout":El=null;break;case"dragenter":case"dragleave":Yl=null;break;case"mouseover":case"mouseout":Kl=null;break;case"pointerover":case"pointerout":ah.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":lh.delete(e.pointerId)}}function zd(n,e,t,i,s,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:o,targetContainers:[s]},e!==null&&(e=$h(e),e!==null&&Xw(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),n)}function aL(n,e,t,i,s){switch(e){case"focusin":return El=zd(El,n,e,t,i,s),!0;case"dragenter":return Yl=zd(Yl,n,e,t,i,s),!0;case"mouseover":return Kl=zd(Kl,n,e,t,i,s),!0;case"pointerover":var o=s.pointerId;return ah.set(o,zd(ah.get(o)||null,n,e,t,i,s)),!0;case"gotpointercapture":return o=s.pointerId,lh.set(o,zd(lh.get(o)||null,n,e,t,i,s)),!0}return!1}function O9(n){var e=Cc(n.target);if(e!==null){var t=tu(e);if(t!==null){if(e=t.tag,e===13){if(e=T9(t),e!==null){n.blockedOn=e,J9(n.priority,function(){P9(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function _m(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Tv(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);Wv=i,t.target.dispatchEvent(i),Wv=null}else return e=$h(t),e!==null&&Xw(e),n.blockedOn=t,!1;e.shift()}return!0}function $x(n,e,t){_m(n)&&t.delete(e)}function lL(){Xv=!1,El!==null&&_m(El)&&(El=null),Yl!==null&&_m(Yl)&&(Yl=null),Kl!==null&&_m(Kl)&&(Kl=null),ah.forEach($x),lh.forEach($x)}function Dd(n,e){n.blockedOn===e&&(n.blockedOn=null,Xv||(Xv=!0,Zo.unstable_scheduleCallback(Zo.unstable_NormalPriority,lL)))}function gh(n){function e(s){return Dd(s,n)}if(0<Cp.length){Dd(Cp[0],n);for(var t=1;t<Cp.length;t++){var i=Cp[t];i.blockedOn===n&&(i.blockedOn=null)}}for(El!==null&&Dd(El,n),Yl!==null&&Dd(Yl,n),Kl!==null&&Dd(Kl,n),ah.forEach(e),lh.forEach(e),t=0;t<Ml.length;t++)i=Ml[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<Ml.length&&(t=Ml[0],t.blockedOn===null);)O9(t),t.blockedOn===null&&Ml.shift()}var ZI=nl.ReactCurrentBatchConfig,pf=!0;function gL(n,e,t,i){var s=yn,o=ZI.transition;ZI.transition=null;try{yn=1,Tw(n,e,t,i)}finally{yn=s,ZI.transition=o}}function cL(n,e,t,i){var s=yn,o=ZI.transition;ZI.transition=null;try{yn=4,Tw(n,e,t,i)}finally{yn=s,ZI.transition=o}}function Tw(n,e,t,i){if(pf){var s=Tv(n,e,t,i);if(s===null)xB(n,e,i,mf,t),qx(n,i);else if(aL(s,n,e,t,i))i.stopPropagation();else if(qx(n,i),e&4&&-1<rL.indexOf(n)){for(;s!==null;){var o=$h(s);if(o!==null&&D9(o),o=Tv(n,e,t,i),o===null&&xB(n,e,i,mf,t),o===s)break;s=o}s!==null&&i.stopPropagation()}else xB(n,e,i,null,t)}}var mf=null;function Tv(n,e,t,i){if(mf=null,n=Nw(i),n=Cc(n),n!==null)if(e=tu(n),e===null)n=null;else if(t=e.tag,t===13){if(n=T9(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return mf=n,null}function Q9(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(j_()){case Fw:return 1;case _9:return 4;case hf:case q_:return 16;case L9:return 536870912;default:return 16}default:return 16}}var Hl=null,Ew=null,Lm=null;function j9(){if(Lm)return Lm;var n,e=Ew,t=e.length,i,s="value"in Hl?Hl.value:Hl.textContent,o=s.length;for(n=0;n<t&&e[n]===s[n];n++);var r=t-n;for(i=1;i<=r&&e[t-i]===s[o-i];i++);return Lm=s.slice(n,1<i?1-i:void 0)}function km(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function hp(){return!0}function e1(){return!1}function xo(n){function e(t,i,s,o,r){this._reactName=t,this._targetInst=s,this.type=i,this.nativeEvent=o,this.target=r,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?hp:e1,this.isPropagationStopped=e1,this}return Jn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=hp)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=hp)},persist:function(){},isPersistent:hp}),e}var td={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yw=xo(td),qh=Jn({},td,{view:0,detail:0}),uL=xo(qh),bB,yB,Pd,Q0=Jn({},qh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kw,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Pd&&(Pd&&n.type==="mousemove"?(bB=n.screenX-Pd.screenX,yB=n.screenY-Pd.screenY):yB=bB=0,Pd=n),bB)},movementY:function(n){return"movementY"in n?n.movementY:yB}}),t1=xo(Q0),IL=Jn({},Q0,{dataTransfer:0}),dL=xo(IL),CL=Jn({},qh,{relatedTarget:0}),BB=xo(CL),hL=Jn({},td,{animationName:0,elapsedTime:0,pseudoElement:0}),AL=xo(hL),pL=Jn({},td,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),mL=xo(pL),fL=Jn({},td,{data:0}),n1=xo(fL),bL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},BL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GL(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=BL[n])?!!e[n]:!1}function Kw(){return GL}var vL=Jn({},qh,{key:function(n){if(n.key){var e=bL[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=km(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?yL[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kw,charCode:function(n){return n.type==="keypress"?km(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?km(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),wL=xo(vL),ZL=Jn({},Q0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),i1=xo(ZL),SL=Jn({},qh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kw}),RL=xo(SL),xL=Jn({},td,{propertyName:0,elapsedTime:0,pseudoElement:0}),VL=xo(xL),WL=Jn({},Q0,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),ML=xo(WL),NL=[9,13,27,32],_w=Da&&"CompositionEvent"in window,FC=null;Da&&"documentMode"in document&&(FC=document.documentMode);var FL=Da&&"TextEvent"in window&&!FC,q9=Da&&(!_w||FC&&8<FC&&11>=FC),s1=" ",o1=!1;function $9(n,e){switch(n){case"keyup":return NL.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eH(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var iI=!1;function HL(n,e){switch(n){case"compositionend":return eH(e);case"keypress":return e.which!==32?null:(o1=!0,s1);case"textInput":return n=e.data,n===s1&&o1?null:n;default:return null}}function XL(n,e){if(iI)return n==="compositionend"||!_w&&$9(n,e)?(n=j9(),Lm=Ew=Hl=null,iI=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return q9&&e.locale!=="ko"?null:e.data;default:return null}}var TL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function r1(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!TL[n.type]:e==="textarea"}function tH(n,e,t,i){M9(i),e=ff(e,"onChange"),0<e.length&&(t=new Yw("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var HC=null,ch=null;function EL(n){IH(n,0)}function j0(n){var e=rI(n);if(w9(e))return n}function YL(n,e){if(n==="change")return e}var nH=!1;if(Da){var GB;if(Da){var vB="oninput"in document;if(!vB){var a1=document.createElement("div");a1.setAttribute("oninput","return;"),vB=typeof a1.oninput=="function"}GB=vB}else GB=!1;nH=GB&&(!document.documentMode||9<document.documentMode)}function l1(){HC&&(HC.detachEvent("onpropertychange",iH),ch=HC=null)}function iH(n){if(n.propertyName==="value"&&j0(ch)){var e=[];tH(e,ch,n,Nw(n)),X9(EL,e)}}function KL(n,e,t){n==="focusin"?(l1(),HC=e,ch=t,HC.attachEvent("onpropertychange",iH)):n==="focusout"&&l1()}function _L(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return j0(ch)}function LL(n,e){if(n==="click")return j0(e)}function kL(n,e){if(n==="input"||n==="change")return j0(e)}function zL(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Sr=typeof Object.is=="function"?Object.is:zL;function uh(n,e){if(Sr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var s=t[i];if(!fv.call(e,s)||!Sr(n[s],e[s]))return!1}return!0}function g1(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function c1(n,e){var t=g1(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=g1(t)}}function sH(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?sH(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function oH(){for(var n=window,e=If();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=If(n.document)}return e}function Lw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function DL(n){var e=oH(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&sH(t.ownerDocument.documentElement,t)){if(i!==null&&Lw(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var s=t.textContent.length,o=Math.min(i.start,s);i=i.end===void 0?o:Math.min(i.end,s),!n.extend&&o>i&&(s=i,i=o,o=s),s=c1(t,o);var r=c1(t,i);s&&r&&(n.rangeCount!==1||n.anchorNode!==s.node||n.anchorOffset!==s.offset||n.focusNode!==r.node||n.focusOffset!==r.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),n.removeAllRanges(),o>i?(n.addRange(e),n.extend(r.node,r.offset)):(e.setEnd(r.node,r.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var PL=Da&&"documentMode"in document&&11>=document.documentMode,sI=null,Ev=null,XC=null,Yv=!1;function u1(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Yv||sI==null||sI!==If(i)||(i=sI,"selectionStart"in i&&Lw(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),XC&&uh(XC,i)||(XC=i,i=ff(Ev,"onSelect"),0<i.length&&(e=new Yw("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=sI)))}function Ap(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var oI={animationend:Ap("Animation","AnimationEnd"),animationiteration:Ap("Animation","AnimationIteration"),animationstart:Ap("Animation","AnimationStart"),transitionend:Ap("Transition","TransitionEnd")},wB={},rH={};Da&&(rH=document.createElement("div").style,"AnimationEvent"in window||(delete oI.animationend.animation,delete oI.animationiteration.animation,delete oI.animationstart.animation),"TransitionEvent"in window||delete oI.transitionend.transition);function q0(n){if(wB[n])return wB[n];if(!oI[n])return n;var e=oI[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in rH)return wB[n]=e[t];return n}var aH=q0("animationend"),lH=q0("animationiteration"),gH=q0("animationstart"),cH=q0("transitionend"),uH=new Map,I1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function cg(n,e){uH.set(n,e),eu(e,[n])}for(var ZB=0;ZB<I1.length;ZB++){var SB=I1[ZB],UL=SB.toLowerCase(),JL=SB[0].toUpperCase()+SB.slice(1);cg(UL,"on"+JL)}cg(aH,"onAnimationEnd");cg(lH,"onAnimationIteration");cg(gH,"onAnimationStart");cg("dblclick","onDoubleClick");cg("focusin","onFocus");cg("focusout","onBlur");cg(cH,"onTransitionEnd");XI("onMouseEnter",["mouseout","mouseover"]);XI("onMouseLeave",["mouseout","mouseover"]);XI("onPointerEnter",["pointerout","pointerover"]);XI("onPointerLeave",["pointerout","pointerover"]);eu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));eu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));eu("onBeforeInput",["compositionend","keypress","textInput","paste"]);eu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));eu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));eu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ZC="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),OL=new Set("cancel close invalid load scroll toggle".split(" ").concat(ZC));function d1(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,U_(i,e,void 0,n),n.currentTarget=null}function IH(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],s=i.event;i=i.listeners;e:{var o=void 0;if(e)for(var r=i.length-1;0<=r;r--){var a=i[r],l=a.instance,g=a.currentTarget;if(a=a.listener,l!==o&&s.isPropagationStopped())break e;d1(s,a,g),o=l}else for(r=0;r<i.length;r++){if(a=i[r],l=a.instance,g=a.currentTarget,a=a.listener,l!==o&&s.isPropagationStopped())break e;d1(s,a,g),o=l}}}if(Cf)throw n=Fv,Cf=!1,Fv=null,n}function Xn(n,e){var t=e[zv];t===void 0&&(t=e[zv]=new Set);var i=n+"__bubble";t.has(i)||(dH(e,n,2,!1),t.add(i))}function RB(n,e,t){var i=0;e&&(i|=4),dH(t,n,i,e)}var pp="_reactListening"+Math.random().toString(36).slice(2);function Ih(n){if(!n[pp]){n[pp]=!0,b9.forEach(function(t){t!=="selectionchange"&&(OL.has(t)||RB(t,!1,n),RB(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[pp]||(e[pp]=!0,RB("selectionchange",!1,e))}}function dH(n,e,t,i){switch(Q9(e)){case 1:var s=gL;break;case 4:s=cL;break;default:s=Tw}t=s.bind(null,e,t,n),s=void 0,!Nv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),i?s!==void 0?n.addEventListener(e,t,{capture:!0,passive:s}):n.addEventListener(e,t,!0):s!==void 0?n.addEventListener(e,t,{passive:s}):n.addEventListener(e,t,!1)}function xB(n,e,t,i,s){var o=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var r=i.tag;if(r===3||r===4){var a=i.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(r===4)for(r=i.return;r!==null;){var l=r.tag;if((l===3||l===4)&&(l=r.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;r=r.return}for(;a!==null;){if(r=Cc(a),r===null)return;if(l=r.tag,l===5||l===6){i=o=r;continue e}a=a.parentNode}}i=i.return}X9(function(){var g=o,c=Nw(t),u=[];e:{var C=uH.get(n);if(C!==void 0){var h=Yw,p=n;switch(n){case"keypress":if(km(t)===0)break e;case"keydown":case"keyup":h=wL;break;case"focusin":p="focus",h=BB;break;case"focusout":p="blur",h=BB;break;case"beforeblur":case"afterblur":h=BB;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":h=t1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":h=dL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":h=RL;break;case aH:case lH:case gH:h=AL;break;case cH:h=VL;break;case"scroll":h=uL;break;case"wheel":h=ML;break;case"copy":case"cut":case"paste":h=mL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":h=i1}var b=(e&4)!==0,m=!b&&n==="scroll",A=b?C!==null?C+"Capture":null:C;b=[];for(var B=g,G;B!==null;){G=B;var w=G.stateNode;if(G.tag===5&&w!==null&&(G=w,A!==null&&(w=rh(B,A),w!=null&&b.push(dh(B,w,G)))),m)break;B=B.return}0<b.length&&(C=new h(C,p,null,t,c),u.push({event:C,listeners:b}))}}if(!(e&7)){e:{if(C=n==="mouseover"||n==="pointerover",h=n==="mouseout"||n==="pointerout",C&&t!==Wv&&(p=t.relatedTarget||t.fromElement)&&(Cc(p)||p[Pa]))break e;if((h||C)&&(C=c.window===c?c:(C=c.ownerDocument)?C.defaultView||C.parentWindow:window,h?(p=t.relatedTarget||t.toElement,h=g,p=p?Cc(p):null,p!==null&&(m=tu(p),p!==m||p.tag!==5&&p.tag!==6)&&(p=null)):(h=null,p=g),h!==p)){if(b=t1,w="onMouseLeave",A="onMouseEnter",B="mouse",(n==="pointerout"||n==="pointerover")&&(b=i1,w="onPointerLeave",A="onPointerEnter",B="pointer"),m=h==null?C:rI(h),G=p==null?C:rI(p),C=new b(w,B+"leave",h,t,c),C.target=m,C.relatedTarget=G,w=null,Cc(c)===g&&(b=new b(A,B+"enter",p,t,c),b.target=G,b.relatedTarget=m,w=b),m=w,h&&p)t:{for(b=h,A=p,B=0,G=b;G;G=Wu(G))B++;for(G=0,w=A;w;w=Wu(w))G++;for(;0<B-G;)b=Wu(b),B--;for(;0<G-B;)A=Wu(A),G--;for(;B--;){if(b===A||A!==null&&b===A.alternate)break t;b=Wu(b),A=Wu(A)}b=null}else b=null;h!==null&&C1(u,C,h,b,!1),p!==null&&m!==null&&C1(u,m,p,b,!0)}}e:{if(C=g?rI(g):window,h=C.nodeName&&C.nodeName.toLowerCase(),h==="select"||h==="input"&&C.type==="file")var N=YL;else if(r1(C))if(nH)N=kL;else{N=_L;var M=KL}else(h=C.nodeName)&&h.toLowerCase()==="input"&&(C.type==="checkbox"||C.type==="radio")&&(N=LL);if(N&&(N=N(n,g))){tH(u,N,t,c);break e}M&&M(n,C,g),n==="focusout"&&(M=C._wrapperState)&&M.controlled&&C.type==="number"&&Zv(C,"number",C.value)}switch(M=g?rI(g):window,n){case"focusin":(r1(M)||M.contentEditable==="true")&&(sI=M,Ev=g,XC=null);break;case"focusout":XC=Ev=sI=null;break;case"mousedown":Yv=!0;break;case"contextmenu":case"mouseup":case"dragend":Yv=!1,u1(u,t,c);break;case"selectionchange":if(PL)break;case"keydown":case"keyup":u1(u,t,c)}var R;if(_w)e:{switch(n){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else iI?$9(n,t)&&(S="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(S="onCompositionStart");S&&(q9&&t.locale!=="ko"&&(iI||S!=="onCompositionStart"?S==="onCompositionEnd"&&iI&&(R=j9()):(Hl=c,Ew="value"in Hl?Hl.value:Hl.textContent,iI=!0)),M=ff(g,S),0<M.length&&(S=new n1(S,n,null,t,c),u.push({event:S,listeners:M}),R?S.data=R:(R=eH(t),R!==null&&(S.data=R)))),(R=FL?HL(n,t):XL(n,t))&&(g=ff(g,"onBeforeInput"),0<g.length&&(c=new n1("onBeforeInput","beforeinput",null,t,c),u.push({event:c,listeners:g}),c.data=R))}IH(u,e)})}function dh(n,e,t){return{instance:n,listener:e,currentTarget:t}}function ff(n,e){for(var t=e+"Capture",i=[];n!==null;){var s=n,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=rh(n,t),o!=null&&i.unshift(dh(n,o,s)),o=rh(n,e),o!=null&&i.push(dh(n,o,s))),n=n.return}return i}function Wu(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function C1(n,e,t,i,s){for(var o=e._reactName,r=[];t!==null&&t!==i;){var a=t,l=a.alternate,g=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&g!==null&&(a=g,s?(l=rh(t,o),l!=null&&r.unshift(dh(t,l,a))):s||(l=rh(t,o),l!=null&&r.push(dh(t,l,a)))),t=t.return}r.length!==0&&n.push({event:e,listeners:r})}var QL=/\r\n?/g,jL=/\u0000|\uFFFD/g;function h1(n){return(typeof n=="string"?n:""+n).replace(QL,`
`).replace(jL,"")}function mp(n,e,t){if(e=h1(e),h1(n)!==e&&t)throw Error(Te(425))}function bf(){}var Kv=null,_v=null;function Lv(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var kv=typeof setTimeout=="function"?setTimeout:void 0,qL=typeof clearTimeout=="function"?clearTimeout:void 0,A1=typeof Promise=="function"?Promise:void 0,$L=typeof queueMicrotask=="function"?queueMicrotask:typeof A1<"u"?function(n){return A1.resolve(null).then(n).catch(ek)}:kv;function ek(n){setTimeout(function(){throw n})}function VB(n,e){var t=e,i=0;do{var s=t.nextSibling;if(n.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(i===0){n.removeChild(s),gh(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=s}while(t);gh(e)}function _l(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function p1(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var nd=Math.random().toString(36).slice(2),Qr="__reactFiber$"+nd,Ch="__reactProps$"+nd,Pa="__reactContainer$"+nd,zv="__reactEvents$"+nd,tk="__reactListeners$"+nd,nk="__reactHandles$"+nd;function Cc(n){var e=n[Qr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Pa]||t[Qr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=p1(n);n!==null;){if(t=n[Qr])return t;n=p1(n)}return e}n=t,t=n.parentNode}return null}function $h(n){return n=n[Qr]||n[Pa],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function rI(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Te(33))}function $0(n){return n[Ch]||null}var Dv=[],aI=-1;function ug(n){return{current:n}}function Tn(n){0>aI||(n.current=Dv[aI],Dv[aI]=null,aI--)}function Mn(n,e){aI++,Dv[aI]=n.current,n.current=e}var $l={},Bs=ug($l),io=ug(!1),Xc=$l;function TI(n,e){var t=n.type.contextTypes;if(!t)return $l;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in t)s[o]=e[o];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=s),s}function so(n){return n=n.childContextTypes,n!=null}function yf(){Tn(io),Tn(Bs)}function m1(n,e,t){if(Bs.current!==$l)throw Error(Te(168));Mn(Bs,e),Mn(io,t)}function CH(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var s in i)if(!(s in e))throw Error(Te(108,K_(n)||"Unknown",s));return Jn({},t,i)}function Bf(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||$l,Xc=Bs.current,Mn(Bs,n),Mn(io,io.current),!0}function f1(n,e,t){var i=n.stateNode;if(!i)throw Error(Te(169));t?(n=CH(n,e,Xc),i.__reactInternalMemoizedMergedChildContext=n,Tn(io),Tn(Bs),Mn(Bs,n)):Tn(io),Mn(io,t)}var Ra=null,eb=!1,WB=!1;function hH(n){Ra===null?Ra=[n]:Ra.push(n)}function ik(n){eb=!0,hH(n)}function Ig(){if(!WB&&Ra!==null){WB=!0;var n=0,e=yn;try{var t=Ra;for(yn=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}Ra=null,eb=!1}catch(s){throw Ra!==null&&(Ra=Ra.slice(n+1)),K9(Fw,Ig),s}finally{yn=e,WB=!1}}return null}var lI=[],gI=0,Gf=null,vf=0,Uo=[],Jo=0,Tc=null,Wa=1,Ma="";function nc(n,e){lI[gI++]=vf,lI[gI++]=Gf,Gf=n,vf=e}function AH(n,e,t){Uo[Jo++]=Wa,Uo[Jo++]=Ma,Uo[Jo++]=Tc,Tc=n;var i=Wa;n=Ma;var s=32-vr(i)-1;i&=~(1<<s),t+=1;var o=32-vr(e)+s;if(30<o){var r=s-s%5;o=(i&(1<<r)-1).toString(32),i>>=r,s-=r,Wa=1<<32-vr(e)+s|t<<s|i,Ma=o+n}else Wa=1<<o|t<<s|i,Ma=n}function kw(n){n.return!==null&&(nc(n,1),AH(n,1,0))}function zw(n){for(;n===Gf;)Gf=lI[--gI],lI[gI]=null,vf=lI[--gI],lI[gI]=null;for(;n===Tc;)Tc=Uo[--Jo],Uo[Jo]=null,Ma=Uo[--Jo],Uo[Jo]=null,Wa=Uo[--Jo],Uo[Jo]=null}var Bo=null,yo=null,Kn=!1,fr=null;function pH(n,e){var t=Oo(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function b1(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Bo=n,yo=_l(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Bo=n,yo=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Tc!==null?{id:Wa,overflow:Ma}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Oo(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Bo=n,yo=null,!0):!1;default:return!1}}function Pv(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Uv(n){if(Kn){var e=yo;if(e){var t=e;if(!b1(n,e)){if(Pv(n))throw Error(Te(418));e=_l(t.nextSibling);var i=Bo;e&&b1(n,e)?pH(i,t):(n.flags=n.flags&-4097|2,Kn=!1,Bo=n)}}else{if(Pv(n))throw Error(Te(418));n.flags=n.flags&-4097|2,Kn=!1,Bo=n}}}function y1(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Bo=n}function fp(n){if(n!==Bo)return!1;if(!Kn)return y1(n),Kn=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Lv(n.type,n.memoizedProps)),e&&(e=yo)){if(Pv(n))throw mH(),Error(Te(418));for(;e;)pH(n,e),e=_l(e.nextSibling)}if(y1(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Te(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){yo=_l(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}yo=null}}else yo=Bo?_l(n.stateNode.nextSibling):null;return!0}function mH(){for(var n=yo;n;)n=_l(n.nextSibling)}function EI(){yo=Bo=null,Kn=!1}function Dw(n){fr===null?fr=[n]:fr.push(n)}var sk=nl.ReactCurrentBatchConfig;function Ud(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Te(309));var i=t.stateNode}if(!i)throw Error(Te(147,n));var s=i,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(r){var a=s.refs;r===null?delete a[o]:a[o]=r},e._stringRef=o,e)}if(typeof n!="string")throw Error(Te(284));if(!t._owner)throw Error(Te(290,n))}return n}function bp(n,e){throw n=Object.prototype.toString.call(e),Error(Te(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function B1(n){var e=n._init;return e(n._payload)}function fH(n){function e(A,B){if(n){var G=A.deletions;G===null?(A.deletions=[B],A.flags|=16):G.push(B)}}function t(A,B){if(!n)return null;for(;B!==null;)e(A,B),B=B.sibling;return null}function i(A,B){for(A=new Map;B!==null;)B.key!==null?A.set(B.key,B):A.set(B.index,B),B=B.sibling;return A}function s(A,B){return A=Dl(A,B),A.index=0,A.sibling=null,A}function o(A,B,G){return A.index=G,n?(G=A.alternate,G!==null?(G=G.index,G<B?(A.flags|=2,B):G):(A.flags|=2,B)):(A.flags|=1048576,B)}function r(A){return n&&A.alternate===null&&(A.flags|=2),A}function a(A,B,G,w){return B===null||B.tag!==6?(B=EB(G,A.mode,w),B.return=A,B):(B=s(B,G),B.return=A,B)}function l(A,B,G,w){var N=G.type;return N===nI?c(A,B,G.props.children,w,G.key):B!==null&&(B.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Vl&&B1(N)===B.type)?(w=s(B,G.props),w.ref=Ud(A,B,G),w.return=A,w):(w=Qm(G.type,G.key,G.props,null,A.mode,w),w.ref=Ud(A,B,G),w.return=A,w)}function g(A,B,G,w){return B===null||B.tag!==4||B.stateNode.containerInfo!==G.containerInfo||B.stateNode.implementation!==G.implementation?(B=YB(G,A.mode,w),B.return=A,B):(B=s(B,G.children||[]),B.return=A,B)}function c(A,B,G,w,N){return B===null||B.tag!==7?(B=Sc(G,A.mode,w,N),B.return=A,B):(B=s(B,G),B.return=A,B)}function u(A,B,G){if(typeof B=="string"&&B!==""||typeof B=="number")return B=EB(""+B,A.mode,G),B.return=A,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case gp:return G=Qm(B.type,B.key,B.props,null,A.mode,G),G.ref=Ud(A,null,B),G.return=A,G;case tI:return B=YB(B,A.mode,G),B.return=A,B;case Vl:var w=B._init;return u(A,w(B._payload),G)}if(vC(B)||Ld(B))return B=Sc(B,A.mode,G,null),B.return=A,B;bp(A,B)}return null}function C(A,B,G,w){var N=B!==null?B.key:null;if(typeof G=="string"&&G!==""||typeof G=="number")return N!==null?null:a(A,B,""+G,w);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case gp:return G.key===N?l(A,B,G,w):null;case tI:return G.key===N?g(A,B,G,w):null;case Vl:return N=G._init,C(A,B,N(G._payload),w)}if(vC(G)||Ld(G))return N!==null?null:c(A,B,G,w,null);bp(A,G)}return null}function h(A,B,G,w,N){if(typeof w=="string"&&w!==""||typeof w=="number")return A=A.get(G)||null,a(B,A,""+w,N);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case gp:return A=A.get(w.key===null?G:w.key)||null,l(B,A,w,N);case tI:return A=A.get(w.key===null?G:w.key)||null,g(B,A,w,N);case Vl:var M=w._init;return h(A,B,G,M(w._payload),N)}if(vC(w)||Ld(w))return A=A.get(G)||null,c(B,A,w,N,null);bp(B,w)}return null}function p(A,B,G,w){for(var N=null,M=null,R=B,S=B=0,F=null;R!==null&&S<G.length;S++){R.index>S?(F=R,R=null):F=R.sibling;var Z=C(A,R,G[S],w);if(Z===null){R===null&&(R=F);break}n&&R&&Z.alternate===null&&e(A,R),B=o(Z,B,S),M===null?N=Z:M.sibling=Z,M=Z,R=F}if(S===G.length)return t(A,R),Kn&&nc(A,S),N;if(R===null){for(;S<G.length;S++)R=u(A,G[S],w),R!==null&&(B=o(R,B,S),M===null?N=R:M.sibling=R,M=R);return Kn&&nc(A,S),N}for(R=i(A,R);S<G.length;S++)F=h(R,A,S,G[S],w),F!==null&&(n&&F.alternate!==null&&R.delete(F.key===null?S:F.key),B=o(F,B,S),M===null?N=F:M.sibling=F,M=F);return n&&R.forEach(function(x){return e(A,x)}),Kn&&nc(A,S),N}function b(A,B,G,w){var N=Ld(G);if(typeof N!="function")throw Error(Te(150));if(G=N.call(G),G==null)throw Error(Te(151));for(var M=N=null,R=B,S=B=0,F=null,Z=G.next();R!==null&&!Z.done;S++,Z=G.next()){R.index>S?(F=R,R=null):F=R.sibling;var x=C(A,R,Z.value,w);if(x===null){R===null&&(R=F);break}n&&R&&x.alternate===null&&e(A,R),B=o(x,B,S),M===null?N=x:M.sibling=x,M=x,R=F}if(Z.done)return t(A,R),Kn&&nc(A,S),N;if(R===null){for(;!Z.done;S++,Z=G.next())Z=u(A,Z.value,w),Z!==null&&(B=o(Z,B,S),M===null?N=Z:M.sibling=Z,M=Z);return Kn&&nc(A,S),N}for(R=i(A,R);!Z.done;S++,Z=G.next())Z=h(R,A,S,Z.value,w),Z!==null&&(n&&Z.alternate!==null&&R.delete(Z.key===null?S:Z.key),B=o(Z,B,S),M===null?N=Z:M.sibling=Z,M=Z);return n&&R.forEach(function(Y){return e(A,Y)}),Kn&&nc(A,S),N}function m(A,B,G,w){if(typeof G=="object"&&G!==null&&G.type===nI&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case gp:e:{for(var N=G.key,M=B;M!==null;){if(M.key===N){if(N=G.type,N===nI){if(M.tag===7){t(A,M.sibling),B=s(M,G.props.children),B.return=A,A=B;break e}}else if(M.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Vl&&B1(N)===M.type){t(A,M.sibling),B=s(M,G.props),B.ref=Ud(A,M,G),B.return=A,A=B;break e}t(A,M);break}else e(A,M);M=M.sibling}G.type===nI?(B=Sc(G.props.children,A.mode,w,G.key),B.return=A,A=B):(w=Qm(G.type,G.key,G.props,null,A.mode,w),w.ref=Ud(A,B,G),w.return=A,A=w)}return r(A);case tI:e:{for(M=G.key;B!==null;){if(B.key===M)if(B.tag===4&&B.stateNode.containerInfo===G.containerInfo&&B.stateNode.implementation===G.implementation){t(A,B.sibling),B=s(B,G.children||[]),B.return=A,A=B;break e}else{t(A,B);break}else e(A,B);B=B.sibling}B=YB(G,A.mode,w),B.return=A,A=B}return r(A);case Vl:return M=G._init,m(A,B,M(G._payload),w)}if(vC(G))return p(A,B,G,w);if(Ld(G))return b(A,B,G,w);bp(A,G)}return typeof G=="string"&&G!==""||typeof G=="number"?(G=""+G,B!==null&&B.tag===6?(t(A,B.sibling),B=s(B,G),B.return=A,A=B):(t(A,B),B=EB(G,A.mode,w),B.return=A,A=B),r(A)):t(A,B)}return m}var YI=fH(!0),bH=fH(!1),wf=ug(null),Zf=null,cI=null,Pw=null;function Uw(){Pw=cI=Zf=null}function Jw(n){var e=wf.current;Tn(wf),n._currentValue=e}function Jv(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function SI(n,e){Zf=n,Pw=cI=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(eo=!0),n.firstContext=null)}function $o(n){var e=n._currentValue;if(Pw!==n)if(n={context:n,memoizedValue:e,next:null},cI===null){if(Zf===null)throw Error(Te(308));cI=n,Zf.dependencies={lanes:0,firstContext:n}}else cI=cI.next=n;return e}var hc=null;function Ow(n){hc===null?hc=[n]:hc.push(n)}function yH(n,e,t,i){var s=e.interleaved;return s===null?(t.next=t,Ow(e)):(t.next=s.next,s.next=t),e.interleaved=t,Ua(n,i)}function Ua(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Wl=!1;function Qw(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function BH(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ta(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Ll(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,dn&2){var s=i.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),i.pending=e,Ua(n,t)}return s=i.interleaved,s===null?(e.next=e,Ow(i)):(e.next=s.next,s.next=e),i.interleaved=e,Ua(n,t)}function zm(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Hw(n,t)}}function G1(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var s=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var r={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?s=o=r:o=o.next=r,t=t.next}while(t!==null);o===null?s=o=e:o=o.next=e}else s=o=e;t={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Sf(n,e,t,i){var s=n.updateQueue;Wl=!1;var o=s.firstBaseUpdate,r=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,g=l.next;l.next=null,r===null?o=g:r.next=g,r=l;var c=n.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==r&&(a===null?c.firstBaseUpdate=g:a.next=g,c.lastBaseUpdate=l))}if(o!==null){var u=s.baseState;r=0,c=g=l=null,a=o;do{var C=a.lane,h=a.eventTime;if((i&C)===C){c!==null&&(c=c.next={eventTime:h,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=n,b=a;switch(C=e,h=t,b.tag){case 1:if(p=b.payload,typeof p=="function"){u=p.call(h,u,C);break e}u=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=b.payload,C=typeof p=="function"?p.call(h,u,C):p,C==null)break e;u=Jn({},u,C);break e;case 2:Wl=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,C=s.effects,C===null?s.effects=[a]:C.push(a))}else h={eventTime:h,lane:C,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(g=c=h,l=u):c=c.next=h,r|=C;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;C=a,a=C.next,C.next=null,s.lastBaseUpdate=C,s.shared.pending=null}}while(!0);if(c===null&&(l=u),s.baseState=l,s.firstBaseUpdate=g,s.lastBaseUpdate=c,e=s.shared.interleaved,e!==null){s=e;do r|=s.lane,s=s.next;while(s!==e)}else o===null&&(s.shared.lanes=0);Yc|=r,n.lanes=r,n.memoizedState=u}}function v1(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],s=i.callback;if(s!==null){if(i.callback=null,i=t,typeof s!="function")throw Error(Te(191,s));s.call(i)}}}var eA={},$r=ug(eA),hh=ug(eA),Ah=ug(eA);function Ac(n){if(n===eA)throw Error(Te(174));return n}function jw(n,e){switch(Mn(Ah,e),Mn(hh,n),Mn($r,eA),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Rv(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Rv(e,n)}Tn($r),Mn($r,e)}function KI(){Tn($r),Tn(hh),Tn(Ah)}function GH(n){Ac(Ah.current);var e=Ac($r.current),t=Rv(e,n.type);e!==t&&(Mn(hh,n),Mn($r,t))}function qw(n){hh.current===n&&(Tn($r),Tn(hh))}var kn=ug(0);function Rf(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var MB=[];function $w(){for(var n=0;n<MB.length;n++)MB[n]._workInProgressVersionPrimary=null;MB.length=0}var Dm=nl.ReactCurrentDispatcher,NB=nl.ReactCurrentBatchConfig,Ec=0,Pn=null,vi=null,Ni=null,xf=!1,TC=!1,ph=0,ok=0;function rs(){throw Error(Te(321))}function eZ(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Sr(n[t],e[t]))return!1;return!0}function tZ(n,e,t,i,s,o){if(Ec=o,Pn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Dm.current=n===null||n.memoizedState===null?gk:ck,n=t(i,s),TC){o=0;do{if(TC=!1,ph=0,25<=o)throw Error(Te(301));o+=1,Ni=vi=null,e.updateQueue=null,Dm.current=uk,n=t(i,s)}while(TC)}if(Dm.current=Vf,e=vi!==null&&vi.next!==null,Ec=0,Ni=vi=Pn=null,xf=!1,e)throw Error(Te(300));return n}function nZ(){var n=ph!==0;return ph=0,n}function Pr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ni===null?Pn.memoizedState=Ni=n:Ni=Ni.next=n,Ni}function er(){if(vi===null){var n=Pn.alternate;n=n!==null?n.memoizedState:null}else n=vi.next;var e=Ni===null?Pn.memoizedState:Ni.next;if(e!==null)Ni=e,vi=n;else{if(n===null)throw Error(Te(310));vi=n,n={memoizedState:vi.memoizedState,baseState:vi.baseState,baseQueue:vi.baseQueue,queue:vi.queue,next:null},Ni===null?Pn.memoizedState=Ni=n:Ni=Ni.next=n}return Ni}function mh(n,e){return typeof e=="function"?e(n):e}function FB(n){var e=er(),t=e.queue;if(t===null)throw Error(Te(311));t.lastRenderedReducer=n;var i=vi,s=i.baseQueue,o=t.pending;if(o!==null){if(s!==null){var r=s.next;s.next=o.next,o.next=r}i.baseQueue=s=o,t.pending=null}if(s!==null){o=s.next,i=i.baseState;var a=r=null,l=null,g=o;do{var c=g.lane;if((Ec&c)===c)l!==null&&(l=l.next={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null}),i=g.hasEagerState?g.eagerState:n(i,g.action);else{var u={lane:c,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};l===null?(a=l=u,r=i):l=l.next=u,Pn.lanes|=c,Yc|=c}g=g.next}while(g!==null&&g!==o);l===null?r=i:l.next=a,Sr(i,e.memoizedState)||(eo=!0),e.memoizedState=i,e.baseState=r,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){s=n;do o=s.lane,Pn.lanes|=o,Yc|=o,s=s.next;while(s!==n)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function HB(n){var e=er(),t=e.queue;if(t===null)throw Error(Te(311));t.lastRenderedReducer=n;var i=t.dispatch,s=t.pending,o=e.memoizedState;if(s!==null){t.pending=null;var r=s=s.next;do o=n(o,r.action),r=r.next;while(r!==s);Sr(o,e.memoizedState)||(eo=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,i]}function vH(){}function wH(n,e){var t=Pn,i=er(),s=e(),o=!Sr(i.memoizedState,s);if(o&&(i.memoizedState=s,eo=!0),i=i.queue,iZ(RH.bind(null,t,i,n),[n]),i.getSnapshot!==e||o||Ni!==null&&Ni.memoizedState.tag&1){if(t.flags|=2048,fh(9,SH.bind(null,t,i,s,e),void 0,null),Xi===null)throw Error(Te(349));Ec&30||ZH(t,e,s)}return s}function ZH(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Pn.updateQueue,e===null?(e={lastEffect:null,stores:null},Pn.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function SH(n,e,t,i){e.value=t,e.getSnapshot=i,xH(e)&&VH(n)}function RH(n,e,t){return t(function(){xH(e)&&VH(n)})}function xH(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Sr(n,t)}catch{return!0}}function VH(n){var e=Ua(n,1);e!==null&&wr(e,n,1,-1)}function w1(n){var e=Pr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:mh,lastRenderedState:n},e.queue=n,n=n.dispatch=lk.bind(null,Pn,n),[e.memoizedState,n]}function fh(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Pn.updateQueue,e===null?(e={lastEffect:null,stores:null},Pn.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function WH(){return er().memoizedState}function Pm(n,e,t,i){var s=Pr();Pn.flags|=n,s.memoizedState=fh(1|e,t,void 0,i===void 0?null:i)}function tb(n,e,t,i){var s=er();i=i===void 0?null:i;var o=void 0;if(vi!==null){var r=vi.memoizedState;if(o=r.destroy,i!==null&&eZ(i,r.deps)){s.memoizedState=fh(e,t,o,i);return}}Pn.flags|=n,s.memoizedState=fh(1|e,t,o,i)}function Z1(n,e){return Pm(8390656,8,n,e)}function iZ(n,e){return tb(2048,8,n,e)}function MH(n,e){return tb(4,2,n,e)}function NH(n,e){return tb(4,4,n,e)}function FH(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function HH(n,e,t){return t=t!=null?t.concat([n]):null,tb(4,4,FH.bind(null,e,n),t)}function sZ(){}function XH(n,e){var t=er();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&eZ(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function TH(n,e){var t=er();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&eZ(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function EH(n,e,t){return Ec&21?(Sr(t,e)||(t=k9(),Pn.lanes|=t,Yc|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,eo=!0),n.memoizedState=t)}function rk(n,e){var t=yn;yn=t!==0&&4>t?t:4,n(!0);var i=NB.transition;NB.transition={};try{n(!1),e()}finally{yn=t,NB.transition=i}}function YH(){return er().memoizedState}function ak(n,e,t){var i=zl(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},KH(n))_H(e,t);else if(t=yH(n,e,t,i),t!==null){var s=Ts();wr(t,n,i,s),LH(t,e,i)}}function lk(n,e,t){var i=zl(n),s={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(KH(n))_H(e,s);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var r=e.lastRenderedState,a=o(r,t);if(s.hasEagerState=!0,s.eagerState=a,Sr(a,r)){var l=e.interleaved;l===null?(s.next=s,Ow(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}t=yH(n,e,s,i),t!==null&&(s=Ts(),wr(t,n,i,s),LH(t,e,i))}}function KH(n){var e=n.alternate;return n===Pn||e!==null&&e===Pn}function _H(n,e){TC=xf=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function LH(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Hw(n,t)}}var Vf={readContext:$o,useCallback:rs,useContext:rs,useEffect:rs,useImperativeHandle:rs,useInsertionEffect:rs,useLayoutEffect:rs,useMemo:rs,useReducer:rs,useRef:rs,useState:rs,useDebugValue:rs,useDeferredValue:rs,useTransition:rs,useMutableSource:rs,useSyncExternalStore:rs,useId:rs,unstable_isNewReconciler:!1},gk={readContext:$o,useCallback:function(n,e){return Pr().memoizedState=[n,e===void 0?null:e],n},useContext:$o,useEffect:Z1,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Pm(4194308,4,FH.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Pm(4194308,4,n,e)},useInsertionEffect:function(n,e){return Pm(4,2,n,e)},useMemo:function(n,e){var t=Pr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=Pr();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=ak.bind(null,Pn,n),[i.memoizedState,n]},useRef:function(n){var e=Pr();return n={current:n},e.memoizedState=n},useState:w1,useDebugValue:sZ,useDeferredValue:function(n){return Pr().memoizedState=n},useTransition:function(){var n=w1(!1),e=n[0];return n=rk.bind(null,n[1]),Pr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Pn,s=Pr();if(Kn){if(t===void 0)throw Error(Te(407));t=t()}else{if(t=e(),Xi===null)throw Error(Te(349));Ec&30||ZH(i,e,t)}s.memoizedState=t;var o={value:t,getSnapshot:e};return s.queue=o,Z1(RH.bind(null,i,o,n),[n]),i.flags|=2048,fh(9,SH.bind(null,i,o,t,e),void 0,null),t},useId:function(){var n=Pr(),e=Xi.identifierPrefix;if(Kn){var t=Ma,i=Wa;t=(i&~(1<<32-vr(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=ph++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=ok++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},ck={readContext:$o,useCallback:XH,useContext:$o,useEffect:iZ,useImperativeHandle:HH,useInsertionEffect:MH,useLayoutEffect:NH,useMemo:TH,useReducer:FB,useRef:WH,useState:function(){return FB(mh)},useDebugValue:sZ,useDeferredValue:function(n){var e=er();return EH(e,vi.memoizedState,n)},useTransition:function(){var n=FB(mh)[0],e=er().memoizedState;return[n,e]},useMutableSource:vH,useSyncExternalStore:wH,useId:YH,unstable_isNewReconciler:!1},uk={readContext:$o,useCallback:XH,useContext:$o,useEffect:iZ,useImperativeHandle:HH,useInsertionEffect:MH,useLayoutEffect:NH,useMemo:TH,useReducer:HB,useRef:WH,useState:function(){return HB(mh)},useDebugValue:sZ,useDeferredValue:function(n){var e=er();return vi===null?e.memoizedState=n:EH(e,vi.memoizedState,n)},useTransition:function(){var n=HB(mh)[0],e=er().memoizedState;return[n,e]},useMutableSource:vH,useSyncExternalStore:wH,useId:YH,unstable_isNewReconciler:!1};function Ar(n,e){if(n&&n.defaultProps){e=Jn({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Ov(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Jn({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var nb={isMounted:function(n){return(n=n._reactInternals)?tu(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Ts(),s=zl(n),o=Ta(i,s);o.payload=e,t!=null&&(o.callback=t),e=Ll(n,o,s),e!==null&&(wr(e,n,s,i),zm(e,n,s))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Ts(),s=zl(n),o=Ta(i,s);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=Ll(n,o,s),e!==null&&(wr(e,n,s,i),zm(e,n,s))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Ts(),i=zl(n),s=Ta(t,i);s.tag=2,e!=null&&(s.callback=e),e=Ll(n,s,i),e!==null&&(wr(e,n,i,t),zm(e,n,i))}};function S1(n,e,t,i,s,o,r){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,o,r):e.prototype&&e.prototype.isPureReactComponent?!uh(t,i)||!uh(s,o):!0}function kH(n,e,t){var i=!1,s=$l,o=e.contextType;return typeof o=="object"&&o!==null?o=$o(o):(s=so(e)?Xc:Bs.current,i=e.contextTypes,o=(i=i!=null)?TI(n,s):$l),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=nb,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=o),e}function R1(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&nb.enqueueReplaceState(e,e.state,null)}function Qv(n,e,t,i){var s=n.stateNode;s.props=t,s.state=n.memoizedState,s.refs={},Qw(n);var o=e.contextType;typeof o=="object"&&o!==null?s.context=$o(o):(o=so(e)?Xc:Bs.current,s.context=TI(n,o)),s.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Ov(n,e,o,t),s.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&nb.enqueueReplaceState(s,s.state,null),Sf(n,t,s,i),s.state=n.memoizedState),typeof s.componentDidMount=="function"&&(n.flags|=4194308)}function _I(n,e){try{var t="",i=e;do t+=Y_(i),i=i.return;while(i);var s=t}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:s,digest:null}}function XB(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function jv(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Ik=typeof WeakMap=="function"?WeakMap:Map;function zH(n,e,t){t=Ta(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){Mf||(Mf=!0,a2=i),jv(n,e)},t}function DH(n,e,t){t=Ta(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var s=e.value;t.payload=function(){return i(s)},t.callback=function(){jv(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){jv(n,e),typeof i!="function"&&(kl===null?kl=new Set([this]):kl.add(this));var r=e.stack;this.componentDidCatch(e.value,{componentStack:r!==null?r:""})}),t}function x1(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new Ik;var s=new Set;i.set(e,s)}else s=i.get(e),s===void 0&&(s=new Set,i.set(e,s));s.has(t)||(s.add(t),n=Zk.bind(null,n,e,t),e.then(n,n))}function V1(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function W1(n,e,t,i,s){return n.mode&1?(n.flags|=65536,n.lanes=s,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Ta(-1,1),e.tag=2,Ll(t,e,1))),t.lanes|=1),n)}var dk=nl.ReactCurrentOwner,eo=!1;function Ms(n,e,t,i){e.child=n===null?bH(e,null,t,i):YI(e,n.child,t,i)}function M1(n,e,t,i,s){t=t.render;var o=e.ref;return SI(e,s),i=tZ(n,e,t,i,o,s),t=nZ(),n!==null&&!eo?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ja(n,e,s)):(Kn&&t&&kw(e),e.flags|=1,Ms(n,e,i,s),e.child)}function N1(n,e,t,i,s){if(n===null){var o=t.type;return typeof o=="function"&&!IZ(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,PH(n,e,o,i,s)):(n=Qm(t.type,null,i,e,e.mode,s),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&s)){var r=o.memoizedProps;if(t=t.compare,t=t!==null?t:uh,t(r,i)&&n.ref===e.ref)return Ja(n,e,s)}return e.flags|=1,n=Dl(o,i),n.ref=e.ref,n.return=e,e.child=n}function PH(n,e,t,i,s){if(n!==null){var o=n.memoizedProps;if(uh(o,i)&&n.ref===e.ref)if(eo=!1,e.pendingProps=i=o,(n.lanes&s)!==0)n.flags&131072&&(eo=!0);else return e.lanes=n.lanes,Ja(n,e,s)}return qv(n,e,t,i,s)}function UH(n,e,t){var i=e.pendingProps,s=i.children,o=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mn(II,fo),fo|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Mn(II,fo),fo|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=o!==null?o.baseLanes:t,Mn(II,fo),fo|=i}else o!==null?(i=o.baseLanes|t,e.memoizedState=null):i=t,Mn(II,fo),fo|=i;return Ms(n,e,s,t),e.child}function JH(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function qv(n,e,t,i,s){var o=so(t)?Xc:Bs.current;return o=TI(e,o),SI(e,s),t=tZ(n,e,t,i,o,s),i=nZ(),n!==null&&!eo?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~s,Ja(n,e,s)):(Kn&&i&&kw(e),e.flags|=1,Ms(n,e,t,s),e.child)}function F1(n,e,t,i,s){if(so(t)){var o=!0;Bf(e)}else o=!1;if(SI(e,s),e.stateNode===null)Um(n,e),kH(e,t,i),Qv(e,t,i,s),i=!0;else if(n===null){var r=e.stateNode,a=e.memoizedProps;r.props=a;var l=r.context,g=t.contextType;typeof g=="object"&&g!==null?g=$o(g):(g=so(t)?Xc:Bs.current,g=TI(e,g));var c=t.getDerivedStateFromProps,u=typeof c=="function"||typeof r.getSnapshotBeforeUpdate=="function";u||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(a!==i||l!==g)&&R1(e,r,i,g),Wl=!1;var C=e.memoizedState;r.state=C,Sf(e,i,r,s),l=e.memoizedState,a!==i||C!==l||io.current||Wl?(typeof c=="function"&&(Ov(e,t,c,i),l=e.memoizedState),(a=Wl||S1(e,t,a,i,C,l,g))?(u||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount()),typeof r.componentDidMount=="function"&&(e.flags|=4194308)):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),r.props=i,r.state=l,r.context=g,i=a):(typeof r.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{r=e.stateNode,BH(n,e),a=e.memoizedProps,g=e.type===e.elementType?a:Ar(e.type,a),r.props=g,u=e.pendingProps,C=r.context,l=t.contextType,typeof l=="object"&&l!==null?l=$o(l):(l=so(t)?Xc:Bs.current,l=TI(e,l));var h=t.getDerivedStateFromProps;(c=typeof h=="function"||typeof r.getSnapshotBeforeUpdate=="function")||typeof r.UNSAFE_componentWillReceiveProps!="function"&&typeof r.componentWillReceiveProps!="function"||(a!==u||C!==l)&&R1(e,r,i,l),Wl=!1,C=e.memoizedState,r.state=C,Sf(e,i,r,s);var p=e.memoizedState;a!==u||C!==p||io.current||Wl?(typeof h=="function"&&(Ov(e,t,h,i),p=e.memoizedState),(g=Wl||S1(e,t,g,i,C,p,l)||!1)?(c||typeof r.UNSAFE_componentWillUpdate!="function"&&typeof r.componentWillUpdate!="function"||(typeof r.componentWillUpdate=="function"&&r.componentWillUpdate(i,p,l),typeof r.UNSAFE_componentWillUpdate=="function"&&r.UNSAFE_componentWillUpdate(i,p,l)),typeof r.componentDidUpdate=="function"&&(e.flags|=4),typeof r.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof r.componentDidUpdate!="function"||a===n.memoizedProps&&C===n.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&C===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),r.props=i,r.state=p,r.context=l,i=g):(typeof r.componentDidUpdate!="function"||a===n.memoizedProps&&C===n.memoizedState||(e.flags|=4),typeof r.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&C===n.memoizedState||(e.flags|=1024),i=!1)}return $v(n,e,t,i,o,s)}function $v(n,e,t,i,s,o){JH(n,e);var r=(e.flags&128)!==0;if(!i&&!r)return s&&f1(e,t,!1),Ja(n,e,o);i=e.stateNode,dk.current=e;var a=r&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&r?(e.child=YI(e,n.child,null,o),e.child=YI(e,null,a,o)):Ms(n,e,a,o),e.memoizedState=i.state,s&&f1(e,t,!0),e.child}function OH(n){var e=n.stateNode;e.pendingContext?m1(n,e.pendingContext,e.pendingContext!==e.context):e.context&&m1(n,e.context,!1),jw(n,e.containerInfo)}function H1(n,e,t,i,s){return EI(),Dw(s),e.flags|=256,Ms(n,e,t,i),e.child}var e2={dehydrated:null,treeContext:null,retryLane:0};function t2(n){return{baseLanes:n,cachePool:null,transitions:null}}function QH(n,e,t){var i=e.pendingProps,s=kn.current,o=!1,r=(e.flags&128)!==0,a;if((a=r)||(a=n!==null&&n.memoizedState===null?!1:(s&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(s|=1),Mn(kn,s&1),n===null)return Uv(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(r=i.children,n=i.fallback,o?(i=e.mode,o=e.child,r={mode:"hidden",children:r},!(i&1)&&o!==null?(o.childLanes=0,o.pendingProps=r):o=ob(r,i,0,null),n=Sc(n,i,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=t2(t),e.memoizedState=e2,n):oZ(e,r));if(s=n.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return Ck(n,e,r,i,a,s,t);if(o){o=i.fallback,r=e.mode,s=n.child,a=s.sibling;var l={mode:"hidden",children:i.children};return!(r&1)&&e.child!==s?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Dl(s,l),i.subtreeFlags=s.subtreeFlags&14680064),a!==null?o=Dl(a,o):(o=Sc(o,r,t,null),o.flags|=2),o.return=e,i.return=e,i.sibling=o,e.child=i,i=o,o=e.child,r=n.child.memoizedState,r=r===null?t2(t):{baseLanes:r.baseLanes|t,cachePool:null,transitions:r.transitions},o.memoizedState=r,o.childLanes=n.childLanes&~t,e.memoizedState=e2,i}return o=n.child,n=o.sibling,i=Dl(o,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function oZ(n,e){return e=ob({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function yp(n,e,t,i){return i!==null&&Dw(i),YI(e,n.child,null,t),n=oZ(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Ck(n,e,t,i,s,o,r){if(t)return e.flags&256?(e.flags&=-257,i=XB(Error(Te(422))),yp(n,e,r,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=i.fallback,s=e.mode,i=ob({mode:"visible",children:i.children},s,0,null),o=Sc(o,s,r,null),o.flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,e.mode&1&&YI(e,n.child,null,r),e.child.memoizedState=t2(r),e.memoizedState=e2,o);if(!(e.mode&1))return yp(n,e,r,null);if(s.data==="$!"){if(i=s.nextSibling&&s.nextSibling.dataset,i)var a=i.dgst;return i=a,o=Error(Te(419)),i=XB(o,i,void 0),yp(n,e,r,i)}if(a=(r&n.childLanes)!==0,eo||a){if(i=Xi,i!==null){switch(r&-r){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(i.suspendedLanes|r)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,Ua(n,s),wr(i,n,s,-1))}return uZ(),i=XB(Error(Te(421))),yp(n,e,r,i)}return s.data==="$?"?(e.flags|=128,e.child=n.child,e=Sk.bind(null,n),s._reactRetry=e,null):(n=o.treeContext,yo=_l(s.nextSibling),Bo=e,Kn=!0,fr=null,n!==null&&(Uo[Jo++]=Wa,Uo[Jo++]=Ma,Uo[Jo++]=Tc,Wa=n.id,Ma=n.overflow,Tc=e),e=oZ(e,i.children),e.flags|=4096,e)}function X1(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),Jv(n.return,e,t)}function TB(n,e,t,i,s){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=i,o.tail=t,o.tailMode=s)}function jH(n,e,t){var i=e.pendingProps,s=i.revealOrder,o=i.tail;if(Ms(n,e,i.children,t),i=kn.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&X1(n,t,e);else if(n.tag===19)X1(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(Mn(kn,i),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)n=t.alternate,n!==null&&Rf(n)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),TB(e,!1,s,t,o);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(n=s.alternate,n!==null&&Rf(n)===null){e.child=s;break}n=s.sibling,s.sibling=t,t=s,s=n}TB(e,!0,t,null,o);break;case"together":TB(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Um(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Ja(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Yc|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Te(153));if(e.child!==null){for(n=e.child,t=Dl(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Dl(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function hk(n,e,t){switch(e.tag){case 3:OH(e),EI();break;case 5:GH(e);break;case 1:so(e.type)&&Bf(e);break;case 4:jw(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,s=e.memoizedProps.value;Mn(wf,i._currentValue),i._currentValue=s;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(Mn(kn,kn.current&1),e.flags|=128,null):t&e.child.childLanes?QH(n,e,t):(Mn(kn,kn.current&1),n=Ja(n,e,t),n!==null?n.sibling:null);Mn(kn,kn.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return jH(n,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Mn(kn,kn.current),i)break;return null;case 22:case 23:return e.lanes=0,UH(n,e,t)}return Ja(n,e,t)}var qH,n2,$H,eX;qH=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};n2=function(){};$H=function(n,e,t,i){var s=n.memoizedProps;if(s!==i){n=e.stateNode,Ac($r.current);var o=null;switch(t){case"input":s=vv(n,s),i=vv(n,i),o=[];break;case"select":s=Jn({},s,{value:void 0}),i=Jn({},i,{value:void 0}),o=[];break;case"textarea":s=Sv(n,s),i=Sv(n,i),o=[];break;default:typeof s.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=bf)}xv(t,i);var r;t=null;for(g in s)if(!i.hasOwnProperty(g)&&s.hasOwnProperty(g)&&s[g]!=null)if(g==="style"){var a=s[g];for(r in a)a.hasOwnProperty(r)&&(t||(t={}),t[r]="")}else g!=="dangerouslySetInnerHTML"&&g!=="children"&&g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(sh.hasOwnProperty(g)?o||(o=[]):(o=o||[]).push(g,null));for(g in i){var l=i[g];if(a=s!=null?s[g]:void 0,i.hasOwnProperty(g)&&l!==a&&(l!=null||a!=null))if(g==="style")if(a){for(r in a)!a.hasOwnProperty(r)||l&&l.hasOwnProperty(r)||(t||(t={}),t[r]="");for(r in l)l.hasOwnProperty(r)&&a[r]!==l[r]&&(t||(t={}),t[r]=l[r])}else t||(o||(o=[]),o.push(g,t)),t=l;else g==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(g,l)):g==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(g,""+l):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&(sh.hasOwnProperty(g)?(l!=null&&g==="onScroll"&&Xn("scroll",n),o||a===l||(o=[])):(o=o||[]).push(g,l))}t&&(o=o||[]).push("style",t);var g=o;(e.updateQueue=g)&&(e.flags|=4)}};eX=function(n,e,t,i){t!==i&&(e.flags|=4)};function Jd(n,e){if(!Kn)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function as(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags&14680064,i|=s.flags&14680064,s.return=n,s=s.sibling;else for(s=n.child;s!==null;)t|=s.lanes|s.childLanes,i|=s.subtreeFlags,i|=s.flags,s.return=n,s=s.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function Ak(n,e,t){var i=e.pendingProps;switch(zw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return as(e),null;case 1:return so(e.type)&&yf(),as(e),null;case 3:return i=e.stateNode,KI(),Tn(io),Tn(Bs),$w(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(fp(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,fr!==null&&(c2(fr),fr=null))),n2(n,e),as(e),null;case 5:qw(e);var s=Ac(Ah.current);if(t=e.type,n!==null&&e.stateNode!=null)$H(n,e,t,i,s),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Te(166));return as(e),null}if(n=Ac($r.current),fp(e)){i=e.stateNode,t=e.type;var o=e.memoizedProps;switch(i[Qr]=e,i[Ch]=o,n=(e.mode&1)!==0,t){case"dialog":Xn("cancel",i),Xn("close",i);break;case"iframe":case"object":case"embed":Xn("load",i);break;case"video":case"audio":for(s=0;s<ZC.length;s++)Xn(ZC[s],i);break;case"source":Xn("error",i);break;case"img":case"image":case"link":Xn("error",i),Xn("load",i);break;case"details":Xn("toggle",i);break;case"input":Dx(i,o),Xn("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!o.multiple},Xn("invalid",i);break;case"textarea":Ux(i,o),Xn("invalid",i)}xv(t,o),s=null;for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];r==="children"?typeof a=="string"?i.textContent!==a&&(o.suppressHydrationWarning!==!0&&mp(i.textContent,a,n),s=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&mp(i.textContent,a,n),s=["children",""+a]):sh.hasOwnProperty(r)&&a!=null&&r==="onScroll"&&Xn("scroll",i)}switch(t){case"input":cp(i),Px(i,o,!0);break;case"textarea":cp(i),Jx(i);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(i.onclick=bf)}i=s,e.updateQueue=i,i!==null&&(e.flags|=4)}else{r=s.nodeType===9?s:s.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=R9(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=r.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=r.createElement(t,{is:i.is}):(n=r.createElement(t),t==="select"&&(r=n,i.multiple?r.multiple=!0:i.size&&(r.size=i.size))):n=r.createElementNS(n,t),n[Qr]=e,n[Ch]=i,qH(n,e,!1,!1),e.stateNode=n;e:{switch(r=Vv(t,i),t){case"dialog":Xn("cancel",n),Xn("close",n),s=i;break;case"iframe":case"object":case"embed":Xn("load",n),s=i;break;case"video":case"audio":for(s=0;s<ZC.length;s++)Xn(ZC[s],n);s=i;break;case"source":Xn("error",n),s=i;break;case"img":case"image":case"link":Xn("error",n),Xn("load",n),s=i;break;case"details":Xn("toggle",n),s=i;break;case"input":Dx(n,i),s=vv(n,i),Xn("invalid",n);break;case"option":s=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},s=Jn({},i,{value:void 0}),Xn("invalid",n);break;case"textarea":Ux(n,i),s=Sv(n,i),Xn("invalid",n);break;default:s=i}xv(t,s),a=s;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?W9(n,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&x9(n,l)):o==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&oh(n,l):typeof l=="number"&&oh(n,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(sh.hasOwnProperty(o)?l!=null&&o==="onScroll"&&Xn("scroll",n):l!=null&&xw(n,o,l,r))}switch(t){case"input":cp(n),Px(n,i,!1);break;case"textarea":cp(n),Jx(n);break;case"option":i.value!=null&&n.setAttribute("value",""+ql(i.value));break;case"select":n.multiple=!!i.multiple,o=i.value,o!=null?GI(n,!!i.multiple,o,!1):i.defaultValue!=null&&GI(n,!!i.multiple,i.defaultValue,!0);break;default:typeof s.onClick=="function"&&(n.onclick=bf)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return as(e),null;case 6:if(n&&e.stateNode!=null)eX(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Te(166));if(t=Ac(Ah.current),Ac($r.current),fp(e)){if(i=e.stateNode,t=e.memoizedProps,i[Qr]=e,(o=i.nodeValue!==t)&&(n=Bo,n!==null))switch(n.tag){case 3:mp(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&mp(i.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Qr]=e,e.stateNode=i}return as(e),null;case 13:if(Tn(kn),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Kn&&yo!==null&&e.mode&1&&!(e.flags&128))mH(),EI(),e.flags|=98560,o=!1;else if(o=fp(e),i!==null&&i.dehydrated!==null){if(n===null){if(!o)throw Error(Te(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Te(317));o[Qr]=e}else EI(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;as(e),o=!1}else fr!==null&&(c2(fr),fr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||kn.current&1?wi===0&&(wi=3):uZ())),e.updateQueue!==null&&(e.flags|=4),as(e),null);case 4:return KI(),n2(n,e),n===null&&Ih(e.stateNode.containerInfo),as(e),null;case 10:return Jw(e.type._context),as(e),null;case 17:return so(e.type)&&yf(),as(e),null;case 19:if(Tn(kn),o=e.memoizedState,o===null)return as(e),null;if(i=(e.flags&128)!==0,r=o.rendering,r===null)if(i)Jd(o,!1);else{if(wi!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(r=Rf(n),r!==null){for(e.flags|=128,Jd(o,!1),i=r.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)o=t,n=i,o.flags&=14680066,r=o.alternate,r===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,o.type=r.type,n=r.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Mn(kn,kn.current&1|2),e.child}n=n.sibling}o.tail!==null&&ui()>LI&&(e.flags|=128,i=!0,Jd(o,!1),e.lanes=4194304)}else{if(!i)if(n=Rf(r),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Jd(o,!0),o.tail===null&&o.tailMode==="hidden"&&!r.alternate&&!Kn)return as(e),null}else 2*ui()-o.renderingStartTime>LI&&t!==1073741824&&(e.flags|=128,i=!0,Jd(o,!1),e.lanes=4194304);o.isBackwards?(r.sibling=e.child,e.child=r):(t=o.last,t!==null?t.sibling=r:e.child=r,o.last=r)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=ui(),e.sibling=null,t=kn.current,Mn(kn,i?t&1|2:t&1),e):(as(e),null);case 22:case 23:return cZ(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?fo&1073741824&&(as(e),e.subtreeFlags&6&&(e.flags|=8192)):as(e),null;case 24:return null;case 25:return null}throw Error(Te(156,e.tag))}function pk(n,e){switch(zw(e),e.tag){case 1:return so(e.type)&&yf(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return KI(),Tn(io),Tn(Bs),$w(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return qw(e),null;case 13:if(Tn(kn),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Te(340));EI()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Tn(kn),null;case 4:return KI(),null;case 10:return Jw(e.type._context),null;case 22:case 23:return cZ(),null;case 24:return null;default:return null}}var Bp=!1,ps=!1,mk=typeof WeakSet=="function"?WeakSet:Set,gt=null;function uI(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){$n(n,e,i)}else t.current=null}function i2(n,e,t){try{t()}catch(i){$n(n,e,i)}}var T1=!1;function fk(n,e){if(Kv=pf,n=oH(),Lw(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var s=i.anchorOffset,o=i.focusNode;i=i.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var r=0,a=-1,l=-1,g=0,c=0,u=n,C=null;t:for(;;){for(var h;u!==t||s!==0&&u.nodeType!==3||(a=r+s),u!==o||i!==0&&u.nodeType!==3||(l=r+i),u.nodeType===3&&(r+=u.nodeValue.length),(h=u.firstChild)!==null;)C=u,u=h;for(;;){if(u===n)break t;if(C===t&&++g===s&&(a=r),C===o&&++c===i&&(l=r),(h=u.nextSibling)!==null)break;u=C,C=u.parentNode}u=h}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(_v={focusedElem:n,selectionRange:t},pf=!1,gt=e;gt!==null;)if(e=gt,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,gt=n;else for(;gt!==null;){e=gt;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var b=p.memoizedProps,m=p.memoizedState,A=e.stateNode,B=A.getSnapshotBeforeUpdate(e.elementType===e.type?b:Ar(e.type,b),m);A.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var G=e.stateNode.containerInfo;G.nodeType===1?G.textContent="":G.nodeType===9&&G.documentElement&&G.removeChild(G.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Te(163))}}catch(w){$n(e,e.return,w)}if(n=e.sibling,n!==null){n.return=e.return,gt=n;break}gt=e.return}return p=T1,T1=!1,p}function EC(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var s=i=i.next;do{if((s.tag&n)===n){var o=s.destroy;s.destroy=void 0,o!==void 0&&i2(e,t,o)}s=s.next}while(s!==i)}}function ib(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function s2(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function tX(n){var e=n.alternate;e!==null&&(n.alternate=null,tX(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Qr],delete e[Ch],delete e[zv],delete e[tk],delete e[nk])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function nX(n){return n.tag===5||n.tag===3||n.tag===4}function E1(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||nX(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function o2(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=bf));else if(i!==4&&(n=n.child,n!==null))for(o2(n,e,t),n=n.sibling;n!==null;)o2(n,e,t),n=n.sibling}function r2(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(r2(n,e,t),n=n.sibling;n!==null;)r2(n,e,t),n=n.sibling}var _i=null,mr=!1;function Al(n,e,t){for(t=t.child;t!==null;)iX(n,e,t),t=t.sibling}function iX(n,e,t){if(qr&&typeof qr.onCommitFiberUnmount=="function")try{qr.onCommitFiberUnmount(O0,t)}catch{}switch(t.tag){case 5:ps||uI(t,e);case 6:var i=_i,s=mr;_i=null,Al(n,e,t),_i=i,mr=s,_i!==null&&(mr?(n=_i,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):_i.removeChild(t.stateNode));break;case 18:_i!==null&&(mr?(n=_i,t=t.stateNode,n.nodeType===8?VB(n.parentNode,t):n.nodeType===1&&VB(n,t),gh(n)):VB(_i,t.stateNode));break;case 4:i=_i,s=mr,_i=t.stateNode.containerInfo,mr=!0,Al(n,e,t),_i=i,mr=s;break;case 0:case 11:case 14:case 15:if(!ps&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){s=i=i.next;do{var o=s,r=o.destroy;o=o.tag,r!==void 0&&(o&2||o&4)&&i2(t,e,r),s=s.next}while(s!==i)}Al(n,e,t);break;case 1:if(!ps&&(uI(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){$n(t,e,a)}Al(n,e,t);break;case 21:Al(n,e,t);break;case 22:t.mode&1?(ps=(i=ps)||t.memoizedState!==null,Al(n,e,t),ps=i):Al(n,e,t);break;default:Al(n,e,t)}}function Y1(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new mk),e.forEach(function(i){var s=Rk.bind(null,n,i);t.has(i)||(t.add(i),i.then(s,s))})}}function cr(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var s=t[i];try{var o=n,r=e,a=r;e:for(;a!==null;){switch(a.tag){case 5:_i=a.stateNode,mr=!1;break e;case 3:_i=a.stateNode.containerInfo,mr=!0;break e;case 4:_i=a.stateNode.containerInfo,mr=!0;break e}a=a.return}if(_i===null)throw Error(Te(160));iX(o,r,s),_i=null,mr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(g){$n(s,e,g)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)sX(e,n),e=e.sibling}function sX(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(cr(e,n),_r(n),i&4){try{EC(3,n,n.return),ib(3,n)}catch(b){$n(n,n.return,b)}try{EC(5,n,n.return)}catch(b){$n(n,n.return,b)}}break;case 1:cr(e,n),_r(n),i&512&&t!==null&&uI(t,t.return);break;case 5:if(cr(e,n),_r(n),i&512&&t!==null&&uI(t,t.return),n.flags&32){var s=n.stateNode;try{oh(s,"")}catch(b){$n(n,n.return,b)}}if(i&4&&(s=n.stateNode,s!=null)){var o=n.memoizedProps,r=t!==null?t.memoizedProps:o,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Z9(s,o),Vv(a,r);var g=Vv(a,o);for(r=0;r<l.length;r+=2){var c=l[r],u=l[r+1];c==="style"?W9(s,u):c==="dangerouslySetInnerHTML"?x9(s,u):c==="children"?oh(s,u):xw(s,c,u,g)}switch(a){case"input":wv(s,o);break;case"textarea":S9(s,o);break;case"select":var C=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var h=o.value;h!=null?GI(s,!!o.multiple,h,!1):C!==!!o.multiple&&(o.defaultValue!=null?GI(s,!!o.multiple,o.defaultValue,!0):GI(s,!!o.multiple,o.multiple?[]:"",!1))}s[Ch]=o}catch(b){$n(n,n.return,b)}}break;case 6:if(cr(e,n),_r(n),i&4){if(n.stateNode===null)throw Error(Te(162));s=n.stateNode,o=n.memoizedProps;try{s.nodeValue=o}catch(b){$n(n,n.return,b)}}break;case 3:if(cr(e,n),_r(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{gh(e.containerInfo)}catch(b){$n(n,n.return,b)}break;case 4:cr(e,n),_r(n);break;case 13:cr(e,n),_r(n),s=n.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(lZ=ui())),i&4&&Y1(n);break;case 22:if(c=t!==null&&t.memoizedState!==null,n.mode&1?(ps=(g=ps)||c,cr(e,n),ps=g):cr(e,n),_r(n),i&8192){if(g=n.memoizedState!==null,(n.stateNode.isHidden=g)&&!c&&n.mode&1)for(gt=n,c=n.child;c!==null;){for(u=gt=c;gt!==null;){switch(C=gt,h=C.child,C.tag){case 0:case 11:case 14:case 15:EC(4,C,C.return);break;case 1:uI(C,C.return);var p=C.stateNode;if(typeof p.componentWillUnmount=="function"){i=C,t=C.return;try{e=i,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(b){$n(i,t,b)}}break;case 5:uI(C,C.return);break;case 22:if(C.memoizedState!==null){_1(u);continue}}h!==null?(h.return=C,gt=h):_1(u)}c=c.sibling}e:for(c=null,u=n;;){if(u.tag===5){if(c===null){c=u;try{s=u.stateNode,g?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=u.stateNode,l=u.memoizedProps.style,r=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=V9("display",r))}catch(b){$n(n,n.return,b)}}}else if(u.tag===6){if(c===null)try{u.stateNode.nodeValue=g?"":u.memoizedProps}catch(b){$n(n,n.return,b)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===n)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===n)break e;for(;u.sibling===null;){if(u.return===null||u.return===n)break e;c===u&&(c=null),u=u.return}c===u&&(c=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:cr(e,n),_r(n),i&4&&Y1(n);break;case 21:break;default:cr(e,n),_r(n)}}function _r(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(nX(t)){var i=t;break e}t=t.return}throw Error(Te(160))}switch(i.tag){case 5:var s=i.stateNode;i.flags&32&&(oh(s,""),i.flags&=-33);var o=E1(n);r2(n,o,s);break;case 3:case 4:var r=i.stateNode.containerInfo,a=E1(n);o2(n,a,r);break;default:throw Error(Te(161))}}catch(l){$n(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function bk(n,e,t){gt=n,oX(n)}function oX(n,e,t){for(var i=(n.mode&1)!==0;gt!==null;){var s=gt,o=s.child;if(s.tag===22&&i){var r=s.memoizedState!==null||Bp;if(!r){var a=s.alternate,l=a!==null&&a.memoizedState!==null||ps;a=Bp;var g=ps;if(Bp=r,(ps=l)&&!g)for(gt=s;gt!==null;)r=gt,l=r.child,r.tag===22&&r.memoizedState!==null?L1(s):l!==null?(l.return=r,gt=l):L1(s);for(;o!==null;)gt=o,oX(o),o=o.sibling;gt=s,Bp=a,ps=g}K1(n)}else s.subtreeFlags&8772&&o!==null?(o.return=s,gt=o):K1(n)}}function K1(n){for(;gt!==null;){var e=gt;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ps||ib(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!ps)if(t===null)i.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:Ar(e.type,t.memoizedProps);i.componentDidUpdate(s,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&v1(e,o,i);break;case 3:var r=e.updateQueue;if(r!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}v1(e,r,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var g=e.alternate;if(g!==null){var c=g.memoizedState;if(c!==null){var u=c.dehydrated;u!==null&&gh(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Te(163))}ps||e.flags&512&&s2(e)}catch(C){$n(e,e.return,C)}}if(e===n){gt=null;break}if(t=e.sibling,t!==null){t.return=e.return,gt=t;break}gt=e.return}}function _1(n){for(;gt!==null;){var e=gt;if(e===n){gt=null;break}var t=e.sibling;if(t!==null){t.return=e.return,gt=t;break}gt=e.return}}function L1(n){for(;gt!==null;){var e=gt;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ib(4,e)}catch(l){$n(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var s=e.return;try{i.componentDidMount()}catch(l){$n(e,s,l)}}var o=e.return;try{s2(e)}catch(l){$n(e,o,l)}break;case 5:var r=e.return;try{s2(e)}catch(l){$n(e,r,l)}}}catch(l){$n(e,e.return,l)}if(e===n){gt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,gt=a;break}gt=e.return}}var yk=Math.ceil,Wf=nl.ReactCurrentDispatcher,rZ=nl.ReactCurrentOwner,jo=nl.ReactCurrentBatchConfig,dn=0,Xi=null,yi=null,Ui=0,fo=0,II=ug(0),wi=0,bh=null,Yc=0,sb=0,aZ=0,YC=null,qs=null,lZ=0,LI=1/0,wa=null,Mf=!1,a2=null,kl=null,Gp=!1,Xl=null,Nf=0,KC=0,l2=null,Jm=-1,Om=0;function Ts(){return dn&6?ui():Jm!==-1?Jm:Jm=ui()}function zl(n){return n.mode&1?dn&2&&Ui!==0?Ui&-Ui:sk.transition!==null?(Om===0&&(Om=k9()),Om):(n=yn,n!==0||(n=window.event,n=n===void 0?16:Q9(n.type)),n):1}function wr(n,e,t,i){if(50<KC)throw KC=0,l2=null,Error(Te(185));jh(n,t,i),(!(dn&2)||n!==Xi)&&(n===Xi&&(!(dn&2)&&(sb|=t),wi===4&&Nl(n,Ui)),oo(n,i),t===1&&dn===0&&!(e.mode&1)&&(LI=ui()+500,eb&&Ig()))}function oo(n,e){var t=n.callbackNode;sL(n,e);var i=Af(n,n===Xi?Ui:0);if(i===0)t!==null&&jx(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&jx(t),e===1)n.tag===0?ik(k1.bind(null,n)):hH(k1.bind(null,n)),$L(function(){!(dn&6)&&Ig()}),t=null;else{switch(z9(i)){case 1:t=Fw;break;case 4:t=_9;break;case 16:t=hf;break;case 536870912:t=L9;break;default:t=hf}t=dX(t,rX.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function rX(n,e){if(Jm=-1,Om=0,dn&6)throw Error(Te(327));var t=n.callbackNode;if(RI()&&n.callbackNode!==t)return null;var i=Af(n,n===Xi?Ui:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Ff(n,i);else{e=i;var s=dn;dn|=2;var o=lX();(Xi!==n||Ui!==e)&&(wa=null,LI=ui()+500,Zc(n,e));do try{vk();break}catch(a){aX(n,a)}while(!0);Uw(),Wf.current=o,dn=s,yi!==null?e=0:(Xi=null,Ui=0,e=wi)}if(e!==0){if(e===2&&(s=Hv(n),s!==0&&(i=s,e=g2(n,s))),e===1)throw t=bh,Zc(n,0),Nl(n,i),oo(n,ui()),t;if(e===6)Nl(n,i);else{if(s=n.current.alternate,!(i&30)&&!Bk(s)&&(e=Ff(n,i),e===2&&(o=Hv(n),o!==0&&(i=o,e=g2(n,o))),e===1))throw t=bh,Zc(n,0),Nl(n,i),oo(n,ui()),t;switch(n.finishedWork=s,n.finishedLanes=i,e){case 0:case 1:throw Error(Te(345));case 2:ic(n,qs,wa);break;case 3:if(Nl(n,i),(i&130023424)===i&&(e=lZ+500-ui(),10<e)){if(Af(n,0)!==0)break;if(s=n.suspendedLanes,(s&i)!==i){Ts(),n.pingedLanes|=n.suspendedLanes&s;break}n.timeoutHandle=kv(ic.bind(null,n,qs,wa),e);break}ic(n,qs,wa);break;case 4:if(Nl(n,i),(i&4194240)===i)break;for(e=n.eventTimes,s=-1;0<i;){var r=31-vr(i);o=1<<r,r=e[r],r>s&&(s=r),i&=~o}if(i=s,i=ui()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*yk(i/1960))-i,10<i){n.timeoutHandle=kv(ic.bind(null,n,qs,wa),i);break}ic(n,qs,wa);break;case 5:ic(n,qs,wa);break;default:throw Error(Te(329))}}}return oo(n,ui()),n.callbackNode===t?rX.bind(null,n):null}function g2(n,e){var t=YC;return n.current.memoizedState.isDehydrated&&(Zc(n,e).flags|=256),n=Ff(n,e),n!==2&&(e=qs,qs=t,e!==null&&c2(e)),n}function c2(n){qs===null?qs=n:qs.push.apply(qs,n)}function Bk(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var s=t[i],o=s.getSnapshot;s=s.value;try{if(!Sr(o(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Nl(n,e){for(e&=~aZ,e&=~sb,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-vr(e),i=1<<t;n[t]=-1,e&=~i}}function k1(n){if(dn&6)throw Error(Te(327));RI();var e=Af(n,0);if(!(e&1))return oo(n,ui()),null;var t=Ff(n,e);if(n.tag!==0&&t===2){var i=Hv(n);i!==0&&(e=i,t=g2(n,i))}if(t===1)throw t=bh,Zc(n,0),Nl(n,e),oo(n,ui()),t;if(t===6)throw Error(Te(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ic(n,qs,wa),oo(n,ui()),null}function gZ(n,e){var t=dn;dn|=1;try{return n(e)}finally{dn=t,dn===0&&(LI=ui()+500,eb&&Ig())}}function Kc(n){Xl!==null&&Xl.tag===0&&!(dn&6)&&RI();var e=dn;dn|=1;var t=jo.transition,i=yn;try{if(jo.transition=null,yn=1,n)return n()}finally{yn=i,jo.transition=t,dn=e,!(dn&6)&&Ig()}}function cZ(){fo=II.current,Tn(II)}function Zc(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,qL(t)),yi!==null)for(t=yi.return;t!==null;){var i=t;switch(zw(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&yf();break;case 3:KI(),Tn(io),Tn(Bs),$w();break;case 5:qw(i);break;case 4:KI();break;case 13:Tn(kn);break;case 19:Tn(kn);break;case 10:Jw(i.type._context);break;case 22:case 23:cZ()}t=t.return}if(Xi=n,yi=n=Dl(n.current,null),Ui=fo=e,wi=0,bh=null,aZ=sb=Yc=0,qs=YC=null,hc!==null){for(e=0;e<hc.length;e++)if(t=hc[e],i=t.interleaved,i!==null){t.interleaved=null;var s=i.next,o=t.pending;if(o!==null){var r=o.next;o.next=s,i.next=r}t.pending=i}hc=null}return n}function aX(n,e){do{var t=yi;try{if(Uw(),Dm.current=Vf,xf){for(var i=Pn.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}xf=!1}if(Ec=0,Ni=vi=Pn=null,TC=!1,ph=0,rZ.current=null,t===null||t.return===null){wi=1,bh=e,yi=null;break}e:{var o=n,r=t.return,a=t,l=e;if(e=Ui,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var g=l,c=a,u=c.tag;if(!(c.mode&1)&&(u===0||u===11||u===15)){var C=c.alternate;C?(c.updateQueue=C.updateQueue,c.memoizedState=C.memoizedState,c.lanes=C.lanes):(c.updateQueue=null,c.memoizedState=null)}var h=V1(r);if(h!==null){h.flags&=-257,W1(h,r,a,o,e),h.mode&1&&x1(o,g,e),e=h,l=g;var p=e.updateQueue;if(p===null){var b=new Set;b.add(l),e.updateQueue=b}else p.add(l);break e}else{if(!(e&1)){x1(o,g,e),uZ();break e}l=Error(Te(426))}}else if(Kn&&a.mode&1){var m=V1(r);if(m!==null){!(m.flags&65536)&&(m.flags|=256),W1(m,r,a,o,e),Dw(_I(l,a));break e}}o=l=_I(l,a),wi!==4&&(wi=2),YC===null?YC=[o]:YC.push(o),o=r;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var A=zH(o,l,e);G1(o,A);break e;case 1:a=l;var B=o.type,G=o.stateNode;if(!(o.flags&128)&&(typeof B.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(kl===null||!kl.has(G)))){o.flags|=65536,e&=-e,o.lanes|=e;var w=DH(o,a,e);G1(o,w);break e}}o=o.return}while(o!==null)}cX(t)}catch(N){e=N,yi===t&&t!==null&&(yi=t=t.return);continue}break}while(!0)}function lX(){var n=Wf.current;return Wf.current=Vf,n===null?Vf:n}function uZ(){(wi===0||wi===3||wi===2)&&(wi=4),Xi===null||!(Yc&268435455)&&!(sb&268435455)||Nl(Xi,Ui)}function Ff(n,e){var t=dn;dn|=2;var i=lX();(Xi!==n||Ui!==e)&&(wa=null,Zc(n,e));do try{Gk();break}catch(s){aX(n,s)}while(!0);if(Uw(),dn=t,Wf.current=i,yi!==null)throw Error(Te(261));return Xi=null,Ui=0,wi}function Gk(){for(;yi!==null;)gX(yi)}function vk(){for(;yi!==null&&!O_();)gX(yi)}function gX(n){var e=IX(n.alternate,n,fo);n.memoizedProps=n.pendingProps,e===null?cX(n):yi=e,rZ.current=null}function cX(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=pk(t,e),t!==null){t.flags&=32767,yi=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{wi=6,yi=null;return}}else if(t=Ak(t,e,fo),t!==null){yi=t;return}if(e=e.sibling,e!==null){yi=e;return}yi=e=n}while(e!==null);wi===0&&(wi=5)}function ic(n,e,t){var i=yn,s=jo.transition;try{jo.transition=null,yn=1,wk(n,e,t,i)}finally{jo.transition=s,yn=i}return null}function wk(n,e,t,i){do RI();while(Xl!==null);if(dn&6)throw Error(Te(327));t=n.finishedWork;var s=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Te(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(oL(n,o),n===Xi&&(yi=Xi=null,Ui=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Gp||(Gp=!0,dX(hf,function(){return RI(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=jo.transition,jo.transition=null;var r=yn;yn=1;var a=dn;dn|=4,rZ.current=null,fk(n,t),sX(t,n),DL(_v),pf=!!Kv,_v=Kv=null,n.current=t,bk(t),Q_(),dn=a,yn=r,jo.transition=o}else n.current=t;if(Gp&&(Gp=!1,Xl=n,Nf=s),o=n.pendingLanes,o===0&&(kl=null),$_(t.stateNode),oo(n,ui()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)s=e[t],i(s.value,{componentStack:s.stack,digest:s.digest});if(Mf)throw Mf=!1,n=a2,a2=null,n;return Nf&1&&n.tag!==0&&RI(),o=n.pendingLanes,o&1?n===l2?KC++:(KC=0,l2=n):KC=0,Ig(),null}function RI(){if(Xl!==null){var n=z9(Nf),e=jo.transition,t=yn;try{if(jo.transition=null,yn=16>n?16:n,Xl===null)var i=!1;else{if(n=Xl,Xl=null,Nf=0,dn&6)throw Error(Te(331));var s=dn;for(dn|=4,gt=n.current;gt!==null;){var o=gt,r=o.child;if(gt.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var g=a[l];for(gt=g;gt!==null;){var c=gt;switch(c.tag){case 0:case 11:case 15:EC(8,c,o)}var u=c.child;if(u!==null)u.return=c,gt=u;else for(;gt!==null;){c=gt;var C=c.sibling,h=c.return;if(tX(c),c===g){gt=null;break}if(C!==null){C.return=h,gt=C;break}gt=h}}}var p=o.alternate;if(p!==null){var b=p.child;if(b!==null){p.child=null;do{var m=b.sibling;b.sibling=null,b=m}while(b!==null)}}gt=o}}if(o.subtreeFlags&2064&&r!==null)r.return=o,gt=r;else e:for(;gt!==null;){if(o=gt,o.flags&2048)switch(o.tag){case 0:case 11:case 15:EC(9,o,o.return)}var A=o.sibling;if(A!==null){A.return=o.return,gt=A;break e}gt=o.return}}var B=n.current;for(gt=B;gt!==null;){r=gt;var G=r.child;if(r.subtreeFlags&2064&&G!==null)G.return=r,gt=G;else e:for(r=B;gt!==null;){if(a=gt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ib(9,a)}}catch(N){$n(a,a.return,N)}if(a===r){gt=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,gt=w;break e}gt=a.return}}if(dn=s,Ig(),qr&&typeof qr.onPostCommitFiberRoot=="function")try{qr.onPostCommitFiberRoot(O0,n)}catch{}i=!0}return i}finally{yn=t,jo.transition=e}}return!1}function z1(n,e,t){e=_I(t,e),e=zH(n,e,1),n=Ll(n,e,1),e=Ts(),n!==null&&(jh(n,1,e),oo(n,e))}function $n(n,e,t){if(n.tag===3)z1(n,n,t);else for(;e!==null;){if(e.tag===3){z1(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(kl===null||!kl.has(i))){n=_I(t,n),n=DH(e,n,1),e=Ll(e,n,1),n=Ts(),e!==null&&(jh(e,1,n),oo(e,n));break}}e=e.return}}function Zk(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Ts(),n.pingedLanes|=n.suspendedLanes&t,Xi===n&&(Ui&t)===t&&(wi===4||wi===3&&(Ui&130023424)===Ui&&500>ui()-lZ?Zc(n,0):aZ|=t),oo(n,e)}function uX(n,e){e===0&&(n.mode&1?(e=dp,dp<<=1,!(dp&130023424)&&(dp=4194304)):e=1);var t=Ts();n=Ua(n,e),n!==null&&(jh(n,e,t),oo(n,t))}function Sk(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),uX(n,t)}function Rk(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,s=n.memoizedState;s!==null&&(t=s.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(Te(314))}i!==null&&i.delete(e),uX(n,t)}var IX;IX=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||io.current)eo=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return eo=!1,hk(n,e,t);eo=!!(n.flags&131072)}else eo=!1,Kn&&e.flags&1048576&&AH(e,vf,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;Um(n,e),n=e.pendingProps;var s=TI(e,Bs.current);SI(e,t),s=tZ(null,e,i,n,s,t);var o=nZ();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,so(i)?(o=!0,Bf(e)):o=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Qw(e),s.updater=nb,e.stateNode=s,s._reactInternals=e,Qv(e,i,n,t),e=$v(null,e,i,!0,o,t)):(e.tag=0,Kn&&o&&kw(e),Ms(null,e,s,t),e=e.child),e;case 16:i=e.elementType;e:{switch(Um(n,e),n=e.pendingProps,s=i._init,i=s(i._payload),e.type=i,s=e.tag=Vk(i),n=Ar(i,n),s){case 0:e=qv(null,e,i,n,t);break e;case 1:e=F1(null,e,i,n,t);break e;case 11:e=M1(null,e,i,n,t);break e;case 14:e=N1(null,e,i,Ar(i.type,n),t);break e}throw Error(Te(306,i,""))}return e;case 0:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Ar(i,s),qv(n,e,i,s,t);case 1:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Ar(i,s),F1(n,e,i,s,t);case 3:e:{if(OH(e),n===null)throw Error(Te(387));i=e.pendingProps,o=e.memoizedState,s=o.element,BH(n,e),Sf(e,i,null,t);var r=e.memoizedState;if(i=r.element,o.isDehydrated)if(o={element:i,isDehydrated:!1,cache:r.cache,pendingSuspenseBoundaries:r.pendingSuspenseBoundaries,transitions:r.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){s=_I(Error(Te(423)),e),e=H1(n,e,i,t,s);break e}else if(i!==s){s=_I(Error(Te(424)),e),e=H1(n,e,i,t,s);break e}else for(yo=_l(e.stateNode.containerInfo.firstChild),Bo=e,Kn=!0,fr=null,t=bH(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(EI(),i===s){e=Ja(n,e,t);break e}Ms(n,e,i,t)}e=e.child}return e;case 5:return GH(e),n===null&&Uv(e),i=e.type,s=e.pendingProps,o=n!==null?n.memoizedProps:null,r=s.children,Lv(i,s)?r=null:o!==null&&Lv(i,o)&&(e.flags|=32),JH(n,e),Ms(n,e,r,t),e.child;case 6:return n===null&&Uv(e),null;case 13:return QH(n,e,t);case 4:return jw(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=YI(e,null,i,t):Ms(n,e,i,t),e.child;case 11:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Ar(i,s),M1(n,e,i,s,t);case 7:return Ms(n,e,e.pendingProps,t),e.child;case 8:return Ms(n,e,e.pendingProps.children,t),e.child;case 12:return Ms(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,s=e.pendingProps,o=e.memoizedProps,r=s.value,Mn(wf,i._currentValue),i._currentValue=r,o!==null)if(Sr(o.value,r)){if(o.children===s.children&&!io.current){e=Ja(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){r=o.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(o.tag===1){l=Ta(-1,t&-t),l.tag=2;var g=o.updateQueue;if(g!==null){g=g.shared;var c=g.pending;c===null?l.next=l:(l.next=c.next,c.next=l),g.pending=l}}o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),Jv(o.return,t,e),a.lanes|=t;break}l=l.next}}else if(o.tag===10)r=o.type===e.type?null:o.child;else if(o.tag===18){if(r=o.return,r===null)throw Error(Te(341));r.lanes|=t,a=r.alternate,a!==null&&(a.lanes|=t),Jv(r,t,e),r=o.sibling}else r=o.child;if(r!==null)r.return=o;else for(r=o;r!==null;){if(r===e){r=null;break}if(o=r.sibling,o!==null){o.return=r.return,r=o;break}r=r.return}o=r}Ms(n,e,s.children,t),e=e.child}return e;case 9:return s=e.type,i=e.pendingProps.children,SI(e,t),s=$o(s),i=i(s),e.flags|=1,Ms(n,e,i,t),e.child;case 14:return i=e.type,s=Ar(i,e.pendingProps),s=Ar(i.type,s),N1(n,e,i,s,t);case 15:return PH(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,s=e.pendingProps,s=e.elementType===i?s:Ar(i,s),Um(n,e),e.tag=1,so(i)?(n=!0,Bf(e)):n=!1,SI(e,t),kH(e,i,s),Qv(e,i,s,t),$v(null,e,i,!0,n,t);case 19:return jH(n,e,t);case 22:return UH(n,e,t)}throw Error(Te(156,e.tag))};function dX(n,e){return K9(n,e)}function xk(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Oo(n,e,t,i){return new xk(n,e,t,i)}function IZ(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Vk(n){if(typeof n=="function")return IZ(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Ww)return 11;if(n===Mw)return 14}return 2}function Dl(n,e){var t=n.alternate;return t===null?(t=Oo(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Qm(n,e,t,i,s,o){var r=2;if(i=n,typeof n=="function")IZ(n)&&(r=1);else if(typeof n=="string")r=5;else e:switch(n){case nI:return Sc(t.children,s,o,e);case Vw:r=8,s|=8;break;case bv:return n=Oo(12,t,e,s|2),n.elementType=bv,n.lanes=o,n;case yv:return n=Oo(13,t,e,s),n.elementType=yv,n.lanes=o,n;case Bv:return n=Oo(19,t,e,s),n.elementType=Bv,n.lanes=o,n;case G9:return ob(t,s,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case y9:r=10;break e;case B9:r=9;break e;case Ww:r=11;break e;case Mw:r=14;break e;case Vl:r=16,i=null;break e}throw Error(Te(130,n==null?n:typeof n,""))}return e=Oo(r,t,e,s),e.elementType=n,e.type=i,e.lanes=o,e}function Sc(n,e,t,i){return n=Oo(7,n,i,e),n.lanes=t,n}function ob(n,e,t,i){return n=Oo(22,n,i,e),n.elementType=G9,n.lanes=t,n.stateNode={isHidden:!1},n}function EB(n,e,t){return n=Oo(6,n,null,e),n.lanes=t,n}function YB(n,e,t){return e=Oo(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Wk(n,e,t,i,s){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fB(0),this.expirationTimes=fB(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fB(0),this.identifierPrefix=i,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function dZ(n,e,t,i,s,o,r,a,l){return n=new Wk(n,e,t,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Oo(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Qw(o),n}function Mk(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:tI,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function CX(n){if(!n)return $l;n=n._reactInternals;e:{if(tu(n)!==n||n.tag!==1)throw Error(Te(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(so(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Te(171))}if(n.tag===1){var t=n.type;if(so(t))return CH(n,t,e)}return e}function hX(n,e,t,i,s,o,r,a,l){return n=dZ(t,i,!0,n,s,o,r,a,l),n.context=CX(null),t=n.current,i=Ts(),s=zl(t),o=Ta(i,s),o.callback=e??null,Ll(t,o,s),n.current.lanes=s,jh(n,s,i),oo(n,i),n}function rb(n,e,t,i){var s=e.current,o=Ts(),r=zl(s);return t=CX(t),e.context===null?e.context=t:e.pendingContext=t,e=Ta(o,r),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=Ll(s,e,r),n!==null&&(wr(n,s,r,o),zm(n,s,r)),r}function Hf(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function D1(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function CZ(n,e){D1(n,e),(n=n.alternate)&&D1(n,e)}function Nk(){return null}var AX=typeof reportError=="function"?reportError:function(n){console.error(n)};function hZ(n){this._internalRoot=n}ab.prototype.render=hZ.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Te(409));rb(n,e,null,null)};ab.prototype.unmount=hZ.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Kc(function(){rb(null,n,null,null)}),e[Pa]=null}};function ab(n){this._internalRoot=n}ab.prototype.unstable_scheduleHydration=function(n){if(n){var e=U9();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Ml.length&&e!==0&&e<Ml[t].priority;t++);Ml.splice(t,0,n),t===0&&O9(n)}};function AZ(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function lb(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function P1(){}function Fk(n,e,t,i,s){if(s){if(typeof i=="function"){var o=i;i=function(){var g=Hf(r);o.call(g)}}var r=hX(e,i,n,0,null,!1,!1,"",P1);return n._reactRootContainer=r,n[Pa]=r.current,Ih(n.nodeType===8?n.parentNode:n),Kc(),r}for(;s=n.lastChild;)n.removeChild(s);if(typeof i=="function"){var a=i;i=function(){var g=Hf(l);a.call(g)}}var l=dZ(n,0,!1,null,null,!1,!1,"",P1);return n._reactRootContainer=l,n[Pa]=l.current,Ih(n.nodeType===8?n.parentNode:n),Kc(function(){rb(e,l,t,i)}),l}function gb(n,e,t,i,s){var o=t._reactRootContainer;if(o){var r=o;if(typeof s=="function"){var a=s;s=function(){var l=Hf(r);a.call(l)}}rb(e,r,n,s)}else r=Fk(t,e,n,s,i);return Hf(r)}D9=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=wC(e.pendingLanes);t!==0&&(Hw(e,t|1),oo(e,ui()),!(dn&6)&&(LI=ui()+500,Ig()))}break;case 13:Kc(function(){var i=Ua(n,1);if(i!==null){var s=Ts();wr(i,n,1,s)}}),CZ(n,1)}};Xw=function(n){if(n.tag===13){var e=Ua(n,134217728);if(e!==null){var t=Ts();wr(e,n,134217728,t)}CZ(n,134217728)}};P9=function(n){if(n.tag===13){var e=zl(n),t=Ua(n,e);if(t!==null){var i=Ts();wr(t,n,e,i)}CZ(n,e)}};U9=function(){return yn};J9=function(n,e){var t=yn;try{return yn=n,e()}finally{yn=t}};Mv=function(n,e,t){switch(e){case"input":if(wv(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var s=$0(i);if(!s)throw Error(Te(90));w9(i),wv(i,s)}}}break;case"textarea":S9(n,t);break;case"select":e=t.value,e!=null&&GI(n,!!t.multiple,e,!1)}};F9=gZ;H9=Kc;var Hk={usingClientEntryPoint:!1,Events:[$h,rI,$0,M9,N9,gZ]},Od={findFiberByHostInstance:Cc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Xk={bundleType:Od.bundleType,version:Od.version,rendererPackageName:Od.rendererPackageName,rendererConfig:Od.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:nl.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=E9(n),n===null?null:n.stateNode},findFiberByHostInstance:Od.findFiberByHostInstance||Nk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vp.isDisabled&&vp.supportsFiber)try{O0=vp.inject(Xk),qr=vp}catch{}}Ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hk;Ro.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!AZ(e))throw Error(Te(200));return Mk(n,e,null,t)};Ro.createRoot=function(n,e){if(!AZ(n))throw Error(Te(299));var t=!1,i="",s=AX;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=dZ(n,1,!1,null,null,t,!1,i,s),n[Pa]=e.current,Ih(n.nodeType===8?n.parentNode:n),new hZ(e)};Ro.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Te(188)):(n=Object.keys(n).join(","),Error(Te(268,n)));return n=E9(e),n=n===null?null:n.stateNode,n};Ro.flushSync=function(n){return Kc(n)};Ro.hydrate=function(n,e,t){if(!lb(e))throw Error(Te(200));return gb(null,n,e,!0,t)};Ro.hydrateRoot=function(n,e,t){if(!AZ(n))throw Error(Te(405));var i=t!=null&&t.hydratedSources||null,s=!1,o="",r=AX;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(r=t.onRecoverableError)),e=hX(e,null,n,1,t??null,s,!1,o,r),n[Pa]=e.current,Ih(n),i)for(n=0;n<i.length;n++)t=i[n],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new ab(e)};Ro.render=function(n,e,t){if(!lb(e))throw Error(Te(200));return gb(null,n,e,!1,t)};Ro.unmountComponentAtNode=function(n){if(!lb(n))throw Error(Te(40));return n._reactRootContainer?(Kc(function(){gb(null,null,n,!1,function(){n._reactRootContainer=null,n[Pa]=null})}),!0):!1};Ro.unstable_batchedUpdates=gZ;Ro.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!lb(t))throw Error(Te(200));if(n==null||n._reactInternals===void 0)throw Error(Te(38));return gb(n,e,t,!1,i)};Ro.version="18.3.1-next-f1338f8080-20240426";function pX(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(pX)}catch(n){console.error(n)}}pX(),p9.exports=Ro;var Tk=p9.exports,pZ,U1=Tk;pZ=U1.createRoot,U1.hydrateRoot;/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function yh(){return yh=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},yh.apply(this,arguments)}var pc;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(pc||(pc={}));const J1="popstate";function Ek(n){n===void 0&&(n={});function e(i,s){let{pathname:o,search:r,hash:a}=i.location;return u2("",{pathname:o,search:r,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(i,s){return typeof s=="string"?s:Xf(s)}return Kk(e,t,null,n)}function Zr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function Yk(){return Math.random().toString(36).substr(2,8)}function O1(n,e){return{usr:n.state,key:n.key,idx:e}}function u2(n,e,t,i){return t===void 0&&(t=null),yh({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?cb(e):e,{state:t,key:e&&e.key||i||Yk()})}function Xf(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function cb(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function Kk(n,e,t,i){i===void 0&&(i={});let{window:s=document.defaultView,v5Compat:o=!1}=i,r=s.history,a=pc.Pop,l=null,g=c();g==null&&(g=0,r.replaceState(yh({},r.state,{idx:g}),""));function c(){return(r.state||{idx:null}).idx}function u(){a=pc.Pop;let m=c(),A=m==null?null:m-g;g=m,l&&l({action:a,location:b.location,delta:A})}function C(m,A){a=pc.Push;let B=u2(b.location,m,A);g=c()+1;let G=O1(B,g),w=b.createHref(B);try{r.pushState(G,"",w)}catch(N){if(N instanceof DOMException&&N.name==="DataCloneError")throw N;s.location.assign(w)}o&&l&&l({action:a,location:b.location,delta:1})}function h(m,A){a=pc.Replace;let B=u2(b.location,m,A);g=c();let G=O1(B,g),w=b.createHref(B);r.replaceState(G,"",w),o&&l&&l({action:a,location:b.location,delta:0})}function p(m){let A=s.location.origin!=="null"?s.location.origin:s.location.href,B=typeof m=="string"?m:Xf(m);return B=B.replace(/ $/,"%20"),Zr(A,"No window.location.(origin|href) available to create URL for href: "+B),new URL(B,A)}let b={get action(){return a},get location(){return n(s,r)},listen(m){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(J1,u),l=m,()=>{s.removeEventListener(J1,u),l=null}},createHref(m){return e(s,m)},createURL:p,encodeLocation(m){let A=p(m);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:C,replace:h,go(m){return r.go(m)}};return b}var Q1;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Q1||(Q1={}));function mX(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function _k(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:s=""}=typeof n=="string"?cb(n):n;return{pathname:t?t.startsWith("/")?t:Lk(t,e):e,search:zk(i),hash:Dk(s)}}function Lk(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(s=>{s===".."?t.length>1&&t.pop():s!=="."&&t.push(s)}),t.length>1?t.join("/"):"/"}function KB(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function kk(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function fX(n,e){let t=kk(n);return e?t.map((i,s)=>s===t.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function bX(n,e,t,i){i===void 0&&(i=!1);let s;typeof n=="string"?s=cb(n):(s=yh({},n),Zr(!s.pathname||!s.pathname.includes("?"),KB("?","pathname","search",s)),Zr(!s.pathname||!s.pathname.includes("#"),KB("#","pathname","hash",s)),Zr(!s.search||!s.search.includes("#"),KB("#","search","hash",s)));let o=n===""||s.pathname==="",r=o?"/":s.pathname,a;if(r==null)a=t;else{let u=e.length-1;if(!i&&r.startsWith("..")){let C=r.split("/");for(;C[0]==="..";)C.shift(),u-=1;s.pathname=C.join("/")}a=u>=0?e[u]:"/"}let l=_k(s,a),g=r&&r!=="/"&&r.endsWith("/"),c=(o||r===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(g||c)&&(l.pathname+="/"),l}const yX=n=>n.join("/").replace(/\/\/+/g,"/"),zk=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,Dk=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n,BX=["post","put","patch","delete"];new Set(BX);const Pk=["get",...BX];new Set(Pk);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tf(){return Tf=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Tf.apply(this,arguments)}const GX=z.createContext(null),id=z.createContext(null),mZ=z.createContext(null),ub=z.createContext({outlet:null,matches:[],isDataRoute:!1});function Uk(n,e){let{relative:t}=e===void 0?{}:e;Ib()||Zr(!1);let{basename:i,navigator:s}=z.useContext(id),{hash:o,pathname:r,search:a}=wX(n,{relative:t}),l=r;return i!=="/"&&(l=r==="/"?i:yX([i,r])),s.createHref({pathname:l,search:a,hash:o})}function Ib(){return z.useContext(mZ)!=null}function fZ(){return Ib()||Zr(!1),z.useContext(mZ).location}function vX(n){z.useContext(id).static||z.useLayoutEffect(n)}function Jk(){let{isDataRoute:n}=z.useContext(ub);return n?$k():Ok()}function Ok(){Ib()||Zr(!1);let n=z.useContext(GX),{basename:e,future:t,navigator:i}=z.useContext(id),{matches:s}=z.useContext(ub),{pathname:o}=fZ(),r=JSON.stringify(fX(s,t.v7_relativeSplatPath)),a=z.useRef(!1);return vX(()=>{a.current=!0}),z.useCallback(function(g,c){if(c===void 0&&(c={}),!a.current)return;if(typeof g=="number"){i.go(g);return}let u=bX(g,JSON.parse(r),o,c.relative==="path");n==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:yX([e,u.pathname])),(c.replace?i.replace:i.push)(u,c.state,c)},[e,i,r,o,n])}function wX(n,e){let{relative:t}=e===void 0?{}:e,{future:i}=z.useContext(id),{matches:s}=z.useContext(ub),{pathname:o}=fZ(),r=JSON.stringify(fX(s,i.v7_relativeSplatPath));return z.useMemo(()=>bX(n,JSON.parse(r),o,t==="path"),[n,r,o,t])}var ZX=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(ZX||{}),SX=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(SX||{});function Qk(n){let e=z.useContext(GX);return e||Zr(!1),e}function jk(n){let e=z.useContext(ub);return e||Zr(!1),e}function qk(n){let e=jk(),t=e.matches[e.matches.length-1];return t.route.id||Zr(!1),t.route.id}function $k(){let{router:n}=Qk(ZX.UseNavigateStable),e=qk(SX.UseNavigateStable),t=z.useRef(!1);return vX(()=>{t.current=!0}),z.useCallback(function(s,o){o===void 0&&(o={}),t.current&&(typeof s=="number"?n.navigate(s):n.navigate(s,Tf({fromRouteId:e},o)))},[n,e])}function ez(n){let{basename:e="/",children:t=null,location:i,navigationType:s=pc.Pop,navigator:o,static:r=!1,future:a}=n;Ib()&&Zr(!1);let l=e.replace(/^\/*/,"/"),g=z.useMemo(()=>({basename:l,navigator:o,static:r,future:Tf({v7_relativeSplatPath:!1},a)}),[l,a,o,r]);typeof i=="string"&&(i=cb(i));let{pathname:c="/",search:u="",hash:C="",state:h=null,key:p="default"}=i,b=z.useMemo(()=>{let m=mX(c,l);return m==null?null:{location:{pathname:m,search:u,hash:C,state:h,key:p},navigationType:s}},[l,c,u,C,h,p,s]);return b==null?null:z.createElement(id.Provider,{value:g},z.createElement(mZ.Provider,{children:t,value:b}))}new Promise(()=>{});/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function I2(){return I2=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},I2.apply(this,arguments)}function tz(n,e){if(n==null)return{};var t={},i=Object.keys(n),s,o;for(o=0;o<i.length;o++)s=i[o],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function nz(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function iz(n,e){return n.button===0&&(!e||e==="_self")&&!nz(n)}const sz=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],oz="6";try{window.__reactRouterVersion=oz}catch{}const rz="startTransition",j1=Z_[rz];function az(n){let{basename:e,children:t,future:i,window:s}=n,o=z.useRef();o.current==null&&(o.current=Ek({window:s,v5Compat:!0}));let r=o.current,[a,l]=z.useState({action:r.action,location:r.location}),{v7_startTransition:g}=i||{},c=z.useCallback(u=>{g&&j1?j1(()=>l(u)):l(u)},[l,g]);return z.useLayoutEffect(()=>r.listen(c),[r,c]),z.createElement(ez,{basename:e,children:t,location:a.location,navigationType:a.action,navigator:r,future:i})}const lz=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",gz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,cz=z.forwardRef(function(e,t){let{onClick:i,relative:s,reloadDocument:o,replace:r,state:a,target:l,to:g,preventScrollReset:c,viewTransition:u}=e,C=tz(e,sz),{basename:h}=z.useContext(id),p,b=!1;if(typeof g=="string"&&gz.test(g)&&(p=g,lz))try{let G=new URL(window.location.href),w=g.startsWith("//")?new URL(G.protocol+g):new URL(g),N=mX(w.pathname,h);w.origin===G.origin&&N!=null?g=N+w.search+w.hash:b=!0}catch{}let m=Uk(g,{relative:s}),A=uz(g,{replace:r,state:a,target:l,preventScrollReset:c,relative:s,viewTransition:u});function B(G){i&&i(G),G.defaultPrevented||A(G)}return z.createElement("a",I2({},C,{href:p||m,onClick:b||o?i:B,ref:t,target:l}))});var q1;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(q1||(q1={}));var $1;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})($1||($1={}));function uz(n,e){let{target:t,replace:i,state:s,preventScrollReset:o,relative:r,viewTransition:a}=e===void 0?{}:e,l=Jk(),g=fZ(),c=wX(n,{relative:r});return z.useCallback(u=>{if(iz(u,t)){u.preventDefault();let C=i!==void 0?i:Xf(g)===Xf(c);l(n,{replace:C,state:s,preventScrollReset:o,relative:r,viewTransition:a})}},[g,l,c,i,s,t,n,o,r,a])}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const sd="169",sc={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},oc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},RX=0,d2=1,xX=2,Iz=3,VX=0,db=1,_C=2,pr=3,Rr=0,Es=1,bo=2,ea=0,Rc=1,C2=2,h2=3,A2=4,WX=5,Fl=100,MX=101,NX=102,FX=103,HX=104,XX=200,TX=201,EX=202,YX=203,Ef=204,Yf=205,KX=206,_X=207,LX=208,kX=209,zX=210,DX=211,PX=212,UX=213,JX=214,Kf=0,_f=1,Lf=2,_c=3,kf=4,zf=5,Df=6,Pf=7,tA=0,OX=1,QX=2,ta=0,jX=1,qX=2,$X=3,bZ=4,eT=5,tT=6,nT=7,p2="attached",iT="detached",Cb=300,Oa=301,eg=302,Bh=303,Gh=304,od=306,xr=1e3,to=1001,Lc=1002,Bi=1003,nA=1004,dz=1004,Tl=1005,Cz=1005,fn=1006,xc=1007,hz=1007,no=1008,Az=1008,Vr=1009,yZ=1010,BZ=1011,kc=1012,hb=1013,Qa=1014,Xs=1015,il=1016,Ab=1017,pb=1018,zc=1020,GZ=35902,vZ=1021,wZ=1022,fs=1023,ZZ=1024,SZ=1025,Pl=1026,Dc=1027,mb=1028,iA=1029,RZ=1030,fb=1031,pz=1032,bb=1033,LC=33776,kC=33777,zC=33778,DC=33779,Uf=35840,Jf=35841,Of=35842,Qf=35843,jf=36196,qf=37492,$f=37496,e0=37808,t0=37809,n0=37810,i0=37811,s0=37812,o0=37813,r0=37814,a0=37815,l0=37816,g0=37817,c0=37818,u0=37819,I0=37820,d0=37821,PC=36492,C0=36494,h0=36495,xZ=36283,A0=36284,p0=36285,m0=36286,sT=2200,oT=2201,rT=2202,Pc=2300,tg=2301,jm=2302,mc=2400,fc=2401,vh=2402,yb=2500,VZ=2501,WZ=0,sA=1,Uc=2,aT=3200,lT=3201,mz=3202,fz=3203,dg=0,gT=1,xa="",Di="srgb",Ei="srgb-linear",Bb="display-p3",oA="display-p3-linear",wh="linear",xn="srgb",Zh="rec709",Sh="p3",bz=0,rc=7680,yz=7681,Bz=7682,Gz=7683,vz=34055,wz=34056,Zz=5386,Sz=512,Rz=513,xz=514,Vz=515,Wz=516,Mz=517,Nz=518,m2=519,cT=512,uT=513,IT=514,MZ=515,dT=516,CT=517,hT=518,AT=519,Rh=35044,Ul=35048,Fz=35040,Hz=35045,Xz=35049,Tz=35041,Ez=35046,Yz=35050,Kz=35042,_z="100",f2="300 es",jr=2e3,xh=2001;class Mr{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const o=s.indexOf(t);o!==-1&&s.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let o=0,r=s.length;o<r;o++)s[o].call(this,e);e.target=null}}}const ls=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let eV=1234567;const Vc=Math.PI/180,kI=180/Math.PI;function Go(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ls[n&255]+ls[n>>8&255]+ls[n>>16&255]+ls[n>>24&255]+"-"+ls[e&255]+ls[e>>8&255]+"-"+ls[e>>16&15|64]+ls[e>>24&255]+"-"+ls[t&63|128]+ls[t>>8&255]+"-"+ls[t>>16&255]+ls[t>>24&255]+ls[i&255]+ls[i>>8&255]+ls[i>>16&255]+ls[i>>24&255]).toLowerCase()}function ti(n,e,t){return Math.max(e,Math.min(t,n))}function NZ(n,e){return(n%e+e)%e}function Lz(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}function kz(n,e,t){return n!==e?(t-n)/(e-n):0}function UC(n,e,t){return(1-t)*n+t*e}function zz(n,e,t,i){return UC(n,e,1-Math.exp(-t*i))}function Dz(n,e=1){return e-Math.abs(NZ(n,e*2)-e)}function Pz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Uz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function Jz(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Oz(n,e){return n+Math.random()*(e-n)}function Qz(n){return n*(.5-Math.random())}function jz(n){n!==void 0&&(eV=n);let e=eV+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function qz(n){return n*Vc}function $z(n){return n*kI}function eD(n){return(n&n-1)===0&&n!==0}function tD(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function nD(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function iD(n,e,t,i,s){const o=Math.cos,r=Math.sin,a=o(t/2),l=r(t/2),g=o((e+i)/2),c=r((e+i)/2),u=o((e-i)/2),C=r((e-i)/2),h=o((i-e)/2),p=r((i-e)/2);switch(s){case"XYX":n.set(a*c,l*u,l*C,a*g);break;case"YZY":n.set(l*C,a*c,l*u,a*g);break;case"ZXZ":n.set(l*u,l*C,a*c,a*g);break;case"XZX":n.set(a*c,l*p,l*h,a*g);break;case"YXY":n.set(l*h,a*c,l*p,a*g);break;case"ZYZ":n.set(l*p,l*h,a*c,a*g);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Hs(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Yt(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Gb={DEG2RAD:Vc,RAD2DEG:kI,generateUUID:Go,clamp:ti,euclideanModulo:NZ,mapLinear:Lz,inverseLerp:kz,lerp:UC,damp:zz,pingpong:Dz,smoothstep:Pz,smootherstep:Uz,randInt:Jz,randFloat:Oz,randFloatSpread:Qz,seededRandom:jz,degToRad:qz,radToDeg:$z,isPowerOfTwo:eD,ceilPowerOfTwo:tD,floorPowerOfTwo:nD,setQuaternionFromProperEuler:iD,normalize:Yt,denormalize:Hs};class ye{constructor(e=0,t=0){ye.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6],this.y=s[1]*t+s[4]*i+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ti(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),s=Math.sin(t),o=this.x-e.x,r=this.y-e.y;return this.x=o*i-r*s+e.x,this.y=o*s+r*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Et{constructor(e,t,i,s,o,r,a,l,g){Et.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,s,o,r,a,l,g)}set(e,t,i,s,o,r,a,l,g){const c=this.elements;return c[0]=e,c[1]=s,c[2]=a,c[3]=t,c[4]=o,c[5]=l,c[6]=i,c[7]=r,c[8]=g,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,o=this.elements,r=i[0],a=i[3],l=i[6],g=i[1],c=i[4],u=i[7],C=i[2],h=i[5],p=i[8],b=s[0],m=s[3],A=s[6],B=s[1],G=s[4],w=s[7],N=s[2],M=s[5],R=s[8];return o[0]=r*b+a*B+l*N,o[3]=r*m+a*G+l*M,o[6]=r*A+a*w+l*R,o[1]=g*b+c*B+u*N,o[4]=g*m+c*G+u*M,o[7]=g*A+c*w+u*R,o[2]=C*b+h*B+p*N,o[5]=C*m+h*G+p*M,o[8]=C*A+h*w+p*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],s=e[2],o=e[3],r=e[4],a=e[5],l=e[6],g=e[7],c=e[8];return t*r*c-t*a*g-i*o*c+i*a*l+s*o*g-s*r*l}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],o=e[3],r=e[4],a=e[5],l=e[6],g=e[7],c=e[8],u=c*r-a*g,C=a*l-c*o,h=g*o-r*l,p=t*u+i*C+s*h;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/p;return e[0]=u*b,e[1]=(s*g-c*i)*b,e[2]=(a*i-s*r)*b,e[3]=C*b,e[4]=(c*t-s*l)*b,e[5]=(s*o-a*t)*b,e[6]=h*b,e[7]=(i*l-g*t)*b,e[8]=(r*t-i*o)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,s,o,r,a){const l=Math.cos(o),g=Math.sin(o);return this.set(i*l,i*g,-i*(l*r+g*a)+r+e,-s*g,s*l,-s*(-g*r+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_B.makeScale(e,t)),this}rotate(e){return this.premultiply(_B.makeRotation(-e)),this}translate(e,t){return this.premultiply(_B.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<9;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const _B=new Et;function pT(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const sD={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function dI(n,e){return new sD[n](e)}function Vh(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function mT(){const n=Vh("canvas");return n.style.display="block",n}const tV={};function qm(n){n in tV||(tV[n]=!0,console.warn(n))}function oD(n,e,t){return new Promise(function(i,s){function o(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:s();break;case n.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:i()}}setTimeout(o,t)})}function rD(n){const e=n.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function aD(n){const e=n.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const nV=new Et().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),iV=new Et().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Qd={[Ei]:{transfer:wh,primaries:Zh,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n,fromReference:n=>n},[Di]:{transfer:xn,primaries:Zh,luminanceCoefficients:[.2126,.7152,.0722],toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[oA]:{transfer:wh,primaries:Sh,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.applyMatrix3(iV),fromReference:n=>n.applyMatrix3(nV)},[Bb]:{transfer:xn,primaries:Sh,luminanceCoefficients:[.2289,.6917,.0793],toReference:n=>n.convertSRGBToLinear().applyMatrix3(iV),fromReference:n=>n.applyMatrix3(nV).convertLinearToSRGB()}},lD=new Set([Ei,oA]),cn={enabled:!0,_workingColorSpace:Ei,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!lD.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=Qd[e].toReference,s=Qd[t].fromReference;return s(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Qd[n].primaries},getTransfer:function(n){return n===xa?wh:Qd[n].transfer},getLuminanceCoefficients:function(n,e=this._workingColorSpace){return n.fromArray(Qd[e].luminanceCoefficients)}};function xI(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function LB(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Mu;class fT{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Mu===void 0&&(Mu=Vh("canvas")),Mu.width=e.width,Mu.height=e.height;const i=Mu.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Mu}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Vh("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const s=i.getImageData(0,0,e.width,e.height),o=s.data;for(let r=0;r<o.length;r++)o[r]=xI(o[r]/255)*255;return i.putImageData(s,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(xI(t[i]/255)*255):t[i]=xI(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let gD=0;class bc{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:gD++}),this.uuid=Go(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let o;if(Array.isArray(s)){o=[];for(let r=0,a=s.length;r<a;r++)s[r].isDataTexture?o.push(kB(s[r].image)):o.push(kB(s[r]))}else o=kB(s);i.url=o}return t||(e.images[this.uuid]=i),i}}function kB(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?fT.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let cD=0;class Bn extends Mr{constructor(e=Bn.DEFAULT_IMAGE,t=Bn.DEFAULT_MAPPING,i=to,s=to,o=fn,r=no,a=fs,l=Vr,g=Bn.DEFAULT_ANISOTROPY,c=xa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:cD++}),this.uuid=Go(),this.name="",this.source=new bc(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=o,this.minFilter=r,this.anisotropy=g,this.format=a,this.internalFormat=null,this.type=l,this.offset=new ye(0,0),this.repeat=new ye(1,1),this.center=new ye(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Et,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Cb)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case xr:e.x=e.x-Math.floor(e.x);break;case to:e.x=e.x<0?0:1;break;case Lc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case xr:e.y=e.y-Math.floor(e.y);break;case to:e.y=e.y<0?0:1;break;case Lc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Bn.DEFAULT_IMAGE=null;Bn.DEFAULT_MAPPING=Cb;Bn.DEFAULT_ANISOTROPY=1;class rn{constructor(e=0,t=0,i=0,s=1){rn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,o=this.w,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*s+r[12]*o,this.y=r[1]*t+r[5]*i+r[9]*s+r[13]*o,this.z=r[2]*t+r[6]*i+r[10]*s+r[14]*o,this.w=r[3]*t+r[7]*i+r[11]*s+r[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,s,o;const l=e.elements,g=l[0],c=l[4],u=l[8],C=l[1],h=l[5],p=l[9],b=l[2],m=l[6],A=l[10];if(Math.abs(c-C)<.01&&Math.abs(u-b)<.01&&Math.abs(p-m)<.01){if(Math.abs(c+C)<.1&&Math.abs(u+b)<.1&&Math.abs(p+m)<.1&&Math.abs(g+h+A-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const G=(g+1)/2,w=(h+1)/2,N=(A+1)/2,M=(c+C)/4,R=(u+b)/4,S=(p+m)/4;return G>w&&G>N?G<.01?(i=0,s=.707106781,o=.707106781):(i=Math.sqrt(G),s=M/i,o=R/i):w>N?w<.01?(i=.707106781,s=0,o=.707106781):(s=Math.sqrt(w),i=M/s,o=S/s):N<.01?(i=.707106781,s=.707106781,o=0):(o=Math.sqrt(N),i=R/o,s=S/o),this.set(i,s,o,t),this}let B=Math.sqrt((m-p)*(m-p)+(u-b)*(u-b)+(C-c)*(C-c));return Math.abs(B)<.001&&(B=1),this.x=(m-p)/B,this.y=(u-b)/B,this.z=(C-c)/B,this.w=Math.acos((g+h+A-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class bT extends Mr{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new rn(0,0,e,t),this.scissorTest=!1,this.viewport=new rn(0,0,e,t);const s={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:fn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const o=new Bn(s,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);o.flipY=!1,o.generateMipmaps=i.generateMipmaps,o.internalFormat=i.internalFormat,this.textures=[];const r=i.count;for(let a=0;a<r;a++)this.textures[a]=o.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let s=0,o=this.textures.length;s<o;s++)this.textures[s].image.width=e,this.textures[s].image.height=t,this.textures[s].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,s=e.textures.length;i<s;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new bc(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ys extends bT{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class vb extends Bn{constructor(e=null,t=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Bi,this.minFilter=Bi,this.wrapR=to,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class uD extends Ys{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new vb(null,e,t,i),this.texture.isRenderTargetTexture=!0}}class FZ extends Bn{constructor(e=null,t=1,i=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:s},this.magFilter=Bi,this.minFilter=Bi,this.wrapR=to,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ID extends Ys{constructor(e=1,t=1,i=1,s={}){super(e,t,s),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new FZ(null,e,t,i),this.texture.isRenderTargetTexture=!0}}let ii=class{constructor(e=0,t=0,i=0,s=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=s}static slerpFlat(e,t,i,s,o,r,a){let l=i[s+0],g=i[s+1],c=i[s+2],u=i[s+3];const C=o[r+0],h=o[r+1],p=o[r+2],b=o[r+3];if(a===0){e[t+0]=l,e[t+1]=g,e[t+2]=c,e[t+3]=u;return}if(a===1){e[t+0]=C,e[t+1]=h,e[t+2]=p,e[t+3]=b;return}if(u!==b||l!==C||g!==h||c!==p){let m=1-a;const A=l*C+g*h+c*p+u*b,B=A>=0?1:-1,G=1-A*A;if(G>Number.EPSILON){const N=Math.sqrt(G),M=Math.atan2(N,A*B);m=Math.sin(m*M)/N,a=Math.sin(a*M)/N}const w=a*B;if(l=l*m+C*w,g=g*m+h*w,c=c*m+p*w,u=u*m+b*w,m===1-a){const N=1/Math.sqrt(l*l+g*g+c*c+u*u);l*=N,g*=N,c*=N,u*=N}}e[t]=l,e[t+1]=g,e[t+2]=c,e[t+3]=u}static multiplyQuaternionsFlat(e,t,i,s,o,r){const a=i[s],l=i[s+1],g=i[s+2],c=i[s+3],u=o[r],C=o[r+1],h=o[r+2],p=o[r+3];return e[t]=a*p+c*u+l*h-g*C,e[t+1]=l*p+c*C+g*u-a*h,e[t+2]=g*p+c*h+a*C-l*u,e[t+3]=c*p-a*u-l*C-g*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,s=e._y,o=e._z,r=e._order,a=Math.cos,l=Math.sin,g=a(i/2),c=a(s/2),u=a(o/2),C=l(i/2),h=l(s/2),p=l(o/2);switch(r){case"XYZ":this._x=C*c*u+g*h*p,this._y=g*h*u-C*c*p,this._z=g*c*p+C*h*u,this._w=g*c*u-C*h*p;break;case"YXZ":this._x=C*c*u+g*h*p,this._y=g*h*u-C*c*p,this._z=g*c*p-C*h*u,this._w=g*c*u+C*h*p;break;case"ZXY":this._x=C*c*u-g*h*p,this._y=g*h*u+C*c*p,this._z=g*c*p+C*h*u,this._w=g*c*u-C*h*p;break;case"ZYX":this._x=C*c*u-g*h*p,this._y=g*h*u+C*c*p,this._z=g*c*p-C*h*u,this._w=g*c*u+C*h*p;break;case"YZX":this._x=C*c*u+g*h*p,this._y=g*h*u+C*c*p,this._z=g*c*p-C*h*u,this._w=g*c*u-C*h*p;break;case"XZY":this._x=C*c*u-g*h*p,this._y=g*h*u-C*c*p,this._z=g*c*p+C*h*u,this._w=g*c*u+C*h*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],s=t[4],o=t[8],r=t[1],a=t[5],l=t[9],g=t[2],c=t[6],u=t[10],C=i+a+u;if(C>0){const h=.5/Math.sqrt(C+1);this._w=.25/h,this._x=(c-l)*h,this._y=(o-g)*h,this._z=(r-s)*h}else if(i>a&&i>u){const h=2*Math.sqrt(1+i-a-u);this._w=(c-l)/h,this._x=.25*h,this._y=(s+r)/h,this._z=(o+g)/h}else if(a>u){const h=2*Math.sqrt(1+a-i-u);this._w=(o-g)/h,this._x=(s+r)/h,this._y=.25*h,this._z=(l+c)/h}else{const h=2*Math.sqrt(1+u-i-a);this._w=(r-s)/h,this._x=(o+g)/h,this._y=(l+c)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ti(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const s=Math.min(1,t/i);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,s=e._y,o=e._z,r=e._w,a=t._x,l=t._y,g=t._z,c=t._w;return this._x=i*c+r*a+s*g-o*l,this._y=s*c+r*l+o*a-i*g,this._z=o*c+r*g+i*l-s*a,this._w=r*c-i*a-s*l-o*g,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,s=this._y,o=this._z,r=this._w;let a=r*e._w+i*e._x+s*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=r,this._x=i,this._y=s,this._z=o,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-t;return this._w=h*r+t*this._w,this._x=h*i+t*this._x,this._y=h*s+t*this._y,this._z=h*o+t*this._z,this.normalize(),this}const g=Math.sqrt(l),c=Math.atan2(g,a),u=Math.sin((1-t)*c)/g,C=Math.sin(t*c)/g;return this._w=r*u+this._w*C,this._x=i*u+this._x*C,this._y=s*u+this._y*C,this._z=o*u+this._z*C,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),o=Math.sqrt(i);return this.set(s*Math.sin(e),s*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class _{constructor(e=0,t=0,i=0){_.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(sV.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(sV.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,s=this.z,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6]*s,this.y=o[1]*t+o[4]*i+o[7]*s,this.z=o[2]*t+o[5]*i+o[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,s=this.z,o=e.elements,r=1/(o[3]*t+o[7]*i+o[11]*s+o[15]);return this.x=(o[0]*t+o[4]*i+o[8]*s+o[12])*r,this.y=(o[1]*t+o[5]*i+o[9]*s+o[13])*r,this.z=(o[2]*t+o[6]*i+o[10]*s+o[14])*r,this}applyQuaternion(e){const t=this.x,i=this.y,s=this.z,o=e.x,r=e.y,a=e.z,l=e.w,g=2*(r*s-a*i),c=2*(a*t-o*s),u=2*(o*i-r*t);return this.x=t+l*g+r*u-a*c,this.y=i+l*c+a*g-o*u,this.z=s+l*u+o*c-r*g,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,s=this.z,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*s,this.y=o[1]*t+o[5]*i+o[9]*s,this.z=o[2]*t+o[6]*i+o[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,s=e.y,o=e.z,r=t.x,a=t.y,l=t.z;return this.x=s*l-o*a,this.y=o*r-i*l,this.z=i*a-s*r,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return zB.copy(this).projectOnVector(e),this.sub(zB)}reflect(e){return this.sub(zB.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ti(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const zB=new _,sV=new ii;class Ji{constructor(e=new _(1/0,1/0,1/0),t=new _(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(ur.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(ur.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=ur.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const o=i.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let r=0,a=o.count;r<a;r++)e.isMesh===!0?e.getVertexPosition(r,ur):ur.fromBufferAttribute(o,r),ur.applyMatrix4(e.matrixWorld),this.expandByPoint(ur);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),wp.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),wp.copy(i.boundingBox)),wp.applyMatrix4(e.matrixWorld),this.union(wp)}const s=e.children;for(let o=0,r=s.length;o<r;o++)this.expandByObject(s[o],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,ur),ur.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(jd),Zp.subVectors(this.max,jd),Nu.subVectors(e.a,jd),Fu.subVectors(e.b,jd),Hu.subVectors(e.c,jd),pl.subVectors(Fu,Nu),ml.subVectors(Hu,Fu),Kg.subVectors(Nu,Hu);let t=[0,-pl.z,pl.y,0,-ml.z,ml.y,0,-Kg.z,Kg.y,pl.z,0,-pl.x,ml.z,0,-ml.x,Kg.z,0,-Kg.x,-pl.y,pl.x,0,-ml.y,ml.x,0,-Kg.y,Kg.x,0];return!DB(t,Nu,Fu,Hu,Zp)||(t=[1,0,0,0,1,0,0,0,1],!DB(t,Nu,Fu,Hu,Zp))?!1:(Sp.crossVectors(pl,ml),t=[Sp.x,Sp.y,Sp.z],DB(t,Nu,Fu,Hu,Zp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,ur).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(ur).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(fa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),fa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),fa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),fa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),fa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),fa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),fa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),fa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(fa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const fa=[new _,new _,new _,new _,new _,new _,new _,new _],ur=new _,wp=new Ji,Nu=new _,Fu=new _,Hu=new _,pl=new _,ml=new _,Kg=new _,jd=new _,Zp=new _,Sp=new _,_g=new _;function DB(n,e,t,i,s){for(let o=0,r=n.length-3;o<=r;o+=3){_g.fromArray(n,o);const a=s.x*Math.abs(_g.x)+s.y*Math.abs(_g.y)+s.z*Math.abs(_g.z),l=e.dot(_g),g=t.dot(_g),c=i.dot(_g);if(Math.max(-Math.max(l,g,c),Math.min(l,g,c))>a)return!1}return!0}const dD=new Ji,qd=new _,PB=new _;class Ti{constructor(e=new _,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):dD.setFromPoints(e).getCenter(i);let s=0;for(let o=0,r=e.length;o<r;o++)s=Math.max(s,i.distanceToSquared(e[o]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;qd.subVectors(e,this.center);const t=qd.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),s=(i-this.radius)*.5;this.center.addScaledVector(qd,s/i),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(PB.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(qd.copy(e.center).add(PB)),this.expandByPoint(qd.copy(e.center).sub(PB))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ba=new _,UB=new _,Rp=new _,fl=new _,JB=new _,xp=new _,OB=new _;let nu=class{constructor(e=new _,t=new _(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ba)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ba.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ba.copy(this.origin).addScaledVector(this.direction,t),ba.distanceToSquared(e))}distanceSqToSegment(e,t,i,s){UB.copy(e).add(t).multiplyScalar(.5),Rp.copy(t).sub(e).normalize(),fl.copy(this.origin).sub(UB);const o=e.distanceTo(t)*.5,r=-this.direction.dot(Rp),a=fl.dot(this.direction),l=-fl.dot(Rp),g=fl.lengthSq(),c=Math.abs(1-r*r);let u,C,h,p;if(c>0)if(u=r*l-a,C=r*a-l,p=o*c,u>=0)if(C>=-p)if(C<=p){const b=1/c;u*=b,C*=b,h=u*(u+r*C+2*a)+C*(r*u+C+2*l)+g}else C=o,u=Math.max(0,-(r*C+a)),h=-u*u+C*(C+2*l)+g;else C=-o,u=Math.max(0,-(r*C+a)),h=-u*u+C*(C+2*l)+g;else C<=-p?(u=Math.max(0,-(-r*o+a)),C=u>0?-o:Math.min(Math.max(-o,-l),o),h=-u*u+C*(C+2*l)+g):C<=p?(u=0,C=Math.min(Math.max(-o,-l),o),h=C*(C+2*l)+g):(u=Math.max(0,-(r*o+a)),C=u>0?o:Math.min(Math.max(-o,-l),o),h=-u*u+C*(C+2*l)+g);else C=r>0?-o:o,u=Math.max(0,-(r*C+a)),h=-u*u+C*(C+2*l)+g;return i&&i.copy(this.origin).addScaledVector(this.direction,u),s&&s.copy(UB).addScaledVector(Rp,C),h}intersectSphere(e,t){ba.subVectors(e.center,this.origin);const i=ba.dot(this.direction),s=ba.dot(ba)-i*i,o=e.radius*e.radius;if(s>o)return null;const r=Math.sqrt(o-s),a=i-r,l=i+r;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,s,o,r,a,l;const g=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,C=this.origin;return g>=0?(i=(e.min.x-C.x)*g,s=(e.max.x-C.x)*g):(i=(e.max.x-C.x)*g,s=(e.min.x-C.x)*g),c>=0?(o=(e.min.y-C.y)*c,r=(e.max.y-C.y)*c):(o=(e.max.y-C.y)*c,r=(e.min.y-C.y)*c),i>r||o>s||((o>i||isNaN(i))&&(i=o),(r<s||isNaN(s))&&(s=r),u>=0?(a=(e.min.z-C.z)*u,l=(e.max.z-C.z)*u):(a=(e.max.z-C.z)*u,l=(e.min.z-C.z)*u),i>l||a>s)||((a>i||i!==i)&&(i=a),(l<s||s!==s)&&(s=l),s<0)?null:this.at(i>=0?i:s,t)}intersectsBox(e){return this.intersectBox(e,ba)!==null}intersectTriangle(e,t,i,s,o){JB.subVectors(t,e),xp.subVectors(i,e),OB.crossVectors(JB,xp);let r=this.direction.dot(OB),a;if(r>0){if(s)return null;a=1}else if(r<0)a=-1,r=-r;else return null;fl.subVectors(this.origin,e);const l=a*this.direction.dot(xp.crossVectors(fl,xp));if(l<0)return null;const g=a*this.direction.dot(JB.cross(fl));if(g<0||l+g>r)return null;const c=-a*fl.dot(OB);return c<0?null:this.at(c/r,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class ct{constructor(e,t,i,s,o,r,a,l,g,c,u,C,h,p,b,m){ct.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,s,o,r,a,l,g,c,u,C,h,p,b,m)}set(e,t,i,s,o,r,a,l,g,c,u,C,h,p,b,m){const A=this.elements;return A[0]=e,A[4]=t,A[8]=i,A[12]=s,A[1]=o,A[5]=r,A[9]=a,A[13]=l,A[2]=g,A[6]=c,A[10]=u,A[14]=C,A[3]=h,A[7]=p,A[11]=b,A[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ct().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,s=1/Xu.setFromMatrixColumn(e,0).length(),o=1/Xu.setFromMatrixColumn(e,1).length(),r=1/Xu.setFromMatrixColumn(e,2).length();return t[0]=i[0]*s,t[1]=i[1]*s,t[2]=i[2]*s,t[3]=0,t[4]=i[4]*o,t[5]=i[5]*o,t[6]=i[6]*o,t[7]=0,t[8]=i[8]*r,t[9]=i[9]*r,t[10]=i[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,s=e.y,o=e.z,r=Math.cos(i),a=Math.sin(i),l=Math.cos(s),g=Math.sin(s),c=Math.cos(o),u=Math.sin(o);if(e.order==="XYZ"){const C=r*c,h=r*u,p=a*c,b=a*u;t[0]=l*c,t[4]=-l*u,t[8]=g,t[1]=h+p*g,t[5]=C-b*g,t[9]=-a*l,t[2]=b-C*g,t[6]=p+h*g,t[10]=r*l}else if(e.order==="YXZ"){const C=l*c,h=l*u,p=g*c,b=g*u;t[0]=C+b*a,t[4]=p*a-h,t[8]=r*g,t[1]=r*u,t[5]=r*c,t[9]=-a,t[2]=h*a-p,t[6]=b+C*a,t[10]=r*l}else if(e.order==="ZXY"){const C=l*c,h=l*u,p=g*c,b=g*u;t[0]=C-b*a,t[4]=-r*u,t[8]=p+h*a,t[1]=h+p*a,t[5]=r*c,t[9]=b-C*a,t[2]=-r*g,t[6]=a,t[10]=r*l}else if(e.order==="ZYX"){const C=r*c,h=r*u,p=a*c,b=a*u;t[0]=l*c,t[4]=p*g-h,t[8]=C*g+b,t[1]=l*u,t[5]=b*g+C,t[9]=h*g-p,t[2]=-g,t[6]=a*l,t[10]=r*l}else if(e.order==="YZX"){const C=r*l,h=r*g,p=a*l,b=a*g;t[0]=l*c,t[4]=b-C*u,t[8]=p*u+h,t[1]=u,t[5]=r*c,t[9]=-a*c,t[2]=-g*c,t[6]=h*u+p,t[10]=C-b*u}else if(e.order==="XZY"){const C=r*l,h=r*g,p=a*l,b=a*g;t[0]=l*c,t[4]=-u,t[8]=g*c,t[1]=C*u+b,t[5]=r*c,t[9]=h*u-p,t[2]=p*u-h,t[6]=a*c,t[10]=b*u+C}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(CD,e,hD)}lookAt(e,t,i){const s=this.elements;return po.subVectors(e,t),po.lengthSq()===0&&(po.z=1),po.normalize(),bl.crossVectors(i,po),bl.lengthSq()===0&&(Math.abs(i.z)===1?po.x+=1e-4:po.z+=1e-4,po.normalize(),bl.crossVectors(i,po)),bl.normalize(),Vp.crossVectors(po,bl),s[0]=bl.x,s[4]=Vp.x,s[8]=po.x,s[1]=bl.y,s[5]=Vp.y,s[9]=po.y,s[2]=bl.z,s[6]=Vp.z,s[10]=po.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,s=t.elements,o=this.elements,r=i[0],a=i[4],l=i[8],g=i[12],c=i[1],u=i[5],C=i[9],h=i[13],p=i[2],b=i[6],m=i[10],A=i[14],B=i[3],G=i[7],w=i[11],N=i[15],M=s[0],R=s[4],S=s[8],F=s[12],Z=s[1],x=s[5],Y=s[9],T=s[13],ne=s[2],ue=s[6],se=s[10],Ie=s[14],k=s[3],ee=s[7],$=s[11],ae=s[15];return o[0]=r*M+a*Z+l*ne+g*k,o[4]=r*R+a*x+l*ue+g*ee,o[8]=r*S+a*Y+l*se+g*$,o[12]=r*F+a*T+l*Ie+g*ae,o[1]=c*M+u*Z+C*ne+h*k,o[5]=c*R+u*x+C*ue+h*ee,o[9]=c*S+u*Y+C*se+h*$,o[13]=c*F+u*T+C*Ie+h*ae,o[2]=p*M+b*Z+m*ne+A*k,o[6]=p*R+b*x+m*ue+A*ee,o[10]=p*S+b*Y+m*se+A*$,o[14]=p*F+b*T+m*Ie+A*ae,o[3]=B*M+G*Z+w*ne+N*k,o[7]=B*R+G*x+w*ue+N*ee,o[11]=B*S+G*Y+w*se+N*$,o[15]=B*F+G*T+w*Ie+N*ae,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],s=e[8],o=e[12],r=e[1],a=e[5],l=e[9],g=e[13],c=e[2],u=e[6],C=e[10],h=e[14],p=e[3],b=e[7],m=e[11],A=e[15];return p*(+o*l*u-s*g*u-o*a*C+i*g*C+s*a*h-i*l*h)+b*(+t*l*h-t*g*C+o*r*C-s*r*h+s*g*c-o*l*c)+m*(+t*g*u-t*a*h-o*r*u+i*r*h+o*a*c-i*g*c)+A*(-s*a*c-t*l*u+t*a*C+s*r*u-i*r*C+i*l*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],s=e[2],o=e[3],r=e[4],a=e[5],l=e[6],g=e[7],c=e[8],u=e[9],C=e[10],h=e[11],p=e[12],b=e[13],m=e[14],A=e[15],B=u*m*g-b*C*g+b*l*h-a*m*h-u*l*A+a*C*A,G=p*C*g-c*m*g-p*l*h+r*m*h+c*l*A-r*C*A,w=c*b*g-p*u*g+p*a*h-r*b*h-c*a*A+r*u*A,N=p*u*l-c*b*l-p*a*C+r*b*C+c*a*m-r*u*m,M=t*B+i*G+s*w+o*N;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/M;return e[0]=B*R,e[1]=(b*C*o-u*m*o-b*s*h+i*m*h+u*s*A-i*C*A)*R,e[2]=(a*m*o-b*l*o+b*s*g-i*m*g-a*s*A+i*l*A)*R,e[3]=(u*l*o-a*C*o-u*s*g+i*C*g+a*s*h-i*l*h)*R,e[4]=G*R,e[5]=(c*m*o-p*C*o+p*s*h-t*m*h-c*s*A+t*C*A)*R,e[6]=(p*l*o-r*m*o-p*s*g+t*m*g+r*s*A-t*l*A)*R,e[7]=(r*C*o-c*l*o+c*s*g-t*C*g-r*s*h+t*l*h)*R,e[8]=w*R,e[9]=(p*u*o-c*b*o-p*i*h+t*b*h+c*i*A-t*u*A)*R,e[10]=(r*b*o-p*a*o+p*i*g-t*b*g-r*i*A+t*a*A)*R,e[11]=(c*a*o-r*u*o-c*i*g+t*u*g+r*i*h-t*a*h)*R,e[12]=N*R,e[13]=(c*b*s-p*u*s+p*i*C-t*b*C-c*i*m+t*u*m)*R,e[14]=(p*a*s-r*b*s-p*i*l+t*b*l+r*i*m-t*a*m)*R,e[15]=(r*u*s-c*a*s+c*i*l-t*u*l-r*i*C+t*a*C)*R,this}scale(e){const t=this.elements,i=e.x,s=e.y,o=e.z;return t[0]*=i,t[4]*=s,t[8]*=o,t[1]*=i,t[5]*=s,t[9]*=o,t[2]*=i,t[6]*=s,t[10]*=o,t[3]*=i,t[7]*=s,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),s=Math.sin(t),o=1-i,r=e.x,a=e.y,l=e.z,g=o*r,c=o*a;return this.set(g*r+i,g*a-s*l,g*l+s*a,0,g*a+s*l,c*a+i,c*l-s*r,0,g*l-s*a,c*l+s*r,o*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,s,o,r){return this.set(1,i,o,0,e,1,r,0,t,s,1,0,0,0,0,1),this}compose(e,t,i){const s=this.elements,o=t._x,r=t._y,a=t._z,l=t._w,g=o+o,c=r+r,u=a+a,C=o*g,h=o*c,p=o*u,b=r*c,m=r*u,A=a*u,B=l*g,G=l*c,w=l*u,N=i.x,M=i.y,R=i.z;return s[0]=(1-(b+A))*N,s[1]=(h+w)*N,s[2]=(p-G)*N,s[3]=0,s[4]=(h-w)*M,s[5]=(1-(C+A))*M,s[6]=(m+B)*M,s[7]=0,s[8]=(p+G)*R,s[9]=(m-B)*R,s[10]=(1-(C+b))*R,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,i){const s=this.elements;let o=Xu.set(s[0],s[1],s[2]).length();const r=Xu.set(s[4],s[5],s[6]).length(),a=Xu.set(s[8],s[9],s[10]).length();this.determinant()<0&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],Ir.copy(this);const g=1/o,c=1/r,u=1/a;return Ir.elements[0]*=g,Ir.elements[1]*=g,Ir.elements[2]*=g,Ir.elements[4]*=c,Ir.elements[5]*=c,Ir.elements[6]*=c,Ir.elements[8]*=u,Ir.elements[9]*=u,Ir.elements[10]*=u,t.setFromRotationMatrix(Ir),i.x=o,i.y=r,i.z=a,this}makePerspective(e,t,i,s,o,r,a=jr){const l=this.elements,g=2*o/(t-e),c=2*o/(i-s),u=(t+e)/(t-e),C=(i+s)/(i-s);let h,p;if(a===jr)h=-(r+o)/(r-o),p=-2*r*o/(r-o);else if(a===xh)h=-r/(r-o),p=-r*o/(r-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=g,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=c,l[9]=C,l[13]=0,l[2]=0,l[6]=0,l[10]=h,l[14]=p,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,s,o,r,a=jr){const l=this.elements,g=1/(t-e),c=1/(i-s),u=1/(r-o),C=(t+e)*g,h=(i+s)*c;let p,b;if(a===jr)p=(r+o)*u,b=-2*u;else if(a===xh)p=o*u,b=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*g,l[4]=0,l[8]=0,l[12]=-C,l[1]=0,l[5]=2*c,l[9]=0,l[13]=-h,l[2]=0,l[6]=0,l[10]=b,l[14]=-p,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Xu=new _,Ir=new ct,CD=new _(0,0,0),hD=new _(1,1,1),bl=new _,Vp=new _,po=new _,oV=new ct,rV=new ii;class Gs{constructor(e=0,t=0,i=0,s=Gs.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,s=this._order){return this._x=e,this._y=t,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const s=e.elements,o=s[0],r=s[4],a=s[8],l=s[1],g=s[5],c=s[9],u=s[2],C=s[6],h=s[10];switch(t){case"XYZ":this._y=Math.asin(ti(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._z=Math.atan2(-r,o)):(this._x=Math.atan2(C,g),this._z=0);break;case"YXZ":this._x=Math.asin(-ti(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,g)):(this._y=Math.atan2(-u,o),this._z=0);break;case"ZXY":this._x=Math.asin(ti(C,-1,1)),Math.abs(C)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-r,g)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-ti(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(C,h),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-r,g));break;case"YZX":this._z=Math.asin(ti(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,g),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-ti(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(C,g),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-c,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return oV.makeRotationFromQuaternion(e),this.setFromRotationMatrix(oV,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return rV.setFromEuler(this),this.setFromQuaternion(rV,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Gs.DEFAULT_ORDER="XYZ";class Wc{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let AD=0;const aV=new _,Tu=new ii,ya=new ct,Wp=new _,$d=new _,pD=new _,mD=new ii,lV=new _(1,0,0),gV=new _(0,1,0),cV=new _(0,0,1),uV={type:"added"},fD={type:"removed"},Eu={type:"childadded",child:null},QB={type:"childremoved",child:null};class Lt extends Mr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:AD++}),this.uuid=Go(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Lt.DEFAULT_UP.clone();const e=new _,t=new Gs,i=new ii,s=new _(1,1,1);function o(){i.setFromEuler(t,!1)}function r(){t.setFromQuaternion(i,void 0,!1)}t._onChange(o),i._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ct},normalMatrix:{value:new Et}}),this.matrix=new ct,this.matrixWorld=new ct,this.matrixAutoUpdate=Lt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Wc,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Tu.setFromAxisAngle(e,t),this.quaternion.multiply(Tu),this}rotateOnWorldAxis(e,t){return Tu.setFromAxisAngle(e,t),this.quaternion.premultiply(Tu),this}rotateX(e){return this.rotateOnAxis(lV,e)}rotateY(e){return this.rotateOnAxis(gV,e)}rotateZ(e){return this.rotateOnAxis(cV,e)}translateOnAxis(e,t){return aV.copy(e).applyQuaternion(this.quaternion),this.position.add(aV.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(lV,e)}translateY(e){return this.translateOnAxis(gV,e)}translateZ(e){return this.translateOnAxis(cV,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ya.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Wp.copy(e):Wp.set(e,t,i);const s=this.parent;this.updateWorldMatrix(!0,!1),$d.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ya.lookAt($d,Wp,this.up):ya.lookAt(Wp,$d,this.up),this.quaternion.setFromRotationMatrix(ya),s&&(ya.extractRotation(s.matrixWorld),Tu.setFromRotationMatrix(ya),this.quaternion.premultiply(Tu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(uV),Eu.child=e,this.dispatchEvent(Eu),Eu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(fD),QB.child=e,this.dispatchEvent(QB),QB.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ya.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ya.multiply(e.parent.matrixWorld)),e.applyMatrix4(ya),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(uV),Eu.child=e,this.dispatchEvent(Eu),Eu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,s=this.children.length;i<s;i++){const r=this.children[i].getObjectByProperty(e,t);if(r!==void 0)return r}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const s=this.children;for(let o=0,r=s.length;o<r;o++)s[o].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($d,e,pD),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($d,mD,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,s=t.length;i<s;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const s=this.children;for(let o=0,r=s.length;o<r;o++)s[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function o(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let g=0,c=l.length;g<c;g++){const u=l[g];o(e.shapes,u)}else o(e.shapes,l)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,g=this.material.length;l<g;l++)a.push(o(e.materials,this.material[l]));s.material=a}else s.material=o(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];s.animations.push(o(e.animations,l))}}if(t){const a=r(e.geometries),l=r(e.materials),g=r(e.textures),c=r(e.images),u=r(e.shapes),C=r(e.skeletons),h=r(e.animations),p=r(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),g.length>0&&(i.textures=g),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),C.length>0&&(i.skeletons=C),h.length>0&&(i.animations=h),p.length>0&&(i.nodes=p)}return i.object=s,i;function r(a){const l=[];for(const g in a){const c=a[g];delete c.metadata,l.push(c)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const s=e.children[i];this.add(s.clone())}return this}}Lt.DEFAULT_UP=new _(0,1,0);Lt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const dr=new _,Ba=new _,jB=new _,Ga=new _,Yu=new _,Ku=new _,IV=new _,qB=new _,$B=new _,eG=new _,tG=new rn,nG=new rn,iG=new rn;class $s{constructor(e=new _,t=new _,i=new _){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,s){s.subVectors(i,t),dr.subVectors(e,t),s.cross(dr);const o=s.lengthSq();return o>0?s.multiplyScalar(1/Math.sqrt(o)):s.set(0,0,0)}static getBarycoord(e,t,i,s,o){dr.subVectors(s,t),Ba.subVectors(i,t),jB.subVectors(e,t);const r=dr.dot(dr),a=dr.dot(Ba),l=dr.dot(jB),g=Ba.dot(Ba),c=Ba.dot(jB),u=r*g-a*a;if(u===0)return o.set(0,0,0),null;const C=1/u,h=(g*l-a*c)*C,p=(r*c-a*l)*C;return o.set(1-h-p,p,h)}static containsPoint(e,t,i,s){return this.getBarycoord(e,t,i,s,Ga)===null?!1:Ga.x>=0&&Ga.y>=0&&Ga.x+Ga.y<=1}static getInterpolation(e,t,i,s,o,r,a,l){return this.getBarycoord(e,t,i,s,Ga)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(o,Ga.x),l.addScaledVector(r,Ga.y),l.addScaledVector(a,Ga.z),l)}static getInterpolatedAttribute(e,t,i,s,o,r){return tG.setScalar(0),nG.setScalar(0),iG.setScalar(0),tG.fromBufferAttribute(e,t),nG.fromBufferAttribute(e,i),iG.fromBufferAttribute(e,s),r.setScalar(0),r.addScaledVector(tG,o.x),r.addScaledVector(nG,o.y),r.addScaledVector(iG,o.z),r}static isFrontFacing(e,t,i,s){return dr.subVectors(i,t),Ba.subVectors(e,t),dr.cross(Ba).dot(s)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,s){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,i,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return dr.subVectors(this.c,this.b),Ba.subVectors(this.a,this.b),dr.cross(Ba).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return $s.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return $s.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,s,o){return $s.getInterpolation(e,this.a,this.b,this.c,t,i,s,o)}containsPoint(e){return $s.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return $s.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,s=this.b,o=this.c;let r,a;Yu.subVectors(s,i),Ku.subVectors(o,i),qB.subVectors(e,i);const l=Yu.dot(qB),g=Ku.dot(qB);if(l<=0&&g<=0)return t.copy(i);$B.subVectors(e,s);const c=Yu.dot($B),u=Ku.dot($B);if(c>=0&&u<=c)return t.copy(s);const C=l*u-c*g;if(C<=0&&l>=0&&c<=0)return r=l/(l-c),t.copy(i).addScaledVector(Yu,r);eG.subVectors(e,o);const h=Yu.dot(eG),p=Ku.dot(eG);if(p>=0&&h<=p)return t.copy(o);const b=h*g-l*p;if(b<=0&&g>=0&&p<=0)return a=g/(g-p),t.copy(i).addScaledVector(Ku,a);const m=c*p-h*u;if(m<=0&&u-c>=0&&h-p>=0)return IV.subVectors(o,s),a=(u-c)/(u-c+(h-p)),t.copy(s).addScaledVector(IV,a);const A=1/(m+b+C);return r=b*A,a=C*A,t.copy(i).addScaledVector(Yu,r).addScaledVector(Ku,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const yT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},yl={h:0,s:0,l:0},Mp={h:0,s:0,l:0};function sG(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Pe{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Di){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,cn.toWorkingColorSpace(this,t),this}setRGB(e,t,i,s=cn.workingColorSpace){return this.r=e,this.g=t,this.b=i,cn.toWorkingColorSpace(this,s),this}setHSL(e,t,i,s=cn.workingColorSpace){if(e=NZ(e,1),t=ti(t,0,1),i=ti(i,0,1),t===0)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+t):i+t-i*t,r=2*i-o;this.r=sG(r,o,e+1/3),this.g=sG(r,o,e),this.b=sG(r,o,e-1/3)}return cn.toWorkingColorSpace(this,s),this}setStyle(e,t=Di){function i(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const r=s[1],a=s[2];switch(r){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=s[1],r=o.length;if(r===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(r===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Di){const i=yT[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=xI(e.r),this.g=xI(e.g),this.b=xI(e.b),this}copyLinearToSRGB(e){return this.r=LB(e.r),this.g=LB(e.g),this.b=LB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Di){return cn.fromWorkingColorSpace(gs.copy(this),e),Math.round(ti(gs.r*255,0,255))*65536+Math.round(ti(gs.g*255,0,255))*256+Math.round(ti(gs.b*255,0,255))}getHexString(e=Di){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=cn.workingColorSpace){cn.fromWorkingColorSpace(gs.copy(this),t);const i=gs.r,s=gs.g,o=gs.b,r=Math.max(i,s,o),a=Math.min(i,s,o);let l,g;const c=(a+r)/2;if(a===r)l=0,g=0;else{const u=r-a;switch(g=c<=.5?u/(r+a):u/(2-r-a),r){case i:l=(s-o)/u+(s<o?6:0);break;case s:l=(o-i)/u+2;break;case o:l=(i-s)/u+4;break}l/=6}return e.h=l,e.s=g,e.l=c,e}getRGB(e,t=cn.workingColorSpace){return cn.fromWorkingColorSpace(gs.copy(this),t),e.r=gs.r,e.g=gs.g,e.b=gs.b,e}getStyle(e=Di){cn.fromWorkingColorSpace(gs.copy(this),e);const t=gs.r,i=gs.g,s=gs.b;return e!==Di?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(e,t,i){return this.getHSL(yl),this.setHSL(yl.h+e,yl.s+t,yl.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(yl),e.getHSL(Mp);const i=UC(yl.h,Mp.h,t),s=UC(yl.s,Mp.s,t),o=UC(yl.l,Mp.l,t);return this.setHSL(i,s,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,s=this.b,o=e.elements;return this.r=o[0]*t+o[3]*i+o[6]*s,this.g=o[1]*t+o[4]*i+o[7]*s,this.b=o[2]*t+o[5]*i+o[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const gs=new Pe;Pe.NAMES=yT;let bD=0;class Un extends Mr{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:bD++}),this.uuid=Go(),this.name="",this.type="Material",this.blending=Rc,this.side=Rr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ef,this.blendDst=Yf,this.blendEquation=Fl,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Pe(0,0,0),this.blendAlpha=0,this.depthFunc=_c,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=m2,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rc,this.stencilZFail=rc,this.stencilZPass=rc,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const s=this[t];if(s===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Rc&&(i.blending=this.blending),this.side!==Rr&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Ef&&(i.blendSrc=this.blendSrc),this.blendDst!==Yf&&(i.blendDst=this.blendDst),this.blendEquation!==Fl&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==_c&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==m2&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==rc&&(i.stencilFail=this.stencilFail),this.stencilZFail!==rc&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==rc&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(o){const r=[];for(const a in o){const l=o[a];delete l.metadata,r.push(l)}return r}if(t){const o=s(e.textures),r=s(e.images);o.length>0&&(i.textures=o),r.length>0&&(i.images=r)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const s=t.length;i=new Array(s);for(let o=0;o!==s;++o)i[o]=t[o].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Hi extends Un{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Pe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Gs,this.combine=tA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Va=yD();function yD(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),s=new Uint32Array(512);for(let l=0;l<256;++l){const g=l-127;g<-27?(i[l]=0,i[l|256]=32768,s[l]=24,s[l|256]=24):g<-14?(i[l]=1024>>-g-14,i[l|256]=1024>>-g-14|32768,s[l]=-g-1,s[l|256]=-g-1):g<=15?(i[l]=g+15<<10,i[l|256]=g+15<<10|32768,s[l]=13,s[l|256]=13):g<128?(i[l]=31744,i[l|256]=64512,s[l]=24,s[l|256]=24):(i[l]=31744,i[l|256]=64512,s[l]=13,s[l|256]=13)}const o=new Uint32Array(2048),r=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let g=l<<13,c=0;for(;!(g&8388608);)g<<=1,c-=8388608;g&=-8388609,c+=947912704,o[l]=g|c}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)r[l]=l<<23;r[31]=1199570944,r[32]=2147483648;for(let l=33;l<63;++l)r[l]=2147483648+(l-32<<23);r[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:s,mantissaTable:o,exponentTable:r,offsetTable:a}}function Js(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=ti(n,-65504,65504),Va.floatView[0]=n;const e=Va.uint32View[0],t=e>>23&511;return Va.baseTable[t]+((e&8388607)>>Va.shiftTable[t])}function SC(n){const e=n>>10;return Va.uint32View[0]=Va.mantissaTable[Va.offsetTable[e]+(n&1023)]+Va.exponentTable[e],Va.floatView[0]}const BD={toHalfFloat:Js,fromHalfFloat:SC},fi=new _,Np=new ye;class Pt{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Rh,this.updateRanges=[],this.gpuType=Xs,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let s=0,o=this.itemSize;s<o;s++)this.array[e+s]=t.array[i+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Np.fromBufferAttribute(this,t),Np.applyMatrix3(e),this.setXY(t,Np.x,Np.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)fi.fromBufferAttribute(this,t),fi.applyMatrix3(e),this.setXYZ(t,fi.x,fi.y,fi.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)fi.fromBufferAttribute(this,t),fi.applyMatrix4(e),this.setXYZ(t,fi.x,fi.y,fi.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)fi.fromBufferAttribute(this,t),fi.applyNormalMatrix(e),this.setXYZ(t,fi.x,fi.y,fi.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)fi.fromBufferAttribute(this,t),fi.transformDirection(e),this.setXYZ(t,fi.x,fi.y,fi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Hs(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Yt(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Hs(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Hs(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Hs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Hs(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array),s=Yt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this}setXYZW(e,t,i,s,o){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array),s=Yt(s,this.array),o=Yt(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=s,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Rh&&(e.usage=this.usage),e}}class GD extends Pt{constructor(e,t,i){super(new Int8Array(e),t,i)}}class vD extends Pt{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class wD extends Pt{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class ZD extends Pt{constructor(e,t,i){super(new Int16Array(e),t,i)}}class HZ extends Pt{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class SD extends Pt{constructor(e,t,i){super(new Int32Array(e),t,i)}}class XZ extends Pt{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class RD extends Pt{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=SC(this.array[e*this.itemSize]);return this.normalized&&(t=Hs(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize]=Js(t),this}getY(e){let t=SC(this.array[e*this.itemSize+1]);return this.normalized&&(t=Hs(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+1]=Js(t),this}getZ(e){let t=SC(this.array[e*this.itemSize+2]);return this.normalized&&(t=Hs(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+2]=Js(t),this}getW(e){let t=SC(this.array[e*this.itemSize+3]);return this.normalized&&(t=Hs(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yt(t,this.array)),this.array[e*this.itemSize+3]=Js(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array)),this.array[e+0]=Js(t),this.array[e+1]=Js(i),this}setXYZ(e,t,i,s){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array),s=Yt(s,this.array)),this.array[e+0]=Js(t),this.array[e+1]=Js(i),this.array[e+2]=Js(s),this}setXYZW(e,t,i,s,o){return e*=this.itemSize,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array),s=Yt(s,this.array),o=Yt(o,this.array)),this.array[e+0]=Js(t),this.array[e+1]=Js(i),this.array[e+2]=Js(s),this.array[e+3]=Js(o),this}}class dt extends Pt{constructor(e,t,i){super(new Float32Array(e),t,i)}}let xD=0;const _o=new ct,oG=new Lt,_u=new _,mo=new Ji,eC=new Ji,Wi=new _;class Mt extends Mr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:xD++}),this.uuid=Go(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(pT(e)?XZ:HZ)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const o=new Et().getNormalMatrix(e);i.applyNormalMatrix(o),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _o.makeRotationFromQuaternion(e),this.applyMatrix4(_o),this}rotateX(e){return _o.makeRotationX(e),this.applyMatrix4(_o),this}rotateY(e){return _o.makeRotationY(e),this.applyMatrix4(_o),this}rotateZ(e){return _o.makeRotationZ(e),this.applyMatrix4(_o),this}translate(e,t,i){return _o.makeTranslation(e,t,i),this.applyMatrix4(_o),this}scale(e,t,i){return _o.makeScale(e,t,i),this.applyMatrix4(_o),this}lookAt(e){return oG.lookAt(e),oG.updateMatrix(),this.applyMatrix4(oG.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_u).negate(),this.translate(_u.x,_u.y,_u.z),this}setFromPoints(e){const t=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new dt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ji);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new _(-1/0,-1/0,-1/0),new _(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,s=t.length;i<s;i++){const o=t[i];mo.setFromBufferAttribute(o),this.morphTargetsRelative?(Wi.addVectors(this.boundingBox.min,mo.min),this.boundingBox.expandByPoint(Wi),Wi.addVectors(this.boundingBox.max,mo.max),this.boundingBox.expandByPoint(Wi)):(this.boundingBox.expandByPoint(mo.min),this.boundingBox.expandByPoint(mo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ti);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new _,1/0);return}if(e){const i=this.boundingSphere.center;if(mo.setFromBufferAttribute(e),t)for(let o=0,r=t.length;o<r;o++){const a=t[o];eC.setFromBufferAttribute(a),this.morphTargetsRelative?(Wi.addVectors(mo.min,eC.min),mo.expandByPoint(Wi),Wi.addVectors(mo.max,eC.max),mo.expandByPoint(Wi)):(mo.expandByPoint(eC.min),mo.expandByPoint(eC.max))}mo.getCenter(i);let s=0;for(let o=0,r=e.count;o<r;o++)Wi.fromBufferAttribute(e,o),s=Math.max(s,i.distanceToSquared(Wi));if(t)for(let o=0,r=t.length;o<r;o++){const a=t[o],l=this.morphTargetsRelative;for(let g=0,c=a.count;g<c;g++)Wi.fromBufferAttribute(a,g),l&&(_u.fromBufferAttribute(e,g),Wi.add(_u)),s=Math.max(s,i.distanceToSquared(Wi))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,s=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Pt(new Float32Array(4*i.count),4));const r=this.getAttribute("tangent"),a=[],l=[];for(let S=0;S<i.count;S++)a[S]=new _,l[S]=new _;const g=new _,c=new _,u=new _,C=new ye,h=new ye,p=new ye,b=new _,m=new _;function A(S,F,Z){g.fromBufferAttribute(i,S),c.fromBufferAttribute(i,F),u.fromBufferAttribute(i,Z),C.fromBufferAttribute(o,S),h.fromBufferAttribute(o,F),p.fromBufferAttribute(o,Z),c.sub(g),u.sub(g),h.sub(C),p.sub(C);const x=1/(h.x*p.y-p.x*h.y);isFinite(x)&&(b.copy(c).multiplyScalar(p.y).addScaledVector(u,-h.y).multiplyScalar(x),m.copy(u).multiplyScalar(h.x).addScaledVector(c,-p.x).multiplyScalar(x),a[S].add(b),a[F].add(b),a[Z].add(b),l[S].add(m),l[F].add(m),l[Z].add(m))}let B=this.groups;B.length===0&&(B=[{start:0,count:e.count}]);for(let S=0,F=B.length;S<F;++S){const Z=B[S],x=Z.start,Y=Z.count;for(let T=x,ne=x+Y;T<ne;T+=3)A(e.getX(T+0),e.getX(T+1),e.getX(T+2))}const G=new _,w=new _,N=new _,M=new _;function R(S){N.fromBufferAttribute(s,S),M.copy(N);const F=a[S];G.copy(F),G.sub(N.multiplyScalar(N.dot(F))).normalize(),w.crossVectors(M,F);const x=w.dot(l[S])<0?-1:1;r.setXYZW(S,G.x,G.y,G.z,x)}for(let S=0,F=B.length;S<F;++S){const Z=B[S],x=Z.start,Y=Z.count;for(let T=x,ne=x+Y;T<ne;T+=3)R(e.getX(T+0)),R(e.getX(T+1)),R(e.getX(T+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Pt(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let C=0,h=i.count;C<h;C++)i.setXYZ(C,0,0,0);const s=new _,o=new _,r=new _,a=new _,l=new _,g=new _,c=new _,u=new _;if(e)for(let C=0,h=e.count;C<h;C+=3){const p=e.getX(C+0),b=e.getX(C+1),m=e.getX(C+2);s.fromBufferAttribute(t,p),o.fromBufferAttribute(t,b),r.fromBufferAttribute(t,m),c.subVectors(r,o),u.subVectors(s,o),c.cross(u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,b),g.fromBufferAttribute(i,m),a.add(c),l.add(c),g.add(c),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(b,l.x,l.y,l.z),i.setXYZ(m,g.x,g.y,g.z)}else for(let C=0,h=t.count;C<h;C+=3)s.fromBufferAttribute(t,C+0),o.fromBufferAttribute(t,C+1),r.fromBufferAttribute(t,C+2),c.subVectors(r,o),u.subVectors(s,o),c.cross(u),i.setXYZ(C+0,c.x,c.y,c.z),i.setXYZ(C+1,c.x,c.y,c.z),i.setXYZ(C+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Wi.fromBufferAttribute(e,t),Wi.normalize(),e.setXYZ(t,Wi.x,Wi.y,Wi.z)}toNonIndexed(){function e(a,l){const g=a.array,c=a.itemSize,u=a.normalized,C=new g.constructor(l.length*c);let h=0,p=0;for(let b=0,m=l.length;b<m;b++){a.isInterleavedBufferAttribute?h=l[b]*a.data.stride+a.offset:h=l[b]*c;for(let A=0;A<c;A++)C[p++]=g[h++]}return new Pt(C,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Mt,i=this.index.array,s=this.attributes;for(const a in s){const l=s[a],g=e(l,i);t.setAttribute(a,g)}const o=this.morphAttributes;for(const a in o){const l=[],g=o[a];for(let c=0,u=g.length;c<u;c++){const C=g[c],h=e(C,i);l.push(h)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,l=r.length;a<l;a++){const g=r[a];t.addGroup(g.start,g.count,g.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const g in l)l[g]!==void 0&&(e[g]=l[g]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const g=i[l];e.data.attributes[l]=g.toJSON(e.data)}const s={};let o=!1;for(const l in this.morphAttributes){const g=this.morphAttributes[l],c=[];for(let u=0,C=g.length;u<C;u++){const h=g[u];c.push(h.toJSON(e.data))}c.length>0&&(s[l]=c,o=!0)}o&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const s=e.attributes;for(const g in s){const c=s[g];this.setAttribute(g,c.clone(t))}const o=e.morphAttributes;for(const g in o){const c=[],u=o[g];for(let C=0,h=u.length;C<h;C++)c.push(u[C].clone(t));this.morphAttributes[g]=c}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let g=0,c=r.length;g<c;g++){const u=r[g];this.addGroup(u.start,u.count,u.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const dV=new ct,Lg=new nu,Fp=new Ti,CV=new _,Hp=new _,Xp=new _,Tp=new _,rG=new _,Ep=new _,hV=new _,Yp=new _;class _n extends Lt{constructor(e=new Mt,t=new Hi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=s.length;o<r;o++){const a=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){const i=this.geometry,s=i.attributes.position,o=i.morphAttributes.position,r=i.morphTargetsRelative;t.fromBufferAttribute(s,e);const a=this.morphTargetInfluences;if(o&&a){Ep.set(0,0,0);for(let l=0,g=o.length;l<g;l++){const c=a[l],u=o[l];c!==0&&(rG.fromBufferAttribute(u,e),r?Ep.addScaledVector(rG,c):Ep.addScaledVector(rG.sub(t),c))}t.add(Ep)}return t}raycast(e,t){const i=this.geometry,s=this.material,o=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Fp.copy(i.boundingSphere),Fp.applyMatrix4(o),Lg.copy(e.ray).recast(e.near),!(Fp.containsPoint(Lg.origin)===!1&&(Lg.intersectSphere(Fp,CV)===null||Lg.origin.distanceToSquared(CV)>(e.far-e.near)**2))&&(dV.copy(o).invert(),Lg.copy(e.ray).applyMatrix4(dV),!(i.boundingBox!==null&&Lg.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Lg)))}_computeIntersections(e,t,i){let s;const o=this.geometry,r=this.material,a=o.index,l=o.attributes.position,g=o.attributes.uv,c=o.attributes.uv1,u=o.attributes.normal,C=o.groups,h=o.drawRange;if(a!==null)if(Array.isArray(r))for(let p=0,b=C.length;p<b;p++){const m=C[p],A=r[m.materialIndex],B=Math.max(m.start,h.start),G=Math.min(a.count,Math.min(m.start+m.count,h.start+h.count));for(let w=B,N=G;w<N;w+=3){const M=a.getX(w),R=a.getX(w+1),S=a.getX(w+2);s=Kp(this,A,e,i,g,c,u,M,R,S),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const p=Math.max(0,h.start),b=Math.min(a.count,h.start+h.count);for(let m=p,A=b;m<A;m+=3){const B=a.getX(m),G=a.getX(m+1),w=a.getX(m+2);s=Kp(this,r,e,i,g,c,u,B,G,w),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}else if(l!==void 0)if(Array.isArray(r))for(let p=0,b=C.length;p<b;p++){const m=C[p],A=r[m.materialIndex],B=Math.max(m.start,h.start),G=Math.min(l.count,Math.min(m.start+m.count,h.start+h.count));for(let w=B,N=G;w<N;w+=3){const M=w,R=w+1,S=w+2;s=Kp(this,A,e,i,g,c,u,M,R,S),s&&(s.faceIndex=Math.floor(w/3),s.face.materialIndex=m.materialIndex,t.push(s))}}else{const p=Math.max(0,h.start),b=Math.min(l.count,h.start+h.count);for(let m=p,A=b;m<A;m+=3){const B=m,G=m+1,w=m+2;s=Kp(this,r,e,i,g,c,u,B,G,w),s&&(s.faceIndex=Math.floor(m/3),t.push(s))}}}}function VD(n,e,t,i,s,o,r,a){let l;if(e.side===Es?l=i.intersectTriangle(r,o,s,!0,a):l=i.intersectTriangle(s,o,r,e.side===Rr,a),l===null)return null;Yp.copy(a),Yp.applyMatrix4(n.matrixWorld);const g=t.ray.origin.distanceTo(Yp);return g<t.near||g>t.far?null:{distance:g,point:Yp.clone(),object:n}}function Kp(n,e,t,i,s,o,r,a,l,g){n.getVertexPosition(a,Hp),n.getVertexPosition(l,Xp),n.getVertexPosition(g,Tp);const c=VD(n,e,t,i,Hp,Xp,Tp,hV);if(c){const u=new _;$s.getBarycoord(hV,Hp,Xp,Tp,u),s&&(c.uv=$s.getInterpolatedAttribute(s,a,l,g,u,new ye)),o&&(c.uv1=$s.getInterpolatedAttribute(o,a,l,g,u,new ye)),r&&(c.normal=$s.getInterpolatedAttribute(r,a,l,g,u,new _),c.normal.dot(i.direction)>0&&c.normal.multiplyScalar(-1));const C={a,b:l,c:g,normal:new _,materialIndex:0};$s.getNormal(Hp,Xp,Tp,C.normal),c.face=C,c.barycoord=u}return c}class iu extends Mt{constructor(e=1,t=1,i=1,s=1,o=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:s,heightSegments:o,depthSegments:r};const a=this;s=Math.floor(s),o=Math.floor(o),r=Math.floor(r);const l=[],g=[],c=[],u=[];let C=0,h=0;p("z","y","x",-1,-1,i,t,e,r,o,0),p("z","y","x",1,-1,i,t,-e,r,o,1),p("x","z","y",1,1,e,i,t,s,r,2),p("x","z","y",1,-1,e,i,-t,s,r,3),p("x","y","z",1,-1,e,t,i,s,o,4),p("x","y","z",-1,-1,e,t,-i,s,o,5),this.setIndex(l),this.setAttribute("position",new dt(g,3)),this.setAttribute("normal",new dt(c,3)),this.setAttribute("uv",new dt(u,2));function p(b,m,A,B,G,w,N,M,R,S,F){const Z=w/R,x=N/S,Y=w/2,T=N/2,ne=M/2,ue=R+1,se=S+1;let Ie=0,k=0;const ee=new _;for(let $=0;$<se;$++){const ae=$*x-T;for(let be=0;be<ue;be++){const me=be*Z-Y;ee[b]=me*B,ee[m]=ae*G,ee[A]=ne,g.push(ee.x,ee.y,ee.z),ee[b]=0,ee[m]=0,ee[A]=M>0?1:-1,c.push(ee.x,ee.y,ee.z),u.push(be/R),u.push(1-$/S),Ie+=1}}for(let $=0;$<S;$++)for(let ae=0;ae<R;ae++){const be=C+ae+ue*$,me=C+ae+ue*($+1),ce=C+(ae+1)+ue*($+1),Be=C+(ae+1)+ue*$;l.push(be,me,Be),l.push(me,ce,Be),k+=6}a.addGroup(h,k,F),h+=k,C+=Ie}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new iu(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function zI(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const s=n[t][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=s.clone():Array.isArray(s)?e[t][i]=s.slice():e[t][i]=s}}return e}function Ws(n){const e={};for(let t=0;t<n.length;t++){const i=zI(n[t]);for(const s in i)e[s]=i[s]}return e}function WD(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function BT(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:cn.workingColorSpace}const GT={clone:zI,merge:Ws};var MD=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ND=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class tr extends Un{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=MD,this.fragmentShader=ND,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=zI(e.uniforms),this.uniformsGroups=WD(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const s in this.uniforms){const r=this.uniforms[s].value;r&&r.isTexture?t.uniforms[s]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[s]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[s]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[s]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[s]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[s]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[s]={type:"m4",value:r.toArray()}:t.uniforms[s]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class rd extends Lt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ct,this.projectionMatrix=new ct,this.projectionMatrixInverse=new ct,this.coordinateSystem=jr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Bl=new _,AV=new ye,pV=new ye;let Wn=class extends rd{constructor(e=50,t=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=kI*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Vc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return kI*2*Math.atan(Math.tan(Vc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Bl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Bl.x,Bl.y).multiplyScalar(-e/Bl.z),Bl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Bl.x,Bl.y).multiplyScalar(-e/Bl.z)}getViewSize(e,t){return this.getViewBounds(e,AV,pV),t.subVectors(pV,AV)}setViewOffset(e,t,i,s,o,r){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Vc*.5*this.fov)/this.zoom,i=2*t,s=this.aspect*i,o=-.5*s;const r=this.view;if(this.view!==null&&this.view.enabled){const l=r.fullWidth,g=r.fullHeight;o+=r.offsetX*s/l,t-=r.offsetY*i/g,s*=r.width/l,i*=r.height/g}const a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+s,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const Lu=-90,ku=1;class TZ extends Lt{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Wn(Lu,ku,e,t);s.layers=this.layers,this.add(s);const o=new Wn(Lu,ku,e,t);o.layers=this.layers,this.add(o);const r=new Wn(Lu,ku,e,t);r.layers=this.layers,this.add(r);const a=new Wn(Lu,ku,e,t);a.layers=this.layers,this.add(a);const l=new Wn(Lu,ku,e,t);l.layers=this.layers,this.add(l);const g=new Wn(Lu,ku,e,t);g.layers=this.layers,this.add(g)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,s,o,r,a,l]=t;for(const g of t)this.remove(g);if(e===jr)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===xh)i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const g of t)this.add(g),g.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,r,a,l,g,c]=this.children,u=e.getRenderTarget(),C=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const b=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,s),e.render(t,o),e.setRenderTarget(i,1,s),e.render(t,r),e.setRenderTarget(i,2,s),e.render(t,a),e.setRenderTarget(i,3,s),e.render(t,l),e.setRenderTarget(i,4,s),e.render(t,g),i.texture.generateMipmaps=b,e.setRenderTarget(i,5,s),e.render(t,c),e.setRenderTarget(u,C,h),e.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class rA extends Bn{constructor(e,t,i,s,o,r,a,l,g,c){e=e!==void 0?e:[],t=t!==void 0?t:Oa,super(e,t,i,s,o,r,a,l,g,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class EZ extends Ys{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},s=[i,i,i,i,i,i];this.texture=new rA(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:fn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new iu(5,5,5),o=new tr({name:"CubemapFromEquirect",uniforms:zI(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Es,blending:ea});o.uniforms.tEquirect.value=t;const r=new _n(s,o),a=t.minFilter;return t.minFilter===no&&(t.minFilter=fn),new TZ(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,i,s){const o=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,i,s);e.setRenderTarget(o)}}const aG=new _,FD=new _,HD=new Et;class Jr{constructor(e=new _(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,s){return this.normal.set(e,t,i),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const s=aG.subVectors(i,t).cross(FD.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(aG),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/s;return o<0||o>1?null:t.copy(e.start).addScaledVector(i,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||HD.getNormalMatrix(e),s=this.coplanarPoint(aG).applyMatrix4(e),o=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const kg=new Ti,_p=new _;class aA{constructor(e=new Jr,t=new Jr,i=new Jr,s=new Jr,o=new Jr,r=new Jr){this.planes=[e,t,i,s,o,r]}set(e,t,i,s,o,r){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(s),a[4].copy(o),a[5].copy(r),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=jr){const i=this.planes,s=e.elements,o=s[0],r=s[1],a=s[2],l=s[3],g=s[4],c=s[5],u=s[6],C=s[7],h=s[8],p=s[9],b=s[10],m=s[11],A=s[12],B=s[13],G=s[14],w=s[15];if(i[0].setComponents(l-o,C-g,m-h,w-A).normalize(),i[1].setComponents(l+o,C+g,m+h,w+A).normalize(),i[2].setComponents(l+r,C+c,m+p,w+B).normalize(),i[3].setComponents(l-r,C-c,m-p,w-B).normalize(),i[4].setComponents(l-a,C-u,m-b,w-G).normalize(),t===jr)i[5].setComponents(l+a,C+u,m+b,w+G).normalize();else if(t===xh)i[5].setComponents(a,u,b,G).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),kg.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),kg.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(kg)}intersectsSprite(e){return kg.center.set(0,0,0),kg.radius=.7071067811865476,kg.applyMatrix4(e.matrixWorld),this.intersectsSphere(kg)}intersectsSphere(e){const t=this.planes,i=e.center,s=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(i)<s)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const s=t[i];if(_p.x=s.normal.x>0?e.max.x:e.min.x,_p.y=s.normal.y>0?e.max.y:e.min.y,_p.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(_p)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function vT(){let n=null,e=!1,t=null,i=null;function s(o,r){t(o,r),i=n.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(s),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function XD(n){const e=new WeakMap;function t(a,l){const g=a.array,c=a.usage,u=g.byteLength,C=n.createBuffer();n.bindBuffer(l,C),n.bufferData(l,g,c),a.onUploadCallback();let h;if(g instanceof Float32Array)h=n.FLOAT;else if(g instanceof Uint16Array)a.isFloat16BufferAttribute?h=n.HALF_FLOAT:h=n.UNSIGNED_SHORT;else if(g instanceof Int16Array)h=n.SHORT;else if(g instanceof Uint32Array)h=n.UNSIGNED_INT;else if(g instanceof Int32Array)h=n.INT;else if(g instanceof Int8Array)h=n.BYTE;else if(g instanceof Uint8Array)h=n.UNSIGNED_BYTE;else if(g instanceof Uint8ClampedArray)h=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:C,type:h,bytesPerElement:g.BYTES_PER_ELEMENT,version:a.version,size:u}}function i(a,l,g){const c=l.array,u=l.updateRanges;if(n.bindBuffer(g,a),u.length===0)n.bufferSubData(g,0,c);else{u.sort((h,p)=>h.start-p.start);let C=0;for(let h=1;h<u.length;h++){const p=u[C],b=u[h];b.start<=p.start+p.count+1?p.count=Math.max(p.count,b.start+b.count-p.start):(++C,u[C]=b)}u.length=C+1;for(let h=0,p=u.length;h<p;h++){const b=u[h];n.bufferSubData(g,b.start*c.BYTES_PER_ELEMENT,c,b.start,b.count)}l.clearUpdateRanges()}l.onUploadCallback()}function s(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function o(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function r(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const c=e.get(a);(!c||c.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const g=e.get(a);if(g===void 0)e.set(a,t(a,l));else if(g.version<a.version){if(g.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(g.buffer,a,l),g.version=a.version}}return{get:s,remove:o,update:r}}class ad extends Mt{constructor(e=1,t=1,i=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:s};const o=e/2,r=t/2,a=Math.floor(i),l=Math.floor(s),g=a+1,c=l+1,u=e/a,C=t/l,h=[],p=[],b=[],m=[];for(let A=0;A<c;A++){const B=A*C-r;for(let G=0;G<g;G++){const w=G*u-o;p.push(w,-B,0),b.push(0,0,1),m.push(G/a),m.push(1-A/l)}}for(let A=0;A<l;A++)for(let B=0;B<a;B++){const G=B+g*A,w=B+g*(A+1),N=B+1+g*(A+1),M=B+1+g*A;h.push(G,w,M),h.push(w,N,M)}this.setIndex(h),this.setAttribute("position",new dt(p,3)),this.setAttribute("normal",new dt(b,3)),this.setAttribute("uv",new dt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ad(e.width,e.height,e.widthSegments,e.heightSegments)}}var TD=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,ED=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,YD=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,KD=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_D=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,LD=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,kD=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,zD=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DD=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,PD=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,UD=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,JD=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,OD=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,QD=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,jD=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,qD=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,$D=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,eP=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,tP=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,nP=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,iP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,sP=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,oP=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,rP=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,aP=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,lP=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,gP=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,cP=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,uP=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,IP=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,dP="gl_FragColor = linearToOutputTexel( gl_FragColor );",CP=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,hP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,AP=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,pP=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,mP=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,fP=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,bP=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,yP=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,BP=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,GP=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,vP=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,wP=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,ZP=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,SP=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,RP=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,xP=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,VP=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,WP=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,MP=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,NP=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,FP=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,HP=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,XP=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,TP=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,EP=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,YP=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,KP=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,_P=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,LP=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,kP=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,zP=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,DP=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,PP=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,UP=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,JP=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,OP=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,QP=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,jP=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,qP=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,$P=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,eU=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,tU=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,nU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,iU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,sU=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,oU=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,rU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,aU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,lU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,gU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,cU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,uU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,IU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,dU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,CU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,hU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,AU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,pU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,mU=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,fU=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,bU=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,yU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,BU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,GU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,vU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,wU=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,ZU=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,SU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,RU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,xU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,VU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,WU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,MU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,NU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,FU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,HU=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const XU=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,TU=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,EU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,YU=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,KU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,_U=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,LU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,kU=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,zU=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,DU=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,PU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,UU=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JU=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,OU=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,QU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,jU=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,qU=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,$U=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,eJ=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,tJ=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,nJ=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,iJ=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,sJ=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,oJ=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rJ=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,aJ=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,lJ=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gJ=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cJ=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,uJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,IJ=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dJ=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,CJ=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,hJ=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,_t={alphahash_fragment:TD,alphahash_pars_fragment:ED,alphamap_fragment:YD,alphamap_pars_fragment:KD,alphatest_fragment:_D,alphatest_pars_fragment:LD,aomap_fragment:kD,aomap_pars_fragment:zD,batching_pars_vertex:DD,batching_vertex:PD,begin_vertex:UD,beginnormal_vertex:JD,bsdfs:OD,iridescence_fragment:QD,bumpmap_pars_fragment:jD,clipping_planes_fragment:qD,clipping_planes_pars_fragment:$D,clipping_planes_pars_vertex:eP,clipping_planes_vertex:tP,color_fragment:nP,color_pars_fragment:iP,color_pars_vertex:sP,color_vertex:oP,common:rP,cube_uv_reflection_fragment:aP,defaultnormal_vertex:lP,displacementmap_pars_vertex:gP,displacementmap_vertex:cP,emissivemap_fragment:uP,emissivemap_pars_fragment:IP,colorspace_fragment:dP,colorspace_pars_fragment:CP,envmap_fragment:hP,envmap_common_pars_fragment:AP,envmap_pars_fragment:pP,envmap_pars_vertex:mP,envmap_physical_pars_fragment:xP,envmap_vertex:fP,fog_vertex:bP,fog_pars_vertex:yP,fog_fragment:BP,fog_pars_fragment:GP,gradientmap_pars_fragment:vP,lightmap_pars_fragment:wP,lights_lambert_fragment:ZP,lights_lambert_pars_fragment:SP,lights_pars_begin:RP,lights_toon_fragment:VP,lights_toon_pars_fragment:WP,lights_phong_fragment:MP,lights_phong_pars_fragment:NP,lights_physical_fragment:FP,lights_physical_pars_fragment:HP,lights_fragment_begin:XP,lights_fragment_maps:TP,lights_fragment_end:EP,logdepthbuf_fragment:YP,logdepthbuf_pars_fragment:KP,logdepthbuf_pars_vertex:_P,logdepthbuf_vertex:LP,map_fragment:kP,map_pars_fragment:zP,map_particle_fragment:DP,map_particle_pars_fragment:PP,metalnessmap_fragment:UP,metalnessmap_pars_fragment:JP,morphinstance_vertex:OP,morphcolor_vertex:QP,morphnormal_vertex:jP,morphtarget_pars_vertex:qP,morphtarget_vertex:$P,normal_fragment_begin:eU,normal_fragment_maps:tU,normal_pars_fragment:nU,normal_pars_vertex:iU,normal_vertex:sU,normalmap_pars_fragment:oU,clearcoat_normal_fragment_begin:rU,clearcoat_normal_fragment_maps:aU,clearcoat_pars_fragment:lU,iridescence_pars_fragment:gU,opaque_fragment:cU,packing:uU,premultiplied_alpha_fragment:IU,project_vertex:dU,dithering_fragment:CU,dithering_pars_fragment:hU,roughnessmap_fragment:AU,roughnessmap_pars_fragment:pU,shadowmap_pars_fragment:mU,shadowmap_pars_vertex:fU,shadowmap_vertex:bU,shadowmask_pars_fragment:yU,skinbase_vertex:BU,skinning_pars_vertex:GU,skinning_vertex:vU,skinnormal_vertex:wU,specularmap_fragment:ZU,specularmap_pars_fragment:SU,tonemapping_fragment:RU,tonemapping_pars_fragment:xU,transmission_fragment:VU,transmission_pars_fragment:WU,uv_pars_fragment:MU,uv_pars_vertex:NU,uv_vertex:FU,worldpos_vertex:HU,background_vert:XU,background_frag:TU,backgroundCube_vert:EU,backgroundCube_frag:YU,cube_vert:KU,cube_frag:_U,depth_vert:LU,depth_frag:kU,distanceRGBA_vert:zU,distanceRGBA_frag:DU,equirect_vert:PU,equirect_frag:UU,linedashed_vert:JU,linedashed_frag:OU,meshbasic_vert:QU,meshbasic_frag:jU,meshlambert_vert:qU,meshlambert_frag:$U,meshmatcap_vert:eJ,meshmatcap_frag:tJ,meshnormal_vert:nJ,meshnormal_frag:iJ,meshphong_vert:sJ,meshphong_frag:oJ,meshphysical_vert:rJ,meshphysical_frag:aJ,meshtoon_vert:lJ,meshtoon_frag:gJ,points_vert:cJ,points_frag:uJ,shadow_vert:IJ,shadow_frag:dJ,sprite_vert:CJ,sprite_frag:hJ},je={common:{diffuse:{value:new Pe(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Et},alphaMap:{value:null},alphaMapTransform:{value:new Et},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Et}},envmap:{envMap:{value:null},envMapRotation:{value:new Et},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Et}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Et}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Et},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Et},normalScale:{value:new ye(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Et},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Et}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Et}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Et}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Pe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Pe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Et},alphaTest:{value:0},uvTransform:{value:new Et}},sprite:{diffuse:{value:new Pe(16777215)},opacity:{value:1},center:{value:new ye(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Et},alphaMap:{value:null},alphaMapTransform:{value:new Et},alphaTest:{value:0}}},br={basic:{uniforms:Ws([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.fog]),vertexShader:_t.meshbasic_vert,fragmentShader:_t.meshbasic_frag},lambert:{uniforms:Ws([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new Pe(0)}}]),vertexShader:_t.meshlambert_vert,fragmentShader:_t.meshlambert_frag},phong:{uniforms:Ws([je.common,je.specularmap,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.fog,je.lights,{emissive:{value:new Pe(0)},specular:{value:new Pe(1118481)},shininess:{value:30}}]),vertexShader:_t.meshphong_vert,fragmentShader:_t.meshphong_frag},standard:{uniforms:Ws([je.common,je.envmap,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.roughnessmap,je.metalnessmap,je.fog,je.lights,{emissive:{value:new Pe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:_t.meshphysical_vert,fragmentShader:_t.meshphysical_frag},toon:{uniforms:Ws([je.common,je.aomap,je.lightmap,je.emissivemap,je.bumpmap,je.normalmap,je.displacementmap,je.gradientmap,je.fog,je.lights,{emissive:{value:new Pe(0)}}]),vertexShader:_t.meshtoon_vert,fragmentShader:_t.meshtoon_frag},matcap:{uniforms:Ws([je.common,je.bumpmap,je.normalmap,je.displacementmap,je.fog,{matcap:{value:null}}]),vertexShader:_t.meshmatcap_vert,fragmentShader:_t.meshmatcap_frag},points:{uniforms:Ws([je.points,je.fog]),vertexShader:_t.points_vert,fragmentShader:_t.points_frag},dashed:{uniforms:Ws([je.common,je.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_t.linedashed_vert,fragmentShader:_t.linedashed_frag},depth:{uniforms:Ws([je.common,je.displacementmap]),vertexShader:_t.depth_vert,fragmentShader:_t.depth_frag},normal:{uniforms:Ws([je.common,je.bumpmap,je.normalmap,je.displacementmap,{opacity:{value:1}}]),vertexShader:_t.meshnormal_vert,fragmentShader:_t.meshnormal_frag},sprite:{uniforms:Ws([je.sprite,je.fog]),vertexShader:_t.sprite_vert,fragmentShader:_t.sprite_frag},background:{uniforms:{uvTransform:{value:new Et},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:_t.background_vert,fragmentShader:_t.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Et}},vertexShader:_t.backgroundCube_vert,fragmentShader:_t.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:_t.cube_vert,fragmentShader:_t.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_t.equirect_vert,fragmentShader:_t.equirect_frag},distanceRGBA:{uniforms:Ws([je.common,je.displacementmap,{referencePosition:{value:new _},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_t.distanceRGBA_vert,fragmentShader:_t.distanceRGBA_frag},shadow:{uniforms:Ws([je.lights,je.fog,{color:{value:new Pe(0)},opacity:{value:1}}]),vertexShader:_t.shadow_vert,fragmentShader:_t.shadow_frag}};br.physical={uniforms:Ws([br.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Et},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Et},clearcoatNormalScale:{value:new ye(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Et},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Et},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Et},sheen:{value:0},sheenColor:{value:new Pe(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Et},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Et},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Et},transmissionSamplerSize:{value:new ye},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Et},attenuationDistance:{value:0},attenuationColor:{value:new Pe(0)},specularColor:{value:new Pe(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Et},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Et},anisotropyVector:{value:new ye},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Et}}]),vertexShader:_t.meshphysical_vert,fragmentShader:_t.meshphysical_frag};const Lp={r:0,b:0,g:0},zg=new Gs,AJ=new ct;function pJ(n,e,t,i,s,o,r){const a=new Pe(0);let l=o===!0?0:1,g,c,u=null,C=0,h=null;function p(B){let G=B.isScene===!0?B.background:null;return G&&G.isTexture&&(G=(B.backgroundBlurriness>0?t:e).get(G)),G}function b(B){let G=!1;const w=p(B);w===null?A(a,l):w&&w.isColor&&(A(w,1),G=!0);const N=n.xr.getEnvironmentBlendMode();N==="additive"?i.buffers.color.setClear(0,0,0,1,r):N==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,r),(n.autoClear||G)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function m(B,G){const w=p(G);w&&(w.isCubeTexture||w.mapping===od)?(c===void 0&&(c=new _n(new iu(1,1,1),new tr({name:"BackgroundCubeMaterial",uniforms:zI(br.backgroundCube.uniforms),vertexShader:br.backgroundCube.vertexShader,fragmentShader:br.backgroundCube.fragmentShader,side:Es,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(N,M,R){this.matrixWorld.copyPosition(R.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(c)),zg.copy(G.backgroundRotation),zg.x*=-1,zg.y*=-1,zg.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(zg.y*=-1,zg.z*=-1),c.material.uniforms.envMap.value=w,c.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=G.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=G.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(AJ.makeRotationFromEuler(zg)),c.material.toneMapped=cn.getTransfer(w.colorSpace)!==xn,(u!==w||C!==w.version||h!==n.toneMapping)&&(c.material.needsUpdate=!0,u=w,C=w.version,h=n.toneMapping),c.layers.enableAll(),B.unshift(c,c.geometry,c.material,0,0,null)):w&&w.isTexture&&(g===void 0&&(g=new _n(new ad(2,2),new tr({name:"BackgroundMaterial",uniforms:zI(br.background.uniforms),vertexShader:br.background.vertexShader,fragmentShader:br.background.fragmentShader,side:Rr,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),Object.defineProperty(g.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(g)),g.material.uniforms.t2D.value=w,g.material.uniforms.backgroundIntensity.value=G.backgroundIntensity,g.material.toneMapped=cn.getTransfer(w.colorSpace)!==xn,w.matrixAutoUpdate===!0&&w.updateMatrix(),g.material.uniforms.uvTransform.value.copy(w.matrix),(u!==w||C!==w.version||h!==n.toneMapping)&&(g.material.needsUpdate=!0,u=w,C=w.version,h=n.toneMapping),g.layers.enableAll(),B.unshift(g,g.geometry,g.material,0,0,null))}function A(B,G){B.getRGB(Lp,BT(n)),i.buffers.color.setClear(Lp.r,Lp.g,Lp.b,G,r)}return{getClearColor:function(){return a},setClearColor:function(B,G=1){a.set(B),l=G,A(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(B){l=B,A(a,l)},render:b,addToRenderList:m}}function mJ(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},s=C(null);let o=s,r=!1;function a(Z,x,Y,T,ne){let ue=!1;const se=u(T,Y,x);o!==se&&(o=se,g(o.object)),ue=h(Z,T,Y,ne),ue&&p(Z,T,Y,ne),ne!==null&&e.update(ne,n.ELEMENT_ARRAY_BUFFER),(ue||r)&&(r=!1,w(Z,x,Y,T),ne!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(ne).buffer))}function l(){return n.createVertexArray()}function g(Z){return n.bindVertexArray(Z)}function c(Z){return n.deleteVertexArray(Z)}function u(Z,x,Y){const T=Y.wireframe===!0;let ne=i[Z.id];ne===void 0&&(ne={},i[Z.id]=ne);let ue=ne[x.id];ue===void 0&&(ue={},ne[x.id]=ue);let se=ue[T];return se===void 0&&(se=C(l()),ue[T]=se),se}function C(Z){const x=[],Y=[],T=[];for(let ne=0;ne<t;ne++)x[ne]=0,Y[ne]=0,T[ne]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:x,enabledAttributes:Y,attributeDivisors:T,object:Z,attributes:{},index:null}}function h(Z,x,Y,T){const ne=o.attributes,ue=x.attributes;let se=0;const Ie=Y.getAttributes();for(const k in Ie)if(Ie[k].location>=0){const $=ne[k];let ae=ue[k];if(ae===void 0&&(k==="instanceMatrix"&&Z.instanceMatrix&&(ae=Z.instanceMatrix),k==="instanceColor"&&Z.instanceColor&&(ae=Z.instanceColor)),$===void 0||$.attribute!==ae||ae&&$.data!==ae.data)return!0;se++}return o.attributesNum!==se||o.index!==T}function p(Z,x,Y,T){const ne={},ue=x.attributes;let se=0;const Ie=Y.getAttributes();for(const k in Ie)if(Ie[k].location>=0){let $=ue[k];$===void 0&&(k==="instanceMatrix"&&Z.instanceMatrix&&($=Z.instanceMatrix),k==="instanceColor"&&Z.instanceColor&&($=Z.instanceColor));const ae={};ae.attribute=$,$&&$.data&&(ae.data=$.data),ne[k]=ae,se++}o.attributes=ne,o.attributesNum=se,o.index=T}function b(){const Z=o.newAttributes;for(let x=0,Y=Z.length;x<Y;x++)Z[x]=0}function m(Z){A(Z,0)}function A(Z,x){const Y=o.newAttributes,T=o.enabledAttributes,ne=o.attributeDivisors;Y[Z]=1,T[Z]===0&&(n.enableVertexAttribArray(Z),T[Z]=1),ne[Z]!==x&&(n.vertexAttribDivisor(Z,x),ne[Z]=x)}function B(){const Z=o.newAttributes,x=o.enabledAttributes;for(let Y=0,T=x.length;Y<T;Y++)x[Y]!==Z[Y]&&(n.disableVertexAttribArray(Y),x[Y]=0)}function G(Z,x,Y,T,ne,ue,se){se===!0?n.vertexAttribIPointer(Z,x,Y,ne,ue):n.vertexAttribPointer(Z,x,Y,T,ne,ue)}function w(Z,x,Y,T){b();const ne=T.attributes,ue=Y.getAttributes(),se=x.defaultAttributeValues;for(const Ie in ue){const k=ue[Ie];if(k.location>=0){let ee=ne[Ie];if(ee===void 0&&(Ie==="instanceMatrix"&&Z.instanceMatrix&&(ee=Z.instanceMatrix),Ie==="instanceColor"&&Z.instanceColor&&(ee=Z.instanceColor)),ee!==void 0){const $=ee.normalized,ae=ee.itemSize,be=e.get(ee);if(be===void 0)continue;const me=be.buffer,ce=be.type,Be=be.bytesPerElement,He=ce===n.INT||ce===n.UNSIGNED_INT||ee.gpuType===hb;if(ee.isInterleavedBufferAttribute){const Fe=ee.data,Ct=Fe.stride,pt=ee.offset;if(Fe.isInstancedInterleavedBuffer){for(let ot=0;ot<k.locationSize;ot++)A(k.location+ot,Fe.meshPerAttribute);Z.isInstancedMesh!==!0&&T._maxInstanceCount===void 0&&(T._maxInstanceCount=Fe.meshPerAttribute*Fe.count)}else for(let ot=0;ot<k.locationSize;ot++)m(k.location+ot);n.bindBuffer(n.ARRAY_BUFFER,me);for(let ot=0;ot<k.locationSize;ot++)G(k.location+ot,ae/k.locationSize,ce,$,Ct*Be,(pt+ae/k.locationSize*ot)*Be,He)}else{if(ee.isInstancedBufferAttribute){for(let Fe=0;Fe<k.locationSize;Fe++)A(k.location+Fe,ee.meshPerAttribute);Z.isInstancedMesh!==!0&&T._maxInstanceCount===void 0&&(T._maxInstanceCount=ee.meshPerAttribute*ee.count)}else for(let Fe=0;Fe<k.locationSize;Fe++)m(k.location+Fe);n.bindBuffer(n.ARRAY_BUFFER,me);for(let Fe=0;Fe<k.locationSize;Fe++)G(k.location+Fe,ae/k.locationSize,ce,$,ae*Be,ae/k.locationSize*Fe*Be,He)}}else if(se!==void 0){const $=se[Ie];if($!==void 0)switch($.length){case 2:n.vertexAttrib2fv(k.location,$);break;case 3:n.vertexAttrib3fv(k.location,$);break;case 4:n.vertexAttrib4fv(k.location,$);break;default:n.vertexAttrib1fv(k.location,$)}}}}B()}function N(){S();for(const Z in i){const x=i[Z];for(const Y in x){const T=x[Y];for(const ne in T)c(T[ne].object),delete T[ne];delete x[Y]}delete i[Z]}}function M(Z){if(i[Z.id]===void 0)return;const x=i[Z.id];for(const Y in x){const T=x[Y];for(const ne in T)c(T[ne].object),delete T[ne];delete x[Y]}delete i[Z.id]}function R(Z){for(const x in i){const Y=i[x];if(Y[Z.id]===void 0)continue;const T=Y[Z.id];for(const ne in T)c(T[ne].object),delete T[ne];delete Y[Z.id]}}function S(){F(),r=!0,o!==s&&(o=s,g(o.object))}function F(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:a,reset:S,resetDefaultState:F,dispose:N,releaseStatesOfGeometry:M,releaseStatesOfProgram:R,initAttributes:b,enableAttribute:m,disableUnusedAttributes:B}}function fJ(n,e,t){let i;function s(g){i=g}function o(g,c){n.drawArrays(i,g,c),t.update(c,i,1)}function r(g,c,u){u!==0&&(n.drawArraysInstanced(i,g,c,u),t.update(c,i,u))}function a(g,c,u){if(u===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,g,0,c,0,u);let h=0;for(let p=0;p<u;p++)h+=c[p];t.update(h,i,1)}function l(g,c,u,C){if(u===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let p=0;p<g.length;p++)r(g[p],c[p],C[p]);else{h.multiDrawArraysInstancedWEBGL(i,g,0,c,0,C,0,u);let p=0;for(let b=0;b<u;b++)p+=c[b];for(let b=0;b<C.length;b++)t.update(p,i,C[b])}}this.setMode=s,this.render=o,this.renderInstances=r,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function bJ(n,e,t,i){let s;function o(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");s=n.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function r(R){return!(R!==fs&&i.convert(R)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(R){const S=R===il&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(R!==Vr&&i.convert(R)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&R!==Xs&&!S)}function l(R){if(R==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let g=t.precision!==void 0?t.precision:"highp";const c=l(g);c!==g&&(console.warn("THREE.WebGLRenderer:",g,"not supported, using",c,"instead."),g=c);const u=t.logarithmicDepthBuffer===!0,C=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control");if(C===!0){const R=e.get("EXT_clip_control");R.clipControlEXT(R.LOWER_LEFT_EXT,R.ZERO_TO_ONE_EXT)}const h=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),p=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=n.getParameter(n.MAX_TEXTURE_SIZE),m=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),A=n.getParameter(n.MAX_VERTEX_ATTRIBS),B=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),G=n.getParameter(n.MAX_VARYING_VECTORS),w=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),N=p>0,M=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:l,textureFormatReadable:r,textureTypeReadable:a,precision:g,logarithmicDepthBuffer:u,reverseDepthBuffer:C,maxTextures:h,maxVertexTextures:p,maxTextureSize:b,maxCubemapSize:m,maxAttributes:A,maxVertexUniforms:B,maxVaryings:G,maxFragmentUniforms:w,vertexTextures:N,maxSamples:M}}function yJ(n){const e=this;let t=null,i=0,s=!1,o=!1;const r=new Jr,a=new Et,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(u,C){const h=u.length!==0||C||i!==0||s;return s=C,i=u.length,h},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(u,C){t=c(u,C,0)},this.setState=function(u,C,h){const p=u.clippingPlanes,b=u.clipIntersection,m=u.clipShadows,A=n.get(u);if(!s||p===null||p.length===0||o&&!m)o?c(null):g();else{const B=o?0:i,G=B*4;let w=A.clippingState||null;l.value=w,w=c(p,C,G,h);for(let N=0;N!==G;++N)w[N]=t[N];A.clippingState=w,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=B}};function g(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function c(u,C,h,p){const b=u!==null?u.length:0;let m=null;if(b!==0){if(m=l.value,p!==!0||m===null){const A=h+b*4,B=C.matrixWorldInverse;a.getNormalMatrix(B),(m===null||m.length<A)&&(m=new Float32Array(A));for(let G=0,w=h;G!==b;++G,w+=4)r.copy(u[G]).applyMatrix4(B,a),r.normal.toArray(m,w),m[w+3]=r.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,m}}function BJ(n){let e=new WeakMap;function t(r,a){return a===Bh?r.mapping=Oa:a===Gh&&(r.mapping=eg),r}function i(r){if(r&&r.isTexture){const a=r.mapping;if(a===Bh||a===Gh)if(e.has(r)){const l=e.get(r).texture;return t(l,r.mapping)}else{const l=r.image;if(l&&l.height>0){const g=new EZ(l.height);return g.fromEquirectangularTexture(n,r),e.set(r,g),r.addEventListener("dispose",s),t(g.texture,r.mapping)}else return null}}return r}function s(r){const a=r.target;a.removeEventListener("dispose",s);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap}return{get:i,dispose:o}}class qo extends rd{constructor(e=-1,t=1,i=1,s=-1,o=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=s,this.near=o,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,s,o,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=s,this.view.width=o,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let o=i-e,r=i+e,a=s+t,l=s-t;if(this.view!==null&&this.view.enabled){const g=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=g*this.view.offsetX,r=o+g*this.view.width,a-=c*this.view.offsetY,l=a-c*this.view.height}this.projectionMatrix.makeOrthographic(o,r,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const CI=4,mV=[.125,.215,.35,.446,.526,.582],uc=20,lG=new qo,fV=new Pe;let gG=null,cG=0,uG=0,IG=!1;const ac=(1+Math.sqrt(5))/2,zu=1/ac,bV=[new _(-ac,zu,0),new _(ac,zu,0),new _(-zu,0,ac),new _(zu,0,ac),new _(0,ac,-zu),new _(0,ac,zu),new _(-1,1,-1),new _(1,1,-1),new _(-1,1,1),new _(1,1,1)];class b2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,s=100){gG=this._renderer.getRenderTarget(),cG=this._renderer.getActiveCubeFace(),uG=this._renderer.getActiveMipmapLevel(),IG=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,i,s,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=GV(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=BV(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(gG,cG,uG),this._renderer.xr.enabled=IG,e.scissorTest=!1,kp(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Oa||e.mapping===eg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),gG=this._renderer.getRenderTarget(),cG=this._renderer.getActiveCubeFace(),uG=this._renderer.getActiveMipmapLevel(),IG=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:fn,minFilter:fn,generateMipmaps:!1,type:il,format:fs,colorSpace:Ei,depthBuffer:!1},s=yV(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=yV(e,t,i);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=GJ(o)),this._blurMaterial=vJ(o,e,t)}return s}_compileMaterial(e){const t=new _n(this._lodPlanes[0],e);this._renderer.compile(t,lG)}_sceneToCubeUV(e,t,i,s){const a=new Wn(90,1,t,i),l=[1,-1,1,1,1,1],g=[1,1,1,-1,-1,-1],c=this._renderer,u=c.autoClear,C=c.toneMapping;c.getClearColor(fV),c.toneMapping=ta,c.autoClear=!1;const h=new Hi({name:"PMREM.Background",side:Es,depthWrite:!1,depthTest:!1}),p=new _n(new iu,h);let b=!1;const m=e.background;m?m.isColor&&(h.color.copy(m),e.background=null,b=!0):(h.color.copy(fV),b=!0);for(let A=0;A<6;A++){const B=A%3;B===0?(a.up.set(0,l[A],0),a.lookAt(g[A],0,0)):B===1?(a.up.set(0,0,l[A]),a.lookAt(0,g[A],0)):(a.up.set(0,l[A],0),a.lookAt(0,0,g[A]));const G=this._cubeSize;kp(s,B*G,A>2?G:0,G,G),c.setRenderTarget(s),b&&c.render(p,a),c.render(e,a)}p.geometry.dispose(),p.material.dispose(),c.toneMapping=C,c.autoClear=u,e.background=m}_textureToCubeUV(e,t){const i=this._renderer,s=e.mapping===Oa||e.mapping===eg;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=GV()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=BV());const o=s?this._cubemapMaterial:this._equirectMaterial,r=new _n(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;const l=this._cubeSize;kp(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(r,lG)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const s=this._lodPlanes.length;for(let o=1;o<s;o++){const r=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),a=bV[(s-o-1)%bV.length];this._blur(e,o-1,o,r,a)}t.autoClear=i}_blur(e,t,i,s,o){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,i,s,"latitudinal",o),this._halfBlur(r,e,i,i,s,"longitudinal",o)}_halfBlur(e,t,i,s,o,r,a){const l=this._renderer,g=this._blurMaterial;r!=="latitudinal"&&r!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,u=new _n(this._lodPlanes[s],g),C=g.uniforms,h=this._sizeLods[i]-1,p=isFinite(o)?Math.PI/(2*h):2*Math.PI/(2*uc-1),b=o/p,m=isFinite(o)?1+Math.floor(c*b):uc;m>uc&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${uc}`);const A=[];let B=0;for(let R=0;R<uc;++R){const S=R/b,F=Math.exp(-S*S/2);A.push(F),R===0?B+=F:R<m&&(B+=2*F)}for(let R=0;R<A.length;R++)A[R]=A[R]/B;C.envMap.value=e.texture,C.samples.value=m,C.weights.value=A,C.latitudinal.value=r==="latitudinal",a&&(C.poleAxis.value=a);const{_lodMax:G}=this;C.dTheta.value=p,C.mipInt.value=G-i;const w=this._sizeLods[s],N=3*w*(s>G-CI?s-G+CI:0),M=4*(this._cubeSize-w);kp(t,N,M,3*w,2*w),l.setRenderTarget(t),l.render(u,lG)}}function GJ(n){const e=[],t=[],i=[];let s=n;const o=n-CI+1+mV.length;for(let r=0;r<o;r++){const a=Math.pow(2,s);t.push(a);let l=1/a;r>n-CI?l=mV[r-n+CI-1]:r===0&&(l=0),i.push(l);const g=1/(a-2),c=-g,u=1+g,C=[c,c,u,c,u,u,c,c,u,u,c,u],h=6,p=6,b=3,m=2,A=1,B=new Float32Array(b*p*h),G=new Float32Array(m*p*h),w=new Float32Array(A*p*h);for(let M=0;M<h;M++){const R=M%3*2/3-1,S=M>2?0:-1,F=[R,S,0,R+2/3,S,0,R+2/3,S+1,0,R,S,0,R+2/3,S+1,0,R,S+1,0];B.set(F,b*p*M),G.set(C,m*p*M);const Z=[M,M,M,M,M,M];w.set(Z,A*p*M)}const N=new Mt;N.setAttribute("position",new Pt(B,b)),N.setAttribute("uv",new Pt(G,m)),N.setAttribute("faceIndex",new Pt(w,A)),e.push(N),s>CI&&s--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function yV(n,e,t){const i=new Ys(n,e,t);return i.texture.mapping=od,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function kp(n,e,t,i,s){n.viewport.set(e,t,i,s),n.scissor.set(e,t,i,s)}function vJ(n,e,t){const i=new Float32Array(uc),s=new _(0,1,0);return new tr({name:"SphericalGaussianBlur",defines:{n:uc,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:YZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ea,depthTest:!1,depthWrite:!1})}function BV(){return new tr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:YZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ea,depthTest:!1,depthWrite:!1})}function GV(){return new tr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:YZ(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ea,depthTest:!1,depthWrite:!1})}function YZ(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function wJ(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,g=l===Bh||l===Gh,c=l===Oa||l===eg;if(g||c){let u=e.get(a);const C=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==C)return t===null&&(t=new b2(n)),u=g?t.fromEquirectangular(a,u):t.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),u.texture;if(u!==void 0)return u.texture;{const h=a.image;return g&&h&&h.height>0||c&&h&&s(h)?(t===null&&(t=new b2(n)),u=g?t.fromEquirectangular(a):t.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,e.set(a,u),a.addEventListener("dispose",o),u.texture):null}}}return a}function s(a){let l=0;const g=6;for(let c=0;c<g;c++)a[c]!==void 0&&l++;return l===g}function o(a){const l=a.target;l.removeEventListener("dispose",o);const g=e.get(l);g!==void 0&&(e.delete(l),g.dispose())}function r(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:r}}function ZJ(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let s;switch(i){case"WEBGL_depth_texture":s=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=n.getExtension(i)}return e[i]=s,s}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const s=t(i);return s===null&&qm("THREE.WebGLRenderer: "+i+" extension not supported."),s}}}function SJ(n,e,t,i){const s={},o=new WeakMap;function r(u){const C=u.target;C.index!==null&&e.remove(C.index);for(const p in C.attributes)e.remove(C.attributes[p]);for(const p in C.morphAttributes){const b=C.morphAttributes[p];for(let m=0,A=b.length;m<A;m++)e.remove(b[m])}C.removeEventListener("dispose",r),delete s[C.id];const h=o.get(C);h&&(e.remove(h),o.delete(C)),i.releaseStatesOfGeometry(C),C.isInstancedBufferGeometry===!0&&delete C._maxInstanceCount,t.memory.geometries--}function a(u,C){return s[C.id]===!0||(C.addEventListener("dispose",r),s[C.id]=!0,t.memory.geometries++),C}function l(u){const C=u.attributes;for(const p in C)e.update(C[p],n.ARRAY_BUFFER);const h=u.morphAttributes;for(const p in h){const b=h[p];for(let m=0,A=b.length;m<A;m++)e.update(b[m],n.ARRAY_BUFFER)}}function g(u){const C=[],h=u.index,p=u.attributes.position;let b=0;if(h!==null){const B=h.array;b=h.version;for(let G=0,w=B.length;G<w;G+=3){const N=B[G+0],M=B[G+1],R=B[G+2];C.push(N,M,M,R,R,N)}}else if(p!==void 0){const B=p.array;b=p.version;for(let G=0,w=B.length/3-1;G<w;G+=3){const N=G+0,M=G+1,R=G+2;C.push(N,M,M,R,R,N)}}else return;const m=new(pT(C)?XZ:HZ)(C,1);m.version=b;const A=o.get(u);A&&e.remove(A),o.set(u,m)}function c(u){const C=o.get(u);if(C){const h=u.index;h!==null&&C.version<h.version&&g(u)}else g(u);return o.get(u)}return{get:a,update:l,getWireframeAttribute:c}}function RJ(n,e,t){let i;function s(C){i=C}let o,r;function a(C){o=C.type,r=C.bytesPerElement}function l(C,h){n.drawElements(i,h,o,C*r),t.update(h,i,1)}function g(C,h,p){p!==0&&(n.drawElementsInstanced(i,h,o,C*r,p),t.update(h,i,p))}function c(C,h,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,h,0,o,C,0,p);let m=0;for(let A=0;A<p;A++)m+=h[A];t.update(m,i,1)}function u(C,h,p,b){if(p===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let A=0;A<C.length;A++)g(C[A]/r,h[A],b[A]);else{m.multiDrawElementsInstancedWEBGL(i,h,0,o,C,0,b,0,p);let A=0;for(let B=0;B<p;B++)A+=h[B];for(let B=0;B<b.length;B++)t.update(A,i,b[B])}}this.setMode=s,this.setIndex=a,this.render=l,this.renderInstances=g,this.renderMultiDraw=c,this.renderMultiDrawInstances=u}function xJ(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(o,r,a){switch(t.calls++,r){case n.TRIANGLES:t.triangles+=a*(o/3);break;case n.LINES:t.lines+=a*(o/2);break;case n.LINE_STRIP:t.lines+=a*(o-1);break;case n.LINE_LOOP:t.lines+=a*o;break;case n.POINTS:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function s(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:i}}function VJ(n,e,t){const i=new WeakMap,s=new rn;function o(r,a,l){const g=r.morphTargetInfluences,c=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=c!==void 0?c.length:0;let C=i.get(a);if(C===void 0||C.count!==u){let F=function(){R.dispose(),i.delete(a),a.removeEventListener("dispose",F)};C!==void 0&&C.texture.dispose();const h=a.morphAttributes.position!==void 0,p=a.morphAttributes.normal!==void 0,b=a.morphAttributes.color!==void 0,m=a.morphAttributes.position||[],A=a.morphAttributes.normal||[],B=a.morphAttributes.color||[];let G=0;h===!0&&(G=1),p===!0&&(G=2),b===!0&&(G=3);let w=a.attributes.position.count*G,N=1;w>e.maxTextureSize&&(N=Math.ceil(w/e.maxTextureSize),w=e.maxTextureSize);const M=new Float32Array(w*N*4*u),R=new vb(M,w,N,u);R.type=Xs,R.needsUpdate=!0;const S=G*4;for(let Z=0;Z<u;Z++){const x=m[Z],Y=A[Z],T=B[Z],ne=w*N*4*Z;for(let ue=0;ue<x.count;ue++){const se=ue*S;h===!0&&(s.fromBufferAttribute(x,ue),M[ne+se+0]=s.x,M[ne+se+1]=s.y,M[ne+se+2]=s.z,M[ne+se+3]=0),p===!0&&(s.fromBufferAttribute(Y,ue),M[ne+se+4]=s.x,M[ne+se+5]=s.y,M[ne+se+6]=s.z,M[ne+se+7]=0),b===!0&&(s.fromBufferAttribute(T,ue),M[ne+se+8]=s.x,M[ne+se+9]=s.y,M[ne+se+10]=s.z,M[ne+se+11]=T.itemSize===4?s.w:1)}}C={count:u,texture:R,size:new ye(w,N)},i.set(a,C),a.addEventListener("dispose",F)}if(r.isInstancedMesh===!0&&r.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",r.morphTexture,t);else{let h=0;for(let b=0;b<g.length;b++)h+=g[b];const p=a.morphTargetsRelative?1:1-h;l.getUniforms().setValue(n,"morphTargetBaseInfluence",p),l.getUniforms().setValue(n,"morphTargetInfluences",g)}l.getUniforms().setValue(n,"morphTargetsTexture",C.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",C.size)}return{update:o}}function WJ(n,e,t,i){let s=new WeakMap;function o(l){const g=i.render.frame,c=l.geometry,u=e.get(l,c);if(s.get(u)!==g&&(e.update(u),s.set(u,g)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),s.get(l)!==g&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),s.set(l,g))),l.isSkinnedMesh){const C=l.skeleton;s.get(C)!==g&&(C.update(),s.set(C,g))}return u}function r(){s=new WeakMap}function a(l){const g=l.target;g.removeEventListener("dispose",a),t.remove(g.instanceMatrix),g.instanceColor!==null&&t.remove(g.instanceColor)}return{update:o,dispose:r}}class lA extends Bn{constructor(e,t,i,s,o,r,a,l,g,c=Pl){if(c!==Pl&&c!==Dc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===Pl&&(i=Qa),i===void 0&&c===Dc&&(i=zc),super(null,s,o,r,a,l,c,i,g),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Bi,this.minFilter=l!==void 0?l:Bi,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const wT=new Bn,vV=new lA(1,1),ZT=new vb,ST=new FZ,RT=new rA,wV=[],ZV=[],SV=new Float32Array(16),RV=new Float32Array(9),xV=new Float32Array(4);function ld(n,e,t){const i=n[0];if(i<=0||i>0)return n;const s=e*t;let o=wV[s];if(o===void 0&&(o=new Float32Array(s),wV[s]=o),e!==0){i.toArray(o,0);for(let r=1,a=0;r!==e;++r)a+=t,n[r].toArray(o,a)}return o}function Si(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ri(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function wb(n,e){let t=ZV[e];t===void 0&&(t=new Int32Array(e),ZV[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function MJ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function NJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Si(t,e))return;n.uniform2fv(this.addr,e),Ri(t,e)}}function FJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Si(t,e))return;n.uniform3fv(this.addr,e),Ri(t,e)}}function HJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Si(t,e))return;n.uniform4fv(this.addr,e),Ri(t,e)}}function XJ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Si(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ri(t,e)}else{if(Si(t,i))return;xV.set(i),n.uniformMatrix2fv(this.addr,!1,xV),Ri(t,i)}}function TJ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Si(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ri(t,e)}else{if(Si(t,i))return;RV.set(i),n.uniformMatrix3fv(this.addr,!1,RV),Ri(t,i)}}function EJ(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Si(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ri(t,e)}else{if(Si(t,i))return;SV.set(i),n.uniformMatrix4fv(this.addr,!1,SV),Ri(t,i)}}function YJ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function KJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Si(t,e))return;n.uniform2iv(this.addr,e),Ri(t,e)}}function _J(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Si(t,e))return;n.uniform3iv(this.addr,e),Ri(t,e)}}function LJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Si(t,e))return;n.uniform4iv(this.addr,e),Ri(t,e)}}function kJ(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function zJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Si(t,e))return;n.uniform2uiv(this.addr,e),Ri(t,e)}}function DJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Si(t,e))return;n.uniform3uiv(this.addr,e),Ri(t,e)}}function PJ(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Si(t,e))return;n.uniform4uiv(this.addr,e),Ri(t,e)}}function UJ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s);let o;this.type===n.SAMPLER_2D_SHADOW?(vV.compareFunction=MZ,o=vV):o=wT,t.setTexture2D(e||o,s)}function JJ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture3D(e||ST,s)}function OJ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTextureCube(e||RT,s)}function QJ(n,e,t){const i=this.cache,s=t.allocateTextureUnit();i[0]!==s&&(n.uniform1i(this.addr,s),i[0]=s),t.setTexture2DArray(e||ZT,s)}function jJ(n){switch(n){case 5126:return MJ;case 35664:return NJ;case 35665:return FJ;case 35666:return HJ;case 35674:return XJ;case 35675:return TJ;case 35676:return EJ;case 5124:case 35670:return YJ;case 35667:case 35671:return KJ;case 35668:case 35672:return _J;case 35669:case 35673:return LJ;case 5125:return kJ;case 36294:return zJ;case 36295:return DJ;case 36296:return PJ;case 35678:case 36198:case 36298:case 36306:case 35682:return UJ;case 35679:case 36299:case 36307:return JJ;case 35680:case 36300:case 36308:case 36293:return OJ;case 36289:case 36303:case 36311:case 36292:return QJ}}function qJ(n,e){n.uniform1fv(this.addr,e)}function $J(n,e){const t=ld(e,this.size,2);n.uniform2fv(this.addr,t)}function eO(n,e){const t=ld(e,this.size,3);n.uniform3fv(this.addr,t)}function tO(n,e){const t=ld(e,this.size,4);n.uniform4fv(this.addr,t)}function nO(n,e){const t=ld(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function iO(n,e){const t=ld(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function sO(n,e){const t=ld(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function oO(n,e){n.uniform1iv(this.addr,e)}function rO(n,e){n.uniform2iv(this.addr,e)}function aO(n,e){n.uniform3iv(this.addr,e)}function lO(n,e){n.uniform4iv(this.addr,e)}function gO(n,e){n.uniform1uiv(this.addr,e)}function cO(n,e){n.uniform2uiv(this.addr,e)}function uO(n,e){n.uniform3uiv(this.addr,e)}function IO(n,e){n.uniform4uiv(this.addr,e)}function dO(n,e,t){const i=this.cache,s=e.length,o=wb(t,s);Si(i,o)||(n.uniform1iv(this.addr,o),Ri(i,o));for(let r=0;r!==s;++r)t.setTexture2D(e[r]||wT,o[r])}function CO(n,e,t){const i=this.cache,s=e.length,o=wb(t,s);Si(i,o)||(n.uniform1iv(this.addr,o),Ri(i,o));for(let r=0;r!==s;++r)t.setTexture3D(e[r]||ST,o[r])}function hO(n,e,t){const i=this.cache,s=e.length,o=wb(t,s);Si(i,o)||(n.uniform1iv(this.addr,o),Ri(i,o));for(let r=0;r!==s;++r)t.setTextureCube(e[r]||RT,o[r])}function AO(n,e,t){const i=this.cache,s=e.length,o=wb(t,s);Si(i,o)||(n.uniform1iv(this.addr,o),Ri(i,o));for(let r=0;r!==s;++r)t.setTexture2DArray(e[r]||ZT,o[r])}function pO(n){switch(n){case 5126:return qJ;case 35664:return $J;case 35665:return eO;case 35666:return tO;case 35674:return nO;case 35675:return iO;case 35676:return sO;case 5124:case 35670:return oO;case 35667:case 35671:return rO;case 35668:case 35672:return aO;case 35669:case 35673:return lO;case 5125:return gO;case 36294:return cO;case 36295:return uO;case 36296:return IO;case 35678:case 36198:case 36298:case 36306:case 35682:return dO;case 35679:case 36299:case 36307:return CO;case 35680:case 36300:case 36308:case 36293:return hO;case 36289:case 36303:case 36311:case 36292:return AO}}class mO{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=jJ(t.type)}}class fO{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=pO(t.type)}}class bO{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const s=this.seq;for(let o=0,r=s.length;o!==r;++o){const a=s[o];a.setValue(e,t[a.id],i)}}}const dG=/(\w+)(\])?(\[|\.)?/g;function VV(n,e){n.seq.push(e),n.map[e.id]=e}function yO(n,e,t){const i=n.name,s=i.length;for(dG.lastIndex=0;;){const o=dG.exec(i),r=dG.lastIndex;let a=o[1];const l=o[2]==="]",g=o[3];if(l&&(a=a|0),g===void 0||g==="["&&r+2===s){VV(t,g===void 0?new mO(a,n,e):new fO(a,n,e));break}else{let u=t.map[a];u===void 0&&(u=new bO(a),VV(t,u)),t=u}}}class $m{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let s=0;s<i;++s){const o=e.getActiveUniform(t,s),r=e.getUniformLocation(t,o.name);yO(o,r,this)}}setValue(e,t,i,s){const o=this.map[t];o!==void 0&&o.setValue(e,i,s)}setOptional(e,t,i){const s=t[i];s!==void 0&&this.setValue(e,i,s)}static upload(e,t,i,s){for(let o=0,r=t.length;o!==r;++o){const a=t[o],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,s)}}static seqWithValue(e,t){const i=[];for(let s=0,o=e.length;s!==o;++s){const r=e[s];r.id in t&&i.push(r)}return i}}function WV(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const BO=37297;let GO=0;function vO(n,e){const t=n.split(`
`),i=[],s=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let r=s;r<o;r++){const a=r+1;i.push(`${a===e?">":" "} ${a}: ${t[r]}`)}return i.join(`
`)}function wO(n){const e=cn.getPrimaries(cn.workingColorSpace),t=cn.getPrimaries(n);let i;switch(e===t?i="":e===Sh&&t===Zh?i="LinearDisplayP3ToLinearSRGB":e===Zh&&t===Sh&&(i="LinearSRGBToLinearDisplayP3"),n){case Ei:case oA:return[i,"LinearTransferOETF"];case Di:case Bb:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function MV(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=n.getShaderInfoLog(e).trim();if(i&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const r=parseInt(o[1]);return t.toUpperCase()+`

`+s+`

`+vO(n.getShaderSource(e),r)}else return s}function ZO(n,e){const t=wO(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function SO(n,e){let t;switch(e){case jX:t="Linear";break;case qX:t="Reinhard";break;case $X:t="Cineon";break;case bZ:t="ACESFilmic";break;case tT:t="AgX";break;case nT:t="Neutral";break;case eT:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const zp=new _;function RO(){cn.getLuminanceCoefficients(zp);const n=zp.x.toFixed(4),e=zp.y.toFixed(4),t=zp.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function xO(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(RC).join(`
`)}function VO(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function WO(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const o=n.getActiveAttrib(e,s),r=o.name;let a=1;o.type===n.FLOAT_MAT2&&(a=2),o.type===n.FLOAT_MAT3&&(a=3),o.type===n.FLOAT_MAT4&&(a=4),t[r]={type:o.type,location:n.getAttribLocation(e,r),locationSize:a}}return t}function RC(n){return n!==""}function NV(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function FV(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const MO=/^[ \t]*#include +<([\w\d./]+)>/gm;function y2(n){return n.replace(MO,FO)}const NO=new Map;function FO(n,e){let t=_t[e];if(t===void 0){const i=NO.get(e);if(i!==void 0)t=_t[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return y2(t)}const HO=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function HV(n){return n.replace(HO,XO)}function XO(n,e,t,i){let s="";for(let o=parseInt(e);o<parseInt(t);o++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return s}function XV(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function TO(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===db?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===_C?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===pr&&(e="SHADOWMAP_TYPE_VSM"),e}function EO(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Oa:case eg:e="ENVMAP_TYPE_CUBE";break;case od:e="ENVMAP_TYPE_CUBE_UV";break}return e}function YO(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case eg:e="ENVMAP_MODE_REFRACTION";break}return e}function KO(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case tA:e="ENVMAP_BLENDING_MULTIPLY";break;case OX:e="ENVMAP_BLENDING_MIX";break;case QX:e="ENVMAP_BLENDING_ADD";break}return e}function _O(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function LO(n,e,t,i){const s=n.getContext(),o=t.defines;let r=t.vertexShader,a=t.fragmentShader;const l=TO(t),g=EO(t),c=YO(t),u=KO(t),C=_O(t),h=xO(t),p=VO(o),b=s.createProgram();let m,A,B=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(RC).join(`
`),m.length>0&&(m+=`
`),A=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(RC).join(`
`),A.length>0&&(A+=`
`)):(m=[XV(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(RC).join(`
`),A=[XV(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",C?"#define CUBEUV_TEXEL_WIDTH "+C.texelWidth:"",C?"#define CUBEUV_TEXEL_HEIGHT "+C.texelHeight:"",C?"#define CUBEUV_MAX_MIP "+C.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ta?"#define TONE_MAPPING":"",t.toneMapping!==ta?_t.tonemapping_pars_fragment:"",t.toneMapping!==ta?SO("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",_t.colorspace_pars_fragment,ZO("linearToOutputTexel",t.outputColorSpace),RO(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(RC).join(`
`)),r=y2(r),r=NV(r,t),r=FV(r,t),a=y2(a),a=NV(a,t),a=FV(a,t),r=HV(r),a=HV(a),t.isRawShaderMaterial!==!0&&(B=`#version 300 es
`,m=[h,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,A=["#define varying in",t.glslVersion===f2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===f2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+A);const G=B+m+r,w=B+A+a,N=WV(s,s.VERTEX_SHADER,G),M=WV(s,s.FRAGMENT_SHADER,w);s.attachShader(b,N),s.attachShader(b,M),t.index0AttributeName!==void 0?s.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(b,0,"position"),s.linkProgram(b);function R(x){if(n.debug.checkShaderErrors){const Y=s.getProgramInfoLog(b).trim(),T=s.getShaderInfoLog(N).trim(),ne=s.getShaderInfoLog(M).trim();let ue=!0,se=!0;if(s.getProgramParameter(b,s.LINK_STATUS)===!1)if(ue=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(s,b,N,M);else{const Ie=MV(s,N,"vertex"),k=MV(s,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(b,s.VALIDATE_STATUS)+`

Material Name: `+x.name+`
Material Type: `+x.type+`

Program Info Log: `+Y+`
`+Ie+`
`+k)}else Y!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Y):(T===""||ne==="")&&(se=!1);se&&(x.diagnostics={runnable:ue,programLog:Y,vertexShader:{log:T,prefix:m},fragmentShader:{log:ne,prefix:A}})}s.deleteShader(N),s.deleteShader(M),S=new $m(s,b),F=WO(s,b)}let S;this.getUniforms=function(){return S===void 0&&R(this),S};let F;this.getAttributes=function(){return F===void 0&&R(this),F};let Z=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Z===!1&&(Z=s.getProgramParameter(b,BO)),Z},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(b),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=GO++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=N,this.fragmentShader=M,this}let kO=0;class zO{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,s=this._getShaderStage(t),o=this._getShaderStage(i),r=this._getShaderCacheForMaterial(e);return r.has(s)===!1&&(r.add(s),s.usedTimes++),r.has(o)===!1&&(r.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new DO(e),t.set(e,i)),i}}class DO{constructor(e){this.id=kO++,this.code=e,this.usedTimes=0}}function PO(n,e,t,i,s,o,r){const a=new Wc,l=new zO,g=new Set,c=[],u=s.logarithmicDepthBuffer,C=s.reverseDepthBuffer,h=s.vertexTextures;let p=s.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(Z){return g.add(Z),Z===0?"uv":`uv${Z}`}function A(Z,x,Y,T,ne){const ue=T.fog,se=ne.geometry,Ie=Z.isMeshStandardMaterial?T.environment:null,k=(Z.isMeshStandardMaterial?t:e).get(Z.envMap||Ie),ee=k&&k.mapping===od?k.image.height:null,$=b[Z.type];Z.precision!==null&&(p=s.getMaxPrecision(Z.precision),p!==Z.precision&&console.warn("THREE.WebGLProgram.getParameters:",Z.precision,"not supported, using",p,"instead."));const ae=se.morphAttributes.position||se.morphAttributes.normal||se.morphAttributes.color,be=ae!==void 0?ae.length:0;let me=0;se.morphAttributes.position!==void 0&&(me=1),se.morphAttributes.normal!==void 0&&(me=2),se.morphAttributes.color!==void 0&&(me=3);let ce,Be,He,Fe;if($){const bn=br[$];ce=bn.vertexShader,Be=bn.fragmentShader}else ce=Z.vertexShader,Be=Z.fragmentShader,l.update(Z),He=l.getVertexShaderID(Z),Fe=l.getFragmentShaderID(Z);const Ct=n.getRenderTarget(),pt=ne.isInstancedMesh===!0,ot=ne.isBatchedMesh===!0,Ue=!!Z.map,we=!!Z.matcap,D=!!k,Ee=!!Z.aoMap,Ye=!!Z.lightMap,Ne=!!Z.bumpMap,_e=!!Z.normalMap,ut=!!Z.displacementMap,Oe=!!Z.emissiveMap,P=!!Z.metalnessMap,E=!!Z.roughnessMap,ge=Z.anisotropy>0,ve=Z.clearcoat>0,Se=Z.dispersion>0,Ze=Z.iridescence>0,Je=Z.sheen>0,We=Z.transmission>0,Qe=ge&&!!Z.anisotropyMap,Kt=ve&&!!Z.clearcoatMap,Xe=ve&&!!Z.clearcoatNormalMap,et=ve&&!!Z.clearcoatRoughnessMap,Gt=Ze&&!!Z.iridescenceMap,wt=Ze&&!!Z.iridescenceThicknessMap,it=Je&&!!Z.sheenColorMap,Nt=Je&&!!Z.sheenRoughnessMap,q=!!Z.specularMap,xe=!!Z.specularColorMap,Q=!!Z.specularIntensityMap,Me=We&&!!Z.transmissionMap,Ce=We&&!!Z.thicknessMap,Re=!!Z.gradientMap,De=!!Z.alphaMap,qe=Z.alphaTest>0,Wt=!!Z.alphaHash,$t=!!Z.extensions;let An=ta;Z.toneMapped&&(Ct===null||Ct.isXRRenderTarget===!0)&&(An=n.toneMapping);const Ft={shaderID:$,shaderType:Z.type,shaderName:Z.name,vertexShader:ce,fragmentShader:Be,defines:Z.defines,customVertexShaderID:He,customFragmentShaderID:Fe,isRawShaderMaterial:Z.isRawShaderMaterial===!0,glslVersion:Z.glslVersion,precision:p,batching:ot,batchingColor:ot&&ne._colorsTexture!==null,instancing:pt,instancingColor:pt&&ne.instanceColor!==null,instancingMorph:pt&&ne.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:Ct===null?n.outputColorSpace:Ct.isXRRenderTarget===!0?Ct.texture.colorSpace:Ei,alphaToCoverage:!!Z.alphaToCoverage,map:Ue,matcap:we,envMap:D,envMapMode:D&&k.mapping,envMapCubeUVHeight:ee,aoMap:Ee,lightMap:Ye,bumpMap:Ne,normalMap:_e,displacementMap:h&&ut,emissiveMap:Oe,normalMapObjectSpace:_e&&Z.normalMapType===gT,normalMapTangentSpace:_e&&Z.normalMapType===dg,metalnessMap:P,roughnessMap:E,anisotropy:ge,anisotropyMap:Qe,clearcoat:ve,clearcoatMap:Kt,clearcoatNormalMap:Xe,clearcoatRoughnessMap:et,dispersion:Se,iridescence:Ze,iridescenceMap:Gt,iridescenceThicknessMap:wt,sheen:Je,sheenColorMap:it,sheenRoughnessMap:Nt,specularMap:q,specularColorMap:xe,specularIntensityMap:Q,transmission:We,transmissionMap:Me,thicknessMap:Ce,gradientMap:Re,opaque:Z.transparent===!1&&Z.blending===Rc&&Z.alphaToCoverage===!1,alphaMap:De,alphaTest:qe,alphaHash:Wt,combine:Z.combine,mapUv:Ue&&m(Z.map.channel),aoMapUv:Ee&&m(Z.aoMap.channel),lightMapUv:Ye&&m(Z.lightMap.channel),bumpMapUv:Ne&&m(Z.bumpMap.channel),normalMapUv:_e&&m(Z.normalMap.channel),displacementMapUv:ut&&m(Z.displacementMap.channel),emissiveMapUv:Oe&&m(Z.emissiveMap.channel),metalnessMapUv:P&&m(Z.metalnessMap.channel),roughnessMapUv:E&&m(Z.roughnessMap.channel),anisotropyMapUv:Qe&&m(Z.anisotropyMap.channel),clearcoatMapUv:Kt&&m(Z.clearcoatMap.channel),clearcoatNormalMapUv:Xe&&m(Z.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&m(Z.clearcoatRoughnessMap.channel),iridescenceMapUv:Gt&&m(Z.iridescenceMap.channel),iridescenceThicknessMapUv:wt&&m(Z.iridescenceThicknessMap.channel),sheenColorMapUv:it&&m(Z.sheenColorMap.channel),sheenRoughnessMapUv:Nt&&m(Z.sheenRoughnessMap.channel),specularMapUv:q&&m(Z.specularMap.channel),specularColorMapUv:xe&&m(Z.specularColorMap.channel),specularIntensityMapUv:Q&&m(Z.specularIntensityMap.channel),transmissionMapUv:Me&&m(Z.transmissionMap.channel),thicknessMapUv:Ce&&m(Z.thicknessMap.channel),alphaMapUv:De&&m(Z.alphaMap.channel),vertexTangents:!!se.attributes.tangent&&(_e||ge),vertexColors:Z.vertexColors,vertexAlphas:Z.vertexColors===!0&&!!se.attributes.color&&se.attributes.color.itemSize===4,pointsUvs:ne.isPoints===!0&&!!se.attributes.uv&&(Ue||De),fog:!!ue,useFog:Z.fog===!0,fogExp2:!!ue&&ue.isFogExp2,flatShading:Z.flatShading===!0,sizeAttenuation:Z.sizeAttenuation===!0,logarithmicDepthBuffer:u,reverseDepthBuffer:C,skinning:ne.isSkinnedMesh===!0,morphTargets:se.morphAttributes.position!==void 0,morphNormals:se.morphAttributes.normal!==void 0,morphColors:se.morphAttributes.color!==void 0,morphTargetsCount:be,morphTextureStride:me,numDirLights:x.directional.length,numPointLights:x.point.length,numSpotLights:x.spot.length,numSpotLightMaps:x.spotLightMap.length,numRectAreaLights:x.rectArea.length,numHemiLights:x.hemi.length,numDirLightShadows:x.directionalShadowMap.length,numPointLightShadows:x.pointShadowMap.length,numSpotLightShadows:x.spotShadowMap.length,numSpotLightShadowsWithMaps:x.numSpotLightShadowsWithMaps,numLightProbes:x.numLightProbes,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:Z.dithering,shadowMapEnabled:n.shadowMap.enabled&&Y.length>0,shadowMapType:n.shadowMap.type,toneMapping:An,decodeVideoTexture:Ue&&Z.map.isVideoTexture===!0&&cn.getTransfer(Z.map.colorSpace)===xn,premultipliedAlpha:Z.premultipliedAlpha,doubleSided:Z.side===bo,flipSided:Z.side===Es,useDepthPacking:Z.depthPacking>=0,depthPacking:Z.depthPacking||0,index0AttributeName:Z.index0AttributeName,extensionClipCullDistance:$t&&Z.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:($t&&Z.extensions.multiDraw===!0||ot)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:Z.customProgramCacheKey()};return Ft.vertexUv1s=g.has(1),Ft.vertexUv2s=g.has(2),Ft.vertexUv3s=g.has(3),g.clear(),Ft}function B(Z){const x=[];if(Z.shaderID?x.push(Z.shaderID):(x.push(Z.customVertexShaderID),x.push(Z.customFragmentShaderID)),Z.defines!==void 0)for(const Y in Z.defines)x.push(Y),x.push(Z.defines[Y]);return Z.isRawShaderMaterial===!1&&(G(x,Z),w(x,Z),x.push(n.outputColorSpace)),x.push(Z.customProgramCacheKey),x.join()}function G(Z,x){Z.push(x.precision),Z.push(x.outputColorSpace),Z.push(x.envMapMode),Z.push(x.envMapCubeUVHeight),Z.push(x.mapUv),Z.push(x.alphaMapUv),Z.push(x.lightMapUv),Z.push(x.aoMapUv),Z.push(x.bumpMapUv),Z.push(x.normalMapUv),Z.push(x.displacementMapUv),Z.push(x.emissiveMapUv),Z.push(x.metalnessMapUv),Z.push(x.roughnessMapUv),Z.push(x.anisotropyMapUv),Z.push(x.clearcoatMapUv),Z.push(x.clearcoatNormalMapUv),Z.push(x.clearcoatRoughnessMapUv),Z.push(x.iridescenceMapUv),Z.push(x.iridescenceThicknessMapUv),Z.push(x.sheenColorMapUv),Z.push(x.sheenRoughnessMapUv),Z.push(x.specularMapUv),Z.push(x.specularColorMapUv),Z.push(x.specularIntensityMapUv),Z.push(x.transmissionMapUv),Z.push(x.thicknessMapUv),Z.push(x.combine),Z.push(x.fogExp2),Z.push(x.sizeAttenuation),Z.push(x.morphTargetsCount),Z.push(x.morphAttributeCount),Z.push(x.numDirLights),Z.push(x.numPointLights),Z.push(x.numSpotLights),Z.push(x.numSpotLightMaps),Z.push(x.numHemiLights),Z.push(x.numRectAreaLights),Z.push(x.numDirLightShadows),Z.push(x.numPointLightShadows),Z.push(x.numSpotLightShadows),Z.push(x.numSpotLightShadowsWithMaps),Z.push(x.numLightProbes),Z.push(x.shadowMapType),Z.push(x.toneMapping),Z.push(x.numClippingPlanes),Z.push(x.numClipIntersection),Z.push(x.depthPacking)}function w(Z,x){a.disableAll(),x.supportsVertexTextures&&a.enable(0),x.instancing&&a.enable(1),x.instancingColor&&a.enable(2),x.instancingMorph&&a.enable(3),x.matcap&&a.enable(4),x.envMap&&a.enable(5),x.normalMapObjectSpace&&a.enable(6),x.normalMapTangentSpace&&a.enable(7),x.clearcoat&&a.enable(8),x.iridescence&&a.enable(9),x.alphaTest&&a.enable(10),x.vertexColors&&a.enable(11),x.vertexAlphas&&a.enable(12),x.vertexUv1s&&a.enable(13),x.vertexUv2s&&a.enable(14),x.vertexUv3s&&a.enable(15),x.vertexTangents&&a.enable(16),x.anisotropy&&a.enable(17),x.alphaHash&&a.enable(18),x.batching&&a.enable(19),x.dispersion&&a.enable(20),x.batchingColor&&a.enable(21),Z.push(a.mask),a.disableAll(),x.fog&&a.enable(0),x.useFog&&a.enable(1),x.flatShading&&a.enable(2),x.logarithmicDepthBuffer&&a.enable(3),x.reverseDepthBuffer&&a.enable(4),x.skinning&&a.enable(5),x.morphTargets&&a.enable(6),x.morphNormals&&a.enable(7),x.morphColors&&a.enable(8),x.premultipliedAlpha&&a.enable(9),x.shadowMapEnabled&&a.enable(10),x.doubleSided&&a.enable(11),x.flipSided&&a.enable(12),x.useDepthPacking&&a.enable(13),x.dithering&&a.enable(14),x.transmission&&a.enable(15),x.sheen&&a.enable(16),x.opaque&&a.enable(17),x.pointsUvs&&a.enable(18),x.decodeVideoTexture&&a.enable(19),x.alphaToCoverage&&a.enable(20),Z.push(a.mask)}function N(Z){const x=b[Z.type];let Y;if(x){const T=br[x];Y=GT.clone(T.uniforms)}else Y=Z.uniforms;return Y}function M(Z,x){let Y;for(let T=0,ne=c.length;T<ne;T++){const ue=c[T];if(ue.cacheKey===x){Y=ue,++Y.usedTimes;break}}return Y===void 0&&(Y=new LO(n,x,Z,o),c.push(Y)),Y}function R(Z){if(--Z.usedTimes===0){const x=c.indexOf(Z);c[x]=c[c.length-1],c.pop(),Z.destroy()}}function S(Z){l.remove(Z)}function F(){l.dispose()}return{getParameters:A,getProgramCacheKey:B,getUniforms:N,acquireProgram:M,releaseProgram:R,releaseShaderCache:S,programs:c,dispose:F}}function UO(){let n=new WeakMap;function e(r){return n.has(r)}function t(r){let a=n.get(r);return a===void 0&&(a={},n.set(r,a)),a}function i(r){n.delete(r)}function s(r,a,l){n.get(r)[a]=l}function o(){n=new WeakMap}return{has:e,get:t,remove:i,update:s,dispose:o}}function JO(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function TV(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function EV(){const n=[];let e=0;const t=[],i=[],s=[];function o(){e=0,t.length=0,i.length=0,s.length=0}function r(u,C,h,p,b,m){let A=n[e];return A===void 0?(A={id:u.id,object:u,geometry:C,material:h,groupOrder:p,renderOrder:u.renderOrder,z:b,group:m},n[e]=A):(A.id=u.id,A.object=u,A.geometry=C,A.material=h,A.groupOrder=p,A.renderOrder=u.renderOrder,A.z=b,A.group=m),e++,A}function a(u,C,h,p,b,m){const A=r(u,C,h,p,b,m);h.transmission>0?i.push(A):h.transparent===!0?s.push(A):t.push(A)}function l(u,C,h,p,b,m){const A=r(u,C,h,p,b,m);h.transmission>0?i.unshift(A):h.transparent===!0?s.unshift(A):t.unshift(A)}function g(u,C){t.length>1&&t.sort(u||JO),i.length>1&&i.sort(C||TV),s.length>1&&s.sort(C||TV)}function c(){for(let u=e,C=n.length;u<C;u++){const h=n[u];if(h.id===null)break;h.id=null,h.object=null,h.geometry=null,h.material=null,h.group=null}}return{opaque:t,transmissive:i,transparent:s,init:o,push:a,unshift:l,finish:c,sort:g}}function OO(){let n=new WeakMap;function e(i,s){const o=n.get(i);let r;return o===void 0?(r=new EV,n.set(i,[r])):s>=o.length?(r=new EV,o.push(r)):r=o[s],r}function t(){n=new WeakMap}return{get:e,dispose:t}}function QO(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new _,color:new Pe};break;case"SpotLight":t={position:new _,direction:new _,color:new Pe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new _,color:new Pe,distance:0,decay:0};break;case"HemisphereLight":t={direction:new _,skyColor:new Pe,groundColor:new Pe};break;case"RectAreaLight":t={color:new Pe,position:new _,halfWidth:new _,halfHeight:new _};break}return n[e.id]=t,t}}}function jO(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ye,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let qO=0;function $O(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function eQ(n){const e=new QO,t=jO(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let g=0;g<9;g++)i.probe.push(new _);const s=new _,o=new ct,r=new ct;function a(g){let c=0,u=0,C=0;for(let F=0;F<9;F++)i.probe[F].set(0,0,0);let h=0,p=0,b=0,m=0,A=0,B=0,G=0,w=0,N=0,M=0,R=0;g.sort($O);for(let F=0,Z=g.length;F<Z;F++){const x=g[F],Y=x.color,T=x.intensity,ne=x.distance,ue=x.shadow&&x.shadow.map?x.shadow.map.texture:null;if(x.isAmbientLight)c+=Y.r*T,u+=Y.g*T,C+=Y.b*T;else if(x.isLightProbe){for(let se=0;se<9;se++)i.probe[se].addScaledVector(x.sh.coefficients[se],T);R++}else if(x.isDirectionalLight){const se=e.get(x);if(se.color.copy(x.color).multiplyScalar(x.intensity),x.castShadow){const Ie=x.shadow,k=t.get(x);k.shadowIntensity=Ie.intensity,k.shadowBias=Ie.bias,k.shadowNormalBias=Ie.normalBias,k.shadowRadius=Ie.radius,k.shadowMapSize=Ie.mapSize,i.directionalShadow[h]=k,i.directionalShadowMap[h]=ue,i.directionalShadowMatrix[h]=x.shadow.matrix,B++}i.directional[h]=se,h++}else if(x.isSpotLight){const se=e.get(x);se.position.setFromMatrixPosition(x.matrixWorld),se.color.copy(Y).multiplyScalar(T),se.distance=ne,se.coneCos=Math.cos(x.angle),se.penumbraCos=Math.cos(x.angle*(1-x.penumbra)),se.decay=x.decay,i.spot[b]=se;const Ie=x.shadow;if(x.map&&(i.spotLightMap[N]=x.map,N++,Ie.updateMatrices(x),x.castShadow&&M++),i.spotLightMatrix[b]=Ie.matrix,x.castShadow){const k=t.get(x);k.shadowIntensity=Ie.intensity,k.shadowBias=Ie.bias,k.shadowNormalBias=Ie.normalBias,k.shadowRadius=Ie.radius,k.shadowMapSize=Ie.mapSize,i.spotShadow[b]=k,i.spotShadowMap[b]=ue,w++}b++}else if(x.isRectAreaLight){const se=e.get(x);se.color.copy(Y).multiplyScalar(T),se.halfWidth.set(x.width*.5,0,0),se.halfHeight.set(0,x.height*.5,0),i.rectArea[m]=se,m++}else if(x.isPointLight){const se=e.get(x);if(se.color.copy(x.color).multiplyScalar(x.intensity),se.distance=x.distance,se.decay=x.decay,x.castShadow){const Ie=x.shadow,k=t.get(x);k.shadowIntensity=Ie.intensity,k.shadowBias=Ie.bias,k.shadowNormalBias=Ie.normalBias,k.shadowRadius=Ie.radius,k.shadowMapSize=Ie.mapSize,k.shadowCameraNear=Ie.camera.near,k.shadowCameraFar=Ie.camera.far,i.pointShadow[p]=k,i.pointShadowMap[p]=ue,i.pointShadowMatrix[p]=x.shadow.matrix,G++}i.point[p]=se,p++}else if(x.isHemisphereLight){const se=e.get(x);se.skyColor.copy(x.color).multiplyScalar(T),se.groundColor.copy(x.groundColor).multiplyScalar(T),i.hemi[A]=se,A++}}m>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=je.LTC_FLOAT_1,i.rectAreaLTC2=je.LTC_FLOAT_2):(i.rectAreaLTC1=je.LTC_HALF_1,i.rectAreaLTC2=je.LTC_HALF_2)),i.ambient[0]=c,i.ambient[1]=u,i.ambient[2]=C;const S=i.hash;(S.directionalLength!==h||S.pointLength!==p||S.spotLength!==b||S.rectAreaLength!==m||S.hemiLength!==A||S.numDirectionalShadows!==B||S.numPointShadows!==G||S.numSpotShadows!==w||S.numSpotMaps!==N||S.numLightProbes!==R)&&(i.directional.length=h,i.spot.length=b,i.rectArea.length=m,i.point.length=p,i.hemi.length=A,i.directionalShadow.length=B,i.directionalShadowMap.length=B,i.pointShadow.length=G,i.pointShadowMap.length=G,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=B,i.pointShadowMatrix.length=G,i.spotLightMatrix.length=w+N-M,i.spotLightMap.length=N,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=R,S.directionalLength=h,S.pointLength=p,S.spotLength=b,S.rectAreaLength=m,S.hemiLength=A,S.numDirectionalShadows=B,S.numPointShadows=G,S.numSpotShadows=w,S.numSpotMaps=N,S.numLightProbes=R,i.version=qO++)}function l(g,c){let u=0,C=0,h=0,p=0,b=0;const m=c.matrixWorldInverse;for(let A=0,B=g.length;A<B;A++){const G=g[A];if(G.isDirectionalLight){const w=i.directional[u];w.direction.setFromMatrixPosition(G.matrixWorld),s.setFromMatrixPosition(G.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(m),u++}else if(G.isSpotLight){const w=i.spot[h];w.position.setFromMatrixPosition(G.matrixWorld),w.position.applyMatrix4(m),w.direction.setFromMatrixPosition(G.matrixWorld),s.setFromMatrixPosition(G.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(m),h++}else if(G.isRectAreaLight){const w=i.rectArea[p];w.position.setFromMatrixPosition(G.matrixWorld),w.position.applyMatrix4(m),r.identity(),o.copy(G.matrixWorld),o.premultiply(m),r.extractRotation(o),w.halfWidth.set(G.width*.5,0,0),w.halfHeight.set(0,G.height*.5,0),w.halfWidth.applyMatrix4(r),w.halfHeight.applyMatrix4(r),p++}else if(G.isPointLight){const w=i.point[C];w.position.setFromMatrixPosition(G.matrixWorld),w.position.applyMatrix4(m),C++}else if(G.isHemisphereLight){const w=i.hemi[b];w.direction.setFromMatrixPosition(G.matrixWorld),w.direction.transformDirection(m),b++}}}return{setup:a,setupView:l,state:i}}function YV(n){const e=new eQ(n),t=[],i=[];function s(c){g.camera=c,t.length=0,i.length=0}function o(c){t.push(c)}function r(c){i.push(c)}function a(){e.setup(t)}function l(c){e.setupView(t,c)}const g={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:g,setupLights:a,setupLightsView:l,pushLight:o,pushShadow:r}}function tQ(n){let e=new WeakMap;function t(s,o=0){const r=e.get(s);let a;return r===void 0?(a=new YV(n),e.set(s,[a])):o>=r.length?(a=new YV(n),r.push(a)):a=r[o],a}function i(){e=new WeakMap}return{get:t,dispose:i}}class KZ extends Un{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=aT,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class _Z extends Un{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const nQ=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,iQ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function sQ(n,e,t){let i=new aA;const s=new ye,o=new ye,r=new rn,a=new KZ({depthPacking:lT}),l=new _Z,g={},c=t.maxTextureSize,u={[Rr]:Es,[Es]:Rr,[bo]:bo},C=new tr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ye},radius:{value:4}},vertexShader:nQ,fragmentShader:iQ}),h=C.clone();h.defines.HORIZONTAL_PASS=1;const p=new Mt;p.setAttribute("position",new Pt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new _n(p,C),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=db;let A=this.type;this.render=function(M,R,S){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||M.length===0)return;const F=n.getRenderTarget(),Z=n.getActiveCubeFace(),x=n.getActiveMipmapLevel(),Y=n.state;Y.setBlending(ea),Y.buffers.color.setClear(1,1,1,1),Y.buffers.depth.setTest(!0),Y.setScissorTest(!1);const T=A!==pr&&this.type===pr,ne=A===pr&&this.type!==pr;for(let ue=0,se=M.length;ue<se;ue++){const Ie=M[ue],k=Ie.shadow;if(k===void 0){console.warn("THREE.WebGLShadowMap:",Ie,"has no shadow.");continue}if(k.autoUpdate===!1&&k.needsUpdate===!1)continue;s.copy(k.mapSize);const ee=k.getFrameExtents();if(s.multiply(ee),o.copy(k.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(o.x=Math.floor(c/ee.x),s.x=o.x*ee.x,k.mapSize.x=o.x),s.y>c&&(o.y=Math.floor(c/ee.y),s.y=o.y*ee.y,k.mapSize.y=o.y)),k.map===null||T===!0||ne===!0){const ae=this.type!==pr?{minFilter:Bi,magFilter:Bi}:{};k.map!==null&&k.map.dispose(),k.map=new Ys(s.x,s.y,ae),k.map.texture.name=Ie.name+".shadowMap",k.camera.updateProjectionMatrix()}n.setRenderTarget(k.map),n.clear();const $=k.getViewportCount();for(let ae=0;ae<$;ae++){const be=k.getViewport(ae);r.set(o.x*be.x,o.y*be.y,o.x*be.z,o.y*be.w),Y.viewport(r),k.updateMatrices(Ie,ae),i=k.getFrustum(),w(R,S,k.camera,Ie,this.type)}k.isPointLightShadow!==!0&&this.type===pr&&B(k,S),k.needsUpdate=!1}A=this.type,m.needsUpdate=!1,n.setRenderTarget(F,Z,x)};function B(M,R){const S=e.update(b);C.defines.VSM_SAMPLES!==M.blurSamples&&(C.defines.VSM_SAMPLES=M.blurSamples,h.defines.VSM_SAMPLES=M.blurSamples,C.needsUpdate=!0,h.needsUpdate=!0),M.mapPass===null&&(M.mapPass=new Ys(s.x,s.y)),C.uniforms.shadow_pass.value=M.map.texture,C.uniforms.resolution.value=M.mapSize,C.uniforms.radius.value=M.radius,n.setRenderTarget(M.mapPass),n.clear(),n.renderBufferDirect(R,null,S,C,b,null),h.uniforms.shadow_pass.value=M.mapPass.texture,h.uniforms.resolution.value=M.mapSize,h.uniforms.radius.value=M.radius,n.setRenderTarget(M.map),n.clear(),n.renderBufferDirect(R,null,S,h,b,null)}function G(M,R,S,F){let Z=null;const x=S.isPointLight===!0?M.customDistanceMaterial:M.customDepthMaterial;if(x!==void 0)Z=x;else if(Z=S.isPointLight===!0?l:a,n.localClippingEnabled&&R.clipShadows===!0&&Array.isArray(R.clippingPlanes)&&R.clippingPlanes.length!==0||R.displacementMap&&R.displacementScale!==0||R.alphaMap&&R.alphaTest>0||R.map&&R.alphaTest>0){const Y=Z.uuid,T=R.uuid;let ne=g[Y];ne===void 0&&(ne={},g[Y]=ne);let ue=ne[T];ue===void 0&&(ue=Z.clone(),ne[T]=ue,R.addEventListener("dispose",N)),Z=ue}if(Z.visible=R.visible,Z.wireframe=R.wireframe,F===pr?Z.side=R.shadowSide!==null?R.shadowSide:R.side:Z.side=R.shadowSide!==null?R.shadowSide:u[R.side],Z.alphaMap=R.alphaMap,Z.alphaTest=R.alphaTest,Z.map=R.map,Z.clipShadows=R.clipShadows,Z.clippingPlanes=R.clippingPlanes,Z.clipIntersection=R.clipIntersection,Z.displacementMap=R.displacementMap,Z.displacementScale=R.displacementScale,Z.displacementBias=R.displacementBias,Z.wireframeLinewidth=R.wireframeLinewidth,Z.linewidth=R.linewidth,S.isPointLight===!0&&Z.isMeshDistanceMaterial===!0){const Y=n.properties.get(Z);Y.light=S}return Z}function w(M,R,S,F,Z){if(M.visible===!1)return;if(M.layers.test(R.layers)&&(M.isMesh||M.isLine||M.isPoints)&&(M.castShadow||M.receiveShadow&&Z===pr)&&(!M.frustumCulled||i.intersectsObject(M))){M.modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,M.matrixWorld);const T=e.update(M),ne=M.material;if(Array.isArray(ne)){const ue=T.groups;for(let se=0,Ie=ue.length;se<Ie;se++){const k=ue[se],ee=ne[k.materialIndex];if(ee&&ee.visible){const $=G(M,ee,F,Z);M.onBeforeShadow(n,M,R,S,T,$,k),n.renderBufferDirect(S,null,T,$,M,k),M.onAfterShadow(n,M,R,S,T,$,k)}}}else if(ne.visible){const ue=G(M,ne,F,Z);M.onBeforeShadow(n,M,R,S,T,ue,null),n.renderBufferDirect(S,null,T,ue,M,null),M.onAfterShadow(n,M,R,S,T,ue,null)}}const Y=M.children;for(let T=0,ne=Y.length;T<ne;T++)w(Y[T],R,S,F,Z)}function N(M){M.target.removeEventListener("dispose",N);for(const S in g){const F=g[S],Z=M.target.uuid;Z in F&&(F[Z].dispose(),delete F[Z])}}}const oQ={[Kf]:_f,[Lf]:Df,[kf]:Pf,[_c]:zf,[_f]:Kf,[Df]:Lf,[Pf]:kf,[zf]:_c};function rQ(n){function e(){let Q=!1;const Me=new rn;let Ce=null;const Re=new rn(0,0,0,0);return{setMask:function(De){Ce!==De&&!Q&&(n.colorMask(De,De,De,De),Ce=De)},setLocked:function(De){Q=De},setClear:function(De,qe,Wt,$t,An){An===!0&&(De*=$t,qe*=$t,Wt*=$t),Me.set(De,qe,Wt,$t),Re.equals(Me)===!1&&(n.clearColor(De,qe,Wt,$t),Re.copy(Me))},reset:function(){Q=!1,Ce=null,Re.set(-1,0,0,0)}}}function t(){let Q=!1,Me=!1,Ce=null,Re=null,De=null;return{setReversed:function(qe){Me=qe},setTest:function(qe){qe?He(n.DEPTH_TEST):Fe(n.DEPTH_TEST)},setMask:function(qe){Ce!==qe&&!Q&&(n.depthMask(qe),Ce=qe)},setFunc:function(qe){if(Me&&(qe=oQ[qe]),Re!==qe){switch(qe){case Kf:n.depthFunc(n.NEVER);break;case _f:n.depthFunc(n.ALWAYS);break;case Lf:n.depthFunc(n.LESS);break;case _c:n.depthFunc(n.LEQUAL);break;case kf:n.depthFunc(n.EQUAL);break;case zf:n.depthFunc(n.GEQUAL);break;case Df:n.depthFunc(n.GREATER);break;case Pf:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Re=qe}},setLocked:function(qe){Q=qe},setClear:function(qe){De!==qe&&(n.clearDepth(qe),De=qe)},reset:function(){Q=!1,Ce=null,Re=null,De=null}}}function i(){let Q=!1,Me=null,Ce=null,Re=null,De=null,qe=null,Wt=null,$t=null,An=null;return{setTest:function(Ft){Q||(Ft?He(n.STENCIL_TEST):Fe(n.STENCIL_TEST))},setMask:function(Ft){Me!==Ft&&!Q&&(n.stencilMask(Ft),Me=Ft)},setFunc:function(Ft,bn,ri){(Ce!==Ft||Re!==bn||De!==ri)&&(n.stencilFunc(Ft,bn,ri),Ce=Ft,Re=bn,De=ri)},setOp:function(Ft,bn,ri){(qe!==Ft||Wt!==bn||$t!==ri)&&(n.stencilOp(Ft,bn,ri),qe=Ft,Wt=bn,$t=ri)},setLocked:function(Ft){Q=Ft},setClear:function(Ft){An!==Ft&&(n.clearStencil(Ft),An=Ft)},reset:function(){Q=!1,Me=null,Ce=null,Re=null,De=null,qe=null,Wt=null,$t=null,An=null}}}const s=new e,o=new t,r=new i,a=new WeakMap,l=new WeakMap;let g={},c={},u=new WeakMap,C=[],h=null,p=!1,b=null,m=null,A=null,B=null,G=null,w=null,N=null,M=new Pe(0,0,0),R=0,S=!1,F=null,Z=null,x=null,Y=null,T=null;const ne=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ue=!1,se=0;const Ie=n.getParameter(n.VERSION);Ie.indexOf("WebGL")!==-1?(se=parseFloat(/^WebGL (\d)/.exec(Ie)[1]),ue=se>=1):Ie.indexOf("OpenGL ES")!==-1&&(se=parseFloat(/^OpenGL ES (\d)/.exec(Ie)[1]),ue=se>=2);let k=null,ee={};const $=n.getParameter(n.SCISSOR_BOX),ae=n.getParameter(n.VIEWPORT),be=new rn().fromArray($),me=new rn().fromArray(ae);function ce(Q,Me,Ce,Re){const De=new Uint8Array(4),qe=n.createTexture();n.bindTexture(Q,qe),n.texParameteri(Q,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Q,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Wt=0;Wt<Ce;Wt++)Q===n.TEXTURE_3D||Q===n.TEXTURE_2D_ARRAY?n.texImage3D(Me,0,n.RGBA,1,1,Re,0,n.RGBA,n.UNSIGNED_BYTE,De):n.texImage2D(Me+Wt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,De);return qe}const Be={};Be[n.TEXTURE_2D]=ce(n.TEXTURE_2D,n.TEXTURE_2D,1),Be[n.TEXTURE_CUBE_MAP]=ce(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),Be[n.TEXTURE_2D_ARRAY]=ce(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),Be[n.TEXTURE_3D]=ce(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),r.setClear(0),He(n.DEPTH_TEST),o.setFunc(_c),Ye(!1),Ne(d2),He(n.CULL_FACE),D(ea);function He(Q){g[Q]!==!0&&(n.enable(Q),g[Q]=!0)}function Fe(Q){g[Q]!==!1&&(n.disable(Q),g[Q]=!1)}function Ct(Q,Me){return c[Q]!==Me?(n.bindFramebuffer(Q,Me),c[Q]=Me,Q===n.DRAW_FRAMEBUFFER&&(c[n.FRAMEBUFFER]=Me),Q===n.FRAMEBUFFER&&(c[n.DRAW_FRAMEBUFFER]=Me),!0):!1}function pt(Q,Me){let Ce=C,Re=!1;if(Q){Ce=u.get(Me),Ce===void 0&&(Ce=[],u.set(Me,Ce));const De=Q.textures;if(Ce.length!==De.length||Ce[0]!==n.COLOR_ATTACHMENT0){for(let qe=0,Wt=De.length;qe<Wt;qe++)Ce[qe]=n.COLOR_ATTACHMENT0+qe;Ce.length=De.length,Re=!0}}else Ce[0]!==n.BACK&&(Ce[0]=n.BACK,Re=!0);Re&&n.drawBuffers(Ce)}function ot(Q){return h!==Q?(n.useProgram(Q),h=Q,!0):!1}const Ue={[Fl]:n.FUNC_ADD,[MX]:n.FUNC_SUBTRACT,[NX]:n.FUNC_REVERSE_SUBTRACT};Ue[FX]=n.MIN,Ue[HX]=n.MAX;const we={[XX]:n.ZERO,[TX]:n.ONE,[EX]:n.SRC_COLOR,[Ef]:n.SRC_ALPHA,[zX]:n.SRC_ALPHA_SATURATE,[LX]:n.DST_COLOR,[KX]:n.DST_ALPHA,[YX]:n.ONE_MINUS_SRC_COLOR,[Yf]:n.ONE_MINUS_SRC_ALPHA,[kX]:n.ONE_MINUS_DST_COLOR,[_X]:n.ONE_MINUS_DST_ALPHA,[DX]:n.CONSTANT_COLOR,[PX]:n.ONE_MINUS_CONSTANT_COLOR,[UX]:n.CONSTANT_ALPHA,[JX]:n.ONE_MINUS_CONSTANT_ALPHA};function D(Q,Me,Ce,Re,De,qe,Wt,$t,An,Ft){if(Q===ea){p===!0&&(Fe(n.BLEND),p=!1);return}if(p===!1&&(He(n.BLEND),p=!0),Q!==WX){if(Q!==b||Ft!==S){if((m!==Fl||G!==Fl)&&(n.blendEquation(n.FUNC_ADD),m=Fl,G=Fl),Ft)switch(Q){case Rc:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case C2:n.blendFunc(n.ONE,n.ONE);break;case h2:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case A2:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}else switch(Q){case Rc:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case C2:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case h2:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case A2:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}A=null,B=null,w=null,N=null,M.set(0,0,0),R=0,b=Q,S=Ft}return}De=De||Me,qe=qe||Ce,Wt=Wt||Re,(Me!==m||De!==G)&&(n.blendEquationSeparate(Ue[Me],Ue[De]),m=Me,G=De),(Ce!==A||Re!==B||qe!==w||Wt!==N)&&(n.blendFuncSeparate(we[Ce],we[Re],we[qe],we[Wt]),A=Ce,B=Re,w=qe,N=Wt),($t.equals(M)===!1||An!==R)&&(n.blendColor($t.r,$t.g,$t.b,An),M.copy($t),R=An),b=Q,S=!1}function Ee(Q,Me){Q.side===bo?Fe(n.CULL_FACE):He(n.CULL_FACE);let Ce=Q.side===Es;Me&&(Ce=!Ce),Ye(Ce),Q.blending===Rc&&Q.transparent===!1?D(ea):D(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst,Q.blendEquationAlpha,Q.blendSrcAlpha,Q.blendDstAlpha,Q.blendColor,Q.blendAlpha,Q.premultipliedAlpha),o.setFunc(Q.depthFunc),o.setTest(Q.depthTest),o.setMask(Q.depthWrite),s.setMask(Q.colorWrite);const Re=Q.stencilWrite;r.setTest(Re),Re&&(r.setMask(Q.stencilWriteMask),r.setFunc(Q.stencilFunc,Q.stencilRef,Q.stencilFuncMask),r.setOp(Q.stencilFail,Q.stencilZFail,Q.stencilZPass)),ut(Q.polygonOffset,Q.polygonOffsetFactor,Q.polygonOffsetUnits),Q.alphaToCoverage===!0?He(n.SAMPLE_ALPHA_TO_COVERAGE):Fe(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ye(Q){F!==Q&&(Q?n.frontFace(n.CW):n.frontFace(n.CCW),F=Q)}function Ne(Q){Q!==RX?(He(n.CULL_FACE),Q!==Z&&(Q===d2?n.cullFace(n.BACK):Q===xX?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Fe(n.CULL_FACE),Z=Q}function _e(Q){Q!==x&&(ue&&n.lineWidth(Q),x=Q)}function ut(Q,Me,Ce){Q?(He(n.POLYGON_OFFSET_FILL),(Y!==Me||T!==Ce)&&(n.polygonOffset(Me,Ce),Y=Me,T=Ce)):Fe(n.POLYGON_OFFSET_FILL)}function Oe(Q){Q?He(n.SCISSOR_TEST):Fe(n.SCISSOR_TEST)}function P(Q){Q===void 0&&(Q=n.TEXTURE0+ne-1),k!==Q&&(n.activeTexture(Q),k=Q)}function E(Q,Me,Ce){Ce===void 0&&(k===null?Ce=n.TEXTURE0+ne-1:Ce=k);let Re=ee[Ce];Re===void 0&&(Re={type:void 0,texture:void 0},ee[Ce]=Re),(Re.type!==Q||Re.texture!==Me)&&(k!==Ce&&(n.activeTexture(Ce),k=Ce),n.bindTexture(Q,Me||Be[Q]),Re.type=Q,Re.texture=Me)}function ge(){const Q=ee[k];Q!==void 0&&Q.type!==void 0&&(n.bindTexture(Q.type,null),Q.type=void 0,Q.texture=void 0)}function ve(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Se(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Ze(){try{n.texSubImage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Je(){try{n.texSubImage3D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function We(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Qe(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Kt(){try{n.texStorage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Xe(){try{n.texStorage3D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function et(){try{n.texImage2D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Gt(){try{n.texImage3D.apply(n,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function wt(Q){be.equals(Q)===!1&&(n.scissor(Q.x,Q.y,Q.z,Q.w),be.copy(Q))}function it(Q){me.equals(Q)===!1&&(n.viewport(Q.x,Q.y,Q.z,Q.w),me.copy(Q))}function Nt(Q,Me){let Ce=l.get(Me);Ce===void 0&&(Ce=new WeakMap,l.set(Me,Ce));let Re=Ce.get(Q);Re===void 0&&(Re=n.getUniformBlockIndex(Me,Q.name),Ce.set(Q,Re))}function q(Q,Me){const Re=l.get(Me).get(Q);a.get(Me)!==Re&&(n.uniformBlockBinding(Me,Re,Q.__bindingPointIndex),a.set(Me,Re))}function xe(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),g={},k=null,ee={},c={},u=new WeakMap,C=[],h=null,p=!1,b=null,m=null,A=null,B=null,G=null,w=null,N=null,M=new Pe(0,0,0),R=0,S=!1,F=null,Z=null,x=null,Y=null,T=null,be.set(0,0,n.canvas.width,n.canvas.height),me.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),r.reset()}return{buffers:{color:s,depth:o,stencil:r},enable:He,disable:Fe,bindFramebuffer:Ct,drawBuffers:pt,useProgram:ot,setBlending:D,setMaterial:Ee,setFlipSided:Ye,setCullFace:Ne,setLineWidth:_e,setPolygonOffset:ut,setScissorTest:Oe,activeTexture:P,bindTexture:E,unbindTexture:ge,compressedTexImage2D:ve,compressedTexImage3D:Se,texImage2D:et,texImage3D:Gt,updateUBOMapping:Nt,uniformBlockBinding:q,texStorage2D:Kt,texStorage3D:Xe,texSubImage2D:Ze,texSubImage3D:Je,compressedTexSubImage2D:We,compressedTexSubImage3D:Qe,scissor:wt,viewport:it,reset:xe}}function aQ(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function lQ(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function gQ(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function B2(n,e,t,i){const s=cQ(i);switch(t){case vZ:return n*e;case ZZ:return n*e;case SZ:return n*e*2;case mb:return n*e/s.components*s.byteLength;case iA:return n*e/s.components*s.byteLength;case RZ:return n*e*2/s.components*s.byteLength;case fb:return n*e*2/s.components*s.byteLength;case wZ:return n*e*3/s.components*s.byteLength;case fs:return n*e*4/s.components*s.byteLength;case bb:return n*e*4/s.components*s.byteLength;case LC:case kC:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case zC:case DC:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Jf:case Qf:return Math.max(n,16)*Math.max(e,8)/4;case Uf:case Of:return Math.max(n,8)*Math.max(e,8)/2;case jf:case qf:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case $f:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case e0:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case t0:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case n0:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case i0:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case s0:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case o0:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case r0:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case a0:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case l0:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case g0:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case c0:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case u0:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case I0:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case d0:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case PC:case C0:case h0:return Math.ceil(n/4)*Math.ceil(e/4)*16;case xZ:case A0:return Math.ceil(n/4)*Math.ceil(e/4)*8;case p0:case m0:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function cQ(n){switch(n){case Vr:case yZ:return{byteLength:1,components:1};case kc:case BZ:case il:return{byteLength:2,components:1};case Ab:case pb:return{byteLength:2,components:4};case Qa:case hb:case Xs:return{byteLength:4,components:1};case GZ:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}const uQ={contain:aQ,cover:lQ,fill:gQ,getByteLength:B2};function IQ(n,e,t,i,s,o,r){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new ye,c=new WeakMap;let u;const C=new WeakMap;let h=!1;try{h=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(P,E){return h?new OffscreenCanvas(P,E):Vh("canvas")}function b(P,E,ge){let ve=1;const Se=Oe(P);if((Se.width>ge||Se.height>ge)&&(ve=ge/Math.max(Se.width,Se.height)),ve<1)if(typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&P instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&P instanceof ImageBitmap||typeof VideoFrame<"u"&&P instanceof VideoFrame){const Ze=Math.floor(ve*Se.width),Je=Math.floor(ve*Se.height);u===void 0&&(u=p(Ze,Je));const We=E?p(Ze,Je):u;return We.width=Ze,We.height=Je,We.getContext("2d").drawImage(P,0,0,Ze,Je),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Se.width+"x"+Se.height+") to ("+Ze+"x"+Je+")."),We}else return"data"in P&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Se.width+"x"+Se.height+")."),P;return P}function m(P){return P.generateMipmaps&&P.minFilter!==Bi&&P.minFilter!==fn}function A(P){n.generateMipmap(P)}function B(P,E,ge,ve,Se=!1){if(P!==null){if(n[P]!==void 0)return n[P];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+P+"'")}let Ze=E;if(E===n.RED&&(ge===n.FLOAT&&(Ze=n.R32F),ge===n.HALF_FLOAT&&(Ze=n.R16F),ge===n.UNSIGNED_BYTE&&(Ze=n.R8)),E===n.RED_INTEGER&&(ge===n.UNSIGNED_BYTE&&(Ze=n.R8UI),ge===n.UNSIGNED_SHORT&&(Ze=n.R16UI),ge===n.UNSIGNED_INT&&(Ze=n.R32UI),ge===n.BYTE&&(Ze=n.R8I),ge===n.SHORT&&(Ze=n.R16I),ge===n.INT&&(Ze=n.R32I)),E===n.RG&&(ge===n.FLOAT&&(Ze=n.RG32F),ge===n.HALF_FLOAT&&(Ze=n.RG16F),ge===n.UNSIGNED_BYTE&&(Ze=n.RG8)),E===n.RG_INTEGER&&(ge===n.UNSIGNED_BYTE&&(Ze=n.RG8UI),ge===n.UNSIGNED_SHORT&&(Ze=n.RG16UI),ge===n.UNSIGNED_INT&&(Ze=n.RG32UI),ge===n.BYTE&&(Ze=n.RG8I),ge===n.SHORT&&(Ze=n.RG16I),ge===n.INT&&(Ze=n.RG32I)),E===n.RGB_INTEGER&&(ge===n.UNSIGNED_BYTE&&(Ze=n.RGB8UI),ge===n.UNSIGNED_SHORT&&(Ze=n.RGB16UI),ge===n.UNSIGNED_INT&&(Ze=n.RGB32UI),ge===n.BYTE&&(Ze=n.RGB8I),ge===n.SHORT&&(Ze=n.RGB16I),ge===n.INT&&(Ze=n.RGB32I)),E===n.RGBA_INTEGER&&(ge===n.UNSIGNED_BYTE&&(Ze=n.RGBA8UI),ge===n.UNSIGNED_SHORT&&(Ze=n.RGBA16UI),ge===n.UNSIGNED_INT&&(Ze=n.RGBA32UI),ge===n.BYTE&&(Ze=n.RGBA8I),ge===n.SHORT&&(Ze=n.RGBA16I),ge===n.INT&&(Ze=n.RGBA32I)),E===n.RGB&&ge===n.UNSIGNED_INT_5_9_9_9_REV&&(Ze=n.RGB9_E5),E===n.RGBA){const Je=Se?wh:cn.getTransfer(ve);ge===n.FLOAT&&(Ze=n.RGBA32F),ge===n.HALF_FLOAT&&(Ze=n.RGBA16F),ge===n.UNSIGNED_BYTE&&(Ze=Je===xn?n.SRGB8_ALPHA8:n.RGBA8),ge===n.UNSIGNED_SHORT_4_4_4_4&&(Ze=n.RGBA4),ge===n.UNSIGNED_SHORT_5_5_5_1&&(Ze=n.RGB5_A1)}return(Ze===n.R16F||Ze===n.R32F||Ze===n.RG16F||Ze===n.RG32F||Ze===n.RGBA16F||Ze===n.RGBA32F)&&e.get("EXT_color_buffer_float"),Ze}function G(P,E){let ge;return P?E===null||E===Qa||E===zc?ge=n.DEPTH24_STENCIL8:E===Xs?ge=n.DEPTH32F_STENCIL8:E===kc&&(ge=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):E===null||E===Qa||E===zc?ge=n.DEPTH_COMPONENT24:E===Xs?ge=n.DEPTH_COMPONENT32F:E===kc&&(ge=n.DEPTH_COMPONENT16),ge}function w(P,E){return m(P)===!0||P.isFramebufferTexture&&P.minFilter!==Bi&&P.minFilter!==fn?Math.log2(Math.max(E.width,E.height))+1:P.mipmaps!==void 0&&P.mipmaps.length>0?P.mipmaps.length:P.isCompressedTexture&&Array.isArray(P.image)?E.mipmaps.length:1}function N(P){const E=P.target;E.removeEventListener("dispose",N),R(E),E.isVideoTexture&&c.delete(E)}function M(P){const E=P.target;E.removeEventListener("dispose",M),F(E)}function R(P){const E=i.get(P);if(E.__webglInit===void 0)return;const ge=P.source,ve=C.get(ge);if(ve){const Se=ve[E.__cacheKey];Se.usedTimes--,Se.usedTimes===0&&S(P),Object.keys(ve).length===0&&C.delete(ge)}i.remove(P)}function S(P){const E=i.get(P);n.deleteTexture(E.__webglTexture);const ge=P.source,ve=C.get(ge);delete ve[E.__cacheKey],r.memory.textures--}function F(P){const E=i.get(P);if(P.depthTexture&&P.depthTexture.dispose(),P.isWebGLCubeRenderTarget)for(let ve=0;ve<6;ve++){if(Array.isArray(E.__webglFramebuffer[ve]))for(let Se=0;Se<E.__webglFramebuffer[ve].length;Se++)n.deleteFramebuffer(E.__webglFramebuffer[ve][Se]);else n.deleteFramebuffer(E.__webglFramebuffer[ve]);E.__webglDepthbuffer&&n.deleteRenderbuffer(E.__webglDepthbuffer[ve])}else{if(Array.isArray(E.__webglFramebuffer))for(let ve=0;ve<E.__webglFramebuffer.length;ve++)n.deleteFramebuffer(E.__webglFramebuffer[ve]);else n.deleteFramebuffer(E.__webglFramebuffer);if(E.__webglDepthbuffer&&n.deleteRenderbuffer(E.__webglDepthbuffer),E.__webglMultisampledFramebuffer&&n.deleteFramebuffer(E.__webglMultisampledFramebuffer),E.__webglColorRenderbuffer)for(let ve=0;ve<E.__webglColorRenderbuffer.length;ve++)E.__webglColorRenderbuffer[ve]&&n.deleteRenderbuffer(E.__webglColorRenderbuffer[ve]);E.__webglDepthRenderbuffer&&n.deleteRenderbuffer(E.__webglDepthRenderbuffer)}const ge=P.textures;for(let ve=0,Se=ge.length;ve<Se;ve++){const Ze=i.get(ge[ve]);Ze.__webglTexture&&(n.deleteTexture(Ze.__webglTexture),r.memory.textures--),i.remove(ge[ve])}i.remove(P)}let Z=0;function x(){Z=0}function Y(){const P=Z;return P>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+P+" texture units while this GPU supports only "+s.maxTextures),Z+=1,P}function T(P){const E=[];return E.push(P.wrapS),E.push(P.wrapT),E.push(P.wrapR||0),E.push(P.magFilter),E.push(P.minFilter),E.push(P.anisotropy),E.push(P.internalFormat),E.push(P.format),E.push(P.type),E.push(P.generateMipmaps),E.push(P.premultiplyAlpha),E.push(P.flipY),E.push(P.unpackAlignment),E.push(P.colorSpace),E.join()}function ne(P,E){const ge=i.get(P);if(P.isVideoTexture&&_e(P),P.isRenderTargetTexture===!1&&P.version>0&&ge.__version!==P.version){const ve=P.image;if(ve===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ve.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{me(ge,P,E);return}}t.bindTexture(n.TEXTURE_2D,ge.__webglTexture,n.TEXTURE0+E)}function ue(P,E){const ge=i.get(P);if(P.version>0&&ge.__version!==P.version){me(ge,P,E);return}t.bindTexture(n.TEXTURE_2D_ARRAY,ge.__webglTexture,n.TEXTURE0+E)}function se(P,E){const ge=i.get(P);if(P.version>0&&ge.__version!==P.version){me(ge,P,E);return}t.bindTexture(n.TEXTURE_3D,ge.__webglTexture,n.TEXTURE0+E)}function Ie(P,E){const ge=i.get(P);if(P.version>0&&ge.__version!==P.version){ce(ge,P,E);return}t.bindTexture(n.TEXTURE_CUBE_MAP,ge.__webglTexture,n.TEXTURE0+E)}const k={[xr]:n.REPEAT,[to]:n.CLAMP_TO_EDGE,[Lc]:n.MIRRORED_REPEAT},ee={[Bi]:n.NEAREST,[nA]:n.NEAREST_MIPMAP_NEAREST,[Tl]:n.NEAREST_MIPMAP_LINEAR,[fn]:n.LINEAR,[xc]:n.LINEAR_MIPMAP_NEAREST,[no]:n.LINEAR_MIPMAP_LINEAR},$={[cT]:n.NEVER,[AT]:n.ALWAYS,[uT]:n.LESS,[MZ]:n.LEQUAL,[IT]:n.EQUAL,[hT]:n.GEQUAL,[dT]:n.GREATER,[CT]:n.NOTEQUAL};function ae(P,E){if(E.type===Xs&&e.has("OES_texture_float_linear")===!1&&(E.magFilter===fn||E.magFilter===xc||E.magFilter===Tl||E.magFilter===no||E.minFilter===fn||E.minFilter===xc||E.minFilter===Tl||E.minFilter===no)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(P,n.TEXTURE_WRAP_S,k[E.wrapS]),n.texParameteri(P,n.TEXTURE_WRAP_T,k[E.wrapT]),(P===n.TEXTURE_3D||P===n.TEXTURE_2D_ARRAY)&&n.texParameteri(P,n.TEXTURE_WRAP_R,k[E.wrapR]),n.texParameteri(P,n.TEXTURE_MAG_FILTER,ee[E.magFilter]),n.texParameteri(P,n.TEXTURE_MIN_FILTER,ee[E.minFilter]),E.compareFunction&&(n.texParameteri(P,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(P,n.TEXTURE_COMPARE_FUNC,$[E.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(E.magFilter===Bi||E.minFilter!==Tl&&E.minFilter!==no||E.type===Xs&&e.has("OES_texture_float_linear")===!1)return;if(E.anisotropy>1||i.get(E).__currentAnisotropy){const ge=e.get("EXT_texture_filter_anisotropic");n.texParameterf(P,ge.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,s.getMaxAnisotropy())),i.get(E).__currentAnisotropy=E.anisotropy}}}function be(P,E){let ge=!1;P.__webglInit===void 0&&(P.__webglInit=!0,E.addEventListener("dispose",N));const ve=E.source;let Se=C.get(ve);Se===void 0&&(Se={},C.set(ve,Se));const Ze=T(E);if(Ze!==P.__cacheKey){Se[Ze]===void 0&&(Se[Ze]={texture:n.createTexture(),usedTimes:0},r.memory.textures++,ge=!0),Se[Ze].usedTimes++;const Je=Se[P.__cacheKey];Je!==void 0&&(Se[P.__cacheKey].usedTimes--,Je.usedTimes===0&&S(E)),P.__cacheKey=Ze,P.__webglTexture=Se[Ze].texture}return ge}function me(P,E,ge){let ve=n.TEXTURE_2D;(E.isDataArrayTexture||E.isCompressedArrayTexture)&&(ve=n.TEXTURE_2D_ARRAY),E.isData3DTexture&&(ve=n.TEXTURE_3D);const Se=be(P,E),Ze=E.source;t.bindTexture(ve,P.__webglTexture,n.TEXTURE0+ge);const Je=i.get(Ze);if(Ze.version!==Je.__version||Se===!0){t.activeTexture(n.TEXTURE0+ge);const We=cn.getPrimaries(cn.workingColorSpace),Qe=E.colorSpace===xa?null:cn.getPrimaries(E.colorSpace),Kt=E.colorSpace===xa||We===Qe?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,E.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,E.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,E.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Kt);let Xe=b(E.image,!1,s.maxTextureSize);Xe=ut(E,Xe);const et=o.convert(E.format,E.colorSpace),Gt=o.convert(E.type);let wt=B(E.internalFormat,et,Gt,E.colorSpace,E.isVideoTexture);ae(ve,E);let it;const Nt=E.mipmaps,q=E.isVideoTexture!==!0,xe=Je.__version===void 0||Se===!0,Q=Ze.dataReady,Me=w(E,Xe);if(E.isDepthTexture)wt=G(E.format===Dc,E.type),xe&&(q?t.texStorage2D(n.TEXTURE_2D,1,wt,Xe.width,Xe.height):t.texImage2D(n.TEXTURE_2D,0,wt,Xe.width,Xe.height,0,et,Gt,null));else if(E.isDataTexture)if(Nt.length>0){q&&xe&&t.texStorage2D(n.TEXTURE_2D,Me,wt,Nt[0].width,Nt[0].height);for(let Ce=0,Re=Nt.length;Ce<Re;Ce++)it=Nt[Ce],q?Q&&t.texSubImage2D(n.TEXTURE_2D,Ce,0,0,it.width,it.height,et,Gt,it.data):t.texImage2D(n.TEXTURE_2D,Ce,wt,it.width,it.height,0,et,Gt,it.data);E.generateMipmaps=!1}else q?(xe&&t.texStorage2D(n.TEXTURE_2D,Me,wt,Xe.width,Xe.height),Q&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Xe.width,Xe.height,et,Gt,Xe.data)):t.texImage2D(n.TEXTURE_2D,0,wt,Xe.width,Xe.height,0,et,Gt,Xe.data);else if(E.isCompressedTexture)if(E.isCompressedArrayTexture){q&&xe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Me,wt,Nt[0].width,Nt[0].height,Xe.depth);for(let Ce=0,Re=Nt.length;Ce<Re;Ce++)if(it=Nt[Ce],E.format!==fs)if(et!==null)if(q){if(Q)if(E.layerUpdates.size>0){const De=B2(it.width,it.height,E.format,E.type);for(const qe of E.layerUpdates){const Wt=it.data.subarray(qe*De/it.data.BYTES_PER_ELEMENT,(qe+1)*De/it.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Ce,0,0,qe,it.width,it.height,1,et,Wt,0,0)}E.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Ce,0,0,0,it.width,it.height,Xe.depth,et,it.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Ce,wt,it.width,it.height,Xe.depth,0,it.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else q?Q&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Ce,0,0,0,it.width,it.height,Xe.depth,et,Gt,it.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Ce,wt,it.width,it.height,Xe.depth,0,et,Gt,it.data)}else{q&&xe&&t.texStorage2D(n.TEXTURE_2D,Me,wt,Nt[0].width,Nt[0].height);for(let Ce=0,Re=Nt.length;Ce<Re;Ce++)it=Nt[Ce],E.format!==fs?et!==null?q?Q&&t.compressedTexSubImage2D(n.TEXTURE_2D,Ce,0,0,it.width,it.height,et,it.data):t.compressedTexImage2D(n.TEXTURE_2D,Ce,wt,it.width,it.height,0,it.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):q?Q&&t.texSubImage2D(n.TEXTURE_2D,Ce,0,0,it.width,it.height,et,Gt,it.data):t.texImage2D(n.TEXTURE_2D,Ce,wt,it.width,it.height,0,et,Gt,it.data)}else if(E.isDataArrayTexture)if(q){if(xe&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Me,wt,Xe.width,Xe.height,Xe.depth),Q)if(E.layerUpdates.size>0){const Ce=B2(Xe.width,Xe.height,E.format,E.type);for(const Re of E.layerUpdates){const De=Xe.data.subarray(Re*Ce/Xe.data.BYTES_PER_ELEMENT,(Re+1)*Ce/Xe.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Re,Xe.width,Xe.height,1,et,Gt,De)}E.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Xe.width,Xe.height,Xe.depth,et,Gt,Xe.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,wt,Xe.width,Xe.height,Xe.depth,0,et,Gt,Xe.data);else if(E.isData3DTexture)q?(xe&&t.texStorage3D(n.TEXTURE_3D,Me,wt,Xe.width,Xe.height,Xe.depth),Q&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Xe.width,Xe.height,Xe.depth,et,Gt,Xe.data)):t.texImage3D(n.TEXTURE_3D,0,wt,Xe.width,Xe.height,Xe.depth,0,et,Gt,Xe.data);else if(E.isFramebufferTexture){if(xe)if(q)t.texStorage2D(n.TEXTURE_2D,Me,wt,Xe.width,Xe.height);else{let Ce=Xe.width,Re=Xe.height;for(let De=0;De<Me;De++)t.texImage2D(n.TEXTURE_2D,De,wt,Ce,Re,0,et,Gt,null),Ce>>=1,Re>>=1}}else if(Nt.length>0){if(q&&xe){const Ce=Oe(Nt[0]);t.texStorage2D(n.TEXTURE_2D,Me,wt,Ce.width,Ce.height)}for(let Ce=0,Re=Nt.length;Ce<Re;Ce++)it=Nt[Ce],q?Q&&t.texSubImage2D(n.TEXTURE_2D,Ce,0,0,et,Gt,it):t.texImage2D(n.TEXTURE_2D,Ce,wt,et,Gt,it);E.generateMipmaps=!1}else if(q){if(xe){const Ce=Oe(Xe);t.texStorage2D(n.TEXTURE_2D,Me,wt,Ce.width,Ce.height)}Q&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,et,Gt,Xe)}else t.texImage2D(n.TEXTURE_2D,0,wt,et,Gt,Xe);m(E)&&A(ve),Je.__version=Ze.version,E.onUpdate&&E.onUpdate(E)}P.__version=E.version}function ce(P,E,ge){if(E.image.length!==6)return;const ve=be(P,E),Se=E.source;t.bindTexture(n.TEXTURE_CUBE_MAP,P.__webglTexture,n.TEXTURE0+ge);const Ze=i.get(Se);if(Se.version!==Ze.__version||ve===!0){t.activeTexture(n.TEXTURE0+ge);const Je=cn.getPrimaries(cn.workingColorSpace),We=E.colorSpace===xa?null:cn.getPrimaries(E.colorSpace),Qe=E.colorSpace===xa||Je===We?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,E.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,E.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,E.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Qe);const Kt=E.isCompressedTexture||E.image[0].isCompressedTexture,Xe=E.image[0]&&E.image[0].isDataTexture,et=[];for(let Re=0;Re<6;Re++)!Kt&&!Xe?et[Re]=b(E.image[Re],!0,s.maxCubemapSize):et[Re]=Xe?E.image[Re].image:E.image[Re],et[Re]=ut(E,et[Re]);const Gt=et[0],wt=o.convert(E.format,E.colorSpace),it=o.convert(E.type),Nt=B(E.internalFormat,wt,it,E.colorSpace),q=E.isVideoTexture!==!0,xe=Ze.__version===void 0||ve===!0,Q=Se.dataReady;let Me=w(E,Gt);ae(n.TEXTURE_CUBE_MAP,E);let Ce;if(Kt){q&&xe&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Me,Nt,Gt.width,Gt.height);for(let Re=0;Re<6;Re++){Ce=et[Re].mipmaps;for(let De=0;De<Ce.length;De++){const qe=Ce[De];E.format!==fs?wt!==null?q?Q&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De,0,0,qe.width,qe.height,wt,qe.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De,Nt,qe.width,qe.height,0,qe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):q?Q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De,0,0,qe.width,qe.height,wt,it,qe.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De,Nt,qe.width,qe.height,0,wt,it,qe.data)}}}else{if(Ce=E.mipmaps,q&&xe){Ce.length>0&&Me++;const Re=Oe(et[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Me,Nt,Re.width,Re.height)}for(let Re=0;Re<6;Re++)if(Xe){q?Q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,0,0,et[Re].width,et[Re].height,wt,it,et[Re].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,Nt,et[Re].width,et[Re].height,0,wt,it,et[Re].data);for(let De=0;De<Ce.length;De++){const Wt=Ce[De].image[Re].image;q?Q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De+1,0,0,Wt.width,Wt.height,wt,it,Wt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De+1,Nt,Wt.width,Wt.height,0,wt,it,Wt.data)}}else{q?Q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,0,0,wt,it,et[Re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,Nt,wt,it,et[Re]);for(let De=0;De<Ce.length;De++){const qe=Ce[De];q?Q&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De+1,0,0,wt,it,qe.image[Re]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Re,De+1,Nt,wt,it,qe.image[Re])}}}m(E)&&A(n.TEXTURE_CUBE_MAP),Ze.__version=Se.version,E.onUpdate&&E.onUpdate(E)}P.__version=E.version}function Be(P,E,ge,ve,Se,Ze){const Je=o.convert(ge.format,ge.colorSpace),We=o.convert(ge.type),Qe=B(ge.internalFormat,Je,We,ge.colorSpace);if(!i.get(E).__hasExternalTextures){const Xe=Math.max(1,E.width>>Ze),et=Math.max(1,E.height>>Ze);Se===n.TEXTURE_3D||Se===n.TEXTURE_2D_ARRAY?t.texImage3D(Se,Ze,Qe,Xe,et,E.depth,0,Je,We,null):t.texImage2D(Se,Ze,Qe,Xe,et,0,Je,We,null)}t.bindFramebuffer(n.FRAMEBUFFER,P),Ne(E)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,ve,Se,i.get(ge).__webglTexture,0,Ye(E)):(Se===n.TEXTURE_2D||Se>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Se<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,ve,Se,i.get(ge).__webglTexture,Ze),t.bindFramebuffer(n.FRAMEBUFFER,null)}function He(P,E,ge){if(n.bindRenderbuffer(n.RENDERBUFFER,P),E.depthBuffer){const ve=E.depthTexture,Se=ve&&ve.isDepthTexture?ve.type:null,Ze=G(E.stencilBuffer,Se),Je=E.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,We=Ye(E);Ne(E)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,We,Ze,E.width,E.height):ge?n.renderbufferStorageMultisample(n.RENDERBUFFER,We,Ze,E.width,E.height):n.renderbufferStorage(n.RENDERBUFFER,Ze,E.width,E.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Je,n.RENDERBUFFER,P)}else{const ve=E.textures;for(let Se=0;Se<ve.length;Se++){const Ze=ve[Se],Je=o.convert(Ze.format,Ze.colorSpace),We=o.convert(Ze.type),Qe=B(Ze.internalFormat,Je,We,Ze.colorSpace),Kt=Ye(E);ge&&Ne(E)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Kt,Qe,E.width,E.height):Ne(E)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Kt,Qe,E.width,E.height):n.renderbufferStorage(n.RENDERBUFFER,Qe,E.width,E.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Fe(P,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,P),!(E.depthTexture&&E.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),ne(E.depthTexture,0);const ve=i.get(E.depthTexture).__webglTexture,Se=Ye(E);if(E.depthTexture.format===Pl)Ne(E)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ve,0,Se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,ve,0);else if(E.depthTexture.format===Dc)Ne(E)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ve,0,Se):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,ve,0);else throw new Error("Unknown depthTexture format")}function Ct(P){const E=i.get(P),ge=P.isWebGLCubeRenderTarget===!0;if(E.__boundDepthTexture!==P.depthTexture){const ve=P.depthTexture;if(E.__depthDisposeCallback&&E.__depthDisposeCallback(),ve){const Se=()=>{delete E.__boundDepthTexture,delete E.__depthDisposeCallback,ve.removeEventListener("dispose",Se)};ve.addEventListener("dispose",Se),E.__depthDisposeCallback=Se}E.__boundDepthTexture=ve}if(P.depthTexture&&!E.__autoAllocateDepthBuffer){if(ge)throw new Error("target.depthTexture not supported in Cube render targets");Fe(E.__webglFramebuffer,P)}else if(ge){E.__webglDepthbuffer=[];for(let ve=0;ve<6;ve++)if(t.bindFramebuffer(n.FRAMEBUFFER,E.__webglFramebuffer[ve]),E.__webglDepthbuffer[ve]===void 0)E.__webglDepthbuffer[ve]=n.createRenderbuffer(),He(E.__webglDepthbuffer[ve],P,!1);else{const Se=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ze=E.__webglDepthbuffer[ve];n.bindRenderbuffer(n.RENDERBUFFER,Ze),n.framebufferRenderbuffer(n.FRAMEBUFFER,Se,n.RENDERBUFFER,Ze)}}else if(t.bindFramebuffer(n.FRAMEBUFFER,E.__webglFramebuffer),E.__webglDepthbuffer===void 0)E.__webglDepthbuffer=n.createRenderbuffer(),He(E.__webglDepthbuffer,P,!1);else{const ve=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Se=E.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,Se),n.framebufferRenderbuffer(n.FRAMEBUFFER,ve,n.RENDERBUFFER,Se)}t.bindFramebuffer(n.FRAMEBUFFER,null)}function pt(P,E,ge){const ve=i.get(P);E!==void 0&&Be(ve.__webglFramebuffer,P,P.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),ge!==void 0&&Ct(P)}function ot(P){const E=P.texture,ge=i.get(P),ve=i.get(E);P.addEventListener("dispose",M);const Se=P.textures,Ze=P.isWebGLCubeRenderTarget===!0,Je=Se.length>1;if(Je||(ve.__webglTexture===void 0&&(ve.__webglTexture=n.createTexture()),ve.__version=E.version,r.memory.textures++),Ze){ge.__webglFramebuffer=[];for(let We=0;We<6;We++)if(E.mipmaps&&E.mipmaps.length>0){ge.__webglFramebuffer[We]=[];for(let Qe=0;Qe<E.mipmaps.length;Qe++)ge.__webglFramebuffer[We][Qe]=n.createFramebuffer()}else ge.__webglFramebuffer[We]=n.createFramebuffer()}else{if(E.mipmaps&&E.mipmaps.length>0){ge.__webglFramebuffer=[];for(let We=0;We<E.mipmaps.length;We++)ge.__webglFramebuffer[We]=n.createFramebuffer()}else ge.__webglFramebuffer=n.createFramebuffer();if(Je)for(let We=0,Qe=Se.length;We<Qe;We++){const Kt=i.get(Se[We]);Kt.__webglTexture===void 0&&(Kt.__webglTexture=n.createTexture(),r.memory.textures++)}if(P.samples>0&&Ne(P)===!1){ge.__webglMultisampledFramebuffer=n.createFramebuffer(),ge.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,ge.__webglMultisampledFramebuffer);for(let We=0;We<Se.length;We++){const Qe=Se[We];ge.__webglColorRenderbuffer[We]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,ge.__webglColorRenderbuffer[We]);const Kt=o.convert(Qe.format,Qe.colorSpace),Xe=o.convert(Qe.type),et=B(Qe.internalFormat,Kt,Xe,Qe.colorSpace,P.isXRRenderTarget===!0),Gt=Ye(P);n.renderbufferStorageMultisample(n.RENDERBUFFER,Gt,et,P.width,P.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+We,n.RENDERBUFFER,ge.__webglColorRenderbuffer[We])}n.bindRenderbuffer(n.RENDERBUFFER,null),P.depthBuffer&&(ge.__webglDepthRenderbuffer=n.createRenderbuffer(),He(ge.__webglDepthRenderbuffer,P,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(Ze){t.bindTexture(n.TEXTURE_CUBE_MAP,ve.__webglTexture),ae(n.TEXTURE_CUBE_MAP,E);for(let We=0;We<6;We++)if(E.mipmaps&&E.mipmaps.length>0)for(let Qe=0;Qe<E.mipmaps.length;Qe++)Be(ge.__webglFramebuffer[We][Qe],P,E,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+We,Qe);else Be(ge.__webglFramebuffer[We],P,E,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+We,0);m(E)&&A(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Je){for(let We=0,Qe=Se.length;We<Qe;We++){const Kt=Se[We],Xe=i.get(Kt);t.bindTexture(n.TEXTURE_2D,Xe.__webglTexture),ae(n.TEXTURE_2D,Kt),Be(ge.__webglFramebuffer,P,Kt,n.COLOR_ATTACHMENT0+We,n.TEXTURE_2D,0),m(Kt)&&A(n.TEXTURE_2D)}t.unbindTexture()}else{let We=n.TEXTURE_2D;if((P.isWebGL3DRenderTarget||P.isWebGLArrayRenderTarget)&&(We=P.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(We,ve.__webglTexture),ae(We,E),E.mipmaps&&E.mipmaps.length>0)for(let Qe=0;Qe<E.mipmaps.length;Qe++)Be(ge.__webglFramebuffer[Qe],P,E,n.COLOR_ATTACHMENT0,We,Qe);else Be(ge.__webglFramebuffer,P,E,n.COLOR_ATTACHMENT0,We,0);m(E)&&A(We),t.unbindTexture()}P.depthBuffer&&Ct(P)}function Ue(P){const E=P.textures;for(let ge=0,ve=E.length;ge<ve;ge++){const Se=E[ge];if(m(Se)){const Ze=P.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,Je=i.get(Se).__webglTexture;t.bindTexture(Ze,Je),A(Ze),t.unbindTexture()}}}const we=[],D=[];function Ee(P){if(P.samples>0){if(Ne(P)===!1){const E=P.textures,ge=P.width,ve=P.height;let Se=n.COLOR_BUFFER_BIT;const Ze=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Je=i.get(P),We=E.length>1;if(We)for(let Qe=0;Qe<E.length;Qe++)t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Je.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Je.__webglFramebuffer);for(let Qe=0;Qe<E.length;Qe++){if(P.resolveDepthBuffer&&(P.depthBuffer&&(Se|=n.DEPTH_BUFFER_BIT),P.stencilBuffer&&P.resolveStencilBuffer&&(Se|=n.STENCIL_BUFFER_BIT)),We){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Je.__webglColorRenderbuffer[Qe]);const Kt=i.get(E[Qe]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Kt,0)}n.blitFramebuffer(0,0,ge,ve,0,0,ge,ve,Se,n.NEAREST),l===!0&&(we.length=0,D.length=0,we.push(n.COLOR_ATTACHMENT0+Qe),P.depthBuffer&&P.resolveDepthBuffer===!1&&(we.push(Ze),D.push(Ze),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,D)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,we))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),We)for(let Qe=0;Qe<E.length;Qe++){t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.RENDERBUFFER,Je.__webglColorRenderbuffer[Qe]);const Kt=i.get(E[Qe]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Qe,n.TEXTURE_2D,Kt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Je.__webglMultisampledFramebuffer)}else if(P.depthBuffer&&P.resolveDepthBuffer===!1&&l){const E=P.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[E])}}}function Ye(P){return Math.min(s.maxSamples,P.samples)}function Ne(P){const E=i.get(P);return P.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&E.__useRenderToTexture!==!1}function _e(P){const E=r.render.frame;c.get(P)!==E&&(c.set(P,E),P.update())}function ut(P,E){const ge=P.colorSpace,ve=P.format,Se=P.type;return P.isCompressedTexture===!0||P.isVideoTexture===!0||ge!==Ei&&ge!==xa&&(cn.getTransfer(ge)===xn?(ve!==fs||Se!==Vr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ge)),E}function Oe(P){return typeof HTMLImageElement<"u"&&P instanceof HTMLImageElement?(g.width=P.naturalWidth||P.width,g.height=P.naturalHeight||P.height):typeof VideoFrame<"u"&&P instanceof VideoFrame?(g.width=P.displayWidth,g.height=P.displayHeight):(g.width=P.width,g.height=P.height),g}this.allocateTextureUnit=Y,this.resetTextureUnits=x,this.setTexture2D=ne,this.setTexture2DArray=ue,this.setTexture3D=se,this.setTextureCube=Ie,this.rebindTextures=pt,this.setupRenderTarget=ot,this.updateRenderTargetMipmap=Ue,this.updateMultisampleRenderTarget=Ee,this.setupDepthRenderbuffer=Ct,this.setupFrameBufferTexture=Be,this.useMultisampledRTT=Ne}function xT(n,e){function t(i,s=xa){let o;const r=cn.getTransfer(s);if(i===Vr)return n.UNSIGNED_BYTE;if(i===Ab)return n.UNSIGNED_SHORT_4_4_4_4;if(i===pb)return n.UNSIGNED_SHORT_5_5_5_1;if(i===GZ)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===yZ)return n.BYTE;if(i===BZ)return n.SHORT;if(i===kc)return n.UNSIGNED_SHORT;if(i===hb)return n.INT;if(i===Qa)return n.UNSIGNED_INT;if(i===Xs)return n.FLOAT;if(i===il)return n.HALF_FLOAT;if(i===vZ)return n.ALPHA;if(i===wZ)return n.RGB;if(i===fs)return n.RGBA;if(i===ZZ)return n.LUMINANCE;if(i===SZ)return n.LUMINANCE_ALPHA;if(i===Pl)return n.DEPTH_COMPONENT;if(i===Dc)return n.DEPTH_STENCIL;if(i===mb)return n.RED;if(i===iA)return n.RED_INTEGER;if(i===RZ)return n.RG;if(i===fb)return n.RG_INTEGER;if(i===bb)return n.RGBA_INTEGER;if(i===LC||i===kC||i===zC||i===DC)if(r===xn)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(i===LC)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===kC)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===zC)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===DC)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(i===LC)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===kC)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===zC)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===DC)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===Uf||i===Jf||i===Of||i===Qf)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(i===Uf)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===Jf)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===Of)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===Qf)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===jf||i===qf||i===$f)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(i===jf||i===qf)return r===xn?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(i===$f)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===e0||i===t0||i===n0||i===i0||i===s0||i===o0||i===r0||i===a0||i===l0||i===g0||i===c0||i===u0||i===I0||i===d0)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(i===e0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===t0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===n0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===i0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===s0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===o0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===r0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===a0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===l0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===g0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===c0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===u0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===I0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===d0)return r===xn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===PC||i===C0||i===h0)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(i===PC)return r===xn?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===C0)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===h0)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===xZ||i===A0||i===p0||i===m0)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(i===PC)return o.COMPRESSED_RED_RGTC1_EXT;if(i===A0)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===p0)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===m0)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===zc?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class VT extends Wn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Qo extends Lt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const dQ={type:"move"};class CG{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Qo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Qo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new _,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new _),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Qo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new _,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new _),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let s=null,o=null,r=null;const a=this._targetRay,l=this._grip,g=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(g&&e.hand){r=!0;for(const b of e.hand.values()){const m=t.getJointPose(b,i),A=this._getHandJoint(g,b);m!==null&&(A.matrix.fromArray(m.transform.matrix),A.matrix.decompose(A.position,A.rotation,A.scale),A.matrixWorldNeedsUpdate=!0,A.jointRadius=m.radius),A.visible=m!==null}const c=g.joints["index-finger-tip"],u=g.joints["thumb-tip"],C=c.position.distanceTo(u.position),h=.02,p=.005;g.inputState.pinching&&C>h+p?(g.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!g.inputState.pinching&&C<=h-p&&(g.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,i),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,o.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(o.linearVelocity)):l.hasLinearVelocity=!1,o.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(o.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(s=t.getPose(e.targetRaySpace,i),s===null&&o!==null&&(s=o),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(dQ)))}return a!==null&&(a.visible=s!==null),l!==null&&(l.visible=o!==null),g!==null&&(g.visible=r!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Qo;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const CQ=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,hQ=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class AQ{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const s=new Bn,o=e.properties.get(s);o.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=s}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new tr({vertexShader:CQ,fragmentShader:hQ,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new _n(new ad(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class pQ extends Mr{constructor(e,t){super();const i=this;let s=null,o=1,r=null,a="local-floor",l=1,g=null,c=null,u=null,C=null,h=null,p=null;const b=new AQ,m=t.getContextAttributes();let A=null,B=null;const G=[],w=[],N=new ye;let M=null;const R=new Wn;R.layers.enable(1),R.viewport=new rn;const S=new Wn;S.layers.enable(2),S.viewport=new rn;const F=[R,S],Z=new VT;Z.layers.enable(1),Z.layers.enable(2);let x=null,Y=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ce){let Be=G[ce];return Be===void 0&&(Be=new CG,G[ce]=Be),Be.getTargetRaySpace()},this.getControllerGrip=function(ce){let Be=G[ce];return Be===void 0&&(Be=new CG,G[ce]=Be),Be.getGripSpace()},this.getHand=function(ce){let Be=G[ce];return Be===void 0&&(Be=new CG,G[ce]=Be),Be.getHandSpace()};function T(ce){const Be=w.indexOf(ce.inputSource);if(Be===-1)return;const He=G[Be];He!==void 0&&(He.update(ce.inputSource,ce.frame,g||r),He.dispatchEvent({type:ce.type,data:ce.inputSource}))}function ne(){s.removeEventListener("select",T),s.removeEventListener("selectstart",T),s.removeEventListener("selectend",T),s.removeEventListener("squeeze",T),s.removeEventListener("squeezestart",T),s.removeEventListener("squeezeend",T),s.removeEventListener("end",ne),s.removeEventListener("inputsourceschange",ue);for(let ce=0;ce<G.length;ce++){const Be=w[ce];Be!==null&&(w[ce]=null,G[ce].disconnect(Be))}x=null,Y=null,b.reset(),e.setRenderTarget(A),h=null,C=null,u=null,s=null,B=null,me.stop(),i.isPresenting=!1,e.setPixelRatio(M),e.setSize(N.width,N.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ce){o=ce,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ce){a=ce,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return g||r},this.setReferenceSpace=function(ce){g=ce},this.getBaseLayer=function(){return C!==null?C:h},this.getBinding=function(){return u},this.getFrame=function(){return p},this.getSession=function(){return s},this.setSession=async function(ce){if(s=ce,s!==null){if(A=e.getRenderTarget(),s.addEventListener("select",T),s.addEventListener("selectstart",T),s.addEventListener("selectend",T),s.addEventListener("squeeze",T),s.addEventListener("squeezestart",T),s.addEventListener("squeezeend",T),s.addEventListener("end",ne),s.addEventListener("inputsourceschange",ue),m.xrCompatible!==!0&&await t.makeXRCompatible(),M=e.getPixelRatio(),e.getSize(N),s.renderState.layers===void 0){const Be={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:o};h=new XRWebGLLayer(s,t,Be),s.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),B=new Ys(h.framebufferWidth,h.framebufferHeight,{format:fs,type:Vr,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let Be=null,He=null,Fe=null;m.depth&&(Fe=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Be=m.stencil?Dc:Pl,He=m.stencil?zc:Qa);const Ct={colorFormat:t.RGBA8,depthFormat:Fe,scaleFactor:o};u=new XRWebGLBinding(s,t),C=u.createProjectionLayer(Ct),s.updateRenderState({layers:[C]}),e.setPixelRatio(1),e.setSize(C.textureWidth,C.textureHeight,!1),B=new Ys(C.textureWidth,C.textureHeight,{format:fs,type:Vr,depthTexture:new lA(C.textureWidth,C.textureHeight,He,void 0,void 0,void 0,void 0,void 0,void 0,Be),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:C.ignoreDepthValues===!1})}B.isXRRenderTarget=!0,this.setFoveation(l),g=null,r=await s.requestReferenceSpace(a),me.setContext(s),me.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode},this.getDepthTexture=function(){return b.getDepthTexture()};function ue(ce){for(let Be=0;Be<ce.removed.length;Be++){const He=ce.removed[Be],Fe=w.indexOf(He);Fe>=0&&(w[Fe]=null,G[Fe].disconnect(He))}for(let Be=0;Be<ce.added.length;Be++){const He=ce.added[Be];let Fe=w.indexOf(He);if(Fe===-1){for(let pt=0;pt<G.length;pt++)if(pt>=w.length){w.push(He),Fe=pt;break}else if(w[pt]===null){w[pt]=He,Fe=pt;break}if(Fe===-1)break}const Ct=G[Fe];Ct&&Ct.connect(He)}}const se=new _,Ie=new _;function k(ce,Be,He){se.setFromMatrixPosition(Be.matrixWorld),Ie.setFromMatrixPosition(He.matrixWorld);const Fe=se.distanceTo(Ie),Ct=Be.projectionMatrix.elements,pt=He.projectionMatrix.elements,ot=Ct[14]/(Ct[10]-1),Ue=Ct[14]/(Ct[10]+1),we=(Ct[9]+1)/Ct[5],D=(Ct[9]-1)/Ct[5],Ee=(Ct[8]-1)/Ct[0],Ye=(pt[8]+1)/pt[0],Ne=ot*Ee,_e=ot*Ye,ut=Fe/(-Ee+Ye),Oe=ut*-Ee;if(Be.matrixWorld.decompose(ce.position,ce.quaternion,ce.scale),ce.translateX(Oe),ce.translateZ(ut),ce.matrixWorld.compose(ce.position,ce.quaternion,ce.scale),ce.matrixWorldInverse.copy(ce.matrixWorld).invert(),Ct[10]===-1)ce.projectionMatrix.copy(Be.projectionMatrix),ce.projectionMatrixInverse.copy(Be.projectionMatrixInverse);else{const P=ot+ut,E=Ue+ut,ge=Ne-Oe,ve=_e+(Fe-Oe),Se=we*Ue/E*P,Ze=D*Ue/E*P;ce.projectionMatrix.makePerspective(ge,ve,Se,Ze,P,E),ce.projectionMatrixInverse.copy(ce.projectionMatrix).invert()}}function ee(ce,Be){Be===null?ce.matrixWorld.copy(ce.matrix):ce.matrixWorld.multiplyMatrices(Be.matrixWorld,ce.matrix),ce.matrixWorldInverse.copy(ce.matrixWorld).invert()}this.updateCamera=function(ce){if(s===null)return;let Be=ce.near,He=ce.far;b.texture!==null&&(b.depthNear>0&&(Be=b.depthNear),b.depthFar>0&&(He=b.depthFar)),Z.near=S.near=R.near=Be,Z.far=S.far=R.far=He,(x!==Z.near||Y!==Z.far)&&(s.updateRenderState({depthNear:Z.near,depthFar:Z.far}),x=Z.near,Y=Z.far);const Fe=ce.parent,Ct=Z.cameras;ee(Z,Fe);for(let pt=0;pt<Ct.length;pt++)ee(Ct[pt],Fe);Ct.length===2?k(Z,R,S):Z.projectionMatrix.copy(R.projectionMatrix),$(ce,Z,Fe)};function $(ce,Be,He){He===null?ce.matrix.copy(Be.matrixWorld):(ce.matrix.copy(He.matrixWorld),ce.matrix.invert(),ce.matrix.multiply(Be.matrixWorld)),ce.matrix.decompose(ce.position,ce.quaternion,ce.scale),ce.updateMatrixWorld(!0),ce.projectionMatrix.copy(Be.projectionMatrix),ce.projectionMatrixInverse.copy(Be.projectionMatrixInverse),ce.isPerspectiveCamera&&(ce.fov=kI*2*Math.atan(1/ce.projectionMatrix.elements[5]),ce.zoom=1)}this.getCamera=function(){return Z},this.getFoveation=function(){if(!(C===null&&h===null))return l},this.setFoveation=function(ce){l=ce,C!==null&&(C.fixedFoveation=ce),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=ce)},this.hasDepthSensing=function(){return b.texture!==null},this.getDepthSensingMesh=function(){return b.getMesh(Z)};let ae=null;function be(ce,Be){if(c=Be.getViewerPose(g||r),p=Be,c!==null){const He=c.views;h!==null&&(e.setRenderTargetFramebuffer(B,h.framebuffer),e.setRenderTarget(B));let Fe=!1;He.length!==Z.cameras.length&&(Z.cameras.length=0,Fe=!0);for(let pt=0;pt<He.length;pt++){const ot=He[pt];let Ue=null;if(h!==null)Ue=h.getViewport(ot);else{const D=u.getViewSubImage(C,ot);Ue=D.viewport,pt===0&&(e.setRenderTargetTextures(B,D.colorTexture,C.ignoreDepthValues?void 0:D.depthStencilTexture),e.setRenderTarget(B))}let we=F[pt];we===void 0&&(we=new Wn,we.layers.enable(pt),we.viewport=new rn,F[pt]=we),we.matrix.fromArray(ot.transform.matrix),we.matrix.decompose(we.position,we.quaternion,we.scale),we.projectionMatrix.fromArray(ot.projectionMatrix),we.projectionMatrixInverse.copy(we.projectionMatrix).invert(),we.viewport.set(Ue.x,Ue.y,Ue.width,Ue.height),pt===0&&(Z.matrix.copy(we.matrix),Z.matrix.decompose(Z.position,Z.quaternion,Z.scale)),Fe===!0&&Z.cameras.push(we)}const Ct=s.enabledFeatures;if(Ct&&Ct.includes("depth-sensing")){const pt=u.getDepthInformation(He[0]);pt&&pt.isValid&&pt.texture&&b.init(e,pt,s.renderState)}}for(let He=0;He<G.length;He++){const Fe=w[He],Ct=G[He];Fe!==null&&Ct!==void 0&&Ct.update(Fe,Be,g||r)}ae&&ae(ce,Be),Be.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Be}),p=null}const me=new vT;me.setAnimationLoop(be),this.setAnimationLoop=function(ce){ae=ce},this.dispose=function(){}}}const Dg=new Gs,mQ=new ct;function fQ(n,e){function t(m,A){m.matrixAutoUpdate===!0&&m.updateMatrix(),A.value.copy(m.matrix)}function i(m,A){A.color.getRGB(m.fogColor.value,BT(n)),A.isFog?(m.fogNear.value=A.near,m.fogFar.value=A.far):A.isFogExp2&&(m.fogDensity.value=A.density)}function s(m,A,B,G,w){A.isMeshBasicMaterial||A.isMeshLambertMaterial?o(m,A):A.isMeshToonMaterial?(o(m,A),u(m,A)):A.isMeshPhongMaterial?(o(m,A),c(m,A)):A.isMeshStandardMaterial?(o(m,A),C(m,A),A.isMeshPhysicalMaterial&&h(m,A,w)):A.isMeshMatcapMaterial?(o(m,A),p(m,A)):A.isMeshDepthMaterial?o(m,A):A.isMeshDistanceMaterial?(o(m,A),b(m,A)):A.isMeshNormalMaterial?o(m,A):A.isLineBasicMaterial?(r(m,A),A.isLineDashedMaterial&&a(m,A)):A.isPointsMaterial?l(m,A,B,G):A.isSpriteMaterial?g(m,A):A.isShadowMaterial?(m.color.value.copy(A.color),m.opacity.value=A.opacity):A.isShaderMaterial&&(A.uniformsNeedUpdate=!1)}function o(m,A){m.opacity.value=A.opacity,A.color&&m.diffuse.value.copy(A.color),A.emissive&&m.emissive.value.copy(A.emissive).multiplyScalar(A.emissiveIntensity),A.map&&(m.map.value=A.map,t(A.map,m.mapTransform)),A.alphaMap&&(m.alphaMap.value=A.alphaMap,t(A.alphaMap,m.alphaMapTransform)),A.bumpMap&&(m.bumpMap.value=A.bumpMap,t(A.bumpMap,m.bumpMapTransform),m.bumpScale.value=A.bumpScale,A.side===Es&&(m.bumpScale.value*=-1)),A.normalMap&&(m.normalMap.value=A.normalMap,t(A.normalMap,m.normalMapTransform),m.normalScale.value.copy(A.normalScale),A.side===Es&&m.normalScale.value.negate()),A.displacementMap&&(m.displacementMap.value=A.displacementMap,t(A.displacementMap,m.displacementMapTransform),m.displacementScale.value=A.displacementScale,m.displacementBias.value=A.displacementBias),A.emissiveMap&&(m.emissiveMap.value=A.emissiveMap,t(A.emissiveMap,m.emissiveMapTransform)),A.specularMap&&(m.specularMap.value=A.specularMap,t(A.specularMap,m.specularMapTransform)),A.alphaTest>0&&(m.alphaTest.value=A.alphaTest);const B=e.get(A),G=B.envMap,w=B.envMapRotation;G&&(m.envMap.value=G,Dg.copy(w),Dg.x*=-1,Dg.y*=-1,Dg.z*=-1,G.isCubeTexture&&G.isRenderTargetTexture===!1&&(Dg.y*=-1,Dg.z*=-1),m.envMapRotation.value.setFromMatrix4(mQ.makeRotationFromEuler(Dg)),m.flipEnvMap.value=G.isCubeTexture&&G.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=A.reflectivity,m.ior.value=A.ior,m.refractionRatio.value=A.refractionRatio),A.lightMap&&(m.lightMap.value=A.lightMap,m.lightMapIntensity.value=A.lightMapIntensity,t(A.lightMap,m.lightMapTransform)),A.aoMap&&(m.aoMap.value=A.aoMap,m.aoMapIntensity.value=A.aoMapIntensity,t(A.aoMap,m.aoMapTransform))}function r(m,A){m.diffuse.value.copy(A.color),m.opacity.value=A.opacity,A.map&&(m.map.value=A.map,t(A.map,m.mapTransform))}function a(m,A){m.dashSize.value=A.dashSize,m.totalSize.value=A.dashSize+A.gapSize,m.scale.value=A.scale}function l(m,A,B,G){m.diffuse.value.copy(A.color),m.opacity.value=A.opacity,m.size.value=A.size*B,m.scale.value=G*.5,A.map&&(m.map.value=A.map,t(A.map,m.uvTransform)),A.alphaMap&&(m.alphaMap.value=A.alphaMap,t(A.alphaMap,m.alphaMapTransform)),A.alphaTest>0&&(m.alphaTest.value=A.alphaTest)}function g(m,A){m.diffuse.value.copy(A.color),m.opacity.value=A.opacity,m.rotation.value=A.rotation,A.map&&(m.map.value=A.map,t(A.map,m.mapTransform)),A.alphaMap&&(m.alphaMap.value=A.alphaMap,t(A.alphaMap,m.alphaMapTransform)),A.alphaTest>0&&(m.alphaTest.value=A.alphaTest)}function c(m,A){m.specular.value.copy(A.specular),m.shininess.value=Math.max(A.shininess,1e-4)}function u(m,A){A.gradientMap&&(m.gradientMap.value=A.gradientMap)}function C(m,A){m.metalness.value=A.metalness,A.metalnessMap&&(m.metalnessMap.value=A.metalnessMap,t(A.metalnessMap,m.metalnessMapTransform)),m.roughness.value=A.roughness,A.roughnessMap&&(m.roughnessMap.value=A.roughnessMap,t(A.roughnessMap,m.roughnessMapTransform)),A.envMap&&(m.envMapIntensity.value=A.envMapIntensity)}function h(m,A,B){m.ior.value=A.ior,A.sheen>0&&(m.sheenColor.value.copy(A.sheenColor).multiplyScalar(A.sheen),m.sheenRoughness.value=A.sheenRoughness,A.sheenColorMap&&(m.sheenColorMap.value=A.sheenColorMap,t(A.sheenColorMap,m.sheenColorMapTransform)),A.sheenRoughnessMap&&(m.sheenRoughnessMap.value=A.sheenRoughnessMap,t(A.sheenRoughnessMap,m.sheenRoughnessMapTransform))),A.clearcoat>0&&(m.clearcoat.value=A.clearcoat,m.clearcoatRoughness.value=A.clearcoatRoughness,A.clearcoatMap&&(m.clearcoatMap.value=A.clearcoatMap,t(A.clearcoatMap,m.clearcoatMapTransform)),A.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=A.clearcoatRoughnessMap,t(A.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),A.clearcoatNormalMap&&(m.clearcoatNormalMap.value=A.clearcoatNormalMap,t(A.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(A.clearcoatNormalScale),A.side===Es&&m.clearcoatNormalScale.value.negate())),A.dispersion>0&&(m.dispersion.value=A.dispersion),A.iridescence>0&&(m.iridescence.value=A.iridescence,m.iridescenceIOR.value=A.iridescenceIOR,m.iridescenceThicknessMinimum.value=A.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=A.iridescenceThicknessRange[1],A.iridescenceMap&&(m.iridescenceMap.value=A.iridescenceMap,t(A.iridescenceMap,m.iridescenceMapTransform)),A.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=A.iridescenceThicknessMap,t(A.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),A.transmission>0&&(m.transmission.value=A.transmission,m.transmissionSamplerMap.value=B.texture,m.transmissionSamplerSize.value.set(B.width,B.height),A.transmissionMap&&(m.transmissionMap.value=A.transmissionMap,t(A.transmissionMap,m.transmissionMapTransform)),m.thickness.value=A.thickness,A.thicknessMap&&(m.thicknessMap.value=A.thicknessMap,t(A.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=A.attenuationDistance,m.attenuationColor.value.copy(A.attenuationColor)),A.anisotropy>0&&(m.anisotropyVector.value.set(A.anisotropy*Math.cos(A.anisotropyRotation),A.anisotropy*Math.sin(A.anisotropyRotation)),A.anisotropyMap&&(m.anisotropyMap.value=A.anisotropyMap,t(A.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=A.specularIntensity,m.specularColor.value.copy(A.specularColor),A.specularColorMap&&(m.specularColorMap.value=A.specularColorMap,t(A.specularColorMap,m.specularColorMapTransform)),A.specularIntensityMap&&(m.specularIntensityMap.value=A.specularIntensityMap,t(A.specularIntensityMap,m.specularIntensityMapTransform))}function p(m,A){A.matcap&&(m.matcap.value=A.matcap)}function b(m,A){const B=e.get(A).light;m.referencePosition.value.setFromMatrixPosition(B.matrixWorld),m.nearDistance.value=B.shadow.camera.near,m.farDistance.value=B.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:s}}function bQ(n,e,t,i){let s={},o={},r=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(B,G){const w=G.program;i.uniformBlockBinding(B,w)}function g(B,G){let w=s[B.id];w===void 0&&(p(B),w=c(B),s[B.id]=w,B.addEventListener("dispose",m));const N=G.program;i.updateUBOMapping(B,N);const M=e.render.frame;o[B.id]!==M&&(C(B),o[B.id]=M)}function c(B){const G=u();B.__bindingPointIndex=G;const w=n.createBuffer(),N=B.__size,M=B.usage;return n.bindBuffer(n.UNIFORM_BUFFER,w),n.bufferData(n.UNIFORM_BUFFER,N,M),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,G,w),w}function u(){for(let B=0;B<a;B++)if(r.indexOf(B)===-1)return r.push(B),B;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function C(B){const G=s[B.id],w=B.uniforms,N=B.__cache;n.bindBuffer(n.UNIFORM_BUFFER,G);for(let M=0,R=w.length;M<R;M++){const S=Array.isArray(w[M])?w[M]:[w[M]];for(let F=0,Z=S.length;F<Z;F++){const x=S[F];if(h(x,M,F,N)===!0){const Y=x.__offset,T=Array.isArray(x.value)?x.value:[x.value];let ne=0;for(let ue=0;ue<T.length;ue++){const se=T[ue],Ie=b(se);typeof se=="number"||typeof se=="boolean"?(x.__data[0]=se,n.bufferSubData(n.UNIFORM_BUFFER,Y+ne,x.__data)):se.isMatrix3?(x.__data[0]=se.elements[0],x.__data[1]=se.elements[1],x.__data[2]=se.elements[2],x.__data[3]=0,x.__data[4]=se.elements[3],x.__data[5]=se.elements[4],x.__data[6]=se.elements[5],x.__data[7]=0,x.__data[8]=se.elements[6],x.__data[9]=se.elements[7],x.__data[10]=se.elements[8],x.__data[11]=0):(se.toArray(x.__data,ne),ne+=Ie.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,Y,x.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function h(B,G,w,N){const M=B.value,R=G+"_"+w;if(N[R]===void 0)return typeof M=="number"||typeof M=="boolean"?N[R]=M:N[R]=M.clone(),!0;{const S=N[R];if(typeof M=="number"||typeof M=="boolean"){if(S!==M)return N[R]=M,!0}else if(S.equals(M)===!1)return S.copy(M),!0}return!1}function p(B){const G=B.uniforms;let w=0;const N=16;for(let R=0,S=G.length;R<S;R++){const F=Array.isArray(G[R])?G[R]:[G[R]];for(let Z=0,x=F.length;Z<x;Z++){const Y=F[Z],T=Array.isArray(Y.value)?Y.value:[Y.value];for(let ne=0,ue=T.length;ne<ue;ne++){const se=T[ne],Ie=b(se),k=w%N,ee=k%Ie.boundary,$=k+ee;w+=ee,$!==0&&N-$<Ie.storage&&(w+=N-$),Y.__data=new Float32Array(Ie.storage/Float32Array.BYTES_PER_ELEMENT),Y.__offset=w,w+=Ie.storage}}}const M=w%N;return M>0&&(w+=N-M),B.__size=w,B.__cache={},this}function b(B){const G={boundary:0,storage:0};return typeof B=="number"||typeof B=="boolean"?(G.boundary=4,G.storage=4):B.isVector2?(G.boundary=8,G.storage=8):B.isVector3||B.isColor?(G.boundary=16,G.storage=12):B.isVector4?(G.boundary=16,G.storage=16):B.isMatrix3?(G.boundary=48,G.storage=48):B.isMatrix4?(G.boundary=64,G.storage=64):B.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",B),G}function m(B){const G=B.target;G.removeEventListener("dispose",m);const w=r.indexOf(G.__bindingPointIndex);r.splice(w,1),n.deleteBuffer(s[G.id]),delete s[G.id],delete o[G.id]}function A(){for(const B in s)n.deleteBuffer(s[B]);r=[],s={},o={}}return{bind:l,update:g,dispose:A}}class WT{constructor(e={}){const{canvas:t=mT(),context:i=null,depth:s=!0,stencil:o=!1,alpha:r=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:g=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:u=!1}=e;this.isWebGLRenderer=!0;let C;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");C=i.getContextAttributes().alpha}else C=r;const h=new Uint32Array(4),p=new Int32Array(4);let b=null,m=null;const A=[],B=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Di,this.toneMapping=ta,this.toneMappingExposure=1;const G=this;let w=!1,N=0,M=0,R=null,S=-1,F=null;const Z=new rn,x=new rn;let Y=null;const T=new Pe(0);let ne=0,ue=t.width,se=t.height,Ie=1,k=null,ee=null;const $=new rn(0,0,ue,se),ae=new rn(0,0,ue,se);let be=!1;const me=new aA;let ce=!1,Be=!1;const He=new ct,Fe=new ct,Ct=new _,pt=new rn,ot={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ue=!1;function we(){return R===null?Ie:1}let D=i;function Ee(L,ie){return t.getContext(L,ie)}try{const L={alpha:!0,depth:s,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:g,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${sd}`),t.addEventListener("webglcontextlost",Re,!1),t.addEventListener("webglcontextrestored",De,!1),t.addEventListener("webglcontextcreationerror",qe,!1),D===null){const ie="webgl2";if(D=Ee(ie,L),D===null)throw Ee(ie)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(L){throw console.error("THREE.WebGLRenderer: "+L.message),L}let Ye,Ne,_e,ut,Oe,P,E,ge,ve,Se,Ze,Je,We,Qe,Kt,Xe,et,Gt,wt,it,Nt,q,xe,Q;function Me(){Ye=new ZJ(D),Ye.init(),q=new xT(D,Ye),Ne=new bJ(D,Ye,e,q),_e=new rQ(D),Ne.reverseDepthBuffer&&_e.buffers.depth.setReversed(!0),ut=new xJ(D),Oe=new UO,P=new IQ(D,Ye,_e,Oe,Ne,q,ut),E=new BJ(G),ge=new wJ(G),ve=new XD(D),xe=new mJ(D,ve),Se=new SJ(D,ve,ut,xe),Ze=new WJ(D,Se,ve,ut),wt=new VJ(D,Ne,P),Xe=new yJ(Oe),Je=new PO(G,E,ge,Ye,Ne,xe,Xe),We=new fQ(G,Oe),Qe=new OO,Kt=new tQ(Ye),Gt=new pJ(G,E,ge,_e,Ze,C,l),et=new sQ(G,Ze,Ne),Q=new bQ(D,ut,Ne,_e),it=new fJ(D,Ye,ut),Nt=new RJ(D,Ye,ut),ut.programs=Je.programs,G.capabilities=Ne,G.extensions=Ye,G.properties=Oe,G.renderLists=Qe,G.shadowMap=et,G.state=_e,G.info=ut}Me();const Ce=new pQ(G,D);this.xr=Ce,this.getContext=function(){return D},this.getContextAttributes=function(){return D.getContextAttributes()},this.forceContextLoss=function(){const L=Ye.get("WEBGL_lose_context");L&&L.loseContext()},this.forceContextRestore=function(){const L=Ye.get("WEBGL_lose_context");L&&L.restoreContext()},this.getPixelRatio=function(){return Ie},this.setPixelRatio=function(L){L!==void 0&&(Ie=L,this.setSize(ue,se,!1))},this.getSize=function(L){return L.set(ue,se)},this.setSize=function(L,ie,de=!0){if(Ce.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ue=L,se=ie,t.width=Math.floor(L*Ie),t.height=Math.floor(ie*Ie),de===!0&&(t.style.width=L+"px",t.style.height=ie+"px"),this.setViewport(0,0,L,ie)},this.getDrawingBufferSize=function(L){return L.set(ue*Ie,se*Ie).floor()},this.setDrawingBufferSize=function(L,ie,de){ue=L,se=ie,Ie=de,t.width=Math.floor(L*de),t.height=Math.floor(ie*de),this.setViewport(0,0,L,ie)},this.getCurrentViewport=function(L){return L.copy(Z)},this.getViewport=function(L){return L.copy($)},this.setViewport=function(L,ie,de,Ae){L.isVector4?$.set(L.x,L.y,L.z,L.w):$.set(L,ie,de,Ae),_e.viewport(Z.copy($).multiplyScalar(Ie).round())},this.getScissor=function(L){return L.copy(ae)},this.setScissor=function(L,ie,de,Ae){L.isVector4?ae.set(L.x,L.y,L.z,L.w):ae.set(L,ie,de,Ae),_e.scissor(x.copy(ae).multiplyScalar(Ie).round())},this.getScissorTest=function(){return be},this.setScissorTest=function(L){_e.setScissorTest(be=L)},this.setOpaqueSort=function(L){k=L},this.setTransparentSort=function(L){ee=L},this.getClearColor=function(L){return L.copy(Gt.getClearColor())},this.setClearColor=function(){Gt.setClearColor.apply(Gt,arguments)},this.getClearAlpha=function(){return Gt.getClearAlpha()},this.setClearAlpha=function(){Gt.setClearAlpha.apply(Gt,arguments)},this.clear=function(L=!0,ie=!0,de=!0){let Ae=0;if(L){let re=!1;if(R!==null){const ke=R.texture.format;re=ke===bb||ke===fb||ke===iA}if(re){const ke=R.texture.type,tt=ke===Vr||ke===Qa||ke===kc||ke===zc||ke===Ab||ke===pb,st=Gt.getClearColor(),rt=Gt.getClearAlpha(),vt=st.r,Bt=st.g,lt=st.b;tt?(h[0]=vt,h[1]=Bt,h[2]=lt,h[3]=rt,D.clearBufferuiv(D.COLOR,0,h)):(p[0]=vt,p[1]=Bt,p[2]=lt,p[3]=rt,D.clearBufferiv(D.COLOR,0,p))}else Ae|=D.COLOR_BUFFER_BIT}ie&&(Ae|=D.DEPTH_BUFFER_BIT,D.clearDepth(this.capabilities.reverseDepthBuffer?0:1)),de&&(Ae|=D.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),D.clear(Ae)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Re,!1),t.removeEventListener("webglcontextrestored",De,!1),t.removeEventListener("webglcontextcreationerror",qe,!1),Qe.dispose(),Kt.dispose(),Oe.dispose(),E.dispose(),ge.dispose(),Ze.dispose(),xe.dispose(),Q.dispose(),Je.dispose(),Ce.dispose(),Ce.removeEventListener("sessionstart",Fn),Ce.removeEventListener("sessionend",fg),vs.stop()};function Re(L){L.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function De(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1;const L=ut.autoReset,ie=et.enabled,de=et.autoUpdate,Ae=et.needsUpdate,re=et.type;Me(),ut.autoReset=L,et.enabled=ie,et.autoUpdate=de,et.needsUpdate=Ae,et.type=re}function qe(L){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",L.statusMessage)}function Wt(L){const ie=L.target;ie.removeEventListener("dispose",Wt),$t(ie)}function $t(L){An(L),Oe.remove(L)}function An(L){const ie=Oe.get(L).programs;ie!==void 0&&(ie.forEach(function(de){Je.releaseProgram(de)}),L.isShaderMaterial&&Je.releaseShaderCache(L))}this.renderBufferDirect=function(L,ie,de,Ae,re,ke){ie===null&&(ie=ot);const tt=re.isMesh&&re.matrixWorld.determinant()<0,st=yg(L,ie,de,Ae,re);_e.setMaterial(Ae,tt);let rt=de.index,vt=1;if(Ae.wireframe===!0){if(rt=Se.getWireframeAttribute(de),rt===void 0)return;vt=2}const Bt=de.drawRange,lt=de.attributes.position;let Ot=Bt.start*vt,an=(Bt.start+Bt.count)*vt;ke!==null&&(Ot=Math.max(Ot,ke.start*vt),an=Math.min(an,(ke.start+ke.count)*vt)),rt!==null?(Ot=Math.max(Ot,0),an=Math.min(an,rt.count)):lt!=null&&(Ot=Math.max(Ot,0),an=Math.min(an,lt.count));const ln=an-Ot;if(ln<0||ln===1/0)return;xe.setup(re,Ae,st,de,rt);let Tt,At=it;if(rt!==null&&(Tt=ve.get(rt),At=Nt,At.setIndex(Tt)),re.isMesh)Ae.wireframe===!0?(_e.setLineWidth(Ae.wireframeLinewidth*we()),At.setMode(D.LINES)):At.setMode(D.TRIANGLES);else if(re.isLine){let at=Ae.linewidth;at===void 0&&(at=1),_e.setLineWidth(at*we()),re.isLineSegments?At.setMode(D.LINES):re.isLineLoop?At.setMode(D.LINE_LOOP):At.setMode(D.LINE_STRIP)}else re.isPoints?At.setMode(D.POINTS):re.isSprite&&At.setMode(D.TRIANGLES);if(re.isBatchedMesh)if(re._multiDrawInstances!==null)At.renderMultiDrawInstances(re._multiDrawStarts,re._multiDrawCounts,re._multiDrawCount,re._multiDrawInstances);else if(Ye.get("WEBGL_multi_draw"))At.renderMultiDraw(re._multiDrawStarts,re._multiDrawCounts,re._multiDrawCount);else{const at=re._multiDrawStarts,Ut=re._multiDrawCounts,xt=re._multiDrawCount,On=rt?ve.get(rt).bytesPerElement:1,ws=Oe.get(Ae).currentProgram.getUniforms();for(let pn=0;pn<xt;pn++)ws.setValue(D,"_gl_DrawID",pn),At.render(at[pn]/On,Ut[pn])}else if(re.isInstancedMesh)At.renderInstances(Ot,ln,re.count);else if(de.isInstancedBufferGeometry){const at=de._maxInstanceCount!==void 0?de._maxInstanceCount:1/0,Ut=Math.min(de.instanceCount,at);At.renderInstances(Ot,ln,Ut)}else At.render(Ot,ln)};function Ft(L,ie,de){L.transparent===!0&&L.side===bo&&L.forceSinglePass===!1?(L.side=Es,L.needsUpdate=!0,ol(L,ie,de),L.side=Rr,L.needsUpdate=!0,ol(L,ie,de),L.side=bo):ol(L,ie,de)}this.compile=function(L,ie,de=null){de===null&&(de=L),m=Kt.get(de),m.init(ie),B.push(m),de.traverseVisible(function(re){re.isLight&&re.layers.test(ie.layers)&&(m.pushLight(re),re.castShadow&&m.pushShadow(re))}),L!==de&&L.traverseVisible(function(re){re.isLight&&re.layers.test(ie.layers)&&(m.pushLight(re),re.castShadow&&m.pushShadow(re))}),m.setupLights();const Ae=new Set;return L.traverse(function(re){if(!(re.isMesh||re.isPoints||re.isLine||re.isSprite))return;const ke=re.material;if(ke)if(Array.isArray(ke))for(let tt=0;tt<ke.length;tt++){const st=ke[tt];Ft(st,de,re),Ae.add(st)}else Ft(ke,de,re),Ae.add(ke)}),B.pop(),m=null,Ae},this.compileAsync=function(L,ie,de=null){const Ae=this.compile(L,ie,de);return new Promise(re=>{function ke(){if(Ae.forEach(function(tt){Oe.get(tt).currentProgram.isReady()&&Ae.delete(tt)}),Ae.size===0){re(L);return}setTimeout(ke,10)}Ye.get("KHR_parallel_shader_compile")!==null?ke():setTimeout(ke,10)})};let bn=null;function ri(L){bn&&bn(L)}function Fn(){vs.stop()}function fg(){vs.start()}const vs=new vT;vs.setAnimationLoop(ri),typeof self<"u"&&vs.setContext(self),this.setAnimationLoop=function(L){bn=L,Ce.setAnimationLoop(L),L===null?vs.stop():vs.start()},Ce.addEventListener("sessionstart",Fn),Ce.addEventListener("sessionend",fg),this.render=function(L,ie){if(ie!==void 0&&ie.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(w===!0)return;if(L.matrixWorldAutoUpdate===!0&&L.updateMatrixWorld(),ie.parent===null&&ie.matrixWorldAutoUpdate===!0&&ie.updateMatrixWorld(),Ce.enabled===!0&&Ce.isPresenting===!0&&(Ce.cameraAutoUpdate===!0&&Ce.updateCamera(ie),ie=Ce.getCamera()),L.isScene===!0&&L.onBeforeRender(G,L,ie,R),m=Kt.get(L,B.length),m.init(ie),B.push(m),Fe.multiplyMatrices(ie.projectionMatrix,ie.matrixWorldInverse),me.setFromProjectionMatrix(Fe),Be=this.localClippingEnabled,ce=Xe.init(this.clippingPlanes,Be),b=Qe.get(L,A.length),b.init(),A.push(b),Ce.enabled===!0&&Ce.isPresenting===!0){const ke=G.xr.getDepthSensingMesh();ke!==null&&Wo(ke,ie,-1/0,G.sortObjects)}Wo(L,ie,0,G.sortObjects),b.finish(),G.sortObjects===!0&&b.sort(k,ee),Ue=Ce.enabled===!1||Ce.isPresenting===!1||Ce.hasDepthSensing()===!1,Ue&&Gt.addToRenderList(b,L),this.info.render.frame++,ce===!0&&Xe.beginShadows();const de=m.state.shadowsArray;et.render(de,L,ie),ce===!0&&Xe.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ae=b.opaque,re=b.transmissive;if(m.setupLights(),ie.isArrayCamera){const ke=ie.cameras;if(re.length>0)for(let tt=0,st=ke.length;tt<st;tt++){const rt=ke[tt];uu(Ae,re,L,rt)}Ue&&Gt.render(L);for(let tt=0,st=ke.length;tt<st;tt++){const rt=ke[tt];sl(b,L,rt,rt.viewport)}}else re.length>0&&uu(Ae,re,L,ie),Ue&&Gt.render(L),sl(b,L,ie);R!==null&&(P.updateMultisampleRenderTarget(R),P.updateRenderTargetMipmap(R)),L.isScene===!0&&L.onAfterRender(G,L,ie),xe.resetDefaultState(),S=-1,F=null,B.pop(),B.length>0?(m=B[B.length-1],ce===!0&&Xe.setGlobalState(G.clippingPlanes,m.state.camera)):m=null,A.pop(),A.length>0?b=A[A.length-1]:b=null};function Wo(L,ie,de,Ae){if(L.visible===!1)return;if(L.layers.test(ie.layers)){if(L.isGroup)de=L.renderOrder;else if(L.isLOD)L.autoUpdate===!0&&L.update(ie);else if(L.isLight)m.pushLight(L),L.castShadow&&m.pushShadow(L);else if(L.isSprite){if(!L.frustumCulled||me.intersectsSprite(L)){Ae&&pt.setFromMatrixPosition(L.matrixWorld).applyMatrix4(Fe);const tt=Ze.update(L),st=L.material;st.visible&&b.push(L,tt,st,de,pt.z,null)}}else if((L.isMesh||L.isLine||L.isPoints)&&(!L.frustumCulled||me.intersectsObject(L))){const tt=Ze.update(L),st=L.material;if(Ae&&(L.boundingSphere!==void 0?(L.boundingSphere===null&&L.computeBoundingSphere(),pt.copy(L.boundingSphere.center)):(tt.boundingSphere===null&&tt.computeBoundingSphere(),pt.copy(tt.boundingSphere.center)),pt.applyMatrix4(L.matrixWorld).applyMatrix4(Fe)),Array.isArray(st)){const rt=tt.groups;for(let vt=0,Bt=rt.length;vt<Bt;vt++){const lt=rt[vt],Ot=st[lt.materialIndex];Ot&&Ot.visible&&b.push(L,tt,Ot,de,pt.z,lt)}}else st.visible&&b.push(L,tt,st,de,pt.z,null)}}const ke=L.children;for(let tt=0,st=ke.length;tt<st;tt++)Wo(ke[tt],ie,de,Ae)}function sl(L,ie,de,Ae){const re=L.opaque,ke=L.transmissive,tt=L.transparent;m.setupLightsView(de),ce===!0&&Xe.setGlobalState(G.clippingPlanes,de),Ae&&_e.viewport(Z.copy(Ae)),re.length>0&&Yi(re,ie,de),ke.length>0&&Yi(ke,ie,de),tt.length>0&&Yi(tt,ie,de),_e.buffers.depth.setTest(!0),_e.buffers.depth.setMask(!0),_e.buffers.color.setMask(!0),_e.setPolygonOffset(!1)}function uu(L,ie,de,Ae){if((de.isScene===!0?de.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[Ae.id]===void 0&&(m.state.transmissionRenderTarget[Ae.id]=new Ys(1,1,{generateMipmaps:!0,type:Ye.has("EXT_color_buffer_half_float")||Ye.has("EXT_color_buffer_float")?il:Vr,minFilter:no,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:cn.workingColorSpace}));const ke=m.state.transmissionRenderTarget[Ae.id],tt=Ae.viewport||Z;ke.setSize(tt.z,tt.w);const st=G.getRenderTarget();G.setRenderTarget(ke),G.getClearColor(T),ne=G.getClearAlpha(),ne<1&&G.setClearColor(16777215,.5),G.clear(),Ue&&Gt.render(de);const rt=G.toneMapping;G.toneMapping=ta;const vt=Ae.viewport;if(Ae.viewport!==void 0&&(Ae.viewport=void 0),m.setupLightsView(Ae),ce===!0&&Xe.setGlobalState(G.clippingPlanes,Ae),Yi(L,de,Ae),P.updateMultisampleRenderTarget(ke),P.updateRenderTargetMipmap(ke),Ye.has("WEBGL_multisampled_render_to_texture")===!1){let Bt=!1;for(let lt=0,Ot=ie.length;lt<Ot;lt++){const an=ie[lt],ln=an.object,Tt=an.geometry,At=an.material,at=an.group;if(At.side===bo&&ln.layers.test(Ae.layers)){const Ut=At.side;At.side=Es,At.needsUpdate=!0,Iu(ln,de,Ae,Tt,At,at),At.side=Ut,At.needsUpdate=!0,Bt=!0}}Bt===!0&&(P.updateMultisampleRenderTarget(ke),P.updateRenderTargetMipmap(ke))}G.setRenderTarget(st),G.setClearColor(T,ne),vt!==void 0&&(Ae.viewport=vt),G.toneMapping=rt}function Yi(L,ie,de){const Ae=ie.isScene===!0?ie.overrideMaterial:null;for(let re=0,ke=L.length;re<ke;re++){const tt=L[re],st=tt.object,rt=tt.geometry,vt=Ae===null?tt.material:Ae,Bt=tt.group;st.layers.test(de.layers)&&Iu(st,ie,de,rt,vt,Bt)}}function Iu(L,ie,de,Ae,re,ke){L.onBeforeRender(G,ie,de,Ae,re,ke),L.modelViewMatrix.multiplyMatrices(de.matrixWorldInverse,L.matrixWorld),L.normalMatrix.getNormalMatrix(L.modelViewMatrix),re.onBeforeRender(G,ie,de,Ae,L,ke),re.transparent===!0&&re.side===bo&&re.forceSinglePass===!1?(re.side=Es,re.needsUpdate=!0,G.renderBufferDirect(de,ie,Ae,re,L,ke),re.side=Rr,re.needsUpdate=!0,G.renderBufferDirect(de,ie,Ae,re,L,ke),re.side=bo):G.renderBufferDirect(de,ie,Ae,re,L,ke),L.onAfterRender(G,ie,de,Ae,re,ke)}function ol(L,ie,de){ie.isScene!==!0&&(ie=ot);const Ae=Oe.get(L),re=m.state.lights,ke=m.state.shadowsArray,tt=re.state.version,st=Je.getParameters(L,re.state,ke,ie,de),rt=Je.getProgramCacheKey(st);let vt=Ae.programs;Ae.environment=L.isMeshStandardMaterial?ie.environment:null,Ae.fog=ie.fog,Ae.envMap=(L.isMeshStandardMaterial?ge:E).get(L.envMap||Ae.environment),Ae.envMapRotation=Ae.environment!==null&&L.envMap===null?ie.environmentRotation:L.envMapRotation,vt===void 0&&(L.addEventListener("dispose",Wt),vt=new Map,Ae.programs=vt);let Bt=vt.get(rt);if(Bt!==void 0){if(Ae.currentProgram===Bt&&Ae.lightsStateVersion===tt)return bg(L,st),Bt}else st.uniforms=Je.getUniforms(L),L.onBeforeCompile(st,G),Bt=Je.acquireProgram(st,rt),vt.set(rt,Bt),Ae.uniforms=st.uniforms;const lt=Ae.uniforms;return(!L.isShaderMaterial&&!L.isRawShaderMaterial||L.clipping===!0)&&(lt.clippingPlanes=Xe.uniform),bg(L,st),Ae.needsLights=Mo(L),Ae.lightsStateVersion=tt,Ae.needsLights&&(lt.ambientLightColor.value=re.state.ambient,lt.lightProbe.value=re.state.probe,lt.directionalLights.value=re.state.directional,lt.directionalLightShadows.value=re.state.directionalShadow,lt.spotLights.value=re.state.spot,lt.spotLightShadows.value=re.state.spotShadow,lt.rectAreaLights.value=re.state.rectArea,lt.ltc_1.value=re.state.rectAreaLTC1,lt.ltc_2.value=re.state.rectAreaLTC2,lt.pointLights.value=re.state.point,lt.pointLightShadows.value=re.state.pointShadow,lt.hemisphereLights.value=re.state.hemi,lt.directionalShadowMap.value=re.state.directionalShadowMap,lt.directionalShadowMatrix.value=re.state.directionalShadowMatrix,lt.spotShadowMap.value=re.state.spotShadowMap,lt.spotLightMatrix.value=re.state.spotLightMatrix,lt.spotLightMap.value=re.state.spotLightMap,lt.pointShadowMap.value=re.state.pointShadowMap,lt.pointShadowMatrix.value=re.state.pointShadowMatrix),Ae.currentProgram=Bt,Ae.uniformsList=null,Bt}function ca(L){if(L.uniformsList===null){const ie=L.currentProgram.getUniforms();L.uniformsList=$m.seqWithValue(ie.seq,L.uniforms)}return L.uniformsList}function bg(L,ie){const de=Oe.get(L);de.outputColorSpace=ie.outputColorSpace,de.batching=ie.batching,de.batchingColor=ie.batchingColor,de.instancing=ie.instancing,de.instancingColor=ie.instancingColor,de.instancingMorph=ie.instancingMorph,de.skinning=ie.skinning,de.morphTargets=ie.morphTargets,de.morphNormals=ie.morphNormals,de.morphColors=ie.morphColors,de.morphTargetsCount=ie.morphTargetsCount,de.numClippingPlanes=ie.numClippingPlanes,de.numIntersection=ie.numClipIntersection,de.vertexAlphas=ie.vertexAlphas,de.vertexTangents=ie.vertexTangents,de.toneMapping=ie.toneMapping}function yg(L,ie,de,Ae,re){ie.isScene!==!0&&(ie=ot),P.resetTextureUnits();const ke=ie.fog,tt=Ae.isMeshStandardMaterial?ie.environment:null,st=R===null?G.outputColorSpace:R.isXRRenderTarget===!0?R.texture.colorSpace:Ei,rt=(Ae.isMeshStandardMaterial?ge:E).get(Ae.envMap||tt),vt=Ae.vertexColors===!0&&!!de.attributes.color&&de.attributes.color.itemSize===4,Bt=!!de.attributes.tangent&&(!!Ae.normalMap||Ae.anisotropy>0),lt=!!de.morphAttributes.position,Ot=!!de.morphAttributes.normal,an=!!de.morphAttributes.color;let ln=ta;Ae.toneMapped&&(R===null||R.isXRRenderTarget===!0)&&(ln=G.toneMapping);const Tt=de.morphAttributes.position||de.morphAttributes.normal||de.morphAttributes.color,At=Tt!==void 0?Tt.length:0,at=Oe.get(Ae),Ut=m.state.lights;if(ce===!0&&(Be===!0||L!==F)){const Hn=L===F&&Ae.id===S;Xe.setState(Ae,L,Hn)}let xt=!1;Ae.version===at.__version?(at.needsLights&&at.lightsStateVersion!==Ut.state.version||at.outputColorSpace!==st||re.isBatchedMesh&&at.batching===!1||!re.isBatchedMesh&&at.batching===!0||re.isBatchedMesh&&at.batchingColor===!0&&re.colorTexture===null||re.isBatchedMesh&&at.batchingColor===!1&&re.colorTexture!==null||re.isInstancedMesh&&at.instancing===!1||!re.isInstancedMesh&&at.instancing===!0||re.isSkinnedMesh&&at.skinning===!1||!re.isSkinnedMesh&&at.skinning===!0||re.isInstancedMesh&&at.instancingColor===!0&&re.instanceColor===null||re.isInstancedMesh&&at.instancingColor===!1&&re.instanceColor!==null||re.isInstancedMesh&&at.instancingMorph===!0&&re.morphTexture===null||re.isInstancedMesh&&at.instancingMorph===!1&&re.morphTexture!==null||at.envMap!==rt||Ae.fog===!0&&at.fog!==ke||at.numClippingPlanes!==void 0&&(at.numClippingPlanes!==Xe.numPlanes||at.numIntersection!==Xe.numIntersection)||at.vertexAlphas!==vt||at.vertexTangents!==Bt||at.morphTargets!==lt||at.morphNormals!==Ot||at.morphColors!==an||at.toneMapping!==ln||at.morphTargetsCount!==At)&&(xt=!0):(xt=!0,at.__version=Ae.version);let On=at.currentProgram;xt===!0&&(On=ol(Ae,ie,re));let ws=!1,pn=!1,rr=!1;const wn=On.getUniforms(),ao=at.uniforms;if(_e.useProgram(On.program)&&(ws=!0,pn=!0,rr=!0),Ae.id!==S&&(S=Ae.id,pn=!0),ws||F!==L){Ne.reverseDepthBuffer?(He.copy(L.projectionMatrix),rD(He),aD(He),wn.setValue(D,"projectionMatrix",He)):wn.setValue(D,"projectionMatrix",L.projectionMatrix),wn.setValue(D,"viewMatrix",L.matrixWorldInverse);const Hn=wn.map.cameraPosition;Hn!==void 0&&Hn.setValue(D,Ct.setFromMatrixPosition(L.matrixWorld)),Ne.logarithmicDepthBuffer&&wn.setValue(D,"logDepthBufFC",2/(Math.log(L.far+1)/Math.LN2)),(Ae.isMeshPhongMaterial||Ae.isMeshToonMaterial||Ae.isMeshLambertMaterial||Ae.isMeshBasicMaterial||Ae.isMeshStandardMaterial||Ae.isShaderMaterial)&&wn.setValue(D,"isOrthographic",L.isOrthographicCamera===!0),F!==L&&(F=L,pn=!0,rr=!0)}if(re.isSkinnedMesh){wn.setOptional(D,re,"bindMatrix"),wn.setOptional(D,re,"bindMatrixInverse");const Hn=re.skeleton;Hn&&(Hn.boneTexture===null&&Hn.computeBoneTexture(),wn.setValue(D,"boneTexture",Hn.boneTexture,P))}re.isBatchedMesh&&(wn.setOptional(D,re,"batchingTexture"),wn.setValue(D,"batchingTexture",re._matricesTexture,P),wn.setOptional(D,re,"batchingIdTexture"),wn.setValue(D,"batchingIdTexture",re._indirectTexture,P),wn.setOptional(D,re,"batchingColorTexture"),re._colorsTexture!==null&&wn.setValue(D,"batchingColorTexture",re._colorsTexture,P));const $i=de.morphAttributes;if(($i.position!==void 0||$i.normal!==void 0||$i.color!==void 0)&&wt.update(re,de,On),(pn||at.receiveShadow!==re.receiveShadow)&&(at.receiveShadow=re.receiveShadow,wn.setValue(D,"receiveShadow",re.receiveShadow)),Ae.isMeshGouraudMaterial&&Ae.envMap!==null&&(ao.envMap.value=rt,ao.flipEnvMap.value=rt.isCubeTexture&&rt.isRenderTargetTexture===!1?-1:1),Ae.isMeshStandardMaterial&&Ae.envMap===null&&ie.environment!==null&&(ao.envMapIntensity.value=ie.environmentIntensity),pn&&(wn.setValue(D,"toneMappingExposure",G.toneMappingExposure),at.needsLights&&rl(ao,rr),ke&&Ae.fog===!0&&We.refreshFogUniforms(ao,ke),We.refreshMaterialUniforms(ao,Ae,Ie,se,m.state.transmissionRenderTarget[L.id]),$m.upload(D,ca(at),ao,P)),Ae.isShaderMaterial&&Ae.uniformsNeedUpdate===!0&&($m.upload(D,ca(at),ao,P),Ae.uniformsNeedUpdate=!1),Ae.isSpriteMaterial&&wn.setValue(D,"center",re.center),wn.setValue(D,"modelViewMatrix",re.modelViewMatrix),wn.setValue(D,"normalMatrix",re.normalMatrix),wn.setValue(D,"modelMatrix",re.matrixWorld),Ae.isShaderMaterial||Ae.isRawShaderMaterial){const Hn=Ae.uniformsGroups;for(let Ii=0,al=Hn.length;Ii<al;Ii++){const Bg=Hn[Ii];Q.update(Bg,On),Q.bind(Bg,On)}}return On}function rl(L,ie){L.ambientLightColor.needsUpdate=ie,L.lightProbe.needsUpdate=ie,L.directionalLights.needsUpdate=ie,L.directionalLightShadows.needsUpdate=ie,L.pointLights.needsUpdate=ie,L.pointLightShadows.needsUpdate=ie,L.spotLights.needsUpdate=ie,L.spotLightShadows.needsUpdate=ie,L.rectAreaLights.needsUpdate=ie,L.hemisphereLights.needsUpdate=ie}function Mo(L){return L.isMeshLambertMaterial||L.isMeshToonMaterial||L.isMeshPhongMaterial||L.isMeshStandardMaterial||L.isShadowMaterial||L.isShaderMaterial&&L.lights===!0}this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return M},this.getRenderTarget=function(){return R},this.setRenderTargetTextures=function(L,ie,de){Oe.get(L.texture).__webglTexture=ie,Oe.get(L.depthTexture).__webglTexture=de;const Ae=Oe.get(L);Ae.__hasExternalTextures=!0,Ae.__autoAllocateDepthBuffer=de===void 0,Ae.__autoAllocateDepthBuffer||Ye.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Ae.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(L,ie){const de=Oe.get(L);de.__webglFramebuffer=ie,de.__useDefaultFramebuffer=ie===void 0},this.setRenderTarget=function(L,ie=0,de=0){R=L,N=ie,M=de;let Ae=!0,re=null,ke=!1,tt=!1;if(L){const rt=Oe.get(L);if(rt.__useDefaultFramebuffer!==void 0)_e.bindFramebuffer(D.FRAMEBUFFER,null),Ae=!1;else if(rt.__webglFramebuffer===void 0)P.setupRenderTarget(L);else if(rt.__hasExternalTextures)P.rebindTextures(L,Oe.get(L.texture).__webglTexture,Oe.get(L.depthTexture).__webglTexture);else if(L.depthBuffer){const lt=L.depthTexture;if(rt.__boundDepthTexture!==lt){if(lt!==null&&Oe.has(lt)&&(L.width!==lt.image.width||L.height!==lt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");P.setupDepthRenderbuffer(L)}}const vt=L.texture;(vt.isData3DTexture||vt.isDataArrayTexture||vt.isCompressedArrayTexture)&&(tt=!0);const Bt=Oe.get(L).__webglFramebuffer;L.isWebGLCubeRenderTarget?(Array.isArray(Bt[ie])?re=Bt[ie][de]:re=Bt[ie],ke=!0):L.samples>0&&P.useMultisampledRTT(L)===!1?re=Oe.get(L).__webglMultisampledFramebuffer:Array.isArray(Bt)?re=Bt[de]:re=Bt,Z.copy(L.viewport),x.copy(L.scissor),Y=L.scissorTest}else Z.copy($).multiplyScalar(Ie).floor(),x.copy(ae).multiplyScalar(Ie).floor(),Y=be;if(_e.bindFramebuffer(D.FRAMEBUFFER,re)&&Ae&&_e.drawBuffers(L,re),_e.viewport(Z),_e.scissor(x),_e.setScissorTest(Y),ke){const rt=Oe.get(L.texture);D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+ie,rt.__webglTexture,de)}else if(tt){const rt=Oe.get(L.texture),vt=ie||0;D.framebufferTextureLayer(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,rt.__webglTexture,de||0,vt)}S=-1},this.readRenderTargetPixels=function(L,ie,de,Ae,re,ke,tt){if(!(L&&L.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let st=Oe.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&tt!==void 0&&(st=st[tt]),st){_e.bindFramebuffer(D.FRAMEBUFFER,st);try{const rt=L.texture,vt=rt.format,Bt=rt.type;if(!Ne.textureFormatReadable(vt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ne.textureTypeReadable(Bt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ie>=0&&ie<=L.width-Ae&&de>=0&&de<=L.height-re&&D.readPixels(ie,de,Ae,re,q.convert(vt),q.convert(Bt),ke)}finally{const rt=R!==null?Oe.get(R).__webglFramebuffer:null;_e.bindFramebuffer(D.FRAMEBUFFER,rt)}}},this.readRenderTargetPixelsAsync=async function(L,ie,de,Ae,re,ke,tt){if(!(L&&L.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let st=Oe.get(L).__webglFramebuffer;if(L.isWebGLCubeRenderTarget&&tt!==void 0&&(st=st[tt]),st){const rt=L.texture,vt=rt.format,Bt=rt.type;if(!Ne.textureFormatReadable(vt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ne.textureTypeReadable(Bt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(ie>=0&&ie<=L.width-Ae&&de>=0&&de<=L.height-re){_e.bindFramebuffer(D.FRAMEBUFFER,st);const lt=D.createBuffer();D.bindBuffer(D.PIXEL_PACK_BUFFER,lt),D.bufferData(D.PIXEL_PACK_BUFFER,ke.byteLength,D.STREAM_READ),D.readPixels(ie,de,Ae,re,q.convert(vt),q.convert(Bt),0);const Ot=R!==null?Oe.get(R).__webglFramebuffer:null;_e.bindFramebuffer(D.FRAMEBUFFER,Ot);const an=D.fenceSync(D.SYNC_GPU_COMMANDS_COMPLETE,0);return D.flush(),await oD(D,an,4),D.bindBuffer(D.PIXEL_PACK_BUFFER,lt),D.getBufferSubData(D.PIXEL_PACK_BUFFER,0,ke),D.deleteBuffer(lt),D.deleteSync(an),ke}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(L,ie=null,de=0){L.isTexture!==!0&&(qm("WebGLRenderer: copyFramebufferToTexture function signature has changed."),ie=arguments[0]||null,L=arguments[1]);const Ae=Math.pow(2,-de),re=Math.floor(L.image.width*Ae),ke=Math.floor(L.image.height*Ae),tt=ie!==null?ie.x:0,st=ie!==null?ie.y:0;P.setTexture2D(L,0),D.copyTexSubImage2D(D.TEXTURE_2D,de,0,0,tt,st,re,ke),_e.unbindTexture()},this.copyTextureToTexture=function(L,ie,de=null,Ae=null,re=0){L.isTexture!==!0&&(qm("WebGLRenderer: copyTextureToTexture function signature has changed."),Ae=arguments[0]||null,L=arguments[1],ie=arguments[2],re=arguments[3]||0,de=null);let ke,tt,st,rt,vt,Bt;de!==null?(ke=de.max.x-de.min.x,tt=de.max.y-de.min.y,st=de.min.x,rt=de.min.y):(ke=L.image.width,tt=L.image.height,st=0,rt=0),Ae!==null?(vt=Ae.x,Bt=Ae.y):(vt=0,Bt=0);const lt=q.convert(ie.format),Ot=q.convert(ie.type);P.setTexture2D(ie,0),D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,ie.flipY),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ie.premultiplyAlpha),D.pixelStorei(D.UNPACK_ALIGNMENT,ie.unpackAlignment);const an=D.getParameter(D.UNPACK_ROW_LENGTH),ln=D.getParameter(D.UNPACK_IMAGE_HEIGHT),Tt=D.getParameter(D.UNPACK_SKIP_PIXELS),At=D.getParameter(D.UNPACK_SKIP_ROWS),at=D.getParameter(D.UNPACK_SKIP_IMAGES),Ut=L.isCompressedTexture?L.mipmaps[re]:L.image;D.pixelStorei(D.UNPACK_ROW_LENGTH,Ut.width),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,Ut.height),D.pixelStorei(D.UNPACK_SKIP_PIXELS,st),D.pixelStorei(D.UNPACK_SKIP_ROWS,rt),L.isDataTexture?D.texSubImage2D(D.TEXTURE_2D,re,vt,Bt,ke,tt,lt,Ot,Ut.data):L.isCompressedTexture?D.compressedTexSubImage2D(D.TEXTURE_2D,re,vt,Bt,Ut.width,Ut.height,lt,Ut.data):D.texSubImage2D(D.TEXTURE_2D,re,vt,Bt,ke,tt,lt,Ot,Ut),D.pixelStorei(D.UNPACK_ROW_LENGTH,an),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,ln),D.pixelStorei(D.UNPACK_SKIP_PIXELS,Tt),D.pixelStorei(D.UNPACK_SKIP_ROWS,At),D.pixelStorei(D.UNPACK_SKIP_IMAGES,at),re===0&&ie.generateMipmaps&&D.generateMipmap(D.TEXTURE_2D),_e.unbindTexture()},this.copyTextureToTexture3D=function(L,ie,de=null,Ae=null,re=0){L.isTexture!==!0&&(qm("WebGLRenderer: copyTextureToTexture3D function signature has changed."),de=arguments[0]||null,Ae=arguments[1]||null,L=arguments[2],ie=arguments[3],re=arguments[4]||0);let ke,tt,st,rt,vt,Bt,lt,Ot,an;const ln=L.isCompressedTexture?L.mipmaps[re]:L.image;de!==null?(ke=de.max.x-de.min.x,tt=de.max.y-de.min.y,st=de.max.z-de.min.z,rt=de.min.x,vt=de.min.y,Bt=de.min.z):(ke=ln.width,tt=ln.height,st=ln.depth,rt=0,vt=0,Bt=0),Ae!==null?(lt=Ae.x,Ot=Ae.y,an=Ae.z):(lt=0,Ot=0,an=0);const Tt=q.convert(ie.format),At=q.convert(ie.type);let at;if(ie.isData3DTexture)P.setTexture3D(ie,0),at=D.TEXTURE_3D;else if(ie.isDataArrayTexture||ie.isCompressedArrayTexture)P.setTexture2DArray(ie,0),at=D.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}D.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,ie.flipY),D.pixelStorei(D.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ie.premultiplyAlpha),D.pixelStorei(D.UNPACK_ALIGNMENT,ie.unpackAlignment);const Ut=D.getParameter(D.UNPACK_ROW_LENGTH),xt=D.getParameter(D.UNPACK_IMAGE_HEIGHT),On=D.getParameter(D.UNPACK_SKIP_PIXELS),ws=D.getParameter(D.UNPACK_SKIP_ROWS),pn=D.getParameter(D.UNPACK_SKIP_IMAGES);D.pixelStorei(D.UNPACK_ROW_LENGTH,ln.width),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,ln.height),D.pixelStorei(D.UNPACK_SKIP_PIXELS,rt),D.pixelStorei(D.UNPACK_SKIP_ROWS,vt),D.pixelStorei(D.UNPACK_SKIP_IMAGES,Bt),L.isDataTexture||L.isData3DTexture?D.texSubImage3D(at,re,lt,Ot,an,ke,tt,st,Tt,At,ln.data):ie.isCompressedArrayTexture?D.compressedTexSubImage3D(at,re,lt,Ot,an,ke,tt,st,Tt,ln.data):D.texSubImage3D(at,re,lt,Ot,an,ke,tt,st,Tt,At,ln),D.pixelStorei(D.UNPACK_ROW_LENGTH,Ut),D.pixelStorei(D.UNPACK_IMAGE_HEIGHT,xt),D.pixelStorei(D.UNPACK_SKIP_PIXELS,On),D.pixelStorei(D.UNPACK_SKIP_ROWS,ws),D.pixelStorei(D.UNPACK_SKIP_IMAGES,pn),re===0&&ie.generateMipmaps&&D.generateMipmap(at),_e.unbindTexture()},this.initRenderTarget=function(L){Oe.get(L).__webglFramebuffer===void 0&&P.setupRenderTarget(L)},this.initTexture=function(L){L.isCubeTexture?P.setTextureCube(L,0):L.isData3DTexture?P.setTexture3D(L,0):L.isDataArrayTexture||L.isCompressedArrayTexture?P.setTexture2DArray(L,0):P.setTexture2D(L,0),_e.unbindTexture()},this.resetState=function(){N=0,M=0,R=null,_e.reset(),xe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return jr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Bb?"display-p3":"srgb",t.unpackColorSpace=cn.workingColorSpace===oA?"display-p3":"srgb"}}class Zb{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new Pe(e),this.density=t}clone(){return new Zb(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Sb{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new Pe(e),this.near=t,this.far=i}clone(){return new Sb(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let Wh=class extends Lt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Gs,this.environmentIntensity=1,this.environmentRotation=new Gs,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class gd{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Rh,this.updateRanges=[],this.version=0,this.uuid=Go()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let s=0,o=this.stride;s<o;s++)this.array[e+s]=t.array[i+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Go()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Go()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Vs=new _;class ja{constructor(e,t,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Vs.fromBufferAttribute(this,t),Vs.applyMatrix4(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Vs.fromBufferAttribute(this,t),Vs.applyNormalMatrix(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Vs.fromBufferAttribute(this,t),Vs.transformDirection(e),this.setXYZ(t,Vs.x,Vs.y,Vs.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Hs(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Yt(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Yt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Hs(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Hs(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Hs(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Hs(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array),s=Yt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this}setXYZW(e,t,i,s,o){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yt(t,this.array),i=Yt(i,this.array),s=Yt(s,this.array),o=Yt(o,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=s,this.data.array[e+3]=o,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[s+o])}return new Pt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ja(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let o=0;o<this.itemSize;o++)t.push(this.data.array[s+o])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class LZ extends Un{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Pe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Du;const tC=new _,Pu=new _,Uu=new _,Ju=new ye,nC=new ye,MT=new ct,Dp=new _,iC=new _,Pp=new _,KV=new ye,hG=new ye,_V=new ye;class NT extends Lt{constructor(e=new LZ){if(super(),this.isSprite=!0,this.type="Sprite",Du===void 0){Du=new Mt;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new gd(t,5);Du.setIndex([0,1,2,0,2,3]),Du.setAttribute("position",new ja(i,3,0,!1)),Du.setAttribute("uv",new ja(i,2,3,!1))}this.geometry=Du,this.material=e,this.center=new ye(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Pu.setFromMatrixScale(this.matrixWorld),MT.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Uu.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Pu.multiplyScalar(-Uu.z);const i=this.material.rotation;let s,o;i!==0&&(o=Math.cos(i),s=Math.sin(i));const r=this.center;Up(Dp.set(-.5,-.5,0),Uu,r,Pu,s,o),Up(iC.set(.5,-.5,0),Uu,r,Pu,s,o),Up(Pp.set(.5,.5,0),Uu,r,Pu,s,o),KV.set(0,0),hG.set(1,0),_V.set(1,1);let a=e.ray.intersectTriangle(Dp,iC,Pp,!1,tC);if(a===null&&(Up(iC.set(-.5,.5,0),Uu,r,Pu,s,o),hG.set(0,1),a=e.ray.intersectTriangle(Dp,Pp,iC,!1,tC),a===null))return;const l=e.ray.origin.distanceTo(tC);l<e.near||l>e.far||t.push({distance:l,point:tC.clone(),uv:$s.getInterpolation(tC,Dp,iC,Pp,KV,hG,_V,new ye),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function Up(n,e,t,i,s,o){Ju.subVectors(n,t).addScalar(.5).multiply(i),s!==void 0?(nC.x=o*Ju.x-s*Ju.y,nC.y=s*Ju.x+o*Ju.y):nC.copy(Ju),n.copy(e),n.x+=nC.x,n.y+=nC.y,n.applyMatrix4(MT)}const Jp=new _,LV=new _;class FT extends Lt{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,s=t.length;i<s;i++){const o=t[i];this.addLevel(o.object.clone(),o.distance,o.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const s=this.levels;let o;for(o=0;o<s.length&&!(t<s[o].distance);o++);return s.splice(o,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const s=t.splice(i,1);return this.remove(s[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,s;for(i=1,s=t.length;i<s;i++){let o=t[i].distance;if(t[i].object.visible&&(o-=o*t[i].hysteresis),e<o)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Jp.setFromMatrixPosition(this.matrixWorld);const s=e.ray.origin.distanceTo(Jp);this.getObjectForDistance(s).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Jp.setFromMatrixPosition(e.matrixWorld),LV.setFromMatrixPosition(this.matrixWorld);const i=Jp.distanceTo(LV)/e.zoom;t[0].object.visible=!0;let s,o;for(s=1,o=t.length;s<o;s++){let r=t[s].distance;if(t[s].object.visible&&(r-=r*t[s].hysteresis),i>=r)t[s-1].object.visible=!1,t[s].object.visible=!0;else break}for(this._currentLevel=s-1;s<o;s++)t[s].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let s=0,o=i.length;s<o;s++){const r=i[s];t.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return t}}const kV=new _,zV=new rn,DV=new rn,yQ=new _,PV=new ct,Op=new _,AG=new Ti,UV=new ct,pG=new nu;class Rb extends _n{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=p2,this.bindMatrix=new ct,this.bindMatrixInverse=new ct,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Ji),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Op),this.boundingBox.expandByPoint(Op)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ti),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Op),this.boundingSphere.expandByPoint(Op)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),AG.copy(this.boundingSphere),AG.applyMatrix4(s),e.ray.intersectsSphere(AG)!==!1&&(UV.copy(s).invert(),pG.copy(e.ray).applyMatrix4(UV),!(this.boundingBox!==null&&pG.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,pG)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new rn,t=this.geometry.attributes.skinWeight;for(let i=0,s=t.count;i<s;i++){e.fromBufferAttribute(t,i);const o=1/e.manhattanLength();o!==1/0?e.multiplyScalar(o):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===p2?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===iT?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,s=this.geometry;zV.fromBufferAttribute(s.attributes.skinIndex,e),DV.fromBufferAttribute(s.attributes.skinWeight,e),kV.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let o=0;o<4;o++){const r=DV.getComponent(o);if(r!==0){const a=zV.getComponent(o);PV.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(yQ.copy(kV).applyMatrix4(PV),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class gA extends Lt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class na extends Bn{constructor(e=null,t=1,i=1,s,o,r,a,l,g=Bi,c=Bi,u,C){super(null,r,a,l,g,c,s,o,u,C),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const JV=new ct,BQ=new ct;class cd{constructor(e=[],t=[]){this.uuid=Go(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new ct)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new ct;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let o=0,r=e.length;o<r;o++){const a=e[o]?e[o].matrixWorld:BQ;JV.multiplyMatrices(a,t[o]),JV.toArray(i,o*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new cd(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new na(t,e,e,fs,Xs);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const s=this.bones[t];if(s.name===e)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,s=e.bones.length;i<s;i++){const o=e.bones[i];let r=t[o];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",o),r=new gA),this.bones.push(r),this.boneInverses.push(new ct().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let s=0,o=t.length;s<o;s++){const r=t[s];e.bones.push(r.uuid);const a=i[s];e.boneInverses.push(a.toArray())}return e}}class ng extends Pt{constructor(e,t,i,s=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Ou=new ct,OV=new ct,Qp=[],QV=new Ji,GQ=new ct,sC=new _n,oC=new Ti;class Jl extends _n{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new ng(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,GQ)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Ji),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Ou),QV.copy(e.boundingBox).applyMatrix4(Ou),this.boundingBox.union(QV)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ti),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Ou),oC.copy(e.boundingSphere).applyMatrix4(Ou),this.boundingSphere.union(oC)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,s=this.morphTexture.source.data.data,o=i.length+1,r=e*o+1;for(let a=0;a<i.length;a++)i[a]=s[r+a]}raycast(e,t){const i=this.matrixWorld,s=this.count;if(sC.geometry=this.geometry,sC.material=this.material,sC.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),oC.copy(this.boundingSphere),oC.applyMatrix4(i),e.ray.intersectsSphere(oC)!==!1))for(let o=0;o<s;o++){this.getMatrixAt(o,Ou),OV.multiplyMatrices(i,Ou),sC.matrixWorld=OV,sC.raycast(e,Qp);for(let r=0,a=Qp.length;r<a;r++){const l=Qp[r];l.instanceId=o,l.object=this,t.push(l)}Qp.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new ng(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new na(new Float32Array(s*this.count),s,this.count,mb,Xs));const o=this.morphTexture.source.data.data;let r=0;for(let g=0;g<i.length;g++)r+=i[g];const a=this.geometry.morphTargetsRelative?1:1-r,l=s*e;o[l]=a,o.set(i,l+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function vQ(n,e){return n.z-e.z}function wQ(n,e){return e.z-n.z}class ZQ{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const r=s[this.index];o.push(r),this.index++,r.start=e.start,r.count=e.count,r.z=t,r.index=i}reset(){this.list.length=0,this.index=0}}const Gl=new ct,mG=new ct,SQ=new ct,RQ=new Pe(1,1,1),jV=new ct,fG=new aA,jp=new Ji,Pg=new Ti,rC=new _,qV=new _,xQ=new _,bG=new ZQ,cs=new _n,qp=[];function VQ(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const s=n.count;for(let o=0;o<s;o++)for(let r=0;r<i;r++)e.setComponent(o+t,r,n.getComponent(o,r))}else e.array.set(n.array,t*i);e.needsUpdate=!0}class HT extends _n{get maxInstanceCount(){return this._maxInstanceCount}constructor(e,t,i=t*2,s){super(new Mt,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawInfo=[],this._availableInstanceIds=[],this._drawRanges=[],this._reservedRanges=[],this._bounds=[],this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new na(t,e,e,fs,Xs);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new na(t,e,e,iA,Qa);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new na(t,e,e,fs,Xs);i.colorSpace=cn.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,s=this._maxIndexCount;if(this._geometryInitialized===!1){for(const o in e.attributes){const r=e.getAttribute(o),{array:a,itemSize:l,normalized:g}=r,c=new a.constructor(i*l),u=new Pt(c,l,g);t.setAttribute(o,u)}if(e.getIndex()!==null){const o=i>65535?new Uint32Array(s):new Uint16Array(s);t.setIndex(new Pt(o,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const s=e.getAttribute(i),o=t.getAttribute(i);if(s.itemSize!==o.itemSize||s.normalized!==o.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ji);const e=this.boundingBox,t=this._drawInfo;e.makeEmpty();for(let i=0,s=t.length;i<s;i++){if(t[i].active===!1)continue;const o=t[i].geometryIndex;this.getMatrixAt(i,Gl),this.getBoundingBoxAt(o,jp).applyMatrix4(Gl),e.union(jp)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ti);const e=this.boundingSphere,t=this._drawInfo;e.makeEmpty();for(let i=0,s=t.length;i<s;i++){if(t[i].active===!1)continue;const o=t[i].geometryIndex;this.getMatrixAt(i,Gl),this.getBoundingSphereAt(o,Pg).applyMatrix4(Gl),e.union(Pg)}}addInstance(e){if(this._drawInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let s=null;this._availableInstanceIds.length>0?(s=this._availableInstanceIds.pop(),this._drawInfo[s]=i):(s=this._drawInfo.length,this._drawInfo.push(i));const o=this._matricesTexture,r=o.image.data;SQ.toArray(r,s*16),o.needsUpdate=!0;const a=this._colorsTexture;return a&&(RQ.toArray(a.image.data,s*4),a.needsUpdate=!0),s}addGeometry(e,t=-1,i=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._drawInfo.length>=this._maxInstanceCount)throw new Error("BatchedMesh: Maximum item count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let o=null;const r=this._reservedRanges,a=this._drawRanges,l=this._bounds;this._geometryCount!==0&&(o=r[r.length-1]),t===-1?s.vertexCount=e.getAttribute("position").count:s.vertexCount=t,o===null?s.vertexStart=0:s.vertexStart=o.vertexStart+o.vertexCount;const g=e.getIndex(),c=g!==null;if(c&&(i===-1?s.indexCount=g.count:s.indexCount=i,o===null?s.indexStart=0:s.indexStart=o.indexStart+o.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._geometryCount;return this._geometryCount++,r.push(s),a.push({start:c?s.indexStart:s.vertexStart,count:-1}),l.push({boxInitialized:!1,box:new Ji,sphereInitialized:!1,sphere:new Ti}),this.setGeometryAt(u,e),u}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,s=i.getIndex()!==null,o=i.getIndex(),r=t.getIndex(),a=this._reservedRanges[e];if(s&&r.count>a.indexCount||t.attributes.position.count>a.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,g=a.vertexCount;for(const h in i.attributes){const p=t.getAttribute(h),b=i.getAttribute(h);VQ(p,b,l);const m=p.itemSize;for(let A=p.count,B=g;A<B;A++){const G=l+A;for(let w=0;w<m;w++)b.setComponent(G,w,0)}b.needsUpdate=!0,b.addUpdateRange(l*m,g*m)}if(s){const h=a.indexStart;for(let p=0;p<r.count;p++)o.setX(h+p,l+r.getX(p));for(let p=r.count,b=a.indexCount;p<b;p++)o.setX(h+p,l);o.needsUpdate=!0,o.addUpdateRange(h,a.indexCount)}const c=this._bounds[e];t.boundingBox!==null?(c.box.copy(t.boundingBox),c.boxInitialized=!0):c.boxInitialized=!1,t.boundingSphere!==null?(c.sphere.copy(t.boundingSphere),c.sphereInitialized=!0):c.sphereInitialized=!1;const u=this._drawRanges[e],C=t.getAttribute("position");return u.count=s?r.count:C.count,this._visibilityChanged=!0,e}deleteInstance(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?this:(t[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this)}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this._bounds[e],s=i.box,o=this.geometry;if(i.boxInitialized===!1){s.makeEmpty();const r=o.index,a=o.attributes.position,l=this._drawRanges[e];for(let g=l.start,c=l.start+l.count;g<c;g++){let u=g;r&&(u=r.getX(u)),s.expandByPoint(rC.fromBufferAttribute(a,u))}i.boxInitialized=!0}return t.copy(s),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this._bounds[e],s=i.sphere,o=this.geometry;if(i.sphereInitialized===!1){s.makeEmpty(),this.getBoundingBoxAt(e,jp),jp.getCenter(s.center);const r=o.index,a=o.attributes.position,l=this._drawRanges[e];let g=0;for(let c=l.start,u=l.start+l.count;c<u;c++){let C=c;r&&(C=r.getX(C)),rC.fromBufferAttribute(a,C),g=Math.max(g,s.center.distanceToSquared(rC))}s.radius=Math.sqrt(g),i.sphereInitialized=!0}return t.copy(s),t}setMatrixAt(e,t){const i=this._drawInfo,s=this._matricesTexture,o=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?this:(t.toArray(o,e*16),s.needsUpdate=!0,this)}getMatrixAt(e,t){const i=this._drawInfo,s=this._matricesTexture.image.data;return e>=i.length||i[e].active===!1?null:t.fromArray(s,e*16)}setColorAt(e,t){this._colorsTexture===null&&this._initColorsTexture();const i=this._colorsTexture,s=this._colorsTexture.image.data,o=this._drawInfo;return e>=o.length||o[e].active===!1?this:(t.toArray(s,e*4),i.needsUpdate=!0,this)}getColorAt(e,t){const i=this._colorsTexture.image.data,s=this._drawInfo;return e>=s.length||s[e].active===!1?null:t.fromArray(i,e*4)}setVisibleAt(e,t){const i=this._drawInfo;return e>=i.length||i[e].active===!1||i[e].visible===t?this:(i[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?!1:t[e].visible}setGeometryIdAt(e,t){const i=this._drawInfo;return e>=i.length||i[e].active===!1||t<0||t>=this._geometryCount?null:(i[e].geometryIndex=t,this)}getGeometryIdAt(e){const t=this._drawInfo;return e>=t.length||t[e].active===!1?-1:t[e].geometryIndex}getGeometryRangeAt(e,t={}){if(e<0||e>=this._geometryCount)return null;const i=this._drawRanges[e];return t.start=i.start,t.count=i.count,t}raycast(e,t){const i=this._drawInfo,s=this._drawRanges,o=this.matrixWorld,r=this.geometry;cs.material=this.material,cs.geometry.index=r.index,cs.geometry.attributes=r.attributes,cs.geometry.boundingBox===null&&(cs.geometry.boundingBox=new Ji),cs.geometry.boundingSphere===null&&(cs.geometry.boundingSphere=new Ti);for(let a=0,l=i.length;a<l;a++){if(!i[a].visible||!i[a].active)continue;const g=i[a].geometryIndex,c=s[g];cs.geometry.setDrawRange(c.start,c.count),this.getMatrixAt(a,cs.matrixWorld).premultiply(o),this.getBoundingBoxAt(g,cs.geometry.boundingBox),this.getBoundingSphereAt(g,cs.geometry.boundingSphere),cs.raycast(e,qp);for(let u=0,C=qp.length;u<C;u++){const h=qp[u];h.object=this,h.batchId=a,t.push(h)}qp.length=0}cs.material=null,cs.geometry.index=null,cs.geometry.attributes={},cs.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(t=>({...t})),this._reservedRanges=e._reservedRanges.map(t=>({...t})),this._drawInfo=e._drawInfo.map(t=>({...t})),this._bounds=e._bounds.map(t=>({boxInitialized:t.boxInitialized,box:t.box.clone(),sphereInitialized:t.sphereInitialized,sphere:t.sphere.clone()})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,t,i,s,o){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const r=s.getIndex(),a=r===null?1:r.array.BYTES_PER_ELEMENT,l=this._drawInfo,g=this._multiDrawStarts,c=this._multiDrawCounts,u=this._drawRanges,C=this.perObjectFrustumCulled,h=this._indirectTexture,p=h.image.data;C&&(jV.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),fG.setFromProjectionMatrix(jV,e.coordinateSystem));let b=0;if(this.sortObjects){mG.copy(this.matrixWorld).invert(),rC.setFromMatrixPosition(i.matrixWorld).applyMatrix4(mG),qV.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(mG);for(let B=0,G=l.length;B<G;B++)if(l[B].visible&&l[B].active){const w=l[B].geometryIndex;this.getMatrixAt(B,Gl),this.getBoundingSphereAt(w,Pg).applyMatrix4(Gl);let N=!1;if(C&&(N=!fG.intersectsSphere(Pg)),!N){const M=xQ.subVectors(Pg.center,rC).dot(qV);bG.push(u[w],M,B)}}const m=bG.list,A=this.customSort;A===null?m.sort(o.transparent?wQ:vQ):A.call(this,m,i);for(let B=0,G=m.length;B<G;B++){const w=m[B];g[b]=w.start*a,c[b]=w.count,p[b]=w.index,b++}bG.reset()}else for(let m=0,A=l.length;m<A;m++)if(l[m].visible&&l[m].active){const B=l[m].geometryIndex;let G=!1;if(C&&(this.getMatrixAt(m,Gl),this.getBoundingSphereAt(B,Pg).applyMatrix4(Gl),G=!fG.intersectsSphere(Pg)),!G){const w=u[B];g[b]=w.start*a,c[b]=w.count,p[b]=m,b++}}h.needsUpdate=!0,this._multiDrawCount=b,this._visibilityChanged=!1}onBeforeShadow(e,t,i,s,o,r){this.onBeforeRender(e,null,s,o,r)}}class ji extends Un{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Pe(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const f0=new _,b0=new _,$V=new ct,aC=new nu,$p=new Ti,yG=new _,eW=new _;class ra extends Lt{constructor(e=new Mt,t=new ji){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let s=1,o=t.count;s<o;s++)f0.fromBufferAttribute(t,s-1),b0.fromBufferAttribute(t,s),i[s]=i[s-1],i[s]+=f0.distanceTo(b0);e.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,o=e.params.Line.threshold,r=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),$p.copy(i.boundingSphere),$p.applyMatrix4(s),$p.radius+=o,e.ray.intersectsSphere($p)===!1)return;$V.copy(s).invert(),aC.copy(e.ray).applyMatrix4($V);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,g=this.isLineSegments?2:1,c=i.index,C=i.attributes.position;if(c!==null){const h=Math.max(0,r.start),p=Math.min(c.count,r.start+r.count);for(let b=h,m=p-1;b<m;b+=g){const A=c.getX(b),B=c.getX(b+1),G=em(this,e,aC,l,A,B);G&&t.push(G)}if(this.isLineLoop){const b=c.getX(p-1),m=c.getX(h),A=em(this,e,aC,l,b,m);A&&t.push(A)}}else{const h=Math.max(0,r.start),p=Math.min(C.count,r.start+r.count);for(let b=h,m=p-1;b<m;b+=g){const A=em(this,e,aC,l,b,b+1);A&&t.push(A)}if(this.isLineLoop){const b=em(this,e,aC,l,p-1,h);b&&t.push(b)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=s.length;o<r;o++){const a=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}}function em(n,e,t,i,s,o){const r=n.geometry.attributes.position;if(f0.fromBufferAttribute(r,s),b0.fromBufferAttribute(r,o),t.distanceSqToSegment(f0,b0,yG,eW)>i)return;yG.applyMatrix4(n.matrixWorld);const l=e.ray.origin.distanceTo(yG);if(!(l<e.near||l>e.far))return{distance:l,point:eW.clone().applyMatrix4(n.matrixWorld),index:s,face:null,faceIndex:null,barycoord:null,object:n}}const tW=new _,nW=new _;class ir extends ra{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let s=0,o=t.count;s<o;s+=2)tW.fromBufferAttribute(t,s),nW.fromBufferAttribute(t,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+tW.distanceTo(nW);e.setAttribute("lineDistance",new dt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class xb extends ra{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ud extends Un{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Pe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const iW=new ct,G2=new nu,tm=new Ti,nm=new _;let Vb=class extends Lt{constructor(e=new Mt,t=new ud){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,s=this.matrixWorld,o=e.params.Points.threshold,r=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),tm.copy(i.boundingSphere),tm.applyMatrix4(s),tm.radius+=o,e.ray.intersectsSphere(tm)===!1)return;iW.copy(s).invert(),G2.copy(e.ray).applyMatrix4(iW);const a=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,g=i.index,u=i.attributes.position;if(g!==null){const C=Math.max(0,r.start),h=Math.min(g.count,r.start+r.count);for(let p=C,b=h;p<b;p++){const m=g.getX(p);nm.fromBufferAttribute(u,m),sW(nm,m,l,s,e,t,this)}}else{const C=Math.max(0,r.start),h=Math.min(u.count,r.start+r.count);for(let p=C,b=h;p<b;p++)nm.fromBufferAttribute(u,p),sW(nm,p,l,s,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const s=t[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,r=s.length;o<r;o++){const a=s[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}};function sW(n,e,t,i,s,o,r){const a=G2.distanceSqToPoint(n);if(a<t){const l=new _;G2.closestPointToPoint(n,l),l.applyMatrix4(i);const g=s.ray.origin.distanceTo(l);if(g<s.near||g>s.far)return;o.push({distance:g,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:r})}}class WQ extends Bn{constructor(e,t,i,s,o,r,a,l,g){super(e,t,i,s,o,r,a,l,g),this.isVideoTexture=!0,this.minFilter=r!==void 0?r:fn,this.magFilter=o!==void 0?o:fn,this.generateMipmaps=!1;const c=this;function u(){c.needsUpdate=!0,e.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class MQ extends Bn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Bi,this.minFilter=Bi,this.generateMipmaps=!1,this.needsUpdate=!0}}class Wb extends Bn{constructor(e,t,i,s,o,r,a,l,g,c,u,C){super(null,r,a,l,g,c,s,o,u,C),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class NQ extends Wb{constructor(e,t,i,s,o,r){super(e,t,i,o,r),this.isCompressedArrayTexture=!0,this.image.depth=s,this.wrapR=to,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class FQ extends Wb{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,Oa),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class HQ extends Bn{constructor(e,t,i,s,o,r,a,l,g){super(e,t,i,s,o,r,a,l,g),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Nr{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,s=this.getPoint(0),o=0;t.push(0);for(let r=1;r<=e;r++)i=this.getPoint(r/e),o+=i.distanceTo(s),t.push(o),s=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let s=0;const o=i.length;let r;t?r=t:r=e*i[o-1];let a=0,l=o-1,g;for(;a<=l;)if(s=Math.floor(a+(l-a)/2),g=i[s]-r,g<0)a=s+1;else if(g>0)l=s-1;else{l=s;break}if(s=l,i[s]===r)return s/(o-1);const c=i[s],C=i[s+1]-c,h=(r-c)/C;return(s+h)/(o-1)}getTangent(e,t){let s=e-1e-4,o=e+1e-4;s<0&&(s=0),o>1&&(o=1);const r=this.getPoint(s),a=this.getPoint(o),l=t||(r.isVector2?new ye:new _);return l.copy(a).sub(r).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new _,s=[],o=[],r=[],a=new _,l=new ct;for(let h=0;h<=e;h++){const p=h/e;s[h]=this.getTangentAt(p,new _)}o[0]=new _,r[0]=new _;let g=Number.MAX_VALUE;const c=Math.abs(s[0].x),u=Math.abs(s[0].y),C=Math.abs(s[0].z);c<=g&&(g=c,i.set(1,0,0)),u<=g&&(g=u,i.set(0,1,0)),C<=g&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),o[0].crossVectors(s[0],a),r[0].crossVectors(s[0],o[0]);for(let h=1;h<=e;h++){if(o[h]=o[h-1].clone(),r[h]=r[h-1].clone(),a.crossVectors(s[h-1],s[h]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(ti(s[h-1].dot(s[h]),-1,1));o[h].applyMatrix4(l.makeRotationAxis(a,p))}r[h].crossVectors(s[h],o[h])}if(t===!0){let h=Math.acos(ti(o[0].dot(o[e]),-1,1));h/=e,s[0].dot(a.crossVectors(o[0],o[e]))>0&&(h=-h);for(let p=1;p<=e;p++)o[p].applyMatrix4(l.makeRotationAxis(s[p],h*p)),r[p].crossVectors(s[p],o[p])}return{tangents:s,normals:o,binormals:r}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Mb extends Nr{constructor(e=0,t=0,i=1,s=1,o=0,r=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=s,this.aStartAngle=o,this.aEndAngle=r,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new ye){const i=t,s=Math.PI*2;let o=this.aEndAngle-this.aStartAngle;const r=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=s;for(;o>s;)o-=s;o<Number.EPSILON&&(r?o=0:o=s),this.aClockwise===!0&&!r&&(o===s?o=-s:o=o-s);const a=this.aStartAngle+e*o;let l=this.aX+this.xRadius*Math.cos(a),g=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),C=l-this.aX,h=g-this.aY;l=C*c-h*u+this.aX,g=C*u+h*c+this.aY}return i.set(l,g)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class XT extends Mb{constructor(e,t,i,s,o,r){super(e,t,i,i,s,o,r),this.isArcCurve=!0,this.type="ArcCurve"}}function kZ(){let n=0,e=0,t=0,i=0;function s(o,r,a,l){n=o,e=a,t=-3*o+3*r-2*a-l,i=2*o-2*r+a+l}return{initCatmullRom:function(o,r,a,l,g){s(r,a,g*(a-o),g*(l-r))},initNonuniformCatmullRom:function(o,r,a,l,g,c,u){let C=(r-o)/g-(a-o)/(g+c)+(a-r)/c,h=(a-r)/c-(l-r)/(c+u)+(l-a)/u;C*=c,h*=c,s(r,a,C,h)},calc:function(o){const r=o*o,a=r*o;return n+e*o+t*r+i*a}}}const im=new _,BG=new kZ,GG=new kZ,vG=new kZ;class TT extends Nr{constructor(e=[],t=!1,i="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=s}getPoint(e,t=new _){const i=t,s=this.points,o=s.length,r=(o-(this.closed?0:1))*e;let a=Math.floor(r),l=r-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/o)+1)*o:l===0&&a===o-1&&(a=o-2,l=1);let g,c;this.closed||a>0?g=s[(a-1)%o]:(im.subVectors(s[0],s[1]).add(s[0]),g=im);const u=s[a%o],C=s[(a+1)%o];if(this.closed||a+2<o?c=s[(a+2)%o]:(im.subVectors(s[o-1],s[o-2]).add(s[o-1]),c=im),this.curveType==="centripetal"||this.curveType==="chordal"){const h=this.curveType==="chordal"?.5:.25;let p=Math.pow(g.distanceToSquared(u),h),b=Math.pow(u.distanceToSquared(C),h),m=Math.pow(C.distanceToSquared(c),h);b<1e-4&&(b=1),p<1e-4&&(p=b),m<1e-4&&(m=b),BG.initNonuniformCatmullRom(g.x,u.x,C.x,c.x,p,b,m),GG.initNonuniformCatmullRom(g.y,u.y,C.y,c.y,p,b,m),vG.initNonuniformCatmullRom(g.z,u.z,C.z,c.z,p,b,m)}else this.curveType==="catmullrom"&&(BG.initCatmullRom(g.x,u.x,C.x,c.x,this.tension),GG.initCatmullRom(g.y,u.y,C.y,c.y,this.tension),vG.initCatmullRom(g.z,u.z,C.z,c.z,this.tension));return i.set(BG.calc(l),GG.calc(l),vG.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new _().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function oW(n,e,t,i,s){const o=(i-e)*.5,r=(s-t)*.5,a=n*n,l=n*a;return(2*t-2*i+o+r)*l+(-3*t+3*i-2*o-r)*a+o*n+t}function XQ(n,e){const t=1-n;return t*t*e}function TQ(n,e){return 2*(1-n)*n*e}function EQ(n,e){return n*n*e}function JC(n,e,t,i){return XQ(n,e)+TQ(n,t)+EQ(n,i)}function YQ(n,e){const t=1-n;return t*t*t*e}function KQ(n,e){const t=1-n;return 3*t*t*n*e}function _Q(n,e){return 3*(1-n)*n*n*e}function LQ(n,e){return n*n*n*e}function OC(n,e,t,i,s){return YQ(n,e)+KQ(n,t)+_Q(n,i)+LQ(n,s)}class zZ extends Nr{constructor(e=new ye,t=new ye,i=new ye,s=new ye){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new ye){const i=t,s=this.v0,o=this.v1,r=this.v2,a=this.v3;return i.set(OC(e,s.x,o.x,r.x,a.x),OC(e,s.y,o.y,r.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ET extends Nr{constructor(e=new _,t=new _,i=new _,s=new _){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=s}getPoint(e,t=new _){const i=t,s=this.v0,o=this.v1,r=this.v2,a=this.v3;return i.set(OC(e,s.x,o.x,r.x,a.x),OC(e,s.y,o.y,r.y,a.y),OC(e,s.z,o.z,r.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class DZ extends Nr{constructor(e=new ye,t=new ye){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new ye){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ye){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class YT extends Nr{constructor(e=new _,t=new _){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new _){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new _){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class PZ extends Nr{constructor(e=new ye,t=new ye,i=new ye){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ye){const i=t,s=this.v0,o=this.v1,r=this.v2;return i.set(JC(e,s.x,o.x,r.x),JC(e,s.y,o.y,r.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class UZ extends Nr{constructor(e=new _,t=new _,i=new _){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new _){const i=t,s=this.v0,o=this.v1,r=this.v2;return i.set(JC(e,s.x,o.x,r.x),JC(e,s.y,o.y,r.y),JC(e,s.z,o.z,r.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class JZ extends Nr{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new ye){const i=t,s=this.points,o=(s.length-1)*e,r=Math.floor(o),a=o-r,l=s[r===0?r:r-1],g=s[r],c=s[r>s.length-2?s.length-1:r+1],u=s[r>s.length-3?s.length-1:r+2];return i.set(oW(a,l.x,g.x,c.x,u.x),oW(a,l.y,g.y,c.y,u.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const s=e.points[t];this.points.push(new ye().fromArray(s))}return this}}var y0=Object.freeze({__proto__:null,ArcCurve:XT,CatmullRomCurve3:TT,CubicBezierCurve:zZ,CubicBezierCurve3:ET,EllipseCurve:Mb,LineCurve:DZ,LineCurve3:YT,QuadraticBezierCurve:PZ,QuadraticBezierCurve3:UZ,SplineCurve:JZ});class KT extends Nr{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new y0[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),s=this.getCurveLengths();let o=0;for(;o<s.length;){if(s[o]>=i){const r=s[o]-i,a=this.curves[o],l=a.getLength(),g=l===0?0:1-r/l;return a.getPointAt(g,t)}o++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,s=this.curves.length;i<s;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let s=0,o=this.curves;s<o.length;s++){const r=o[s],a=r.isEllipseCurve?e*2:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?e*r.points.length:e,l=r.getPoints(a);for(let g=0;g<l.length;g++){const c=l[g];i&&i.equals(c)||(t.push(c),i=c)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const s=e.curves[t];this.curves.push(new y0[s.type]().fromJSON(s))}return this}}class Mh extends KT{constructor(e){super(),this.type="Path",this.currentPoint=new ye,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new DZ(this.currentPoint.clone(),new ye(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,s){const o=new PZ(this.currentPoint.clone(),new ye(e,t),new ye(i,s));return this.curves.push(o),this.currentPoint.set(i,s),this}bezierCurveTo(e,t,i,s,o,r){const a=new zZ(this.currentPoint.clone(),new ye(e,t),new ye(i,s),new ye(o,r));return this.curves.push(a),this.currentPoint.set(o,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new JZ(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,s,o,r){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,s,o,r),this}absarc(e,t,i,s,o,r){return this.absellipse(e,t,i,i,s,o,r),this}ellipse(e,t,i,s,o,r,a,l){const g=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+g,t+c,i,s,o,r,a,l),this}absellipse(e,t,i,s,o,r,a,l){const g=new Mb(e,t,i,s,o,r,a,l);if(this.curves.length>0){const u=g.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(g);const c=g.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class cA extends Mt{constructor(e=[new ye(0,-.5),new ye(.5,0),new ye(0,.5)],t=12,i=0,s=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:s},t=Math.floor(t),s=ti(s,0,Math.PI*2);const o=[],r=[],a=[],l=[],g=[],c=1/t,u=new _,C=new ye,h=new _,p=new _,b=new _;let m=0,A=0;for(let B=0;B<=e.length-1;B++)switch(B){case 0:m=e[B+1].x-e[B].x,A=e[B+1].y-e[B].y,h.x=A*1,h.y=-m,h.z=A*0,b.copy(h),h.normalize(),l.push(h.x,h.y,h.z);break;case e.length-1:l.push(b.x,b.y,b.z);break;default:m=e[B+1].x-e[B].x,A=e[B+1].y-e[B].y,h.x=A*1,h.y=-m,h.z=A*0,p.copy(h),h.x+=b.x,h.y+=b.y,h.z+=b.z,h.normalize(),l.push(h.x,h.y,h.z),b.copy(p)}for(let B=0;B<=t;B++){const G=i+B*c*s,w=Math.sin(G),N=Math.cos(G);for(let M=0;M<=e.length-1;M++){u.x=e[M].x*w,u.y=e[M].y,u.z=e[M].x*N,r.push(u.x,u.y,u.z),C.x=B/t,C.y=M/(e.length-1),a.push(C.x,C.y);const R=l[3*M+0]*w,S=l[3*M+1],F=l[3*M+0]*N;g.push(R,S,F)}}for(let B=0;B<t;B++)for(let G=0;G<e.length-1;G++){const w=G+B*e.length,N=w,M=w+e.length,R=w+e.length+1,S=w+1;o.push(N,M,S),o.push(R,S,M)}this.setIndex(o),this.setAttribute("position",new dt(r,3)),this.setAttribute("uv",new dt(a,2)),this.setAttribute("normal",new dt(g,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new cA(e.points,e.segments,e.phiStart,e.phiLength)}}class Nb extends cA{constructor(e=1,t=1,i=4,s=8){const o=new Mh;o.absarc(0,-t/2,e,Math.PI*1.5,0),o.absarc(0,t/2,e,0,Math.PI*.5),super(o.getPoints(i),s),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:i,radialSegments:s}}static fromJSON(e){return new Nb(e.radius,e.length,e.capSegments,e.radialSegments)}}class Fb extends Mt{constructor(e=1,t=32,i=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:s},t=Math.max(3,t);const o=[],r=[],a=[],l=[],g=new _,c=new ye;r.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let u=0,C=3;u<=t;u++,C+=3){const h=i+u/t*s;g.x=e*Math.cos(h),g.y=e*Math.sin(h),r.push(g.x,g.y,g.z),a.push(0,0,1),c.x=(r[C]/e+1)/2,c.y=(r[C+1]/e+1)/2,l.push(c.x,c.y)}for(let u=1;u<=t;u++)o.push(u,u+1,0);this.setIndex(o),this.setAttribute("position",new dt(r,3)),this.setAttribute("normal",new dt(a,3)),this.setAttribute("uv",new dt(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fb(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Id extends Mt{constructor(e=1,t=1,i=1,s=32,o=1,r=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:s,heightSegments:o,openEnded:r,thetaStart:a,thetaLength:l};const g=this;s=Math.floor(s),o=Math.floor(o);const c=[],u=[],C=[],h=[];let p=0;const b=[],m=i/2;let A=0;B(),r===!1&&(e>0&&G(!0),t>0&&G(!1)),this.setIndex(c),this.setAttribute("position",new dt(u,3)),this.setAttribute("normal",new dt(C,3)),this.setAttribute("uv",new dt(h,2));function B(){const w=new _,N=new _;let M=0;const R=(t-e)/i;for(let S=0;S<=o;S++){const F=[],Z=S/o,x=Z*(t-e)+e;for(let Y=0;Y<=s;Y++){const T=Y/s,ne=T*l+a,ue=Math.sin(ne),se=Math.cos(ne);N.x=x*ue,N.y=-Z*i+m,N.z=x*se,u.push(N.x,N.y,N.z),w.set(ue,R,se).normalize(),C.push(w.x,w.y,w.z),h.push(T,1-Z),F.push(p++)}b.push(F)}for(let S=0;S<s;S++)for(let F=0;F<o;F++){const Z=b[F][S],x=b[F+1][S],Y=b[F+1][S+1],T=b[F][S+1];e>0&&(c.push(Z,x,T),M+=3),t>0&&(c.push(x,Y,T),M+=3)}g.addGroup(A,M,0),A+=M}function G(w){const N=p,M=new ye,R=new _;let S=0;const F=w===!0?e:t,Z=w===!0?1:-1;for(let Y=1;Y<=s;Y++)u.push(0,m*Z,0),C.push(0,Z,0),h.push(.5,.5),p++;const x=p;for(let Y=0;Y<=s;Y++){const ne=Y/s*l+a,ue=Math.cos(ne),se=Math.sin(ne);R.x=F*se,R.y=m*Z,R.z=F*ue,u.push(R.x,R.y,R.z),C.push(0,Z,0),M.x=ue*.5+.5,M.y=se*.5*Z+.5,h.push(M.x,M.y),p++}for(let Y=0;Y<s;Y++){const T=N+Y,ne=x+Y;w===!0?c.push(ne,ne+1,T):c.push(ne+1,ne,T),S+=3}g.addGroup(A,S,w===!0?1:2),A+=S}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Id(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Hb extends Id{constructor(e=1,t=1,i=32,s=1,o=!1,r=0,a=Math.PI*2){super(0,e,t,i,s,o,r,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:r,thetaLength:a}}static fromJSON(e){return new Hb(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Cg extends Mt{constructor(e=[],t=[],i=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:s};const o=[],r=[];a(s),g(i),c(),this.setAttribute("position",new dt(o,3)),this.setAttribute("normal",new dt(o.slice(),3)),this.setAttribute("uv",new dt(r,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(B){const G=new _,w=new _,N=new _;for(let M=0;M<t.length;M+=3)h(t[M+0],G),h(t[M+1],w),h(t[M+2],N),l(G,w,N,B)}function l(B,G,w,N){const M=N+1,R=[];for(let S=0;S<=M;S++){R[S]=[];const F=B.clone().lerp(w,S/M),Z=G.clone().lerp(w,S/M),x=M-S;for(let Y=0;Y<=x;Y++)Y===0&&S===M?R[S][Y]=F:R[S][Y]=F.clone().lerp(Z,Y/x)}for(let S=0;S<M;S++)for(let F=0;F<2*(M-S)-1;F++){const Z=Math.floor(F/2);F%2===0?(C(R[S][Z+1]),C(R[S+1][Z]),C(R[S][Z])):(C(R[S][Z+1]),C(R[S+1][Z+1]),C(R[S+1][Z]))}}function g(B){const G=new _;for(let w=0;w<o.length;w+=3)G.x=o[w+0],G.y=o[w+1],G.z=o[w+2],G.normalize().multiplyScalar(B),o[w+0]=G.x,o[w+1]=G.y,o[w+2]=G.z}function c(){const B=new _;for(let G=0;G<o.length;G+=3){B.x=o[G+0],B.y=o[G+1],B.z=o[G+2];const w=m(B)/2/Math.PI+.5,N=A(B)/Math.PI+.5;r.push(w,1-N)}p(),u()}function u(){for(let B=0;B<r.length;B+=6){const G=r[B+0],w=r[B+2],N=r[B+4],M=Math.max(G,w,N),R=Math.min(G,w,N);M>.9&&R<.1&&(G<.2&&(r[B+0]+=1),w<.2&&(r[B+2]+=1),N<.2&&(r[B+4]+=1))}}function C(B){o.push(B.x,B.y,B.z)}function h(B,G){const w=B*3;G.x=e[w+0],G.y=e[w+1],G.z=e[w+2]}function p(){const B=new _,G=new _,w=new _,N=new _,M=new ye,R=new ye,S=new ye;for(let F=0,Z=0;F<o.length;F+=9,Z+=6){B.set(o[F+0],o[F+1],o[F+2]),G.set(o[F+3],o[F+4],o[F+5]),w.set(o[F+6],o[F+7],o[F+8]),M.set(r[Z+0],r[Z+1]),R.set(r[Z+2],r[Z+3]),S.set(r[Z+4],r[Z+5]),N.copy(B).add(G).add(w).divideScalar(3);const x=m(N);b(M,Z+0,B,x),b(R,Z+2,G,x),b(S,Z+4,w,x)}}function b(B,G,w,N){N<0&&B.x===1&&(r[G]=B.x-1),w.x===0&&w.z===0&&(r[G]=N/2/Math.PI+.5)}function m(B){return Math.atan2(B.z,-B.x)}function A(B){return Math.atan2(-B.y,Math.sqrt(B.x*B.x+B.z*B.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Cg(e.vertices,e.indices,e.radius,e.details)}}class Xb extends Cg{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=1/i,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-s,-i,0,-s,i,0,s,-i,0,s,i,-s,-i,0,-s,i,0,s,-i,0,s,i,0,-i,0,-s,i,0,-s,-i,0,s,i,0,s],r=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(o,r,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Xb(e.radius,e.detail)}}const sm=new _,om=new _,wG=new _,rm=new $s;class _T extends Mt{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const s=Math.pow(10,4),o=Math.cos(Vc*t),r=e.getIndex(),a=e.getAttribute("position"),l=r?r.count:a.count,g=[0,0,0],c=["a","b","c"],u=new Array(3),C={},h=[];for(let p=0;p<l;p+=3){r?(g[0]=r.getX(p),g[1]=r.getX(p+1),g[2]=r.getX(p+2)):(g[0]=p,g[1]=p+1,g[2]=p+2);const{a:b,b:m,c:A}=rm;if(b.fromBufferAttribute(a,g[0]),m.fromBufferAttribute(a,g[1]),A.fromBufferAttribute(a,g[2]),rm.getNormal(wG),u[0]=`${Math.round(b.x*s)},${Math.round(b.y*s)},${Math.round(b.z*s)}`,u[1]=`${Math.round(m.x*s)},${Math.round(m.y*s)},${Math.round(m.z*s)}`,u[2]=`${Math.round(A.x*s)},${Math.round(A.y*s)},${Math.round(A.z*s)}`,!(u[0]===u[1]||u[1]===u[2]||u[2]===u[0]))for(let B=0;B<3;B++){const G=(B+1)%3,w=u[B],N=u[G],M=rm[c[B]],R=rm[c[G]],S=`${w}_${N}`,F=`${N}_${w}`;F in C&&C[F]?(wG.dot(C[F].normal)<=o&&(h.push(M.x,M.y,M.z),h.push(R.x,R.y,R.z)),C[F]=null):S in C||(C[S]={index0:g[B],index1:g[G],normal:wG.clone()})}}for(const p in C)if(C[p]){const{index0:b,index1:m}=C[p];sm.fromBufferAttribute(a,b),om.fromBufferAttribute(a,m),h.push(sm.x,sm.y,sm.z),h.push(om.x,om.y,om.z)}this.setAttribute("position",new dt(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}let Mc=class extends Mh{constructor(e){super(e),this.uuid=Go(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,s=this.holes.length;i<s;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const s=e.holes[t];this.holes.push(new Mh().fromJSON(s))}return this}};const kQ={triangulate:function(n,e,t=2){const i=e&&e.length,s=i?e[0]*t:n.length;let o=LT(n,0,s,t,!0);const r=[];if(!o||o.next===o.prev)return r;let a,l,g,c,u,C,h;if(i&&(o=JQ(n,e,o,t)),n.length>80*t){a=g=n[0],l=c=n[1];for(let p=t;p<s;p+=t)u=n[p],C=n[p+1],u<a&&(a=u),C<l&&(l=C),u>g&&(g=u),C>c&&(c=C);h=Math.max(g-a,c-l),h=h!==0?32767/h:0}return Nh(o,r,t,a,l,h,0),r}};function LT(n,e,t,i,s){let o,r;if(s===o4(n,e,t,i)>0)for(o=e;o<t;o+=i)r=rW(o,n[o],n[o+1],r);else for(o=t-i;o>=e;o-=i)r=rW(o,n[o],n[o+1],r);return r&&Tb(r,r.next)&&(Hh(r),r=r.next),r}function Jc(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(Tb(t,t.next)||zn(t.prev,t,t.next)===0)){if(Hh(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Nh(n,e,t,i,s,o,r){if(!n)return;!r&&o&&$Q(n,i,s,o);let a=n,l,g;for(;n.prev!==n.next;){if(l=n.prev,g=n.next,o?DQ(n,i,s,o):zQ(n)){e.push(l.i/t|0),e.push(n.i/t|0),e.push(g.i/t|0),Hh(n),n=g.next,a=g.next;continue}if(n=g,n===a){r?r===1?(n=PQ(Jc(n),e,t),Nh(n,e,t,i,s,o,2)):r===2&&UQ(n,e,t,i,s,o):Nh(Jc(n),e,t,i,s,o,1);break}}}function zQ(n){const e=n.prev,t=n,i=n.next;if(zn(e,t,i)>=0)return!1;const s=e.x,o=t.x,r=i.x,a=e.y,l=t.y,g=i.y,c=s<o?s<r?s:r:o<r?o:r,u=a<l?a<g?a:g:l<g?l:g,C=s>o?s>r?s:r:o>r?o:r,h=a>l?a>g?a:g:l>g?l:g;let p=i.next;for(;p!==e;){if(p.x>=c&&p.x<=C&&p.y>=u&&p.y<=h&&hI(s,a,o,l,r,g,p.x,p.y)&&zn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function DQ(n,e,t,i){const s=n.prev,o=n,r=n.next;if(zn(s,o,r)>=0)return!1;const a=s.x,l=o.x,g=r.x,c=s.y,u=o.y,C=r.y,h=a<l?a<g?a:g:l<g?l:g,p=c<u?c<C?c:C:u<C?u:C,b=a>l?a>g?a:g:l>g?l:g,m=c>u?c>C?c:C:u>C?u:C,A=v2(h,p,e,t,i),B=v2(b,m,e,t,i);let G=n.prevZ,w=n.nextZ;for(;G&&G.z>=A&&w&&w.z<=B;){if(G.x>=h&&G.x<=b&&G.y>=p&&G.y<=m&&G!==s&&G!==r&&hI(a,c,l,u,g,C,G.x,G.y)&&zn(G.prev,G,G.next)>=0||(G=G.prevZ,w.x>=h&&w.x<=b&&w.y>=p&&w.y<=m&&w!==s&&w!==r&&hI(a,c,l,u,g,C,w.x,w.y)&&zn(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;G&&G.z>=A;){if(G.x>=h&&G.x<=b&&G.y>=p&&G.y<=m&&G!==s&&G!==r&&hI(a,c,l,u,g,C,G.x,G.y)&&zn(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;w&&w.z<=B;){if(w.x>=h&&w.x<=b&&w.y>=p&&w.y<=m&&w!==s&&w!==r&&hI(a,c,l,u,g,C,w.x,w.y)&&zn(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function PQ(n,e,t){let i=n;do{const s=i.prev,o=i.next.next;!Tb(s,o)&&kT(s,i,i.next,o)&&Fh(s,o)&&Fh(o,s)&&(e.push(s.i/t|0),e.push(i.i/t|0),e.push(o.i/t|0),Hh(i),Hh(i.next),i=n=o),i=i.next}while(i!==n);return Jc(i)}function UQ(n,e,t,i,s,o){let r=n;do{let a=r.next.next;for(;a!==r.prev;){if(r.i!==a.i&&n4(r,a)){let l=zT(r,a);r=Jc(r,r.next),l=Jc(l,l.next),Nh(r,e,t,i,s,o,0),Nh(l,e,t,i,s,o,0);return}a=a.next}r=r.next}while(r!==n)}function JQ(n,e,t,i){const s=[];let o,r,a,l,g;for(o=0,r=e.length;o<r;o++)a=e[o]*i,l=o<r-1?e[o+1]*i:n.length,g=LT(n,a,l,i,!1),g===g.next&&(g.steiner=!0),s.push(t4(g));for(s.sort(OQ),o=0;o<s.length;o++)t=QQ(s[o],t);return t}function OQ(n,e){return n.x-e.x}function QQ(n,e){const t=jQ(n,e);if(!t)return e;const i=zT(t,n);return Jc(i,i.next),Jc(t,t.next)}function jQ(n,e){let t=e,i=-1/0,s;const o=n.x,r=n.y;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const C=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(C<=o&&C>i&&(i=C,s=t.x<t.next.x?t:t.next,C===o))return s}t=t.next}while(t!==e);if(!s)return null;const a=s,l=s.x,g=s.y;let c=1/0,u;t=s;do o>=t.x&&t.x>=l&&o!==t.x&&hI(r<g?o:i,r,l,g,r<g?i:o,r,t.x,t.y)&&(u=Math.abs(r-t.y)/(o-t.x),Fh(t,n)&&(u<c||u===c&&(t.x>s.x||t.x===s.x&&qQ(s,t)))&&(s=t,c=u)),t=t.next;while(t!==a);return s}function qQ(n,e){return zn(n.prev,n,e.prev)<0&&zn(e.next,n,n.next)<0}function $Q(n,e,t,i){let s=n;do s.z===0&&(s.z=v2(s.x,s.y,e,t,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==n);s.prevZ.nextZ=null,s.prevZ=null,e4(s)}function e4(n){let e,t,i,s,o,r,a,l,g=1;do{for(t=n,n=null,o=null,r=0;t;){for(r++,i=t,a=0,e=0;e<g&&(a++,i=i.nextZ,!!i);e++);for(l=g;a>0||l>0&&i;)a!==0&&(l===0||!i||t.z<=i.z)?(s=t,t=t.nextZ,a--):(s=i,i=i.nextZ,l--),o?o.nextZ=s:n=s,s.prevZ=o,o=s;t=i}o.nextZ=null,g*=2}while(r>1);return n}function v2(n,e,t,i,s){return n=(n-t)*s|0,e=(e-i)*s|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function t4(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function hI(n,e,t,i,s,o,r,a){return(s-r)*(e-a)>=(n-r)*(o-a)&&(n-r)*(i-a)>=(t-r)*(e-a)&&(t-r)*(o-a)>=(s-r)*(i-a)}function n4(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!i4(n,e)&&(Fh(n,e)&&Fh(e,n)&&s4(n,e)&&(zn(n.prev,n,e.prev)||zn(n,e.prev,e))||Tb(n,e)&&zn(n.prev,n,n.next)>0&&zn(e.prev,e,e.next)>0)}function zn(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Tb(n,e){return n.x===e.x&&n.y===e.y}function kT(n,e,t,i){const s=lm(zn(n,e,t)),o=lm(zn(n,e,i)),r=lm(zn(t,i,n)),a=lm(zn(t,i,e));return!!(s!==o&&r!==a||s===0&&am(n,t,e)||o===0&&am(n,i,e)||r===0&&am(t,n,i)||a===0&&am(t,e,i))}function am(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function lm(n){return n>0?1:n<0?-1:0}function i4(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&kT(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function Fh(n,e){return zn(n.prev,n,n.next)<0?zn(n,e,n.next)>=0&&zn(n,n.prev,e)>=0:zn(n,e,n.prev)<0||zn(n,n.next,e)<0}function s4(n,e){let t=n,i=!1;const s=(n.x+e.x)/2,o=(n.y+e.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&s<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function zT(n,e){const t=new w2(n.i,n.x,n.y),i=new w2(e.i,e.x,e.y),s=n.next,o=e.prev;return n.next=e,e.prev=n,t.next=s,s.prev=t,i.next=t,t.prev=i,o.next=i,i.prev=o,i}function rW(n,e,t,i){const s=new w2(n,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Hh(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function w2(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function o4(n,e,t,i){let s=0;for(let o=e,r=t-i;o<t;o+=i)s+=(n[r]-n[o])*(n[o+1]+n[r+1]),r=o;return s}class ia{static area(e){const t=e.length;let i=0;for(let s=t-1,o=0;o<t;s=o++)i+=e[s].x*e[o].y-e[o].x*e[s].y;return i*.5}static isClockWise(e){return ia.area(e)<0}static triangulateShape(e,t){const i=[],s=[],o=[];aW(e),lW(i,e);let r=e.length;t.forEach(aW);for(let l=0;l<t.length;l++)s.push(r),r+=t[l].length,lW(i,t[l]);const a=kQ.triangulate(i,s);for(let l=0;l<a.length;l+=3)o.push(a.slice(l,l+3));return o}}function aW(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function lW(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class Eb extends Mt{constructor(e=new Mc([new ye(.5,.5),new ye(-.5,.5),new ye(-.5,-.5),new ye(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,s=[],o=[];for(let a=0,l=e.length;a<l;a++){const g=e[a];r(g)}this.setAttribute("position",new dt(s,3)),this.setAttribute("uv",new dt(o,2)),this.computeVertexNormals();function r(a){const l=[],g=t.curveSegments!==void 0?t.curveSegments:12,c=t.steps!==void 0?t.steps:1,u=t.depth!==void 0?t.depth:1;let C=t.bevelEnabled!==void 0?t.bevelEnabled:!0,h=t.bevelThickness!==void 0?t.bevelThickness:.2,p=t.bevelSize!==void 0?t.bevelSize:h-.1,b=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3;const A=t.extrudePath,B=t.UVGenerator!==void 0?t.UVGenerator:r4;let G,w=!1,N,M,R,S;A&&(G=A.getSpacedPoints(c),w=!0,C=!1,N=A.computeFrenetFrames(c,!1),M=new _,R=new _,S=new _),C||(m=0,h=0,p=0,b=0);const F=a.extractPoints(g);let Z=F.shape;const x=F.holes;if(!ia.isClockWise(Z)){Z=Z.reverse();for(let we=0,D=x.length;we<D;we++){const Ee=x[we];ia.isClockWise(Ee)&&(x[we]=Ee.reverse())}}const T=ia.triangulateShape(Z,x),ne=Z;for(let we=0,D=x.length;we<D;we++){const Ee=x[we];Z=Z.concat(Ee)}function ue(we,D,Ee){return D||console.error("THREE.ExtrudeGeometry: vec does not exist"),we.clone().addScaledVector(D,Ee)}const se=Z.length,Ie=T.length;function k(we,D,Ee){let Ye,Ne,_e;const ut=we.x-D.x,Oe=we.y-D.y,P=Ee.x-we.x,E=Ee.y-we.y,ge=ut*ut+Oe*Oe,ve=ut*E-Oe*P;if(Math.abs(ve)>Number.EPSILON){const Se=Math.sqrt(ge),Ze=Math.sqrt(P*P+E*E),Je=D.x-Oe/Se,We=D.y+ut/Se,Qe=Ee.x-E/Ze,Kt=Ee.y+P/Ze,Xe=((Qe-Je)*E-(Kt-We)*P)/(ut*E-Oe*P);Ye=Je+ut*Xe-we.x,Ne=We+Oe*Xe-we.y;const et=Ye*Ye+Ne*Ne;if(et<=2)return new ye(Ye,Ne);_e=Math.sqrt(et/2)}else{let Se=!1;ut>Number.EPSILON?P>Number.EPSILON&&(Se=!0):ut<-Number.EPSILON?P<-Number.EPSILON&&(Se=!0):Math.sign(Oe)===Math.sign(E)&&(Se=!0),Se?(Ye=-Oe,Ne=ut,_e=Math.sqrt(ge)):(Ye=ut,Ne=Oe,_e=Math.sqrt(ge/2))}return new ye(Ye/_e,Ne/_e)}const ee=[];for(let we=0,D=ne.length,Ee=D-1,Ye=we+1;we<D;we++,Ee++,Ye++)Ee===D&&(Ee=0),Ye===D&&(Ye=0),ee[we]=k(ne[we],ne[Ee],ne[Ye]);const $=[];let ae,be=ee.concat();for(let we=0,D=x.length;we<D;we++){const Ee=x[we];ae=[];for(let Ye=0,Ne=Ee.length,_e=Ne-1,ut=Ye+1;Ye<Ne;Ye++,_e++,ut++)_e===Ne&&(_e=0),ut===Ne&&(ut=0),ae[Ye]=k(Ee[Ye],Ee[_e],Ee[ut]);$.push(ae),be=be.concat(ae)}for(let we=0;we<m;we++){const D=we/m,Ee=h*Math.cos(D*Math.PI/2),Ye=p*Math.sin(D*Math.PI/2)+b;for(let Ne=0,_e=ne.length;Ne<_e;Ne++){const ut=ue(ne[Ne],ee[Ne],Ye);Fe(ut.x,ut.y,-Ee)}for(let Ne=0,_e=x.length;Ne<_e;Ne++){const ut=x[Ne];ae=$[Ne];for(let Oe=0,P=ut.length;Oe<P;Oe++){const E=ue(ut[Oe],ae[Oe],Ye);Fe(E.x,E.y,-Ee)}}}const me=p+b;for(let we=0;we<se;we++){const D=C?ue(Z[we],be[we],me):Z[we];w?(R.copy(N.normals[0]).multiplyScalar(D.x),M.copy(N.binormals[0]).multiplyScalar(D.y),S.copy(G[0]).add(R).add(M),Fe(S.x,S.y,S.z)):Fe(D.x,D.y,0)}for(let we=1;we<=c;we++)for(let D=0;D<se;D++){const Ee=C?ue(Z[D],be[D],me):Z[D];w?(R.copy(N.normals[we]).multiplyScalar(Ee.x),M.copy(N.binormals[we]).multiplyScalar(Ee.y),S.copy(G[we]).add(R).add(M),Fe(S.x,S.y,S.z)):Fe(Ee.x,Ee.y,u/c*we)}for(let we=m-1;we>=0;we--){const D=we/m,Ee=h*Math.cos(D*Math.PI/2),Ye=p*Math.sin(D*Math.PI/2)+b;for(let Ne=0,_e=ne.length;Ne<_e;Ne++){const ut=ue(ne[Ne],ee[Ne],Ye);Fe(ut.x,ut.y,u+Ee)}for(let Ne=0,_e=x.length;Ne<_e;Ne++){const ut=x[Ne];ae=$[Ne];for(let Oe=0,P=ut.length;Oe<P;Oe++){const E=ue(ut[Oe],ae[Oe],Ye);w?Fe(E.x,E.y+G[c-1].y,G[c-1].x+Ee):Fe(E.x,E.y,u+Ee)}}}ce(),Be();function ce(){const we=s.length/3;if(C){let D=0,Ee=se*D;for(let Ye=0;Ye<Ie;Ye++){const Ne=T[Ye];Ct(Ne[2]+Ee,Ne[1]+Ee,Ne[0]+Ee)}D=c+m*2,Ee=se*D;for(let Ye=0;Ye<Ie;Ye++){const Ne=T[Ye];Ct(Ne[0]+Ee,Ne[1]+Ee,Ne[2]+Ee)}}else{for(let D=0;D<Ie;D++){const Ee=T[D];Ct(Ee[2],Ee[1],Ee[0])}for(let D=0;D<Ie;D++){const Ee=T[D];Ct(Ee[0]+se*c,Ee[1]+se*c,Ee[2]+se*c)}}i.addGroup(we,s.length/3-we,0)}function Be(){const we=s.length/3;let D=0;He(ne,D),D+=ne.length;for(let Ee=0,Ye=x.length;Ee<Ye;Ee++){const Ne=x[Ee];He(Ne,D),D+=Ne.length}i.addGroup(we,s.length/3-we,1)}function He(we,D){let Ee=we.length;for(;--Ee>=0;){const Ye=Ee;let Ne=Ee-1;Ne<0&&(Ne=we.length-1);for(let _e=0,ut=c+m*2;_e<ut;_e++){const Oe=se*_e,P=se*(_e+1),E=D+Ye+Oe,ge=D+Ne+Oe,ve=D+Ne+P,Se=D+Ye+P;pt(E,ge,ve,Se)}}}function Fe(we,D,Ee){l.push(we),l.push(D),l.push(Ee)}function Ct(we,D,Ee){ot(we),ot(D),ot(Ee);const Ye=s.length/3,Ne=B.generateTopUV(i,s,Ye-3,Ye-2,Ye-1);Ue(Ne[0]),Ue(Ne[1]),Ue(Ne[2])}function pt(we,D,Ee,Ye){ot(we),ot(D),ot(Ye),ot(D),ot(Ee),ot(Ye);const Ne=s.length/3,_e=B.generateSideWallUV(i,s,Ne-6,Ne-3,Ne-2,Ne-1);Ue(_e[0]),Ue(_e[1]),Ue(_e[3]),Ue(_e[1]),Ue(_e[2]),Ue(_e[3])}function ot(we){s.push(l[we*3+0]),s.push(l[we*3+1]),s.push(l[we*3+2])}function Ue(we){o.push(we.x),o.push(we.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return a4(t,i,e)}static fromJSON(e,t){const i=[];for(let o=0,r=e.shapes.length;o<r;o++){const a=t[e.shapes[o]];i.push(a)}const s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new y0[s.type]().fromJSON(s)),new Eb(i,e.options)}}const r4={generateTopUV:function(n,e,t,i,s){const o=e[t*3],r=e[t*3+1],a=e[i*3],l=e[i*3+1],g=e[s*3],c=e[s*3+1];return[new ye(o,r),new ye(a,l),new ye(g,c)]},generateSideWallUV:function(n,e,t,i,s,o){const r=e[t*3],a=e[t*3+1],l=e[t*3+2],g=e[i*3],c=e[i*3+1],u=e[i*3+2],C=e[s*3],h=e[s*3+1],p=e[s*3+2],b=e[o*3],m=e[o*3+1],A=e[o*3+2];return Math.abs(a-c)<Math.abs(r-g)?[new ye(r,1-l),new ye(g,1-u),new ye(C,1-p),new ye(b,1-A)]:[new ye(a,1-l),new ye(c,1-u),new ye(h,1-p),new ye(m,1-A)]}};function a4(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,s=n.length;i<s;i++){const o=n[i];t.shapes.push(o.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Yb extends Cg{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,s=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],o=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,o,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Yb(e.radius,e.detail)}}class uA extends Cg{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],s=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,s,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new uA(e.radius,e.detail)}}class Kb extends Mt{constructor(e=.5,t=1,i=32,s=1,o=0,r=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:s,thetaStart:o,thetaLength:r},i=Math.max(3,i),s=Math.max(1,s);const a=[],l=[],g=[],c=[];let u=e;const C=(t-e)/s,h=new _,p=new ye;for(let b=0;b<=s;b++){for(let m=0;m<=i;m++){const A=o+m/i*r;h.x=u*Math.cos(A),h.y=u*Math.sin(A),l.push(h.x,h.y,h.z),g.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,c.push(p.x,p.y)}u+=C}for(let b=0;b<s;b++){const m=b*(i+1);for(let A=0;A<i;A++){const B=A+m,G=B,w=B+i+1,N=B+i+2,M=B+1;a.push(G,w,M),a.push(w,N,M)}}this.setIndex(a),this.setAttribute("position",new dt(l,3)),this.setAttribute("normal",new dt(g,3)),this.setAttribute("uv",new dt(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Kb(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class _b extends Mt{constructor(e=new Mc([new ye(0,.5),new ye(-.5,-.5),new ye(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],s=[],o=[],r=[];let a=0,l=0;if(Array.isArray(e)===!1)g(e);else for(let c=0;c<e.length;c++)g(e[c]),this.addGroup(a,l,c),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new dt(s,3)),this.setAttribute("normal",new dt(o,3)),this.setAttribute("uv",new dt(r,2));function g(c){const u=s.length/3,C=c.extractPoints(t);let h=C.shape;const p=C.holes;ia.isClockWise(h)===!1&&(h=h.reverse());for(let m=0,A=p.length;m<A;m++){const B=p[m];ia.isClockWise(B)===!0&&(p[m]=B.reverse())}const b=ia.triangulateShape(h,p);for(let m=0,A=p.length;m<A;m++){const B=p[m];h=h.concat(B)}for(let m=0,A=h.length;m<A;m++){const B=h[m];s.push(B.x,B.y,0),o.push(0,0,1),r.push(B.x,B.y)}for(let m=0,A=b.length;m<A;m++){const B=b[m],G=B[0]+u,w=B[1]+u,N=B[2]+u;i.push(G,w,N),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return l4(t,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++){const r=t[e.shapes[s]];i.push(r)}return new _b(i,e.curveSegments)}}function l4(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const s=n[t];e.shapes.push(s.uuid)}else e.shapes.push(n.uuid);return e}class IA extends Mt{constructor(e=1,t=32,i=16,s=0,o=Math.PI*2,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:s,phiLength:o,thetaStart:r,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(r+a,Math.PI);let g=0;const c=[],u=new _,C=new _,h=[],p=[],b=[],m=[];for(let A=0;A<=i;A++){const B=[],G=A/i;let w=0;A===0&&r===0?w=.5/t:A===i&&l===Math.PI&&(w=-.5/t);for(let N=0;N<=t;N++){const M=N/t;u.x=-e*Math.cos(s+M*o)*Math.sin(r+G*a),u.y=e*Math.cos(r+G*a),u.z=e*Math.sin(s+M*o)*Math.sin(r+G*a),p.push(u.x,u.y,u.z),C.copy(u).normalize(),b.push(C.x,C.y,C.z),m.push(M+w,1-G),B.push(g++)}c.push(B)}for(let A=0;A<i;A++)for(let B=0;B<t;B++){const G=c[A][B+1],w=c[A][B],N=c[A+1][B],M=c[A+1][B+1];(A!==0||r>0)&&h.push(G,w,M),(A!==i-1||l<Math.PI)&&h.push(w,N,M)}this.setIndex(h),this.setAttribute("position",new dt(p,3)),this.setAttribute("normal",new dt(b,3)),this.setAttribute("uv",new dt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new IA(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Lb extends Cg{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,s,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Lb(e.radius,e.detail)}}class kb extends Mt{constructor(e=1,t=.4,i=12,s=48,o=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:s,arc:o},i=Math.floor(i),s=Math.floor(s);const r=[],a=[],l=[],g=[],c=new _,u=new _,C=new _;for(let h=0;h<=i;h++)for(let p=0;p<=s;p++){const b=p/s*o,m=h/i*Math.PI*2;u.x=(e+t*Math.cos(m))*Math.cos(b),u.y=(e+t*Math.cos(m))*Math.sin(b),u.z=t*Math.sin(m),a.push(u.x,u.y,u.z),c.x=e*Math.cos(b),c.y=e*Math.sin(b),C.subVectors(u,c).normalize(),l.push(C.x,C.y,C.z),g.push(p/s),g.push(h/i)}for(let h=1;h<=i;h++)for(let p=1;p<=s;p++){const b=(s+1)*h+p-1,m=(s+1)*(h-1)+p-1,A=(s+1)*(h-1)+p,B=(s+1)*h+p;r.push(b,m,B),r.push(m,A,B)}this.setIndex(r),this.setAttribute("position",new dt(a,3)),this.setAttribute("normal",new dt(l,3)),this.setAttribute("uv",new dt(g,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new kb(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class zb extends Mt{constructor(e=1,t=.4,i=64,s=8,o=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:s,p:o,q:r},i=Math.floor(i),s=Math.floor(s);const a=[],l=[],g=[],c=[],u=new _,C=new _,h=new _,p=new _,b=new _,m=new _,A=new _;for(let G=0;G<=i;++G){const w=G/i*o*Math.PI*2;B(w,o,r,e,h),B(w+.01,o,r,e,p),m.subVectors(p,h),A.addVectors(p,h),b.crossVectors(m,A),A.crossVectors(b,m),b.normalize(),A.normalize();for(let N=0;N<=s;++N){const M=N/s*Math.PI*2,R=-t*Math.cos(M),S=t*Math.sin(M);u.x=h.x+(R*A.x+S*b.x),u.y=h.y+(R*A.y+S*b.y),u.z=h.z+(R*A.z+S*b.z),l.push(u.x,u.y,u.z),C.subVectors(u,h).normalize(),g.push(C.x,C.y,C.z),c.push(G/i),c.push(N/s)}}for(let G=1;G<=i;G++)for(let w=1;w<=s;w++){const N=(s+1)*(G-1)+(w-1),M=(s+1)*G+(w-1),R=(s+1)*G+w,S=(s+1)*(G-1)+w;a.push(N,M,S),a.push(M,R,S)}this.setIndex(a),this.setAttribute("position",new dt(l,3)),this.setAttribute("normal",new dt(g,3)),this.setAttribute("uv",new dt(c,2));function B(G,w,N,M,R){const S=Math.cos(G),F=Math.sin(G),Z=N/w*G,x=Math.cos(Z);R.x=M*(2+x)*.5*S,R.y=M*(2+x)*F*.5,R.z=M*Math.sin(Z)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zb(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Db extends Mt{constructor(e=new UZ(new _(-1,-1,0),new _(-1,1,0),new _(1,1,0)),t=64,i=1,s=8,o=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:s,closed:o};const r=e.computeFrenetFrames(t,o);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new _,l=new _,g=new ye;let c=new _;const u=[],C=[],h=[],p=[];b(),this.setIndex(p),this.setAttribute("position",new dt(u,3)),this.setAttribute("normal",new dt(C,3)),this.setAttribute("uv",new dt(h,2));function b(){for(let G=0;G<t;G++)m(G);m(o===!1?t:0),B(),A()}function m(G){c=e.getPointAt(G/t,c);const w=r.normals[G],N=r.binormals[G];for(let M=0;M<=s;M++){const R=M/s*Math.PI*2,S=Math.sin(R),F=-Math.cos(R);l.x=F*w.x+S*N.x,l.y=F*w.y+S*N.y,l.z=F*w.z+S*N.z,l.normalize(),C.push(l.x,l.y,l.z),a.x=c.x+i*l.x,a.y=c.y+i*l.y,a.z=c.z+i*l.z,u.push(a.x,a.y,a.z)}}function A(){for(let G=1;G<=t;G++)for(let w=1;w<=s;w++){const N=(s+1)*(G-1)+(w-1),M=(s+1)*G+(w-1),R=(s+1)*G+w,S=(s+1)*(G-1)+w;p.push(N,M,S),p.push(M,R,S)}}function B(){for(let G=0;G<=t;G++)for(let w=0;w<=s;w++)g.x=G/t,g.y=w/s,h.push(g.x,g.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Db(new y0[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class DT extends Mt{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,s=new _,o=new _;if(e.index!==null){const r=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let g=0,c=l.length;g<c;++g){const u=l[g],C=u.start,h=u.count;for(let p=C,b=C+h;p<b;p+=3)for(let m=0;m<3;m++){const A=a.getX(p+m),B=a.getX(p+(m+1)%3);s.fromBufferAttribute(r,A),o.fromBufferAttribute(r,B),gW(s,o,i)===!0&&(t.push(s.x,s.y,s.z),t.push(o.x,o.y,o.z))}}}else{const r=e.attributes.position;for(let a=0,l=r.count/3;a<l;a++)for(let g=0;g<3;g++){const c=3*a+g,u=3*a+(g+1)%3;s.fromBufferAttribute(r,c),o.fromBufferAttribute(r,u),gW(s,o,i)===!0&&(t.push(s.x,s.y,s.z),t.push(o.x,o.y,o.z))}}this.setAttribute("position",new dt(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function gW(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,s=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(s)===!0?!1:(t.add(i),t.add(s),!0)}var cW=Object.freeze({__proto__:null,BoxGeometry:iu,CapsuleGeometry:Nb,CircleGeometry:Fb,ConeGeometry:Hb,CylinderGeometry:Id,DodecahedronGeometry:Xb,EdgesGeometry:_T,ExtrudeGeometry:Eb,IcosahedronGeometry:Yb,LatheGeometry:cA,OctahedronGeometry:uA,PlaneGeometry:ad,PolyhedronGeometry:Cg,RingGeometry:Kb,ShapeGeometry:_b,SphereGeometry:IA,TetrahedronGeometry:Lb,TorusGeometry:kb,TorusKnotGeometry:zb,TubeGeometry:Db,WireframeGeometry:DT});class PT extends Un{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Pe(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class UT extends tr{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hg extends Un{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Pe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=dg,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Gs,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class oi extends hg{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ye(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ti(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Pe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Pe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Pe(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class JT extends Un{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Pe(16777215),this.specular=new Pe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=dg,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Gs,this.combine=tA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class OT extends Un{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Pe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=dg,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class QT extends Un{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=dg,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class jT extends Un{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Pe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Pe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=dg,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Gs,this.combine=tA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class qT extends Un{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Pe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=dg,this.normalScale=new ye(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $T extends ji{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function yc(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function eE(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function tE(n){function e(s,o){return n[s]-n[o]}const t=n.length,i=new Array(t);for(let s=0;s!==t;++s)i[s]=s;return i.sort(e),i}function Z2(n,e,t){const i=n.length,s=new n.constructor(i);for(let o=0,r=0;r!==i;++o){const a=t[o]*e;for(let l=0;l!==e;++l)s[r++]=n[a+l]}return s}function OZ(n,e,t,i){let s=1,o=n[0];for(;o!==void 0&&o[i]===void 0;)o=n[s++];if(o===void 0)return;let r=o[i];if(r!==void 0)if(Array.isArray(r))do r=o[i],r!==void 0&&(e.push(o.time),t.push.apply(t,r)),o=n[s++];while(o!==void 0);else if(r.toArray!==void 0)do r=o[i],r!==void 0&&(e.push(o.time),r.toArray(t,t.length)),o=n[s++];while(o!==void 0);else do r=o[i],r!==void 0&&(e.push(o.time),t.push(r)),o=n[s++];while(o!==void 0)}function g4(n,e,t,i,s=30){const o=n.clone();o.name=e;const r=[];for(let l=0;l<o.tracks.length;++l){const g=o.tracks[l],c=g.getValueSize(),u=[],C=[];for(let h=0;h<g.times.length;++h){const p=g.times[h]*s;if(!(p<t||p>=i)){u.push(g.times[h]);for(let b=0;b<c;++b)C.push(g.values[h*c+b])}}u.length!==0&&(g.times=yc(u,g.times.constructor),g.values=yc(C,g.values.constructor),r.push(g))}o.tracks=r;let a=1/0;for(let l=0;l<o.tracks.length;++l)a>o.tracks[l].times[0]&&(a=o.tracks[l].times[0]);for(let l=0;l<o.tracks.length;++l)o.tracks[l].shift(-1*a);return o.resetDuration(),o}function c4(n,e=0,t=n,i=30){i<=0&&(i=30);const s=t.tracks.length,o=e/i;for(let r=0;r<s;++r){const a=t.tracks[r],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const g=n.tracks.find(function(A){return A.name===a.name&&A.ValueTypeName===l});if(g===void 0)continue;let c=0;const u=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=u/3);let C=0;const h=g.getValueSize();g.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(C=h/3);const p=a.times.length-1;let b;if(o<=a.times[0]){const A=c,B=u-c;b=a.values.slice(A,B)}else if(o>=a.times[p]){const A=p*u+c,B=A+u-c;b=a.values.slice(A,B)}else{const A=a.createInterpolant(),B=c,G=u-c;A.evaluate(o),b=A.resultBuffer.slice(B,G)}l==="quaternion"&&new ii().fromArray(b).normalize().conjugate().toArray(b);const m=g.times.length;for(let A=0;A<m;++A){const B=A*h+C;if(l==="quaternion")ii.multiplyQuaternionsFlat(g.values,B,b,0,g.values,B);else{const G=h-C*2;for(let w=0;w<G;++w)g.values[B+w]-=b[w]}}}return n.blendMode=VZ,n}const u4={convertArray:yc,isTypedArray:eE,getKeyframeOrder:tE,sortedArray:Z2,flattenJSON:OZ,subclip:g4,makeClipAdditive:c4};class su{constructor(e,t,i,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,s=t[i],o=t[i-1];e:{t:{let r;n:{i:if(!(e<s)){for(let a=i+2;;){if(s===void 0){if(e<o)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(o=s,s=t[++i],e<s)break t}r=t.length;break n}if(!(e>=o)){const a=t[1];e<a&&(i=2,o=a);for(let l=i-2;;){if(o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(s=o,o=t[--i-1],e>=o)break t}r=i,i=0;break n}break e}for(;i<r;){const a=i+r>>>1;e<t[a]?r=a:i=a+1}if(s=t[i],o=t[i-1],o===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,o,s)}return this.interpolate_(i,o,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=e*s;for(let r=0;r!==s;++r)t[r]=i[o+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class nE extends su{constructor(e,t,i,s){super(e,t,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:mc,endingEnd:mc}}intervalChanged_(e,t,i){const s=this.parameterPositions;let o=e-2,r=e+1,a=s[o],l=s[r];if(a===void 0)switch(this.getSettings_().endingStart){case fc:o=e,a=2*t-i;break;case vh:o=s.length-2,a=t+s[o]-s[o+1];break;default:o=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case fc:r=e,l=2*i-t;break;case vh:r=1,l=i+s[1]-s[0];break;default:r=e-1,l=t}const g=(i-t)*.5,c=this.valueSize;this._weightPrev=g/(t-a),this._weightNext=g/(l-i),this._offsetPrev=o*c,this._offsetNext=r*c}interpolate_(e,t,i,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=e*a,g=l-a,c=this._offsetPrev,u=this._offsetNext,C=this._weightPrev,h=this._weightNext,p=(i-t)/(s-t),b=p*p,m=b*p,A=-C*m+2*C*b-C*p,B=(1+C)*m+(-1.5-2*C)*b+(-.5+C)*p+1,G=(-1-h)*m+(1.5+h)*b+.5*p,w=h*m-h*b;for(let N=0;N!==a;++N)o[N]=A*r[c+N]+B*r[g+N]+G*r[l+N]+w*r[u+N];return o}}class QZ extends su{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=e*a,g=l-a,c=(i-t)/(s-t),u=1-c;for(let C=0;C!==a;++C)o[C]=r[g+C]*u+r[l+C]*c;return o}}class iE extends su{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e){return this.copySampleValue_(e-1)}}class Fr{constructor(e,t,i,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=yc(t,this.TimeBufferType),this.values=yc(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:yc(e.times,Array),values:yc(e.values,Array)};const s=e.getInterpolation();s!==e.DefaultInterpolation&&(i.interpolation=s)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new iE(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new QZ(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nE(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Pc:t=this.InterpolantFactoryMethodDiscrete;break;case tg:t=this.InterpolantFactoryMethodLinear;break;case jm:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Pc;case this.InterpolantFactoryMethodLinear:return tg;case this.InterpolantFactoryMethodSmooth:return jm}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,s=t.length;i!==s;++i)t[i]*=e}return this}trim(e,t){const i=this.times,s=i.length;let o=0,r=s-1;for(;o!==s&&i[o]<e;)++o;for(;r!==-1&&i[r]>t;)--r;if(++r,o!==0||r!==s){o>=r&&(r=Math.max(r,1),o=r-1);const a=this.getValueSize();this.times=i.slice(o,r),this.values=this.values.slice(o*a,r*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,s=this.values,o=i.length;o===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let a=0;a!==o;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(r!==null&&r>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,r),e=!1;break}r=l}if(s!==void 0&&eE(s))for(let a=0,l=s.length;a!==l;++a){const g=s[a];if(isNaN(g)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,g),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===jm,o=e.length-1;let r=1;for(let a=1;a<o;++a){let l=!1;const g=e[a],c=e[a+1];if(g!==c&&(a!==1||g!==e[0]))if(s)l=!0;else{const u=a*i,C=u-i,h=u+i;for(let p=0;p!==i;++p){const b=t[u+p];if(b!==t[C+p]||b!==t[h+p]){l=!0;break}}}if(l){if(a!==r){e[r]=e[a];const u=a*i,C=r*i;for(let h=0;h!==i;++h)t[C+h]=t[u+h]}++r}}if(o>0){e[r]=e[o];for(let a=o*i,l=r*i,g=0;g!==i;++g)t[l+g]=t[a+g];++r}return r!==e.length?(this.times=e.slice(0,r),this.values=t.slice(0,r*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,s=new i(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}}Fr.prototype.TimeBufferType=Float32Array;Fr.prototype.ValueBufferType=Float32Array;Fr.prototype.DefaultInterpolation=tg;class ou extends Fr{constructor(e,t,i){super(e,t,i)}}ou.prototype.ValueTypeName="bool";ou.prototype.ValueBufferType=Array;ou.prototype.DefaultInterpolation=Pc;ou.prototype.InterpolantFactoryMethodLinear=void 0;ou.prototype.InterpolantFactoryMethodSmooth=void 0;class jZ extends Fr{}jZ.prototype.ValueTypeName="color";class qa extends Fr{}qa.prototype.ValueTypeName="number";class sE extends su{constructor(e,t,i,s){super(e,t,i,s)}interpolate_(e,t,i,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=(i-t)/(s-t);let g=e*a;for(let c=g+a;g!==c;g+=4)ii.slerpFlat(o,0,r,g-a,r,g,l);return o}}class $a extends Fr{InterpolantFactoryMethodLinear(e){return new sE(this.times,this.values,this.getValueSize(),e)}}$a.prototype.ValueTypeName="quaternion";$a.prototype.InterpolantFactoryMethodSmooth=void 0;class ru extends Fr{constructor(e,t,i){super(e,t,i)}}ru.prototype.ValueTypeName="string";ru.prototype.ValueBufferType=Array;ru.prototype.DefaultInterpolation=Pc;ru.prototype.InterpolantFactoryMethodLinear=void 0;ru.prototype.InterpolantFactoryMethodSmooth=void 0;class el extends Fr{}el.prototype.ValueTypeName="vector";class Oc{constructor(e="",t=-1,i=[],s=yb){this.name=e,this.tracks=i,this.duration=t,this.blendMode=s,this.uuid=Go(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,s=1/(e.fps||1);for(let r=0,a=i.length;r!==a;++r)t.push(d4(i[r]).scale(s));const o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}static toJSON(e){const t=[],i=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let o=0,r=i.length;o!==r;++o)t.push(Fr.toJSON(i[o]));return s}static CreateFromMorphTargetSequence(e,t,i,s){const o=t.length,r=[];for(let a=0;a<o;a++){let l=[],g=[];l.push((a+o-1)%o,a,(a+1)%o),g.push(0,1,0);const c=tE(l);l=Z2(l,1,c),g=Z2(g,1,c),!s&&l[0]===0&&(l.push(o),g.push(g[0])),r.push(new qa(".morphTargetInfluences["+t[a].name+"]",l,g).scale(1/i))}return new this(e,-1,r)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const s=e;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===t)return i[s];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const s={},o=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const g=e[a],c=g.name.match(o);if(c&&c.length>1){const u=c[1];let C=s[u];C||(s[u]=C=[]),C.push(g)}}const r=[];for(const a in s)r.push(this.CreateFromMorphTargetSequence(a,s[a],t,i));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(u,C,h,p,b){if(h.length!==0){const m=[],A=[];OZ(h,m,A,p),m.length!==0&&b.push(new u(C,m,A))}},s=[],o=e.name||"default",r=e.fps||30,a=e.blendMode;let l=e.length||-1;const g=e.hierarchy||[];for(let u=0;u<g.length;u++){const C=g[u].keys;if(!(!C||C.length===0))if(C[0].morphTargets){const h={};let p;for(p=0;p<C.length;p++)if(C[p].morphTargets)for(let b=0;b<C[p].morphTargets.length;b++)h[C[p].morphTargets[b]]=-1;for(const b in h){const m=[],A=[];for(let B=0;B!==C[p].morphTargets.length;++B){const G=C[p];m.push(G.time),A.push(G.morphTarget===b?1:0)}s.push(new qa(".morphTargetInfluence["+b+"]",m,A))}l=h.length*r}else{const h=".bones["+t[u].name+"]";i(el,h+".position",C,"pos",s),i($a,h+".quaternion",C,"rot",s),i(el,h+".scale",C,"scl",s)}}return s.length===0?null:new this(o,l,s,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,s=e.length;i!==s;++i){const o=this.tracks[i];t=Math.max(t,o.times[o.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function I4(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return qa;case"vector":case"vector2":case"vector3":case"vector4":return el;case"color":return jZ;case"quaternion":return $a;case"bool":case"boolean":return ou;case"string":return ru}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function d4(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=I4(n.type);if(n.times===void 0){const t=[],i=[];OZ(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const Na={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class qZ{constructor(e,t,i){const s=this;let o=!1,r=0,a=0,l;const g=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(c){a++,o===!1&&s.onStart!==void 0&&s.onStart(c,r,a),o=!0},this.itemEnd=function(c){r++,s.onProgress!==void 0&&s.onProgress(c,r,a),r===a&&(o=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(c){s.onError!==void 0&&s.onError(c)},this.resolveURL=function(c){return l?l(c):c},this.setURLModifier=function(c){return l=c,this},this.addHandler=function(c,u){return g.push(c,u),this},this.removeHandler=function(c){const u=g.indexOf(c);return u!==-1&&g.splice(u,2),this},this.getHandler=function(c){for(let u=0,C=g.length;u<C;u+=2){const h=g[u],p=g[u+1];if(h.global&&(h.lastIndex=0),h.test(c))return p}return null}}}const AI=new qZ;class qi{constructor(e){this.manager=e!==void 0?e:AI,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(s,o){i.load(e,s,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}qi.DEFAULT_MATERIAL_NAME="__DEFAULT";const va={};class C4 extends Error{constructor(e,t){super(e),this.response=t}}class Ks extends qi{constructor(e){super(e)}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=Na.get(e);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(va[e]!==void 0){va[e].push({onLoad:t,onProgress:i,onError:s});return}va[e]=[],va[e].push({onLoad:t,onProgress:i,onError:s});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(r).then(g=>{if(g.status===200||g.status===0){if(g.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||g.body===void 0||g.body.getReader===void 0)return g;const c=va[e],u=g.body.getReader(),C=g.headers.get("X-File-Size")||g.headers.get("Content-Length"),h=C?parseInt(C):0,p=h!==0;let b=0;const m=new ReadableStream({start(A){B();function B(){u.read().then(({done:G,value:w})=>{if(G)A.close();else{b+=w.byteLength;const N=new ProgressEvent("progress",{lengthComputable:p,loaded:b,total:h});for(let M=0,R=c.length;M<R;M++){const S=c[M];S.onProgress&&S.onProgress(N)}A.enqueue(w),B()}},G=>{A.error(G)})}}});return new Response(m)}else throw new C4(`fetch for "${g.url}" responded with ${g.status}: ${g.statusText}`,g)}).then(g=>{switch(l){case"arraybuffer":return g.arrayBuffer();case"blob":return g.blob();case"document":return g.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return g.json();default:if(a===void 0)return g.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),C=u&&u[1]?u[1].toLowerCase():void 0,h=new TextDecoder(C);return g.arrayBuffer().then(p=>h.decode(p))}}}).then(g=>{Na.add(e,g);const c=va[e];delete va[e];for(let u=0,C=c.length;u<C;u++){const h=c[u];h.onLoad&&h.onLoad(g)}}).catch(g=>{const c=va[e];if(c===void 0)throw this.manager.itemError(e),g;delete va[e];for(let u=0,C=c.length;u<C;u++){const h=c[u];h.onError&&h.onError(g)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class h4 extends qi{constructor(e){super(e)}load(e,t,i,s){const o=this,r=new Ks(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(a){try{t(o.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),o.manager.itemError(e)}},i,s)}parse(e){const t=[];for(let i=0;i<e.length;i++){const s=Oc.parse(e[i]);t.push(s)}return t}}class A4 extends qi{constructor(e){super(e)}load(e,t,i,s){const o=this,r=[],a=new Wb,l=new Ks(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(o.withCredentials);let g=0;function c(u){l.load(e[u],function(C){const h=o.parse(C,!0);r[u]={width:h.width,height:h.height,format:h.format,mipmaps:h.mipmaps},g+=1,g===6&&(h.mipmapCount===1&&(a.minFilter=fn),a.image=r,a.format=h.format,a.needsUpdate=!0,t&&t(a))},i,s)}if(Array.isArray(e))for(let u=0,C=e.length;u<C;++u)c(u);else l.load(e,function(u){const C=o.parse(u,!0);if(C.isCubemap){const h=C.mipmaps.length/C.mipmapCount;for(let p=0;p<h;p++){r[p]={mipmaps:[]};for(let b=0;b<C.mipmapCount;b++)r[p].mipmaps.push(C.mipmaps[p*C.mipmapCount+b]),r[p].format=C.format,r[p].width=C.width,r[p].height=C.height}a.image=r}else a.image.width=C.width,a.image.height=C.height,a.mipmaps=C.mipmaps;C.mipmapCount===1&&(a.minFilter=fn),a.format=C.format,a.needsUpdate=!0,t&&t(a)},i,s);return a}}class Xh extends qi{constructor(e){super(e)}load(e,t,i,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=Na.get(e);if(r!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(r),o.manager.itemEnd(e)},0),r;const a=Vh("img");function l(){c(),Na.add(e,this),t&&t(this),o.manager.itemEnd(e)}function g(u){c(),s&&s(u),o.manager.itemError(e),o.manager.itemEnd(e)}function c(){a.removeEventListener("load",l,!1),a.removeEventListener("error",g,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",g,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),o.manager.itemStart(e),a.src=e,a}}class p4 extends qi{constructor(e){super(e)}load(e,t,i,s){const o=new rA;o.colorSpace=Di;const r=new Xh(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let a=0;function l(g){r.load(e[g],function(c){o.images[g]=c,a++,a===6&&(o.needsUpdate=!0,t&&t(o))},void 0,s)}for(let g=0;g<e.length;++g)l(g);return o}}class m4 extends qi{constructor(e){super(e)}load(e,t,i,s){const o=this,r=new na,a=new Ks(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(o.withCredentials),a.load(e,function(l){let g;try{g=o.parse(l)}catch(c){if(s!==void 0)s(c);else{console.error(c);return}}g.image!==void 0?r.image=g.image:g.data!==void 0&&(r.image.width=g.width,r.image.height=g.height,r.image.data=g.data),r.wrapS=g.wrapS!==void 0?g.wrapS:to,r.wrapT=g.wrapT!==void 0?g.wrapT:to,r.magFilter=g.magFilter!==void 0?g.magFilter:fn,r.minFilter=g.minFilter!==void 0?g.minFilter:fn,r.anisotropy=g.anisotropy!==void 0?g.anisotropy:1,g.colorSpace!==void 0&&(r.colorSpace=g.colorSpace),g.flipY!==void 0&&(r.flipY=g.flipY),g.format!==void 0&&(r.format=g.format),g.type!==void 0&&(r.type=g.type),g.mipmaps!==void 0&&(r.mipmaps=g.mipmaps,r.minFilter=no),g.mipmapCount===1&&(r.minFilter=fn),g.generateMipmaps!==void 0&&(r.generateMipmaps=g.generateMipmaps),r.needsUpdate=!0,t&&t(r,g)},i,s),r}}class au extends qi{constructor(e){super(e)}load(e,t,i,s){const o=new Bn,r=new Xh(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,function(a){o.image=a,o.needsUpdate=!0,t!==void 0&&t(o)},i,s),o}}class Ag extends Lt{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Pe(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class oE extends Ag{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Lt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Pe(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const ZG=new ct,uW=new _,IW=new _;class $Z{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ye(512,512),this.map=null,this.mapPass=null,this.matrix=new ct,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new aA,this._frameExtents=new ye(1,1),this._viewportCount=1,this._viewports=[new rn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;uW.setFromMatrixPosition(e.matrixWorld),t.position.copy(uW),IW.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(IW),t.updateMatrixWorld(),ZG.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ZG),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(ZG)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class f4 extends $Z{constructor(){super(new Wn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=kI*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,o=e.distance||t.far;(i!==t.fov||s!==t.aspect||o!==t.far)&&(t.fov=i,t.aspect=s,t.far=o,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Pb extends Ag{constructor(e,t,i=0,s=Math.PI/3,o=0,r=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Lt.DEFAULT_UP),this.updateMatrix(),this.target=new Lt,this.distance=i,this.angle=s,this.penumbra=o,this.decay=r,this.map=null,this.shadow=new f4}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const dW=new ct,lC=new _,SG=new _;class b4 extends $Z{constructor(){super(new Wn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ye(4,2),this._viewportCount=6,this._viewports=[new rn(2,1,1,1),new rn(0,1,1,1),new rn(3,1,1,1),new rn(1,1,1,1),new rn(3,0,1,1),new rn(1,0,1,1)],this._cubeDirections=[new _(1,0,0),new _(-1,0,0),new _(0,0,1),new _(0,0,-1),new _(0,1,0),new _(0,-1,0)],this._cubeUps=[new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,1,0),new _(0,0,1),new _(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,s=this.matrix,o=e.distance||i.far;o!==i.far&&(i.far=o,i.updateProjectionMatrix()),lC.setFromMatrixPosition(e.matrixWorld),i.position.copy(lC),SG.copy(i.position),SG.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(SG),i.updateMatrixWorld(),s.makeTranslation(-lC.x,-lC.y,-lC.z),dW.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dW)}}class Ub extends Ag{constructor(e,t,i=0,s=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new b4}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class y4 extends $Z{constructor(){super(new qo(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Jb extends Ag{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Lt.DEFAULT_UP),this.updateMatrix(),this.target=new Lt,this.shadow=new y4}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class rE extends Ag{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class aE extends Ag{constructor(e,t,i=10,s=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class lE{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new _)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,s=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*s),t.addScaledVector(r[2],.488603*o),t.addScaledVector(r[3],.488603*i),t.addScaledVector(r[4],1.092548*(i*s)),t.addScaledVector(r[5],1.092548*(s*o)),t.addScaledVector(r[6],.315392*(3*o*o-1)),t.addScaledVector(r[7],1.092548*(i*o)),t.addScaledVector(r[8],.546274*(i*i-s*s)),t}getIrradianceAt(e,t){const i=e.x,s=e.y,o=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],2*.511664*s),t.addScaledVector(r[2],2*.511664*o),t.addScaledVector(r[3],2*.511664*i),t.addScaledVector(r[4],2*.429043*i*s),t.addScaledVector(r[5],2*.429043*s*o),t.addScaledVector(r[6],.743125*o*o-.247708),t.addScaledVector(r[7],2*.429043*i*o),t.addScaledVector(r[8],.429043*(i*i-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let s=0;s<9;s++)i[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){const i=e.x,s=e.y,o=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*o,t[3]=.488603*i,t[4]=1.092548*i*s,t[5]=1.092548*s*o,t[6]=.315392*(3*o*o-1),t[7]=1.092548*i*o,t[8]=.546274*(i*i-s*s)}}class gE extends Ag{constructor(e=new lE,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class Ob extends qi{constructor(e){super(e),this.textures={}}load(e,t,i,s){const o=this,r=new Ks(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,function(a){try{t(o.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),o.manager.itemError(e)}},i,s)}parse(e){const t=this.textures;function i(o){return t[o]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",o),t[o]}const s=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(s.uuid=e.uuid),e.name!==void 0&&(s.name=e.name),e.color!==void 0&&s.color!==void 0&&s.color.setHex(e.color),e.roughness!==void 0&&(s.roughness=e.roughness),e.metalness!==void 0&&(s.metalness=e.metalness),e.sheen!==void 0&&(s.sheen=e.sheen),e.sheenColor!==void 0&&(s.sheenColor=new Pe().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(s.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&s.emissive!==void 0&&s.emissive.setHex(e.emissive),e.specular!==void 0&&s.specular!==void 0&&s.specular.setHex(e.specular),e.specularIntensity!==void 0&&(s.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&s.specularColor!==void 0&&s.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(s.shininess=e.shininess),e.clearcoat!==void 0&&(s.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(s.dispersion=e.dispersion),e.iridescence!==void 0&&(s.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(s.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(s.transmission=e.transmission),e.thickness!==void 0&&(s.thickness=e.thickness),e.attenuationDistance!==void 0&&(s.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&s.attenuationColor!==void 0&&s.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(s.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(s.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(s.fog=e.fog),e.flatShading!==void 0&&(s.flatShading=e.flatShading),e.blending!==void 0&&(s.blending=e.blending),e.combine!==void 0&&(s.combine=e.combine),e.side!==void 0&&(s.side=e.side),e.shadowSide!==void 0&&(s.shadowSide=e.shadowSide),e.opacity!==void 0&&(s.opacity=e.opacity),e.transparent!==void 0&&(s.transparent=e.transparent),e.alphaTest!==void 0&&(s.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(s.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(s.depthFunc=e.depthFunc),e.depthTest!==void 0&&(s.depthTest=e.depthTest),e.depthWrite!==void 0&&(s.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(s.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(s.blendSrc=e.blendSrc),e.blendDst!==void 0&&(s.blendDst=e.blendDst),e.blendEquation!==void 0&&(s.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(s.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(s.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(s.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&s.blendColor!==void 0&&s.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(s.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(s.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(s.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(s.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(s.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(s.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(s.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(s.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(s.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(s.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(s.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(s.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(s.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(s.rotation=e.rotation),e.linewidth!==void 0&&(s.linewidth=e.linewidth),e.dashSize!==void 0&&(s.dashSize=e.dashSize),e.gapSize!==void 0&&(s.gapSize=e.gapSize),e.scale!==void 0&&(s.scale=e.scale),e.polygonOffset!==void 0&&(s.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(s.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(s.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(s.dithering=e.dithering),e.alphaToCoverage!==void 0&&(s.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(s.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(s.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(s.visible=e.visible),e.toneMapped!==void 0&&(s.toneMapped=e.toneMapped),e.userData!==void 0&&(s.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?s.vertexColors=e.vertexColors>0:s.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const o in e.uniforms){const r=e.uniforms[o];switch(s.uniforms[o]={},r.type){case"t":s.uniforms[o].value=i(r.value);break;case"c":s.uniforms[o].value=new Pe().setHex(r.value);break;case"v2":s.uniforms[o].value=new ye().fromArray(r.value);break;case"v3":s.uniforms[o].value=new _().fromArray(r.value);break;case"v4":s.uniforms[o].value=new rn().fromArray(r.value);break;case"m3":s.uniforms[o].value=new Et().fromArray(r.value);break;case"m4":s.uniforms[o].value=new ct().fromArray(r.value);break;default:s.uniforms[o].value=r.value}}if(e.defines!==void 0&&(s.defines=e.defines),e.vertexShader!==void 0&&(s.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(s.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(s.glslVersion=e.glslVersion),e.extensions!==void 0)for(const o in e.extensions)s.extensions[o]=e.extensions[o];if(e.lights!==void 0&&(s.lights=e.lights),e.clipping!==void 0&&(s.clipping=e.clipping),e.size!==void 0&&(s.size=e.size),e.sizeAttenuation!==void 0&&(s.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(s.map=i(e.map)),e.matcap!==void 0&&(s.matcap=i(e.matcap)),e.alphaMap!==void 0&&(s.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(s.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(s.bumpScale=e.bumpScale),e.normalMap!==void 0&&(s.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(s.normalMapType=e.normalMapType),e.normalScale!==void 0){let o=e.normalScale;Array.isArray(o)===!1&&(o=[o,o]),s.normalScale=new ye().fromArray(o)}return e.displacementMap!==void 0&&(s.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(s.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(s.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(s.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(s.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(s.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(s.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(s.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(s.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(s.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(s.envMap=i(e.envMap)),e.envMapRotation!==void 0&&s.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(s.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(s.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(s.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(s.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(s.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(s.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(s.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(s.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(s.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(s.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(s.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(s.clearcoatNormalScale=new ye().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(s.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(s.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(s.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(s.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(s.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(s.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(s.sheenRoughnessMap=i(e.sheenRoughnessMap)),s}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return Ob.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:PT,SpriteMaterial:LZ,RawShaderMaterial:UT,ShaderMaterial:tr,PointsMaterial:ud,MeshPhysicalMaterial:oi,MeshStandardMaterial:hg,MeshPhongMaterial:JT,MeshToonMaterial:OT,MeshNormalMaterial:QT,MeshLambertMaterial:jT,MeshDepthMaterial:KZ,MeshDistanceMaterial:_Z,MeshBasicMaterial:Hi,MeshMatcapMaterial:qT,LineDashedMaterial:$T,LineBasicMaterial:ji,Material:Un};return new t[e]}}class vo{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class cE extends Mt{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class uE extends qi{constructor(e){super(e)}load(e,t,i,s){const o=this,r=new Ks(o.manager);r.setPath(o.path),r.setRequestHeader(o.requestHeader),r.setWithCredentials(o.withCredentials),r.load(e,function(a){try{t(o.parse(JSON.parse(a)))}catch(l){s?s(l):console.error(l),o.manager.itemError(e)}},i,s)}parse(e){const t={},i={};function s(h,p){if(t[p]!==void 0)return t[p];const m=h.interleavedBuffers[p],A=o(h,m.buffer),B=dI(m.type,A),G=new gd(B,m.stride);return G.uuid=m.uuid,t[p]=G,G}function o(h,p){if(i[p]!==void 0)return i[p];const m=h.arrayBuffers[p],A=new Uint32Array(m).buffer;return i[p]=A,A}const r=e.isInstancedBufferGeometry?new cE:new Mt,a=e.data.index;if(a!==void 0){const h=dI(a.type,a.array);r.setIndex(new Pt(h,1))}const l=e.data.attributes;for(const h in l){const p=l[h];let b;if(p.isInterleavedBufferAttribute){const m=s(e.data,p.data);b=new ja(m,p.itemSize,p.offset,p.normalized)}else{const m=dI(p.type,p.array),A=p.isInstancedBufferAttribute?ng:Pt;b=new A(m,p.itemSize,p.normalized)}p.name!==void 0&&(b.name=p.name),p.usage!==void 0&&b.setUsage(p.usage),r.setAttribute(h,b)}const g=e.data.morphAttributes;if(g)for(const h in g){const p=g[h],b=[];for(let m=0,A=p.length;m<A;m++){const B=p[m];let G;if(B.isInterleavedBufferAttribute){const w=s(e.data,B.data);G=new ja(w,B.itemSize,B.offset,B.normalized)}else{const w=dI(B.type,B.array);G=new Pt(w,B.itemSize,B.normalized)}B.name!==void 0&&(G.name=B.name),b.push(G)}r.morphAttributes[h]=b}e.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const u=e.data.groups||e.data.drawcalls||e.data.offsets;if(u!==void 0)for(let h=0,p=u.length;h!==p;++h){const b=u[h];r.addGroup(b.start,b.count,b.materialIndex)}const C=e.data.boundingSphere;if(C!==void 0){const h=new _;C.center!==void 0&&h.fromArray(C.center),r.boundingSphere=new Ti(h,C.radius)}return e.name&&(r.name=e.name),e.userData&&(r.userData=e.userData),r}}class B4 extends qi{constructor(e){super(e)}load(e,t,i,s){const o=this,r=this.path===""?vo.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const a=new Ks(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let g=null;try{g=JSON.parse(l)}catch(u){s!==void 0&&s(u),console.error("THREE:ObjectLoader: Can't parse "+e+".",u.message);return}const c=g.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry"){s!==void 0&&s(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}o.parse(g,t)},i,s)}async loadAsync(e,t){const i=this,s=this.path===""?vo.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const o=new Ks(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials);const r=await o.loadAsync(e,t),a=JSON.parse(r),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),s=this.parseShapes(e.shapes),o=this.parseGeometries(e.geometries,s),r=this.parseImages(e.images,function(){t!==void 0&&t(g)}),a=this.parseTextures(e.textures,r),l=this.parseMaterials(e.materials,a),g=this.parseObject(e.object,o,l,a,i),c=this.parseSkeletons(e.skeletons,g);if(this.bindSkeletons(g,c),this.bindLightTargets(g),t!==void 0){let u=!1;for(const C in r)if(r[C].data instanceof HTMLImageElement){u=!0;break}u===!1&&t(g)}return g}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),o=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,r),l=this.parseObject(e.object,s,a,r,t),g=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,g),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,s=e.length;i<s;i++){const o=new Mc().fromJSON(e[i]);t[o.uuid]=o}return t}parseSkeletons(e,t){const i={},s={};if(t.traverse(function(o){o.isBone&&(s[o.uuid]=o)}),e!==void 0)for(let o=0,r=e.length;o<r;o++){const a=new cd().fromJSON(e[o],s);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const s=new uE;for(let o=0,r=e.length;o<r;o++){let a;const l=e[o];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=s.parse(l);break;default:l.type in cW?a=cW[l.type].fromJSON(l,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},s={};if(e!==void 0){const o=new Ob;o.setTextures(t);for(let r=0,a=e.length;r<a;r++){const l=e[r];i[l.uuid]===void 0&&(i[l.uuid]=o.parse(l)),s[l.uuid]=i[l.uuid]}}return s}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const s=e[i],o=Oc.parse(s);t[o.uuid]=o}return t}parseImages(e,t){const i=this,s={};let o;function r(l){return i.manager.itemStart(l),o.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const g=l,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(g)?g:i.resourcePath+g;return r(c)}else return l.data?{data:dI(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new qZ(t);o=new Xh(l),o.setCrossOrigin(this.crossOrigin);for(let g=0,c=e.length;g<c;g++){const u=e[g],C=u.url;if(Array.isArray(C)){const h=[];for(let p=0,b=C.length;p<b;p++){const m=C[p],A=a(m);A!==null&&(A instanceof HTMLImageElement?h.push(A):h.push(new na(A.data,A.width,A.height)))}s[u.uuid]=new bc(h)}else{const h=a(u.url);s[u.uuid]=new bc(h)}}}return s}async parseImagesAsync(e){const t=this,i={};let s;async function o(r){if(typeof r=="string"){const a=r,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await s.loadAsync(l)}else return r.data?{data:dI(r.type,r.data),width:r.width,height:r.height}:null}if(e!==void 0&&e.length>0){s=new Xh(this.manager),s.setCrossOrigin(this.crossOrigin);for(let r=0,a=e.length;r<a;r++){const l=e[r],g=l.url;if(Array.isArray(g)){const c=[];for(let u=0,C=g.length;u<C;u++){const h=g[u],p=await o(h);p!==null&&(p instanceof HTMLImageElement?c.push(p):c.push(new na(p.data,p.width,p.height)))}i[l.uuid]=new bc(c)}else{const c=await o(l.url);i[l.uuid]=new bc(c)}}}return i}parseTextures(e,t){function i(o,r){return typeof o=="number"?o:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",o),r[o])}const s={};if(e!==void 0)for(let o=0,r=e.length;o<r;o++){const a=e[o];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=t[a.image],g=l.data;let c;Array.isArray(g)?(c=new rA,g.length===6&&(c.needsUpdate=!0)):(g&&g.data?c=new na:c=new Bn,g&&(c.needsUpdate=!0)),c.source=l,c.uuid=a.uuid,a.name!==void 0&&(c.name=a.name),a.mapping!==void 0&&(c.mapping=i(a.mapping,G4)),a.channel!==void 0&&(c.channel=a.channel),a.offset!==void 0&&c.offset.fromArray(a.offset),a.repeat!==void 0&&c.repeat.fromArray(a.repeat),a.center!==void 0&&c.center.fromArray(a.center),a.rotation!==void 0&&(c.rotation=a.rotation),a.wrap!==void 0&&(c.wrapS=i(a.wrap[0],CW),c.wrapT=i(a.wrap[1],CW)),a.format!==void 0&&(c.format=a.format),a.internalFormat!==void 0&&(c.internalFormat=a.internalFormat),a.type!==void 0&&(c.type=a.type),a.colorSpace!==void 0&&(c.colorSpace=a.colorSpace),a.minFilter!==void 0&&(c.minFilter=i(a.minFilter,hW)),a.magFilter!==void 0&&(c.magFilter=i(a.magFilter,hW)),a.anisotropy!==void 0&&(c.anisotropy=a.anisotropy),a.flipY!==void 0&&(c.flipY=a.flipY),a.generateMipmaps!==void 0&&(c.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(c.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(c.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(c.compareFunction=a.compareFunction),a.userData!==void 0&&(c.userData=a.userData),s[a.uuid]=c}return s}parseObject(e,t,i,s,o){let r;function a(C){return t[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",C),t[C]}function l(C){if(C!==void 0){if(Array.isArray(C)){const h=[];for(let p=0,b=C.length;p<b;p++){const m=C[p];i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),h.push(i[m])}return h}return i[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",C),i[C]}}function g(C){return s[C]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",C),s[C]}let c,u;switch(e.type){case"Scene":r=new Wh,e.background!==void 0&&(Number.isInteger(e.background)?r.background=new Pe(e.background):r.background=g(e.background)),e.environment!==void 0&&(r.environment=g(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?r.fog=new Sb(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(r.fog=new Zb(e.fog.color,e.fog.density)),e.fog.name!==""&&(r.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(r.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&r.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(r.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&r.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":r=new Wn(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(r.focus=e.focus),e.zoom!==void 0&&(r.zoom=e.zoom),e.filmGauge!==void 0&&(r.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(r.filmOffset=e.filmOffset),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new qo(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(r.zoom=e.zoom),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new rE(e.color,e.intensity);break;case"DirectionalLight":r=new Jb(e.color,e.intensity),r.target=e.target||"";break;case"PointLight":r=new Ub(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new aE(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Pb(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),r.target=e.target||"";break;case"HemisphereLight":r=new oE(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=new gE().fromJSON(e);break;case"SkinnedMesh":c=a(e.geometry),u=l(e.material),r=new Rb(c,u),e.bindMode!==void 0&&(r.bindMode=e.bindMode),e.bindMatrix!==void 0&&r.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(r.skeleton=e.skeleton);break;case"Mesh":c=a(e.geometry),u=l(e.material),r=new _n(c,u);break;case"InstancedMesh":c=a(e.geometry),u=l(e.material);const C=e.count,h=e.instanceMatrix,p=e.instanceColor;r=new Jl(c,u,C),r.instanceMatrix=new ng(new Float32Array(h.array),16),p!==void 0&&(r.instanceColor=new ng(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":c=a(e.geometry),u=l(e.material),r=new HT(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,u),r.geometry=c,r.perObjectFrustumCulled=e.perObjectFrustumCulled,r.sortObjects=e.sortObjects,r._drawRanges=e.drawRanges,r._reservedRanges=e.reservedRanges,r._visibility=e.visibility,r._active=e.active,r._bounds=e.bounds.map(b=>{const m=new Ji;m.min.fromArray(b.boxMin),m.max.fromArray(b.boxMax);const A=new Ti;return A.radius=b.sphereRadius,A.center.fromArray(b.sphereCenter),{boxInitialized:b.boxInitialized,box:m,sphereInitialized:b.sphereInitialized,sphere:A}}),r._maxInstanceCount=e.maxInstanceCount,r._maxVertexCount=e.maxVertexCount,r._maxIndexCount=e.maxIndexCount,r._geometryInitialized=e.geometryInitialized,r._geometryCount=e.geometryCount,r._matricesTexture=g(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(r._colorsTexture=g(e.colorsTexture.uuid));break;case"LOD":r=new FT;break;case"Line":r=new ra(a(e.geometry),l(e.material));break;case"LineLoop":r=new xb(a(e.geometry),l(e.material));break;case"LineSegments":r=new ir(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":r=new Vb(a(e.geometry),l(e.material));break;case"Sprite":r=new NT(l(e.material));break;case"Group":r=new Qo;break;case"Bone":r=new gA;break;default:r=new Lt}if(r.uuid=e.uuid,e.name!==void 0&&(r.name=e.name),e.matrix!==void 0?(r.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(e.position!==void 0&&r.position.fromArray(e.position),e.rotation!==void 0&&r.rotation.fromArray(e.rotation),e.quaternion!==void 0&&r.quaternion.fromArray(e.quaternion),e.scale!==void 0&&r.scale.fromArray(e.scale)),e.up!==void 0&&r.up.fromArray(e.up),e.castShadow!==void 0&&(r.castShadow=e.castShadow),e.receiveShadow!==void 0&&(r.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(r.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(r.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(r.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(r.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(r.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(r.visible=e.visible),e.frustumCulled!==void 0&&(r.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(r.renderOrder=e.renderOrder),e.userData!==void 0&&(r.userData=e.userData),e.layers!==void 0&&(r.layers.mask=e.layers),e.children!==void 0){const C=e.children;for(let h=0;h<C.length;h++)r.add(this.parseObject(C[h],t,i,s,o))}if(e.animations!==void 0){const C=e.animations;for(let h=0;h<C.length;h++){const p=C[h];r.animations.push(o[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(r.autoUpdate=e.autoUpdate);const C=e.levels;for(let h=0;h<C.length;h++){const p=C[h],b=r.getObjectByProperty("uuid",p.object);b!==void 0&&r.addLevel(b,p.distance,p.hysteresis)}}return r}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const s=t[i.skeleton];s===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(s,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,s=e.getObjectByProperty("uuid",i);s!==void 0?t.target=s:t.target=new Lt}})}}const G4={UVMapping:Cb,CubeReflectionMapping:Oa,CubeRefractionMapping:eg,EquirectangularReflectionMapping:Bh,EquirectangularRefractionMapping:Gh,CubeUVReflectionMapping:od},CW={RepeatWrapping:xr,ClampToEdgeWrapping:to,MirroredRepeatWrapping:Lc},hW={NearestFilter:Bi,NearestMipmapNearestFilter:nA,NearestMipmapLinearFilter:Tl,LinearFilter:fn,LinearMipmapNearestFilter:xc,LinearMipmapLinearFilter:no};class eS extends qi{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,r=Na.get(e);if(r!==void 0){if(o.manager.itemStart(e),r.then){r.then(g=>{t&&t(g),o.manager.itemEnd(e)}).catch(g=>{s&&s(g)});return}return setTimeout(function(){t&&t(r),o.manager.itemEnd(e)},0),r}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const l=fetch(e,a).then(function(g){return g.blob()}).then(function(g){return createImageBitmap(g,Object.assign(o.options,{colorSpaceConversion:"none"}))}).then(function(g){return Na.add(e,g),t&&t(g),o.manager.itemEnd(e),g}).catch(function(g){s&&s(g),Na.remove(e),o.manager.itemError(e),o.manager.itemEnd(e)});Na.add(e,l),o.manager.itemStart(e)}}let gm;class tS{static getContext(){return gm===void 0&&(gm=new(window.AudioContext||window.webkitAudioContext)),gm}static setContext(e){gm=e}}class v4 extends qi{constructor(e){super(e)}load(e,t,i,s){const o=this,r=new Ks(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(l){try{const g=l.slice(0);tS.getContext().decodeAudioData(g,function(u){t(u)}).catch(a)}catch(g){a(g)}},i,s);function a(l){s?s(l):console.error(l),o.manager.itemError(e)}}}const AW=new ct,pW=new ct,Ug=new ct;class w4{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Wn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Wn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ug.copy(e.projectionMatrix);const s=t.eyeSep/2,o=s*t.near/t.focus,r=t.near*Math.tan(Vc*t.fov*.5)/t.zoom;let a,l;pW.elements[12]=-s,AW.elements[12]=s,a=-r*t.aspect+o,l=r*t.aspect+o,Ug.elements[0]=2*t.near/(l-a),Ug.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Ug),a=-r*t.aspect-o,l=r*t.aspect-o,Ug.elements[0]=2*t.near/(l-a),Ug.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Ug)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(pW),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(AW)}}class nS{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=mW(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=mW();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function mW(){return performance.now()}const Jg=new _,fW=new ii,Z4=new _,Og=new _;class S4 extends Lt{constructor(){super(),this.type="AudioListener",this.context=tS.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new nS}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Jg,fW,Z4),Og.set(0,0,-1).applyQuaternion(fW),t.positionX){const s=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Jg.x,s),t.positionY.linearRampToValueAtTime(Jg.y,s),t.positionZ.linearRampToValueAtTime(Jg.z,s),t.forwardX.linearRampToValueAtTime(Og.x,s),t.forwardY.linearRampToValueAtTime(Og.y,s),t.forwardZ.linearRampToValueAtTime(Og.z,s),t.upX.linearRampToValueAtTime(i.x,s),t.upY.linearRampToValueAtTime(i.y,s),t.upZ.linearRampToValueAtTime(i.z,s)}else t.setPosition(Jg.x,Jg.y,Jg.z),t.setOrientation(Og.x,Og.y,Og.z,i.x,i.y,i.z)}}class IE extends Lt{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Qg=new _,bW=new ii,R4=new _,jg=new _;class x4 extends IE{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Qg,bW,R4),jg.set(0,0,1).applyQuaternion(bW);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Qg.x,i),t.positionY.linearRampToValueAtTime(Qg.y,i),t.positionZ.linearRampToValueAtTime(Qg.z,i),t.orientationX.linearRampToValueAtTime(jg.x,i),t.orientationY.linearRampToValueAtTime(jg.y,i),t.orientationZ.linearRampToValueAtTime(jg.z,i)}else t.setPosition(Qg.x,Qg.y,Qg.z),t.setOrientation(jg.x,jg.y,jg.z)}}class V4{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class dE{constructor(e,t,i){this.binding=e,this.valueSize=i;let s,o,r;switch(t){case"quaternion":s=this._slerp,o=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":s=this._select,o=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:s=this._lerp,o=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=o,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,s=this.valueSize,o=e*s+s;let r=this.cumulativeWeight;if(r===0){for(let a=0;a!==s;++a)i[o+a]=i[a];r=t}else{r+=t;const a=t/r;this._mixBufferRegion(i,o,0,a,s)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,s=e*t+t,o=this.cumulativeWeight,r=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const l=t*this._origIndex;this._mixBufferRegion(i,s,l,1-o,t)}r>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*t,1,t);for(let l=t,g=t+t;l!==g;++l)if(i[l]!==i[l+t]){a.setValue(i,s);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,s=i*this._origIndex;e.getValue(t,s);for(let o=i,r=s;o!==r;++o)t[o]=t[s+o%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,s,o){if(s>=.5)for(let r=0;r!==o;++r)e[t+r]=e[i+r]}_slerp(e,t,i,s){ii.slerpFlat(e,t,e,t,e,i,s)}_slerpAdditive(e,t,i,s,o){const r=this._workIndex*o;ii.multiplyQuaternionsFlat(e,r,e,t,e,i),ii.slerpFlat(e,t,e,t,e,r,s)}_lerp(e,t,i,s,o){const r=1-s;for(let a=0;a!==o;++a){const l=t+a;e[l]=e[l]*r+e[i+a]*s}}_lerpAdditive(e,t,i,s,o){for(let r=0;r!==o;++r){const a=t+r;e[a]=e[a]+e[i+r]*s}}}const iS="\\[\\]\\.:\\/",W4=new RegExp("["+iS+"]","g"),sS="[^"+iS+"]",M4="[^"+iS.replace("\\.","")+"]",N4=/((?:WC+[\/:])*)/.source.replace("WC",sS),F4=/(WCOD+)?/.source.replace("WCOD",M4),H4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",sS),X4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",sS),T4=new RegExp("^"+N4+F4+H4+X4+"$"),E4=["material","materials","bones","map"];class Y4{constructor(e,t,i){const s=i||on.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,s=this._bindings[i];s!==void 0&&s.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let s=this._targetGroup.nCachedObjects_,o=i.length;s!==o;++s)i[s].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class on{constructor(e,t,i){this.path=t,this.parsedPath=i||on.parseTrackName(t),this.node=on.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new on.Composite(e,t,i):new on(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(W4,"")}static parseTrackName(e){const t=T4.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const o=i.nodeName.substring(s+1);E4.indexOf(o)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=o)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(o){for(let r=0;r<o.length;r++){const a=o[r];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},s=i(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)e[t++]=i[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,s=t.propertyName;let o=t.propertyIndex;if(e||(e=on.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let g=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let c=0;c<e.length;c++)if(e[c].name===g){g=c;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(g!==void 0){if(e[g]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[g]}}const r=e[s];if(r===void 0){const g=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+g+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(o!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[o]!==void 0&&(o=e.morphTargetDictionary[o])}l=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=o}else r.fromArray!==void 0&&r.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(l=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=s;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}on.Composite=Y4;on.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};on.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};on.prototype.GetterByBindingType=[on.prototype._getValue_direct,on.prototype._getValue_array,on.prototype._getValue_arrayElement,on.prototype._getValue_toArray];on.prototype.SetterByBindingTypeAndVersioning=[[on.prototype._setValue_direct,on.prototype._setValue_direct_setNeedsUpdate,on.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[on.prototype._setValue_array,on.prototype._setValue_array_setNeedsUpdate,on.prototype._setValue_array_setMatrixWorldNeedsUpdate],[on.prototype._setValue_arrayElement,on.prototype._setValue_arrayElement_setNeedsUpdate,on.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[on.prototype._setValue_fromArray,on.prototype._setValue_fromArray_setNeedsUpdate,on.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class K4{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Go(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,s=arguments.length;i!==s;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,s=this._parsedPaths,o=this._bindings,r=o.length;let a,l=e.length,g=this.nCachedObjects_;for(let c=0,u=arguments.length;c!==u;++c){const C=arguments[c],h=C.uuid;let p=t[h];if(p===void 0){p=l++,t[h]=p,e.push(C);for(let b=0,m=r;b!==m;++b)o[b].push(new on(C,i[b],s[b]))}else if(p<g){a=e[p];const b=--g,m=e[b];t[m.uuid]=p,e[p]=m,t[h]=b,e[b]=C;for(let A=0,B=r;A!==B;++A){const G=o[A],w=G[b];let N=G[p];G[p]=w,N===void 0&&(N=new on(C,i[A],s[A])),G[b]=N}}else e[p]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=g}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let o=this.nCachedObjects_;for(let r=0,a=arguments.length;r!==a;++r){const l=arguments[r],g=l.uuid,c=t[g];if(c!==void 0&&c>=o){const u=o++,C=e[u];t[C.uuid]=c,e[c]=C,t[g]=u,e[u]=l;for(let h=0,p=s;h!==p;++h){const b=i[h],m=b[u],A=b[c];b[c]=m,b[u]=A}}}this.nCachedObjects_=o}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,s=i.length;let o=this.nCachedObjects_,r=e.length;for(let a=0,l=arguments.length;a!==l;++a){const g=arguments[a],c=g.uuid,u=t[c];if(u!==void 0)if(delete t[c],u<o){const C=--o,h=e[C],p=--r,b=e[p];t[h.uuid]=u,e[u]=h,t[b.uuid]=C,e[C]=b,e.pop();for(let m=0,A=s;m!==A;++m){const B=i[m],G=B[C],w=B[p];B[u]=G,B[C]=w,B.pop()}}else{const C=--r,h=e[C];C>0&&(t[h.uuid]=u),e[u]=h,e.pop();for(let p=0,b=s;p!==b;++p){const m=i[p];m[u]=m[C],m.pop()}}}this.nCachedObjects_=o}subscribe_(e,t){const i=this._bindingsIndicesByPath;let s=i[e];const o=this._bindings;if(s!==void 0)return o[s];const r=this._paths,a=this._parsedPaths,l=this._objects,g=l.length,c=this.nCachedObjects_,u=new Array(g);s=o.length,i[e]=s,r.push(e),a.push(t),o.push(u);for(let C=c,h=l.length;C!==h;++C){const p=l[C];u[C]=new on(p,e,t)}return u}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const s=this._paths,o=this._parsedPaths,r=this._bindings,a=r.length-1,l=r[a],g=e[a];t[g]=i,r[i]=l,r.pop(),o[i]=o[a],o.pop(),s[i]=s[a],s.pop()}}}class CE{constructor(e,t,i=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=s;const o=t.tracks,r=o.length,a=new Array(r),l={endingStart:mc,endingEnd:mc};for(let g=0;g!==r;++g){const c=o[g].createInterpolant(null);a[g]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=oT,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const s=this._clip.duration,o=e._clip.duration,r=o/s,a=s/o;e.warp(1,r,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const s=this._mixer,o=s.time,r=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,g=a.sampleValues;return l[0]=o,l[1]=o+i,g[0]=e/r,g[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,s){if(!this.enabled){this._updateWeight(e);return}const o=this._startTime;if(o!==null){const l=(e-o)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const r=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,g=this._propertyBindings;switch(this.blendMode){case VZ:for(let c=0,u=l.length;c!==u;++c)l[c].evaluate(r),g[c].accumulateAdditive(a);break;case yb:default:for(let c=0,u=l.length;c!==u;++c)l[c].evaluate(r),g[c].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const s=i.evaluate(e)[0];t*=s,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let s=this.time+e,o=this._loopCount;const r=i===rT;if(e===0)return o===-1?s:r&&(o&1)===1?t-s:s;if(i===sT){o===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(o===-1&&(e>=0?(o=0,this._setEndings(!0,this.repetitions===0,r)):this._setEndings(this.repetitions===0,!0,r)),s>=t||s<0){const a=Math.floor(s/t);s-=t*a,o+=Math.abs(a);const l=this.repetitions-o;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const g=e<0;this._setEndings(g,!g,r)}else this._setEndings(!1,!1,r);this._loopCount=o,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(r&&(o&1)===1)return t-s}return s}_setEndings(e,t,i){const s=this._interpolantSettings;i?(s.endingStart=fc,s.endingEnd=fc):(e?s.endingStart=this.zeroSlopeAtStart?fc:mc:s.endingStart=vh,t?s.endingEnd=this.zeroSlopeAtEnd?fc:mc:s.endingEnd=vh)}_scheduleFading(e,t,i){const s=this._mixer,o=s.time;let r=this._weightInterpolant;r===null&&(r=s._lendControlInterpolant(),this._weightInterpolant=r);const a=r.parameterPositions,l=r.sampleValues;return a[0]=o,l[0]=t,a[1]=o+e,l[1]=i,this}}const _4=new Float32Array(1);class L4 extends Mr{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,s=e._clip.tracks,o=s.length,r=e._propertyBindings,a=e._interpolants,l=i.uuid,g=this._bindingsByRootAndName;let c=g[l];c===void 0&&(c={},g[l]=c);for(let u=0;u!==o;++u){const C=s[u],h=C.name;let p=c[h];if(p!==void 0)++p.referenceCount,r[u]=p;else{if(p=r[u],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,h));continue}const b=t&&t._propertyBindings[u].binding.parsedPath;p=new dE(on.create(i,h,b),C.ValueTypeName,C.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,h),r[u]=p}a[u].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,s=e._clip.uuid,o=this._actionsByClip[s];this._bindAction(e,o&&o.knownActions[0]),this._addInactiveAction(e,s,i)}const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const o=t[i];o.useCount++===0&&(this._lendBinding(o),o.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const o=t[i];--o.useCount===0&&(o.restoreOriginalState(),this._takeBackBinding(o))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const s=this._actions,o=this._actionsByClip;let r=o[t];if(r===void 0)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,o[t]=r;else{const a=r.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),r.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],s=e._cacheIndex;i._cacheIndex=s,t[s]=i,t.pop(),e._cacheIndex=null;const o=e._clip.uuid,r=this._actionsByClip,a=r[o],l=a.knownActions,g=l[l.length-1],c=e._byClipCacheIndex;g._byClipCacheIndex=c,l[c]=g,l.pop(),e._byClipCacheIndex=null;const u=a.actionByRoot,C=(e._localRoot||this._root).uuid;delete u[C],l.length===0&&delete r[o],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,s=t.length;i!==s;++i){const o=t[i];--o.referenceCount===0&&this._removeInactiveBinding(o)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,s=this._nActiveActions++,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,s=--this._nActiveActions,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_addInactiveBinding(e,t,i){const s=this._bindingsByRootAndName,o=this._bindings;let r=s[t];r===void 0&&(r={},s[t]=r),r[i]=e,e._cacheIndex=o.length,o.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,s=i.rootNode.uuid,o=i.path,r=this._bindingsByRootAndName,a=r[s],l=t[t.length-1],g=e._cacheIndex;l._cacheIndex=g,t[g]=l,t.pop(),delete a[o],Object.keys(a).length===0&&delete r[s]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,s=this._nActiveBindings++,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,s=--this._nActiveBindings,o=t[s];e._cacheIndex=s,t[s]=e,o._cacheIndex=i,t[i]=o}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new QZ(new Float32Array(2),new Float32Array(2),1,_4),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,s=--this._nActiveControlInterpolants,o=t[s];e.__cacheIndex=s,t[s]=e,o.__cacheIndex=i,t[i]=o}clipAction(e,t,i){const s=t||this._root,o=s.uuid;let r=typeof e=="string"?Oc.findByName(s,e):e;const a=r!==null?r.uuid:e,l=this._actionsByClip[a];let g=null;if(i===void 0&&(r!==null?i=r.blendMode:i=yb),l!==void 0){const u=l.actionByRoot[o];if(u!==void 0&&u.blendMode===i)return u;g=l.knownActions[0],r===null&&(r=g._clip)}if(r===null)return null;const c=new CE(this,r,t,i);return this._bindAction(c,g),this._addInactiveAction(c,a,o),c}existingAction(e,t){const i=t||this._root,s=i.uuid,o=typeof e=="string"?Oc.findByName(i,e):e,r=o?o.uuid:e,a=this._actionsByClip[r];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,s=this.time+=e,o=Math.sign(e),r=this._accuIndex^=1;for(let g=0;g!==i;++g)t[g]._update(s,e,o,r);const a=this._bindings,l=this._nActiveBindings;for(let g=0;g!==l;++g)a[g].apply(r);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,s=this._actionsByClip,o=s[i];if(o!==void 0){const r=o.knownActions;for(let a=0,l=r.length;a!==l;++a){const g=r[a];this._deactivateAction(g);const c=g._cacheIndex,u=t[t.length-1];g._cacheIndex=null,g._byClipCacheIndex=null,u._cacheIndex=c,t[c]=u,t.pop(),this._removeInactiveBindingsForAction(g)}delete s[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const r in i){const a=i[r].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName,o=s[t];if(o!==void 0)for(const r in o){const a=o[r];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Is{constructor(e){this.value=e}clone(){return new Is(this.value.clone===void 0?this.value:this.value.clone())}}let k4=0;class z4 extends Mr{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:k4++}),this.name="",this.usage=Rh,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,s=t.length;i<s;i++){const o=Array.isArray(t[i])?t[i]:[t[i]];for(let r=0;r<o.length;r++)this.uniforms.push(o[r].clone())}return this}clone(){return new this.constructor().copy(this)}}class D4 extends gd{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class P4{constructor(e,t,i,s,o){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=s,this.count=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const yW=new ct;class hE{constructor(e,t,i=0,s=1/0){this.ray=new nu(e,t),this.near=i,this.far=s,this.camera=null,this.layers=new Wc,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return yW.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(yW),this}intersectObject(e,t=!0,i=[]){return S2(e,this,i,t),i.sort(BW),i}intersectObjects(e,t=!0,i=[]){for(let s=0,o=e.length;s<o;s++)S2(e[s],this,i,t);return i.sort(BW),i}}function BW(n,e){return n.distance-e.distance}function S2(n,e,t,i){let s=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(s=!1),s===!0&&i===!0){const o=n.children;for(let r=0,a=o.length;r<a;r++)S2(o[r],e,t,!0)}}class R2{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ti(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class U4{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class oS{constructor(e,t,i,s){oS.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,s)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,s){const o=this.elements;return o[0]=e,o[2]=t,o[1]=i,o[3]=s,this}}const GW=new ye;class J4{constructor(e=new ye(1/0,1/0),t=new ye(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=GW.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,GW).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const vW=new _,cm=new _;class O4{constructor(e=new _,t=new _){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){vW.subVectors(e,this.start),cm.subVectors(this.end,this.start);const i=cm.dot(cm);let o=cm.dot(vW)/i;return t&&(o=ti(o,0,1)),o}closestPointToPoint(e,t,i){const s=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const wW=new _;class Q4 extends Lt{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Mt,s=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let r=0,a=1,l=32;r<l;r++,a++){const g=r/l*Math.PI*2,c=a/l*Math.PI*2;s.push(Math.cos(g),Math.sin(g),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new dt(s,3));const o=new ji({fog:!1,toneMapped:!1});this.cone=new ir(i,o),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),wW.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(wW),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const vl=new _,um=new ct,RG=new ct;class j4 extends ir{constructor(e){const t=AE(e),i=new Mt,s=[],o=[],r=new Pe(0,0,1),a=new Pe(0,1,0);for(let g=0;g<t.length;g++){const c=t[g];c.parent&&c.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),o.push(r.r,r.g,r.b),o.push(a.r,a.g,a.b))}i.setAttribute("position",new dt(s,3)),i.setAttribute("color",new dt(o,3));const l=new ji({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,s=i.getAttribute("position");RG.copy(this.root.matrixWorld).invert();for(let o=0,r=0;o<t.length;o++){const a=t[o];a.parent&&a.parent.isBone&&(um.multiplyMatrices(RG,a.matrixWorld),vl.setFromMatrixPosition(um),s.setXYZ(r,vl.x,vl.y,vl.z),um.multiplyMatrices(RG,a.parent.matrixWorld),vl.setFromMatrixPosition(um),s.setXYZ(r+1,vl.x,vl.y,vl.z),r+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function AE(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,AE(n.children[t]));return e}class q4 extends _n{constructor(e,t,i){const s=new IA(t,4,2),o=new Hi({wireframe:!0,fog:!1,toneMapped:!1});super(s,o),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const $4=new _,ZW=new Pe,SW=new Pe;class ej extends Lt{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const s=new uA(t);s.rotateY(Math.PI*.5),this.material=new Hi({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const o=s.getAttribute("position"),r=new Float32Array(o.count*3);s.setAttribute("color",new Pt(r,3)),this.add(new _n(s,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");ZW.copy(this.light.color),SW.copy(this.light.groundColor);for(let i=0,s=t.count;i<s;i++){const o=i<s/2?ZW:SW;t.setXYZ(i,o.r,o.g,o.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt($4.setFromMatrixPosition(this.light.matrixWorld).negate())}}class tj extends ir{constructor(e=10,t=10,i=4473924,s=8947848){i=new Pe(i),s=new Pe(s);const o=t/2,r=e/t,a=e/2,l=[],g=[];for(let C=0,h=0,p=-a;C<=t;C++,p+=r){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const b=C===o?i:s;b.toArray(g,h),h+=3,b.toArray(g,h),h+=3,b.toArray(g,h),h+=3,b.toArray(g,h),h+=3}const c=new Mt;c.setAttribute("position",new dt(l,3)),c.setAttribute("color",new dt(g,3));const u=new ji({vertexColors:!0,toneMapped:!1});super(c,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class nj extends ir{constructor(e=10,t=16,i=8,s=64,o=4473924,r=8947848){o=new Pe(o),r=new Pe(r);const a=[],l=[];if(t>1)for(let u=0;u<t;u++){const C=u/t*(Math.PI*2),h=Math.sin(C)*e,p=Math.cos(C)*e;a.push(0,0,0),a.push(h,0,p);const b=u&1?o:r;l.push(b.r,b.g,b.b),l.push(b.r,b.g,b.b)}for(let u=0;u<i;u++){const C=u&1?o:r,h=e-e/i*u;for(let p=0;p<s;p++){let b=p/s*(Math.PI*2),m=Math.sin(b)*h,A=Math.cos(b)*h;a.push(m,0,A),l.push(C.r,C.g,C.b),b=(p+1)/s*(Math.PI*2),m=Math.sin(b)*h,A=Math.cos(b)*h,a.push(m,0,A),l.push(C.r,C.g,C.b)}}const g=new Mt;g.setAttribute("position",new dt(a,3)),g.setAttribute("color",new dt(l,3));const c=new ji({vertexColors:!0,toneMapped:!1});super(g,c),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const RW=new _,Im=new _,xW=new _;class ij extends Lt{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let s=new Mt;s.setAttribute("position",new dt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const o=new ji({fog:!1,toneMapped:!1});this.lightPlane=new ra(s,o),this.add(this.lightPlane),s=new Mt,s.setAttribute("position",new dt([0,0,0,0,0,1],3)),this.targetLine=new ra(s,o),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),RW.setFromMatrixPosition(this.light.matrixWorld),Im.setFromMatrixPosition(this.light.target.matrixWorld),xW.subVectors(Im,RW),this.lightPlane.lookAt(Im),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Im),this.targetLine.scale.z=xW.length()}}const dm=new _,jn=new rd;class sj extends ir{constructor(e){const t=new Mt,i=new ji({color:16777215,vertexColors:!0,toneMapped:!1}),s=[],o=[],r={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(p,b){l(p),l(b)}function l(p){s.push(0,0,0),o.push(0,0,0),r[p]===void 0&&(r[p]=[]),r[p].push(s.length/3-1)}t.setAttribute("position",new dt(s,3)),t.setAttribute("color",new dt(o,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update();const g=new Pe(16755200),c=new Pe(16711680),u=new Pe(43775),C=new Pe(16777215),h=new Pe(3355443);this.setColors(g,c,u,C,h)}setColors(e,t,i,s,o){const a=this.geometry.getAttribute("color");a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,s.r,s.g,s.b),a.setXYZ(39,s.r,s.g,s.b),a.setXYZ(40,o.r,o.g,o.b),a.setXYZ(41,o.r,o.g,o.b),a.setXYZ(42,o.r,o.g,o.b),a.setXYZ(43,o.r,o.g,o.b),a.setXYZ(44,o.r,o.g,o.b),a.setXYZ(45,o.r,o.g,o.b),a.setXYZ(46,o.r,o.g,o.b),a.setXYZ(47,o.r,o.g,o.b),a.setXYZ(48,o.r,o.g,o.b),a.setXYZ(49,o.r,o.g,o.b),a.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,i=1,s=1;jn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),gi("c",t,e,jn,0,0,-1),gi("t",t,e,jn,0,0,1),gi("n1",t,e,jn,-i,-s,-1),gi("n2",t,e,jn,i,-s,-1),gi("n3",t,e,jn,-i,s,-1),gi("n4",t,e,jn,i,s,-1),gi("f1",t,e,jn,-i,-s,1),gi("f2",t,e,jn,i,-s,1),gi("f3",t,e,jn,-i,s,1),gi("f4",t,e,jn,i,s,1),gi("u1",t,e,jn,i*.7,s*1.1,-1),gi("u2",t,e,jn,-i*.7,s*1.1,-1),gi("u3",t,e,jn,0,s*2,-1),gi("cf1",t,e,jn,-i,0,1),gi("cf2",t,e,jn,i,0,1),gi("cf3",t,e,jn,0,-s,1),gi("cf4",t,e,jn,0,s,1),gi("cn1",t,e,jn,-i,0,-1),gi("cn2",t,e,jn,i,0,-1),gi("cn3",t,e,jn,0,-s,-1),gi("cn4",t,e,jn,0,s,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function gi(n,e,t,i,s,o,r){dm.set(s,o,r).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let g=0,c=a.length;g<c;g++)l.setXYZ(a[g],dm.x,dm.y,dm.z)}}const Cm=new Ji;class oj extends ir{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=new Float32Array(8*3),o=new Mt;o.setIndex(new Pt(i,1)),o.setAttribute("position",new Pt(s,3)),super(o,new ji({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Cm.setFromObject(this.object),Cm.isEmpty())return;const t=Cm.min,i=Cm.max,s=this.geometry.attributes.position,o=s.array;o[0]=i.x,o[1]=i.y,o[2]=i.z,o[3]=t.x,o[4]=i.y,o[5]=i.z,o[6]=t.x,o[7]=t.y,o[8]=i.z,o[9]=i.x,o[10]=t.y,o[11]=i.z,o[12]=i.x,o[13]=i.y,o[14]=t.z,o[15]=t.x,o[16]=i.y,o[17]=t.z,o[18]=t.x,o[19]=t.y,o[20]=t.z,o[21]=i.x,o[22]=t.y,o[23]=t.z,s.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class rj extends ir{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),s=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],o=new Mt;o.setIndex(new Pt(i,1)),o.setAttribute("position",new dt(s,3)),super(o,new ji({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class aj extends ra{constructor(e,t=1,i=16776960){const s=i,o=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],r=new Mt;r.setAttribute("position",new dt(o,3)),r.computeBoundingSphere(),super(r,new ji({color:s,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Mt;l.setAttribute("position",new dt(a,3)),l.computeBoundingSphere(),this.add(new _n(l,new Hi({color:s,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const VW=new _;let hm,xG;class lj extends Lt{constructor(e=new _(0,0,1),t=new _(0,0,0),i=1,s=16776960,o=i*.2,r=o*.2){super(),this.type="ArrowHelper",hm===void 0&&(hm=new Mt,hm.setAttribute("position",new dt([0,0,0,0,1,0],3)),xG=new Id(0,.5,1,5,1),xG.translate(0,-.5,0)),this.position.copy(t),this.line=new ra(hm,new ji({color:s,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new _n(xG,new Hi({color:s,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,o,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{VW.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(VW,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class gj extends ir{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Mt;s.setAttribute("position",new dt(t,3)),s.setAttribute("color",new dt(i,3));const o=new ji({vertexColors:!0,toneMapped:!1});super(s,o),this.type="AxesHelper"}setColors(e,t,i){const s=new Pe,o=this.geometry.attributes.color.array;return s.set(e),s.toArray(o,0),s.toArray(o,3),s.set(t),s.toArray(o,6),s.toArray(o,9),s.set(i),s.toArray(o,12),s.toArray(o,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class cj{constructor(){this.type="ShapePath",this.color=new Pe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Mh,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,s){return this.currentPath.quadraticCurveTo(e,t,i,s),this}bezierCurveTo(e,t,i,s,o,r){return this.currentPath.bezierCurveTo(e,t,i,s,o,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(A){const B=[];for(let G=0,w=A.length;G<w;G++){const N=A[G],M=new Mc;M.curves=N.curves,B.push(M)}return B}function i(A,B){const G=B.length;let w=!1;for(let N=G-1,M=0;M<G;N=M++){let R=B[N],S=B[M],F=S.x-R.x,Z=S.y-R.y;if(Math.abs(Z)>Number.EPSILON){if(Z<0&&(R=B[M],F=-F,S=B[N],Z=-Z),A.y<R.y||A.y>S.y)continue;if(A.y===R.y){if(A.x===R.x)return!0}else{const x=Z*(A.x-R.x)-F*(A.y-R.y);if(x===0)return!0;if(x<0)continue;w=!w}}else{if(A.y!==R.y)continue;if(S.x<=A.x&&A.x<=R.x||R.x<=A.x&&A.x<=S.x)return!0}}return w}const s=ia.isClockWise,o=this.subPaths;if(o.length===0)return[];let r,a,l;const g=[];if(o.length===1)return a=o[0],l=new Mc,l.curves=a.curves,g.push(l),g;let c=!s(o[0].getPoints());c=e?!c:c;const u=[],C=[];let h=[],p=0,b;C[p]=void 0,h[p]=[];for(let A=0,B=o.length;A<B;A++)a=o[A],b=a.getPoints(),r=s(b),r=e?!r:r,r?(!c&&C[p]&&p++,C[p]={s:new Mc,p:b},C[p].s.curves=a.curves,c&&p++,h[p]=[]):h[p].push({h:a,p:b[0]});if(!C[0])return t(o);if(C.length>1){let A=!1,B=0;for(let G=0,w=C.length;G<w;G++)u[G]=[];for(let G=0,w=C.length;G<w;G++){const N=h[G];for(let M=0;M<N.length;M++){const R=N[M];let S=!0;for(let F=0;F<C.length;F++)i(R.p,C[F].p)&&(G!==F&&B++,S?(S=!1,u[F].push(R)):A=!0);S&&u[G].push(R)}}B>0&&A===!1&&(h=u)}let m;for(let A=0,B=C.length;A<B;A++){l=C[A].s,g.push(l),m=h[A];for(let G=0,w=m.length;G<w;G++)l.holes.push(m[G].h)}return g}}class uj extends Mr{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class Ij extends Ys{constructor(e=1,t=1,i=1,s={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(e,t,{...s,count:i}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:sd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=sd);const dj=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:bZ,AddEquation:Fl,AddOperation:QX,AdditiveAnimationBlendMode:VZ,AdditiveBlending:C2,AgXToneMapping:tT,AlphaFormat:vZ,AlwaysCompare:AT,AlwaysDepth:_f,AlwaysStencilFunc:m2,AmbientLight:rE,AnimationAction:CE,AnimationClip:Oc,AnimationLoader:h4,AnimationMixer:L4,AnimationObjectGroup:K4,AnimationUtils:u4,ArcCurve:XT,ArrayCamera:VT,ArrowHelper:lj,AttachedBindMode:p2,Audio:IE,AudioAnalyser:V4,AudioContext:tS,AudioListener:S4,AudioLoader:v4,AxesHelper:gj,BackSide:Es,BasicDepthPacking:aT,BasicShadowMap:VX,BatchedMesh:HT,Bone:gA,BooleanKeyframeTrack:ou,Box2:J4,Box3:Ji,Box3Helper:rj,BoxGeometry:iu,BoxHelper:oj,BufferAttribute:Pt,BufferGeometry:Mt,BufferGeometryLoader:uE,ByteType:yZ,Cache:Na,Camera:rd,CameraHelper:sj,CanvasTexture:HQ,CapsuleGeometry:Nb,CatmullRomCurve3:TT,CineonToneMapping:$X,CircleGeometry:Fb,ClampToEdgeWrapping:to,Clock:nS,Color:Pe,ColorKeyframeTrack:jZ,ColorManagement:cn,CompressedArrayTexture:NQ,CompressedCubeTexture:FQ,CompressedTexture:Wb,CompressedTextureLoader:A4,ConeGeometry:Hb,ConstantAlphaFactor:UX,ConstantColorFactor:DX,Controls:uj,CubeCamera:TZ,CubeReflectionMapping:Oa,CubeRefractionMapping:eg,CubeTexture:rA,CubeTextureLoader:p4,CubeUVReflectionMapping:od,CubicBezierCurve:zZ,CubicBezierCurve3:ET,CubicInterpolant:nE,CullFaceBack:d2,CullFaceFront:xX,CullFaceFrontBack:Iz,CullFaceNone:RX,Curve:Nr,CurvePath:KT,CustomBlending:WX,CustomToneMapping:eT,CylinderGeometry:Id,Cylindrical:U4,Data3DTexture:FZ,DataArrayTexture:vb,DataTexture:na,DataTextureLoader:m4,DataUtils:BD,DecrementStencilOp:Gz,DecrementWrapStencilOp:wz,DefaultLoadingManager:AI,DepthFormat:Pl,DepthStencilFormat:Dc,DepthTexture:lA,DetachedBindMode:iT,DirectionalLight:Jb,DirectionalLightHelper:ij,DiscreteInterpolant:iE,DisplayP3ColorSpace:Bb,DodecahedronGeometry:Xb,DoubleSide:bo,DstAlphaFactor:KX,DstColorFactor:LX,DynamicCopyUsage:Yz,DynamicDrawUsage:Ul,DynamicReadUsage:Xz,EdgesGeometry:_T,EllipseCurve:Mb,EqualCompare:IT,EqualDepth:kf,EqualStencilFunc:xz,EquirectangularReflectionMapping:Bh,EquirectangularRefractionMapping:Gh,Euler:Gs,EventDispatcher:Mr,ExtrudeGeometry:Eb,FileLoader:Ks,Float16BufferAttribute:RD,Float32BufferAttribute:dt,FloatType:Xs,Fog:Sb,FogExp2:Zb,FramebufferTexture:MQ,FrontSide:Rr,Frustum:aA,GLBufferAttribute:P4,GLSL1:_z,GLSL3:f2,GreaterCompare:dT,GreaterDepth:Df,GreaterEqualCompare:hT,GreaterEqualDepth:zf,GreaterEqualStencilFunc:Nz,GreaterStencilFunc:Wz,GridHelper:tj,Group:Qo,HalfFloatType:il,HemisphereLight:oE,HemisphereLightHelper:ej,IcosahedronGeometry:Yb,ImageBitmapLoader:eS,ImageLoader:Xh,ImageUtils:fT,IncrementStencilOp:Bz,IncrementWrapStencilOp:vz,InstancedBufferAttribute:ng,InstancedBufferGeometry:cE,InstancedInterleavedBuffer:D4,InstancedMesh:Jl,Int16BufferAttribute:ZD,Int32BufferAttribute:SD,Int8BufferAttribute:GD,IntType:hb,InterleavedBuffer:gd,InterleavedBufferAttribute:ja,Interpolant:su,InterpolateDiscrete:Pc,InterpolateLinear:tg,InterpolateSmooth:jm,InvertStencilOp:Zz,KeepStencilOp:rc,KeyframeTrack:Fr,LOD:FT,LatheGeometry:cA,Layers:Wc,LessCompare:uT,LessDepth:Lf,LessEqualCompare:MZ,LessEqualDepth:_c,LessEqualStencilFunc:Vz,LessStencilFunc:Rz,Light:Ag,LightProbe:gE,Line:ra,Line3:O4,LineBasicMaterial:ji,LineCurve:DZ,LineCurve3:YT,LineDashedMaterial:$T,LineLoop:xb,LineSegments:ir,LinearDisplayP3ColorSpace:oA,LinearFilter:fn,LinearInterpolant:QZ,LinearMipMapLinearFilter:Az,LinearMipMapNearestFilter:hz,LinearMipmapLinearFilter:no,LinearMipmapNearestFilter:xc,LinearSRGBColorSpace:Ei,LinearToneMapping:jX,LinearTransfer:wh,Loader:qi,LoaderUtils:vo,LoadingManager:qZ,LoopOnce:sT,LoopPingPong:rT,LoopRepeat:oT,LuminanceAlphaFormat:SZ,LuminanceFormat:ZZ,MOUSE:sc,Material:Un,MaterialLoader:Ob,MathUtils:Gb,Matrix2:oS,Matrix3:Et,Matrix4:ct,MaxEquation:HX,Mesh:_n,MeshBasicMaterial:Hi,MeshDepthMaterial:KZ,MeshDistanceMaterial:_Z,MeshLambertMaterial:jT,MeshMatcapMaterial:qT,MeshNormalMaterial:QT,MeshPhongMaterial:JT,MeshPhysicalMaterial:oi,MeshStandardMaterial:hg,MeshToonMaterial:OT,MinEquation:FX,MirroredRepeatWrapping:Lc,MixOperation:OX,MultiplyBlending:A2,MultiplyOperation:tA,NearestFilter:Bi,NearestMipMapLinearFilter:Cz,NearestMipMapNearestFilter:dz,NearestMipmapLinearFilter:Tl,NearestMipmapNearestFilter:nA,NeutralToneMapping:nT,NeverCompare:cT,NeverDepth:Kf,NeverStencilFunc:Sz,NoBlending:ea,NoColorSpace:xa,NoToneMapping:ta,NormalAnimationBlendMode:yb,NormalBlending:Rc,NotEqualCompare:CT,NotEqualDepth:Pf,NotEqualStencilFunc:Mz,NumberKeyframeTrack:qa,Object3D:Lt,ObjectLoader:B4,ObjectSpaceNormalMap:gT,OctahedronGeometry:uA,OneFactor:TX,OneMinusConstantAlphaFactor:JX,OneMinusConstantColorFactor:PX,OneMinusDstAlphaFactor:_X,OneMinusDstColorFactor:kX,OneMinusSrcAlphaFactor:Yf,OneMinusSrcColorFactor:YX,OrthographicCamera:qo,P3Primaries:Sh,PCFShadowMap:db,PCFSoftShadowMap:_C,PMREMGenerator:b2,Path:Mh,PerspectiveCamera:Wn,Plane:Jr,PlaneGeometry:ad,PlaneHelper:aj,PointLight:Ub,PointLightHelper:q4,Points:Vb,PointsMaterial:ud,PolarGridHelper:nj,PolyhedronGeometry:Cg,PositionalAudio:x4,PropertyBinding:on,PropertyMixer:dE,QuadraticBezierCurve:PZ,QuadraticBezierCurve3:UZ,Quaternion:ii,QuaternionKeyframeTrack:$a,QuaternionLinearInterpolant:sE,RED_GREEN_RGTC2_Format:p0,RED_RGTC1_Format:xZ,REVISION:sd,RGBADepthPacking:lT,RGBAFormat:fs,RGBAIntegerFormat:bb,RGBA_ASTC_10x10_Format:u0,RGBA_ASTC_10x5_Format:l0,RGBA_ASTC_10x6_Format:g0,RGBA_ASTC_10x8_Format:c0,RGBA_ASTC_12x10_Format:I0,RGBA_ASTC_12x12_Format:d0,RGBA_ASTC_4x4_Format:e0,RGBA_ASTC_5x4_Format:t0,RGBA_ASTC_5x5_Format:n0,RGBA_ASTC_6x5_Format:i0,RGBA_ASTC_6x6_Format:s0,RGBA_ASTC_8x5_Format:o0,RGBA_ASTC_8x6_Format:r0,RGBA_ASTC_8x8_Format:a0,RGBA_BPTC_Format:PC,RGBA_ETC2_EAC_Format:$f,RGBA_PVRTC_2BPPV1_Format:Qf,RGBA_PVRTC_4BPPV1_Format:Of,RGBA_S3TC_DXT1_Format:kC,RGBA_S3TC_DXT3_Format:zC,RGBA_S3TC_DXT5_Format:DC,RGBDepthPacking:mz,RGBFormat:wZ,RGBIntegerFormat:pz,RGB_BPTC_SIGNED_Format:C0,RGB_BPTC_UNSIGNED_Format:h0,RGB_ETC1_Format:jf,RGB_ETC2_Format:qf,RGB_PVRTC_2BPPV1_Format:Jf,RGB_PVRTC_4BPPV1_Format:Uf,RGB_S3TC_DXT1_Format:LC,RGDepthPacking:fz,RGFormat:RZ,RGIntegerFormat:fb,RawShaderMaterial:UT,Ray:nu,Raycaster:hE,Rec709Primaries:Zh,RectAreaLight:aE,RedFormat:mb,RedIntegerFormat:iA,ReinhardToneMapping:qX,RenderTarget:bT,RepeatWrapping:xr,ReplaceStencilOp:yz,ReverseSubtractEquation:NX,RingGeometry:Kb,SIGNED_RED_GREEN_RGTC2_Format:m0,SIGNED_RED_RGTC1_Format:A0,SRGBColorSpace:Di,SRGBTransfer:xn,Scene:Wh,ShaderChunk:_t,ShaderLib:br,ShaderMaterial:tr,ShadowMaterial:PT,Shape:Mc,ShapeGeometry:_b,ShapePath:cj,ShapeUtils:ia,ShortType:BZ,Skeleton:cd,SkeletonHelper:j4,SkinnedMesh:Rb,Source:bc,Sphere:Ti,SphereGeometry:IA,Spherical:R2,SphericalHarmonics3:lE,SplineCurve:JZ,SpotLight:Pb,SpotLightHelper:Q4,Sprite:NT,SpriteMaterial:LZ,SrcAlphaFactor:Ef,SrcAlphaSaturateFactor:zX,SrcColorFactor:EX,StaticCopyUsage:Ez,StaticDrawUsage:Rh,StaticReadUsage:Hz,StereoCamera:w4,StreamCopyUsage:Kz,StreamDrawUsage:Fz,StreamReadUsage:Tz,StringKeyframeTrack:ru,SubtractEquation:MX,SubtractiveBlending:h2,TOUCH:oc,TangentSpaceNormalMap:dg,TetrahedronGeometry:Lb,Texture:Bn,TextureLoader:au,TextureUtils:uQ,TorusGeometry:kb,TorusKnotGeometry:zb,Triangle:$s,TriangleFanDrawMode:Uc,TriangleStripDrawMode:sA,TrianglesDrawMode:WZ,TubeGeometry:Db,UVMapping:Cb,Uint16BufferAttribute:HZ,Uint32BufferAttribute:XZ,Uint8BufferAttribute:vD,Uint8ClampedBufferAttribute:wD,Uniform:Is,UniformsGroup:z4,UniformsLib:je,UniformsUtils:GT,UnsignedByteType:Vr,UnsignedInt248Type:zc,UnsignedInt5999Type:GZ,UnsignedIntType:Qa,UnsignedShort4444Type:Ab,UnsignedShort5551Type:pb,UnsignedShortType:kc,VSMShadowMap:pr,Vector2:ye,Vector3:_,Vector4:rn,VectorKeyframeTrack:el,VideoTexture:WQ,WebGL3DRenderTarget:ID,WebGLArrayRenderTarget:uD,WebGLCoordinateSystem:jr,WebGLCubeRenderTarget:EZ,WebGLMultipleRenderTargets:Ij,WebGLRenderTarget:Ys,WebGLRenderer:WT,WebGLUtils:xT,WebGPUCoordinateSystem:xh,WireframeGeometry:DT,WrapAroundEnding:vh,ZeroCurvatureEnding:mc,ZeroFactor:XX,ZeroSlopeEnding:fc,ZeroStencilOp:bz,createCanvasElement:mT},Symbol.toStringTag,{value:"Module"}));var pE={exports:{}},lu={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */lu.ConcurrentRoot=1;lu.ContinuousEventPriority=4;lu.DefaultEventPriority=16;lu.DiscreteEventPriority=1;lu.IdleEventPriority=536870912;lu.LegacyRoot=0;pE.exports=lu;var pI=pE.exports;function Cj(n){let e;const t=new Set,i=(g,c)=>{const u=typeof g=="function"?g(e):g;if(u!==e){const C=e;e=c?u:Object.assign({},e,u),t.forEach(h=>h(e,C))}},s=()=>e,o=(g,c=s,u=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let C=c(e);function h(){const p=c(e);if(!u(C,p)){const b=C;g(C=p,b)}}return t.add(h),()=>t.delete(h)},l={setState:i,getState:s,subscribe:(g,c,u)=>c||u?o(g,c,u):(t.add(g),()=>t.delete(g)),destroy:()=>t.clear()};return e=n(i,s,l),l}const hj=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),WW=hj?z.useEffect:z.useLayoutEffect;function Aj(n){const e=typeof n=="function"?Cj(n):n,t=(i=e.getState,s=Object.is)=>{const[,o]=z.useReducer(m=>m+1,0),r=e.getState(),a=z.useRef(r),l=z.useRef(i),g=z.useRef(s),c=z.useRef(!1),u=z.useRef();u.current===void 0&&(u.current=i(r));let C,h=!1;(a.current!==r||l.current!==i||g.current!==s||c.current)&&(C=i(r),h=!s(u.current,C)),WW(()=>{h&&(u.current=C),a.current=r,l.current=i,g.current=s,c.current=!1});const p=z.useRef(r);WW(()=>{const m=()=>{try{const B=e.getState(),G=l.current(B);g.current(u.current,G)||(a.current=B,u.current=G,o())}catch{c.current=!0,o()}},A=e.subscribe(m);return e.getState()!==p.current&&m(),A},[]);const b=h?C:u.current;return z.useDebugValue(b),b};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[t,e];return{next(){const s=i.length<=0;return{value:i.shift(),done:s}}}},t}const pj=n=>typeof n=="object"&&typeof n.then=="function",Bc=[];function mE(n,e,t=(i,s)=>i===s){if(n===e)return!0;if(!n||!e)return!1;const i=n.length;if(e.length!==i)return!1;for(let s=0;s<i;s++)if(!t(n[s],e[s]))return!1;return!0}function fE(n,e=null,t=!1,i={}){e===null&&(e=[n]);for(const o of Bc)if(mE(e,o.keys,o.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return i.lifespan&&i.lifespan>0&&(o.timeout&&clearTimeout(o.timeout),o.timeout=setTimeout(o.remove,i.lifespan)),o.response;if(!t)throw o.promise}const s={keys:e,equal:i.equal,remove:()=>{const o=Bc.indexOf(s);o!==-1&&Bc.splice(o,1)},promise:(pj(n)?n:n(...e)).then(o=>{s.response=o,i.lifespan&&i.lifespan>0&&(s.timeout=setTimeout(s.remove,i.lifespan))}).catch(o=>s.error=o)};if(Bc.push(s),!t)throw s.promise}const mj=(n,e,t)=>fE(n,e,!1,t),fj=(n,e,t)=>void fE(n,e,!0,t),bj=n=>{if(n===void 0||n.length===0)Bc.splice(0,Bc.length);else{const e=Bc.find(t=>mE(n,t.keys,t.equal));e&&e.remove()}};var bE={exports:{}},yE={exports:{}},BE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(k,ee){var $=k.length;k.push(ee);e:for(;0<$;){var ae=$-1>>>1,be=k[ae];if(0<s(be,ee))k[ae]=ee,k[$]=be,$=ae;else break e}}function t(k){return k.length===0?null:k[0]}function i(k){if(k.length===0)return null;var ee=k[0],$=k.pop();if($!==ee){k[0]=$;e:for(var ae=0,be=k.length,me=be>>>1;ae<me;){var ce=2*(ae+1)-1,Be=k[ce],He=ce+1,Fe=k[He];if(0>s(Be,$))He<be&&0>s(Fe,Be)?(k[ae]=Fe,k[He]=$,ae=He):(k[ae]=Be,k[ce]=$,ae=ce);else if(He<be&&0>s(Fe,$))k[ae]=Fe,k[He]=$,ae=He;else break e}}return ee}function s(k,ee){var $=k.sortIndex-ee.sortIndex;return $!==0?$:k.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var r=Date,a=r.now();n.unstable_now=function(){return r.now()-a}}var l=[],g=[],c=1,u=null,C=3,h=!1,p=!1,b=!1,m=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function G(k){for(var ee=t(g);ee!==null;){if(ee.callback===null)i(g);else if(ee.startTime<=k)i(g),ee.sortIndex=ee.expirationTime,e(l,ee);else break;ee=t(g)}}function w(k){if(b=!1,G(k),!p)if(t(l)!==null)p=!0,se(N);else{var ee=t(g);ee!==null&&Ie(w,ee.startTime-k)}}function N(k,ee){p=!1,b&&(b=!1,A(S),S=-1),h=!0;var $=C;try{for(G(ee),u=t(l);u!==null&&(!(u.expirationTime>ee)||k&&!x());){var ae=u.callback;if(typeof ae=="function"){u.callback=null,C=u.priorityLevel;var be=ae(u.expirationTime<=ee);ee=n.unstable_now(),typeof be=="function"?u.callback=be:u===t(l)&&i(l),G(ee)}else i(l);u=t(l)}if(u!==null)var me=!0;else{var ce=t(g);ce!==null&&Ie(w,ce.startTime-ee),me=!1}return me}finally{u=null,C=$,h=!1}}var M=!1,R=null,S=-1,F=5,Z=-1;function x(){return!(n.unstable_now()-Z<F)}function Y(){if(R!==null){var k=n.unstable_now();Z=k;var ee=!0;try{ee=R(!0,k)}finally{ee?T():(M=!1,R=null)}}else M=!1}var T;if(typeof B=="function")T=function(){B(Y)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,ue=ne.port2;ne.port1.onmessage=Y,T=function(){ue.postMessage(null)}}else T=function(){m(Y,0)};function se(k){R=k,M||(M=!0,T())}function Ie(k,ee){S=m(function(){k(n.unstable_now())},ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(k){k.callback=null},n.unstable_continueExecution=function(){p||h||(p=!0,se(N))},n.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<k?Math.floor(1e3/k):5},n.unstable_getCurrentPriorityLevel=function(){return C},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(k){switch(C){case 1:case 2:case 3:var ee=3;break;default:ee=C}var $=C;C=ee;try{return k()}finally{C=$}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(k,ee){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var $=C;C=k;try{return ee()}finally{C=$}},n.unstable_scheduleCallback=function(k,ee,$){var ae=n.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?ae+$:ae):$=ae,k){case 1:var be=-1;break;case 2:be=250;break;case 5:be=1073741823;break;case 4:be=1e4;break;default:be=5e3}return be=$+be,k={id:c++,callback:ee,priorityLevel:k,startTime:$,expirationTime:be,sortIndex:-1},$>ae?(k.sortIndex=$,e(g,k),t(l)===null&&k===t(g)&&(b?(A(S),S=-1):b=!0,Ie(w,$-ae))):(k.sortIndex=be,e(l,k),p||h||(p=!0,se(N))),k},n.unstable_shouldYield=x,n.unstable_wrapCallback=function(k){var ee=C;return function(){var $=C;C=ee;try{return k.apply(this,arguments)}finally{C=$}}}})(BE);yE.exports=BE;var x2=yE.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yj=function(e){var t={},i=z,s=x2,o=Object.assign;function r(I){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+I,y=1;y<arguments.length;y++)d+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+I+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),g=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),u=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),h=Symbol.for("react.provider"),p=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),w=Symbol.for("react.offscreen"),N=Symbol.iterator;function M(I){return I===null||typeof I!="object"?null:(I=N&&I[N]||I["@@iterator"],typeof I=="function"?I:null)}function R(I){if(I==null)return null;if(typeof I=="function")return I.displayName||I.name||null;if(typeof I=="string")return I;switch(I){case c:return"Fragment";case g:return"Portal";case C:return"Profiler";case u:return"StrictMode";case m:return"Suspense";case A:return"SuspenseList"}if(typeof I=="object")switch(I.$$typeof){case p:return(I.displayName||"Context")+".Consumer";case h:return(I._context.displayName||"Context")+".Provider";case b:var d=I.render;return I=I.displayName,I||(I=d.displayName||d.name||"",I=I!==""?"ForwardRef("+I+")":"ForwardRef"),I;case B:return d=I.displayName||null,d!==null?d:R(I.type)||"Memo";case G:d=I._payload,I=I._init;try{return R(I(d))}catch{}}return null}function S(I){var d=I.type;switch(I.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return I=d.render,I=I.displayName||I.name||"",d.displayName||(I!==""?"ForwardRef("+I+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return R(d);case 8:return d===u?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function F(I){var d=I,y=I;if(I.alternate)for(;d.return;)d=d.return;else{I=d;do d=I,d.flags&4098&&(y=d.return),I=d.return;while(I)}return d.tag===3?y:null}function Z(I){if(F(I)!==I)throw Error(r(188))}function x(I){var d=I.alternate;if(!d){if(d=F(I),d===null)throw Error(r(188));return d!==I?null:I}for(var y=I,v=d;;){var V=y.return;if(V===null)break;var X=V.alternate;if(X===null){if(v=V.return,v!==null){y=v;continue}break}if(V.child===X.child){for(X=V.child;X;){if(X===y)return Z(V),I;if(X===v)return Z(V),d;X=X.sibling}throw Error(r(188))}if(y.return!==v.return)y=V,v=X;else{for(var O=!1,te=V.child;te;){if(te===y){O=!0,y=V,v=X;break}if(te===v){O=!0,v=V,y=X;break}te=te.sibling}if(!O){for(te=X.child;te;){if(te===y){O=!0,y=X,v=V;break}if(te===v){O=!0,v=X,y=V;break}te=te.sibling}if(!O)throw Error(r(189))}}if(y.alternate!==v)throw Error(r(190))}if(y.tag!==3)throw Error(r(188));return y.stateNode.current===y?I:d}function Y(I){return I=x(I),I!==null?T(I):null}function T(I){if(I.tag===5||I.tag===6)return I;for(I=I.child;I!==null;){var d=T(I);if(d!==null)return d;I=I.sibling}return null}function ne(I){if(I.tag===5||I.tag===6)return I;for(I=I.child;I!==null;){if(I.tag!==4){var d=ne(I);if(d!==null)return d}I=I.sibling}return null}var ue=Array.isArray,se=e.getPublicInstance,Ie=e.getRootHostContext,k=e.getChildHostContext,ee=e.prepareForCommit,$=e.resetAfterCommit,ae=e.createInstance,be=e.appendInitialChild,me=e.finalizeInitialChildren,ce=e.prepareUpdate,Be=e.shouldSetTextContent,He=e.createTextInstance,Fe=e.scheduleTimeout,Ct=e.cancelTimeout,pt=e.noTimeout,ot=e.isPrimaryRenderer,Ue=e.supportsMutation,we=e.supportsPersistence,D=e.supportsHydration,Ee=e.getInstanceFromNode,Ye=e.preparePortalMount,Ne=e.getCurrentEventPriority,_e=e.detachDeletedInstance,ut=e.supportsMicrotasks,Oe=e.scheduleMicrotask,P=e.supportsTestSelectors,E=e.findFiberRoot,ge=e.getBoundingRect,ve=e.getTextContent,Se=e.isHiddenSubtree,Ze=e.matchAccessibilityRole,Je=e.setFocusIfFocusable,We=e.setupIntersectionObserver,Qe=e.appendChild,Kt=e.appendChildToContainer,Xe=e.commitTextUpdate,et=e.commitMount,Gt=e.commitUpdate,wt=e.insertBefore,it=e.insertInContainerBefore,Nt=e.removeChild,q=e.removeChildFromContainer,xe=e.resetTextContent,Q=e.hideInstance,Me=e.hideTextInstance,Ce=e.unhideInstance,Re=e.unhideTextInstance,De=e.clearContainer,qe=e.cloneInstance,Wt=e.createContainerChildSet,$t=e.appendChildToContainerChildSet,An=e.finalizeContainerChildren,Ft=e.replaceContainerChildren,bn=e.cloneHiddenInstance,ri=e.cloneHiddenTextInstance,Fn=e.canHydrateInstance,fg=e.canHydrateTextInstance,vs=e.canHydrateSuspenseInstance,Wo=e.isSuspenseInstancePending,sl=e.isSuspenseInstanceFallback,uu=e.registerSuspenseInstanceRetry,Yi=e.getNextHydratableSibling,Iu=e.getFirstHydratableChild,ol=e.getFirstHydratableChildWithinContainer,ca=e.getFirstHydratableChildWithinSuspenseInstance,bg=e.hydrateInstance,yg=e.hydrateTextInstance,rl=e.hydrateSuspenseInstance,Mo=e.getNextHydratableInstanceAfterSuspenseInstance,L=e.commitHydratedContainer,ie=e.commitHydratedSuspenseInstance,de=e.clearSuspenseBoundary,Ae=e.clearSuspenseBoundaryFromContainer,re=e.shouldDeleteUnhydratedTailInstances,ke=e.didNotMatchHydratedContainerTextInstance,tt=e.didNotMatchHydratedTextInstance,st;function rt(I){if(st===void 0)try{throw Error()}catch(y){var d=y.stack.trim().match(/\n( *(at )?)/);st=d&&d[1]||""}return`
`+st+I}var vt=!1;function Bt(I,d){if(!I||vt)return"";vt=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(ze){var v=ze}Reflect.construct(I,[],d)}else{try{d.call()}catch(ze){v=ze}I.call(d.prototype)}else{try{throw Error()}catch(ze){v=ze}I()}}catch(ze){if(ze&&v&&typeof ze.stack=="string"){for(var V=ze.stack.split(`
`),X=v.stack.split(`
`),O=V.length-1,te=X.length-1;1<=O&&0<=te&&V[O]!==X[te];)te--;for(;1<=O&&0<=te;O--,te--)if(V[O]!==X[te]){if(O!==1||te!==1)do if(O--,te--,0>te||V[O]!==X[te]){var Ge=`
`+V[O].replace(" at new "," at ");return I.displayName&&Ge.includes("<anonymous>")&&(Ge=Ge.replace("<anonymous>",I.displayName)),Ge}while(1<=O&&0<=te);break}}}finally{vt=!1,Error.prepareStackTrace=y}return(I=I?I.displayName||I.name:"")?rt(I):""}var lt=Object.prototype.hasOwnProperty,Ot=[],an=-1;function ln(I){return{current:I}}function Tt(I){0>an||(I.current=Ot[an],Ot[an]=null,an--)}function At(I,d){an++,Ot[an]=I.current,I.current=d}var at={},Ut=ln(at),xt=ln(!1),On=at;function ws(I,d){var y=I.type.contextTypes;if(!y)return at;var v=I.stateNode;if(v&&v.__reactInternalMemoizedUnmaskedChildContext===d)return v.__reactInternalMemoizedMaskedChildContext;var V={},X;for(X in y)V[X]=d[X];return v&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=d,I.__reactInternalMemoizedMaskedChildContext=V),V}function pn(I){return I=I.childContextTypes,I!=null}function rr(){Tt(xt),Tt(Ut)}function wn(I,d,y){if(Ut.current!==at)throw Error(r(168));At(Ut,d),At(xt,y)}function ao(I,d,y){var v=I.stateNode;if(d=d.childContextTypes,typeof v.getChildContext!="function")return y;v=v.getChildContext();for(var V in v)if(!(V in d))throw Error(r(108,S(I)||"Unknown",V));return o({},y,v)}function $i(I){return I=(I=I.stateNode)&&I.__reactInternalMemoizedMergedChildContext||at,On=Ut.current,At(Ut,I),At(xt,xt.current),!0}function Hn(I,d,y){var v=I.stateNode;if(!v)throw Error(r(169));y?(I=ao(I,d,On),v.__reactInternalMemoizedMergedChildContext=I,Tt(xt),Tt(Ut),At(Ut,I)):Tt(xt),At(xt,y)}var Ii=Math.clz32?Math.clz32:Zn,al=Math.log,Bg=Math.LN2;function Zn(I){return I>>>=0,I===0?32:31-(al(I)/Bg|0)|0}var ua=64,Hr=4194304;function ar(I){switch(I&-I){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return I&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return I}}function du(I,d){var y=I.pendingLanes;if(y===0)return 0;var v=0,V=I.suspendedLanes,X=I.pingedLanes,O=y&268435455;if(O!==0){var te=O&~V;te!==0?v=ar(te):(X&=O,X!==0&&(v=ar(X)))}else O=y&~V,O!==0?v=ar(O):X!==0&&(v=ar(X));if(v===0)return 0;if(d!==0&&d!==v&&!(d&V)&&(V=v&-v,X=d&-d,V>=X||V===16&&(X&4194240)!==0))return d;if(v&4&&(v|=y&16),d=I.entangledLanes,d!==0)for(I=I.entanglements,d&=v;0<d;)y=31-Ii(d),V=1<<y,v|=I[y],d&=~V;return v}function vA(I,d){switch(I){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yy(I,d){for(var y=I.suspendedLanes,v=I.pingedLanes,V=I.expirationTimes,X=I.pendingLanes;0<X;){var O=31-Ii(X),te=1<<O,Ge=V[O];Ge===-1?(!(te&y)||te&v)&&(V[O]=vA(te,d)):Ge<=d&&(I.expiredLanes|=te),X&=~te}}function md(I){return I=I.pendingLanes&-1073741825,I!==0?I:I&1073741824?1073741824:0}function fd(I){for(var d=[],y=0;31>y;y++)d.push(I);return d}function Gg(I,d,y){I.pendingLanes|=d,d!==536870912&&(I.suspendedLanes=0,I.pingedLanes=0),I=I.eventTimes,d=31-Ii(d),I[d]=y}function vg(I,d){var y=I.pendingLanes&~d;I.pendingLanes=d,I.suspendedLanes=0,I.pingedLanes=0,I.expiredLanes&=d,I.mutableReadLanes&=d,I.entangledLanes&=d,d=I.entanglements;var v=I.eventTimes;for(I=I.expirationTimes;0<y;){var V=31-Ii(y),X=1<<V;d[V]=0,v[V]=-1,I[V]=-1,y&=~X}}function No(I,d){var y=I.entangledLanes|=d;for(I=I.entanglements;y;){var v=31-Ii(y),V=1<<v;V&d|I[v]&d&&(I[v]|=d),y&=~V}}var nn=0;function bd(I){return I&=-I,1<I?4<I?I&268435455?16:536870912:4:1}var Cu=s.unstable_scheduleCallback,Ia=s.unstable_cancelCallback,By=s.unstable_shouldYield,Gy=s.unstable_requestPaint,di=s.unstable_now,Fo=s.unstable_ImmediatePriority,vy=s.unstable_UserBlockingPriority,yd=s.unstable_NormalPriority,hu=s.unstable_IdlePriority,da=null,lo=null;function wg(I){if(lo&&typeof lo.onCommitFiberRoot=="function")try{lo.onCommitFiberRoot(da,I,void 0,(I.current.flags&128)===128)}catch{}}function Zg(I,d){return I===d&&(I!==0||1/I===1/d)||I!==I&&d!==d}var go=typeof Object.is=="function"?Object.is:Zg,co=null,Sn=!1,Bd=!1;function wA(I){co===null?co=[I]:co.push(I)}function ZA(I){Sn=!0,wA(I)}function uo(){if(!Bd&&co!==null){Bd=!0;var I=0,d=nn;try{var y=co;for(nn=1;I<y.length;I++){var v=y[I];do v=v(!0);while(v!==null)}co=null,Sn=!1}catch(V){throw co!==null&&(co=co.slice(I+1)),Cu(Fo,uo),V}finally{nn=d,Bd=!1}}return null}var SA=a.ReactCurrentBatchConfig;function Ca(I,d){if(go(I,d))return!0;if(typeof I!="object"||I===null||typeof d!="object"||d===null)return!1;var y=Object.keys(I),v=Object.keys(d);if(y.length!==v.length)return!1;for(v=0;v<y.length;v++){var V=y[v];if(!lt.call(d,V)||!go(I[V],d[V]))return!1}return!0}function RA(I){switch(I.tag){case 5:return rt(I.type);case 16:return rt("Lazy");case 13:return rt("Suspense");case 19:return rt("SuspenseList");case 0:case 2:case 15:return I=Bt(I.type,!1),I;case 11:return I=Bt(I.type.render,!1),I;case 1:return I=Bt(I.type,!0),I;default:return""}}function ai(I,d){if(I&&I.defaultProps){d=o({},d),I=I.defaultProps;for(var y in I)d[y]===void 0&&(d[y]=I[y]);return d}return d}var Sg=ln(null),Au=null,Ho=null,pu=null;function Rg(){pu=Ho=Au=null}function xg(I,d,y){ot?(At(Sg,d._currentValue),d._currentValue=y):(At(Sg,d._currentValue2),d._currentValue2=y)}function mu(I){var d=Sg.current;Tt(Sg),ot?I._currentValue=d:I._currentValue2=d}function ll(I,d,y){for(;I!==null;){var v=I.alternate;if((I.childLanes&d)!==d?(I.childLanes|=d,v!==null&&(v.childLanes|=d)):v!==null&&(v.childLanes&d)!==d&&(v.childLanes|=d),I===y)break;I=I.return}}function gl(I,d){Au=I,pu=Ho=null,I=I.dependencies,I!==null&&I.firstContext!==null&&(I.lanes&d&&(ho=!0),I.firstContext=null)}function Zs(I){var d=ot?I._currentValue:I._currentValue2;if(pu!==I)if(I={context:I,memoizedValue:d,next:null},Ho===null){if(Au===null)throw Error(r(308));Ho=I,Au.dependencies={lanes:0,firstContext:I}}else Ho=Ho.next=I;return d}var es=null,lr=!1;function fu(I){I.updateQueue={baseState:I.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bu(I,d){I=I.updateQueue,d.updateQueue===I&&(d.updateQueue={baseState:I.baseState,firstBaseUpdate:I.firstBaseUpdate,lastBaseUpdate:I.lastBaseUpdate,shared:I.shared,effects:I.effects})}function Io(I,d){return{eventTime:I,lane:d,tag:0,payload:null,callback:null,next:null}}function gr(I,d){var y=I.updateQueue;y!==null&&(y=y.shared,pi!==null&&I.mode&1&&!(Dt&2)?(I=y.interleaved,I===null?(d.next=d,es===null?es=[y]:es.push(y)):(d.next=I.next,I.next=d),y.interleaved=d):(I=y.pending,I===null?d.next=d:(d.next=I.next,I.next=d),y.pending=d))}function ha(I,d,y){if(d=d.updateQueue,d!==null&&(d=d.shared,(y&4194240)!==0)){var v=d.lanes;v&=I.pendingLanes,y|=v,d.lanes=y,No(I,y)}}function Gd(I,d){var y=I.updateQueue,v=I.alternate;if(v!==null&&(v=v.updateQueue,y===v)){var V=null,X=null;if(y=y.firstBaseUpdate,y!==null){do{var O={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};X===null?V=X=O:X=X.next=O,y=y.next}while(y!==null);X===null?V=X=d:X=X.next=d}else V=X=d;y={baseState:v.baseState,firstBaseUpdate:V,lastBaseUpdate:X,shared:v.shared,effects:v.effects},I.updateQueue=y;return}I=y.lastBaseUpdate,I===null?y.firstBaseUpdate=d:I.next=d,y.lastBaseUpdate=d}function Vg(I,d,y,v){var V=I.updateQueue;lr=!1;var X=V.firstBaseUpdate,O=V.lastBaseUpdate,te=V.shared.pending;if(te!==null){V.shared.pending=null;var Ge=te,ze=Ge.next;Ge.next=null,O===null?X=ze:O.next=ze,O=Ge;var It=I.alternate;It!==null&&(It=It.updateQueue,te=It.lastBaseUpdate,te!==O&&(te===null?It.firstBaseUpdate=ze:te.next=ze,It.lastBaseUpdate=Ge))}if(X!==null){var Ht=V.baseState;O=0,It=ze=Ge=null,te=X;do{var Zt=te.lane,Rn=te.eventTime;if((v&Zt)===Zt){It!==null&&(It=It.next={eventTime:Rn,lane:0,tag:te.tag,payload:te.payload,callback:te.callback,next:null});e:{var yt=I,os=te;switch(Zt=d,Rn=y,os.tag){case 1:if(yt=os.payload,typeof yt=="function"){Ht=yt.call(Rn,Ht,Zt);break e}Ht=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=os.payload,Zt=typeof yt=="function"?yt.call(Rn,Ht,Zt):yt,Zt==null)break e;Ht=o({},Ht,Zt);break e;case 2:lr=!0}}te.callback!==null&&te.lane!==0&&(I.flags|=64,Zt=V.effects,Zt===null?V.effects=[te]:Zt.push(te))}else Rn={eventTime:Rn,lane:Zt,tag:te.tag,payload:te.payload,callback:te.callback,next:null},It===null?(ze=It=Rn,Ge=Ht):It=It.next=Rn,O|=Zt;if(te=te.next,te===null){if(te=V.shared.pending,te===null)break;Zt=te,te=Zt.next,Zt.next=null,V.lastBaseUpdate=Zt,V.shared.pending=null}}while(!0);if(It===null&&(Ge=Ht),V.baseState=Ge,V.firstBaseUpdate=ze,V.lastBaseUpdate=It,d=V.shared.interleaved,d!==null){V=d;do O|=V.lane,V=V.next;while(V!==d)}else X===null&&(V.shared.lanes=0);xu|=O,I.lanes=O,I.memoizedState=Ht}}function Xr(I,d,y){if(I=d.effects,d.effects=null,I!==null)for(d=0;d<I.length;d++){var v=I[d],V=v.callback;if(V!==null){if(v.callback=null,v=y,typeof V!="function")throw Error(r(191,V));V.call(v)}}}var vd=new i.Component().refs;function yu(I,d,y,v){d=I.memoizedState,y=y(v,d),y=y==null?d:o({},d,y),I.memoizedState=y,I.lanes===0&&(I.updateQueue.baseState=y)}var Wg={isMounted:function(I){return(I=I._reactInternals)?F(I)===I:!1},enqueueSetState:function(I,d,y){I=I._reactInternals;var v=xs(),V=Il(I),X=Io(v,V);X.payload=d,y!=null&&(X.callback=y),gr(I,X),d=Eo(I,V,v),d!==null&&ha(d,I,V)},enqueueReplaceState:function(I,d,y){I=I._reactInternals;var v=xs(),V=Il(I),X=Io(v,V);X.tag=1,X.payload=d,y!=null&&(X.callback=y),gr(I,X),d=Eo(I,V,v),d!==null&&ha(d,I,V)},enqueueForceUpdate:function(I,d){I=I._reactInternals;var y=xs(),v=Il(I),V=Io(y,v);V.tag=2,d!=null&&(V.callback=d),gr(I,V),d=Eo(I,v,y),d!==null&&ha(d,I,v)}};function wd(I,d,y,v,V,X,O){return I=I.stateNode,typeof I.shouldComponentUpdate=="function"?I.shouldComponentUpdate(v,X,O):d.prototype&&d.prototype.isPureReactComponent?!Ca(y,v)||!Ca(V,X):!0}function Mg(I,d,y){var v=!1,V=at,X=d.contextType;return typeof X=="object"&&X!==null?X=Zs(X):(V=pn(d)?On:Ut.current,v=d.contextTypes,X=(v=v!=null)?ws(I,V):at),d=new d(y,X),I.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=Wg,I.stateNode=d,d._reactInternals=I,v&&(I=I.stateNode,I.__reactInternalMemoizedUnmaskedChildContext=V,I.__reactInternalMemoizedMaskedChildContext=X),d}function ts(I,d,y,v){I=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(y,v),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(y,v),d.state!==I&&Wg.enqueueReplaceState(d,d.state,null)}function Bu(I,d,y,v){var V=I.stateNode;V.props=y,V.state=I.memoizedState,V.refs=vd,fu(I);var X=d.contextType;typeof X=="object"&&X!==null?V.context=Zs(X):(X=pn(d)?On:Ut.current,V.context=ws(I,X)),V.state=I.memoizedState,X=d.getDerivedStateFromProps,typeof X=="function"&&(yu(I,d,X,y),V.state=I.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(d=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),d!==V.state&&Wg.enqueueReplaceState(V,V.state,null),Vg(I,y,V,v),V.state=I.memoizedState),typeof V.componentDidMount=="function"&&(I.flags|=4194308)}var Aa=[],Co=0,f=null,W=0,H=[],K=0,le=null,pe=1,Le="";function sn(I,d){Aa[Co++]=W,Aa[Co++]=f,f=I,W=d}function Ci(I,d,y){H[K++]=pe,H[K++]=Le,H[K++]=le,le=I;var v=pe;I=Le;var V=32-Ii(v)-1;v&=~(1<<V),y+=1;var X=32-Ii(d)+V;if(30<X){var O=V-V%5;X=(v&(1<<O)-1).toString(32),v>>=O,V-=O,pe=1<<32-Ii(d)+V|y<<V|v,Le=X+I}else pe=1<<X|y<<V|v,Le=I}function en(I){I.return!==null&&(sn(I,1),Ci(I,1,0))}function hi(I){for(;I===f;)f=Aa[--Co],Aa[Co]=null,W=Aa[--Co],Aa[Co]=null;for(;I===le;)le=H[--K],H[K]=null,Le=H[--K],H[K]=null,pe=H[--K],H[K]=null}var mn=null,Ai=null,tn=!1,Tr=!1,Ss=null;function bR(I,d){var y=Yo(5,null,null,0);y.elementType="DELETED",y.stateNode=d,y.return=I,d=I.deletions,d===null?(I.deletions=[y],I.flags|=16):d.push(y)}function yR(I,d){switch(I.tag){case 5:return d=Fn(d,I.type,I.pendingProps),d!==null?(I.stateNode=d,mn=I,Ai=Iu(d),!0):!1;case 6:return d=fg(d,I.pendingProps),d!==null?(I.stateNode=d,mn=I,Ai=null,!0):!1;case 13:if(d=vs(d),d!==null){var y=le!==null?{id:pe,overflow:Le}:null;return I.memoizedState={dehydrated:d,treeContext:y,retryLane:1073741824},y=Yo(18,null,null,0),y.stateNode=d,y.return=I,I.child=y,mn=I,Ai=null,!0}return!1;default:return!1}}function wy(I){return(I.mode&1)!==0&&(I.flags&128)===0}function Zy(I){if(tn){var d=Ai;if(d){var y=d;if(!yR(I,d)){if(wy(I))throw Error(r(418));d=Yi(y);var v=mn;d&&yR(I,d)?bR(v,y):(I.flags=I.flags&-4097|2,tn=!1,mn=I)}}else{if(wy(I))throw Error(r(418));I.flags=I.flags&-4097|2,tn=!1,mn=I}}}function BR(I){for(I=I.return;I!==null&&I.tag!==5&&I.tag!==3&&I.tag!==13;)I=I.return;mn=I}function Zd(I){if(!D||I!==mn)return!1;if(!tn)return BR(I),tn=!0,!1;if(I.tag!==3&&(I.tag!==5||re(I.type)&&!Be(I.type,I.memoizedProps))){var d=Ai;if(d){if(wy(I)){for(I=Ai;I;)I=Yi(I);throw Error(r(418))}for(;d;)bR(I,d),d=Yi(d)}}if(BR(I),I.tag===13){if(!D)throw Error(r(316));if(I=I.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(r(317));Ai=Mo(I)}else Ai=mn?Yi(I.stateNode):null;return!0}function Gu(){D&&(Ai=mn=null,Tr=tn=!1)}function Sy(I){Ss===null?Ss=[I]:Ss.push(I)}function Sd(I,d,y){if(I=y.ref,I!==null&&typeof I!="function"&&typeof I!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(r(309));var v=y.stateNode}if(!v)throw Error(r(147,I));var V=v,X=""+I;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===X?d.ref:(d=function(O){var te=V.refs;te===vd&&(te=V.refs={}),O===null?delete te[X]:te[X]=O},d._stringRef=X,d)}if(typeof I!="string")throw Error(r(284));if(!y._owner)throw Error(r(290,I))}return I}function xA(I,d){throw I=Object.prototype.toString.call(d),Error(r(31,I==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":I))}function GR(I){var d=I._init;return d(I._payload)}function vR(I){function d(he,oe){if(I){var fe=he.deletions;fe===null?(he.deletions=[oe],he.flags|=16):fe.push(oe)}}function y(he,oe){if(!I)return null;for(;oe!==null;)d(he,oe),oe=oe.sibling;return null}function v(he,oe){for(he=new Map;oe!==null;)oe.key!==null?he.set(oe.key,oe):he.set(oe.index,oe),oe=oe.sibling;return he}function V(he,oe){return he=Cl(he,oe),he.index=0,he.sibling=null,he}function X(he,oe,fe){return he.index=fe,I?(fe=he.alternate,fe!==null?(fe=fe.index,fe<oe?(he.flags|=2,oe):fe):(he.flags|=2,oe)):(he.flags|=1048576,oe)}function O(he){return I&&he.alternate===null&&(he.flags|=2),he}function te(he,oe,fe,nt){return oe===null||oe.tag!==6?(oe=cB(fe,he.mode,nt),oe.return=he,oe):(oe=V(oe,fe),oe.return=he,oe)}function Ge(he,oe,fe,nt){var mt=fe.type;return mt===c?It(he,oe,fe.props.children,nt,fe.key):oe!==null&&(oe.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===G&&GR(mt)===oe.type)?(nt=V(oe,fe.props),nt.ref=Sd(he,oe,fe),nt.return=he,nt):(nt=rp(fe.type,fe.key,fe.props,null,he.mode,nt),nt.ref=Sd(he,oe,fe),nt.return=he,nt)}function ze(he,oe,fe,nt){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==fe.containerInfo||oe.stateNode.implementation!==fe.implementation?(oe=uB(fe,he.mode,nt),oe.return=he,oe):(oe=V(oe,fe.children||[]),oe.return=he,oe)}function It(he,oe,fe,nt,mt){return oe===null||oe.tag!==7?(oe=Yg(fe,he.mode,nt,mt),oe.return=he,oe):(oe=V(oe,fe),oe.return=he,oe)}function Ht(he,oe,fe){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return oe=cB(""+oe,he.mode,fe),oe.return=he,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case l:return fe=rp(oe.type,oe.key,oe.props,null,he.mode,fe),fe.ref=Sd(he,null,oe),fe.return=he,fe;case g:return oe=uB(oe,he.mode,fe),oe.return=he,oe;case G:var nt=oe._init;return Ht(he,nt(oe._payload),fe)}if(ue(oe)||M(oe))return oe=Yg(oe,he.mode,fe,null),oe.return=he,oe;xA(he,oe)}return null}function Zt(he,oe,fe,nt){var mt=oe!==null?oe.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return mt!==null?null:te(he,oe,""+fe,nt);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case l:return fe.key===mt?Ge(he,oe,fe,nt):null;case g:return fe.key===mt?ze(he,oe,fe,nt):null;case G:return mt=fe._init,Zt(he,oe,mt(fe._payload),nt)}if(ue(fe)||M(fe))return mt!==null?null:It(he,oe,fe,nt,null);xA(he,fe)}return null}function Rn(he,oe,fe,nt,mt){if(typeof nt=="string"&&nt!==""||typeof nt=="number")return he=he.get(fe)||null,te(oe,he,""+nt,mt);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case l:return he=he.get(nt.key===null?fe:nt.key)||null,Ge(oe,he,nt,mt);case g:return he=he.get(nt.key===null?fe:nt.key)||null,ze(oe,he,nt,mt);case G:var kt=nt._init;return Rn(he,oe,fe,kt(nt._payload),mt)}if(ue(nt)||M(nt))return he=he.get(fe)||null,It(oe,he,nt,mt,null);xA(oe,nt)}return null}function yt(he,oe,fe,nt){for(var mt=null,kt=null,Xt=oe,Cn=oe=0,Vi=null;Xt!==null&&Cn<fe.length;Cn++){Xt.index>Cn?(Vi=Xt,Xt=null):Vi=Xt.sibling;var hn=Zt(he,Xt,fe[Cn],nt);if(hn===null){Xt===null&&(Xt=Vi);break}I&&Xt&&hn.alternate===null&&d(he,Xt),oe=X(hn,oe,Cn),kt===null?mt=hn:kt.sibling=hn,kt=hn,Xt=Vi}if(Cn===fe.length)return y(he,Xt),tn&&sn(he,Cn),mt;if(Xt===null){for(;Cn<fe.length;Cn++)Xt=Ht(he,fe[Cn],nt),Xt!==null&&(oe=X(Xt,oe,Cn),kt===null?mt=Xt:kt.sibling=Xt,kt=Xt);return tn&&sn(he,Cn),mt}for(Xt=v(he,Xt);Cn<fe.length;Cn++)Vi=Rn(Xt,he,Cn,fe[Cn],nt),Vi!==null&&(I&&Vi.alternate!==null&&Xt.delete(Vi.key===null?Cn:Vi.key),oe=X(Vi,oe,Cn),kt===null?mt=Vi:kt.sibling=Vi,kt=Vi);return I&&Xt.forEach(function(hl){return d(he,hl)}),tn&&sn(he,Cn),mt}function os(he,oe,fe,nt){var mt=M(fe);if(typeof mt!="function")throw Error(r(150));if(fe=mt.call(fe),fe==null)throw Error(r(151));for(var kt=mt=null,Xt=oe,Cn=oe=0,Vi=null,hn=fe.next();Xt!==null&&!hn.done;Cn++,hn=fe.next()){Xt.index>Cn?(Vi=Xt,Xt=null):Vi=Xt.sibling;var hl=Zt(he,Xt,hn.value,nt);if(hl===null){Xt===null&&(Xt=Vi);break}I&&Xt&&hl.alternate===null&&d(he,Xt),oe=X(hl,oe,Cn),kt===null?mt=hl:kt.sibling=hl,kt=hl,Xt=Vi}if(hn.done)return y(he,Xt),tn&&sn(he,Cn),mt;if(Xt===null){for(;!hn.done;Cn++,hn=fe.next())hn=Ht(he,hn.value,nt),hn!==null&&(oe=X(hn,oe,Cn),kt===null?mt=hn:kt.sibling=hn,kt=hn);return tn&&sn(he,Cn),mt}for(Xt=v(he,Xt);!hn.done;Cn++,hn=fe.next())hn=Rn(Xt,he,Cn,hn.value,nt),hn!==null&&(I&&hn.alternate!==null&&Xt.delete(hn.key===null?Cn:hn.key),oe=X(hn,oe,Cn),kt===null?mt=hn:kt.sibling=hn,kt=hn);return I&&Xt.forEach(function(r_){return d(he,r_)}),tn&&sn(he,Cn),mt}function Ko(he,oe,fe,nt){if(typeof fe=="object"&&fe!==null&&fe.type===c&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case l:e:{for(var mt=fe.key,kt=oe;kt!==null;){if(kt.key===mt){if(mt=fe.type,mt===c){if(kt.tag===7){y(he,kt.sibling),oe=V(kt,fe.props.children),oe.return=he,he=oe;break e}}else if(kt.elementType===mt||typeof mt=="object"&&mt!==null&&mt.$$typeof===G&&GR(mt)===kt.type){y(he,kt.sibling),oe=V(kt,fe.props),oe.ref=Sd(he,kt,fe),oe.return=he,he=oe;break e}y(he,kt);break}else d(he,kt);kt=kt.sibling}fe.type===c?(oe=Yg(fe.props.children,he.mode,nt,fe.key),oe.return=he,he=oe):(nt=rp(fe.type,fe.key,fe.props,null,he.mode,nt),nt.ref=Sd(he,oe,fe),nt.return=he,he=nt)}return O(he);case g:e:{for(kt=fe.key;oe!==null;){if(oe.key===kt)if(oe.tag===4&&oe.stateNode.containerInfo===fe.containerInfo&&oe.stateNode.implementation===fe.implementation){y(he,oe.sibling),oe=V(oe,fe.children||[]),oe.return=he,he=oe;break e}else{y(he,oe);break}else d(he,oe);oe=oe.sibling}oe=uB(fe,he.mode,nt),oe.return=he,he=oe}return O(he);case G:return kt=fe._init,Ko(he,oe,kt(fe._payload),nt)}if(ue(fe))return yt(he,oe,fe,nt);if(M(fe))return os(he,oe,fe,nt);xA(he,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,oe!==null&&oe.tag===6?(y(he,oe.sibling),oe=V(oe,fe),oe.return=he,he=oe):(y(he,oe),oe=cB(fe,he.mode,nt),oe.return=he,he=oe),O(he)):y(he,oe)}return Ko}var vu=vR(!0),wR=vR(!1),Rd={},Xo=ln(Rd),xd=ln(Rd),wu=ln(Rd);function Er(I){if(I===Rd)throw Error(r(174));return I}function Ry(I,d){At(wu,d),At(xd,I),At(Xo,Rd),I=Ie(d),Tt(Xo),At(Xo,I)}function Zu(){Tt(Xo),Tt(xd),Tt(wu)}function ZR(I){var d=Er(wu.current),y=Er(Xo.current);d=k(y,I.type,d),y!==d&&(At(xd,I),At(Xo,d))}function xy(I){xd.current===I&&(Tt(Xo),Tt(xd))}var Ln=ln(0);function VA(I){for(var d=I;d!==null;){if(d.tag===13){var y=d.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||Wo(y)||sl(y)))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if(d.flags&128)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===I)break;for(;d.sibling===null;){if(d.return===null||d.return===I)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var Vy=[];function Wy(){for(var I=0;I<Vy.length;I++){var d=Vy[I];ot?d._workInProgressVersionPrimary=null:d._workInProgressVersionSecondary=null}Vy.length=0}var WA=a.ReactCurrentDispatcher,To=a.ReactCurrentBatchConfig,Su=0,Qn=null,ns=null,xi=null,MA=!1,Vd=!1,Wd=0,W5=0;function is(){throw Error(r(321))}function My(I,d){if(d===null)return!1;for(var y=0;y<d.length&&y<I.length;y++)if(!go(I[y],d[y]))return!1;return!0}function Ny(I,d,y,v,V,X){if(Su=X,Qn=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,WA.current=I===null||I.memoizedState===null?H5:X5,I=y(v,V),Vd){X=0;do{if(Vd=!1,Wd=0,25<=X)throw Error(r(301));X+=1,xi=ns=null,d.updateQueue=null,WA.current=T5,I=y(v,V)}while(Vd)}if(WA.current=TA,d=ns!==null&&ns.next!==null,Su=0,xi=ns=Qn=null,MA=!1,d)throw Error(r(300));return I}function Fy(){var I=Wd!==0;return Wd=0,I}function pa(){var I={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return xi===null?Qn.memoizedState=xi=I:xi=xi.next=I,xi}function Yr(){if(ns===null){var I=Qn.alternate;I=I!==null?I.memoizedState:null}else I=ns.next;var d=xi===null?Qn.memoizedState:xi.next;if(d!==null)xi=d,ns=I;else{if(I===null)throw Error(r(310));ns=I,I={memoizedState:ns.memoizedState,baseState:ns.baseState,baseQueue:ns.baseQueue,queue:ns.queue,next:null},xi===null?Qn.memoizedState=xi=I:xi=xi.next=I}return xi}function Ng(I,d){return typeof d=="function"?d(I):d}function NA(I){var d=Yr(),y=d.queue;if(y===null)throw Error(r(311));y.lastRenderedReducer=I;var v=ns,V=v.baseQueue,X=y.pending;if(X!==null){if(V!==null){var O=V.next;V.next=X.next,X.next=O}v.baseQueue=V=X,y.pending=null}if(V!==null){X=V.next,v=v.baseState;var te=O=null,Ge=null,ze=X;do{var It=ze.lane;if((Su&It)===It)Ge!==null&&(Ge=Ge.next={lane:0,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null}),v=ze.hasEagerState?ze.eagerState:I(v,ze.action);else{var Ht={lane:It,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null};Ge===null?(te=Ge=Ht,O=v):Ge=Ge.next=Ht,Qn.lanes|=It,xu|=It}ze=ze.next}while(ze!==null&&ze!==X);Ge===null?O=v:Ge.next=te,go(v,d.memoizedState)||(ho=!0),d.memoizedState=v,d.baseState=O,d.baseQueue=Ge,y.lastRenderedState=v}if(I=y.interleaved,I!==null){V=I;do X=V.lane,Qn.lanes|=X,xu|=X,V=V.next;while(V!==I)}else V===null&&(y.lanes=0);return[d.memoizedState,y.dispatch]}function FA(I){var d=Yr(),y=d.queue;if(y===null)throw Error(r(311));y.lastRenderedReducer=I;var v=y.dispatch,V=y.pending,X=d.memoizedState;if(V!==null){y.pending=null;var O=V=V.next;do X=I(X,O.action),O=O.next;while(O!==V);go(X,d.memoizedState)||(ho=!0),d.memoizedState=X,d.baseQueue===null&&(d.baseState=X),y.lastRenderedState=X}return[X,v]}function SR(){}function RR(I,d){var y=Qn,v=Yr(),V=d(),X=!go(v.memoizedState,V);if(X&&(v.memoizedState=V,ho=!0),v=v.queue,Nd(WR.bind(null,y,v,I),[I]),v.getSnapshot!==d||X||xi!==null&&xi.memoizedState.tag&1){if(y.flags|=2048,Md(9,VR.bind(null,y,v,V,d),void 0,null),pi===null)throw Error(r(349));Su&30||xR(y,d,V)}return V}function xR(I,d,y){I.flags|=16384,I={getSnapshot:d,value:y},d=Qn.updateQueue,d===null?(d={lastEffect:null,stores:null},Qn.updateQueue=d,d.stores=[I]):(y=d.stores,y===null?d.stores=[I]:y.push(I))}function VR(I,d,y,v){d.value=y,d.getSnapshot=v,MR(d)&&Eo(I,1,-1)}function WR(I,d,y){return y(function(){MR(d)&&Eo(I,1,-1)})}function MR(I){var d=I.getSnapshot;I=I.value;try{var y=d();return!go(I,y)}catch{return!0}}function Hy(I){var d=pa();return typeof I=="function"&&(I=I()),d.memoizedState=d.baseState=I,I={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ng,lastRenderedState:I},d.queue=I,I=I.dispatch=F5.bind(null,Qn,I),[d.memoizedState,I]}function Md(I,d,y,v){return I={tag:I,create:d,destroy:y,deps:v,next:null},d=Qn.updateQueue,d===null?(d={lastEffect:null,stores:null},Qn.updateQueue=d,d.lastEffect=I.next=I):(y=d.lastEffect,y===null?d.lastEffect=I.next=I:(v=y.next,y.next=I,I.next=v,d.lastEffect=I)),I}function NR(){return Yr().memoizedState}function HA(I,d,y,v){var V=pa();Qn.flags|=I,V.memoizedState=Md(1|d,y,void 0,v===void 0?null:v)}function XA(I,d,y,v){var V=Yr();v=v===void 0?null:v;var X=void 0;if(ns!==null){var O=ns.memoizedState;if(X=O.destroy,v!==null&&My(v,O.deps)){V.memoizedState=Md(d,y,X,v);return}}Qn.flags|=I,V.memoizedState=Md(1|d,y,X,v)}function Xy(I,d){return HA(8390656,8,I,d)}function Nd(I,d){return XA(2048,8,I,d)}function FR(I,d){return XA(4,2,I,d)}function HR(I,d){return XA(4,4,I,d)}function XR(I,d){if(typeof d=="function")return I=I(),d(I),function(){d(null)};if(d!=null)return I=I(),d.current=I,function(){d.current=null}}function TR(I,d,y){return y=y!=null?y.concat([I]):null,XA(4,4,XR.bind(null,d,I),y)}function Ty(){}function ER(I,d){var y=Yr();d=d===void 0?null:d;var v=y.memoizedState;return v!==null&&d!==null&&My(d,v[1])?v[0]:(y.memoizedState=[I,d],I)}function YR(I,d){var y=Yr();d=d===void 0?null:d;var v=y.memoizedState;return v!==null&&d!==null&&My(d,v[1])?v[0]:(I=I(),y.memoizedState=[I,d],I)}function M5(I,d){var y=nn;nn=y!==0&&4>y?y:4,I(!0);var v=To.transition;To.transition={};try{I(!1),d()}finally{nn=y,To.transition=v}}function KR(){return Yr().memoizedState}function N5(I,d,y){var v=Il(I);y={lane:v,action:y,hasEagerState:!1,eagerState:null,next:null},_R(I)?LR(d,y):(kR(I,d,y),y=xs(),I=Eo(I,v,y),I!==null&&zR(I,d,v))}function F5(I,d,y){var v=Il(I),V={lane:v,action:y,hasEagerState:!1,eagerState:null,next:null};if(_R(I))LR(d,V);else{kR(I,d,V);var X=I.alternate;if(I.lanes===0&&(X===null||X.lanes===0)&&(X=d.lastRenderedReducer,X!==null))try{var O=d.lastRenderedState,te=X(O,y);if(V.hasEagerState=!0,V.eagerState=te,go(te,O))return}catch{}finally{}y=xs(),I=Eo(I,v,y),I!==null&&zR(I,d,v)}}function _R(I){var d=I.alternate;return I===Qn||d!==null&&d===Qn}function LR(I,d){Vd=MA=!0;var y=I.pending;y===null?d.next=d:(d.next=y.next,y.next=d),I.pending=d}function kR(I,d,y){pi!==null&&I.mode&1&&!(Dt&2)?(I=d.interleaved,I===null?(y.next=y,es===null?es=[d]:es.push(d)):(y.next=I.next,I.next=y),d.interleaved=y):(I=d.pending,I===null?y.next=y:(y.next=I.next,I.next=y),d.pending=y)}function zR(I,d,y){if(y&4194240){var v=d.lanes;v&=I.pendingLanes,y|=v,d.lanes=y,No(I,y)}}var TA={readContext:Zs,useCallback:is,useContext:is,useEffect:is,useImperativeHandle:is,useInsertionEffect:is,useLayoutEffect:is,useMemo:is,useReducer:is,useRef:is,useState:is,useDebugValue:is,useDeferredValue:is,useTransition:is,useMutableSource:is,useSyncExternalStore:is,useId:is,unstable_isNewReconciler:!1},H5={readContext:Zs,useCallback:function(I,d){return pa().memoizedState=[I,d===void 0?null:d],I},useContext:Zs,useEffect:Xy,useImperativeHandle:function(I,d,y){return y=y!=null?y.concat([I]):null,HA(4194308,4,XR.bind(null,d,I),y)},useLayoutEffect:function(I,d){return HA(4194308,4,I,d)},useInsertionEffect:function(I,d){return HA(4,2,I,d)},useMemo:function(I,d){var y=pa();return d=d===void 0?null:d,I=I(),y.memoizedState=[I,d],I},useReducer:function(I,d,y){var v=pa();return d=y!==void 0?y(d):d,v.memoizedState=v.baseState=d,I={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:I,lastRenderedState:d},v.queue=I,I=I.dispatch=N5.bind(null,Qn,I),[v.memoizedState,I]},useRef:function(I){var d=pa();return I={current:I},d.memoizedState=I},useState:Hy,useDebugValue:Ty,useDeferredValue:function(I){var d=Hy(I),y=d[0],v=d[1];return Xy(function(){var V=To.transition;To.transition={};try{v(I)}finally{To.transition=V}},[I]),y},useTransition:function(){var I=Hy(!1),d=I[0];return I=M5.bind(null,I[1]),pa().memoizedState=I,[d,I]},useMutableSource:function(){},useSyncExternalStore:function(I,d,y){var v=Qn,V=pa();if(tn){if(y===void 0)throw Error(r(407));y=y()}else{if(y=d(),pi===null)throw Error(r(349));Su&30||xR(v,d,y)}V.memoizedState=y;var X={value:y,getSnapshot:d};return V.queue=X,Xy(WR.bind(null,v,X,I),[I]),v.flags|=2048,Md(9,VR.bind(null,v,X,y,d),void 0,null),y},useId:function(){var I=pa(),d=pi.identifierPrefix;if(tn){var y=Le,v=pe;y=(v&~(1<<32-Ii(v)-1)).toString(32)+y,d=":"+d+"R"+y,y=Wd++,0<y&&(d+="H"+y.toString(32)),d+=":"}else y=W5++,d=":"+d+"r"+y.toString(32)+":";return I.memoizedState=d},unstable_isNewReconciler:!1},X5={readContext:Zs,useCallback:ER,useContext:Zs,useEffect:Nd,useImperativeHandle:TR,useInsertionEffect:FR,useLayoutEffect:HR,useMemo:YR,useReducer:NA,useRef:NR,useState:function(){return NA(Ng)},useDebugValue:Ty,useDeferredValue:function(I){var d=NA(Ng),y=d[0],v=d[1];return Nd(function(){var V=To.transition;To.transition={};try{v(I)}finally{To.transition=V}},[I]),y},useTransition:function(){var I=NA(Ng)[0],d=Yr().memoizedState;return[I,d]},useMutableSource:SR,useSyncExternalStore:RR,useId:KR,unstable_isNewReconciler:!1},T5={readContext:Zs,useCallback:ER,useContext:Zs,useEffect:Nd,useImperativeHandle:TR,useInsertionEffect:FR,useLayoutEffect:HR,useMemo:YR,useReducer:FA,useRef:NR,useState:function(){return FA(Ng)},useDebugValue:Ty,useDeferredValue:function(I){var d=FA(Ng),y=d[0],v=d[1];return Nd(function(){var V=To.transition;To.transition={};try{v(I)}finally{To.transition=V}},[I]),y},useTransition:function(){var I=FA(Ng)[0],d=Yr().memoizedState;return[I,d]},useMutableSource:SR,useSyncExternalStore:RR,useId:KR,unstable_isNewReconciler:!1};function Ey(I,d){try{var y="",v=d;do y+=RA(v),v=v.return;while(v);var V=y}catch(X){V=`
Error generating stack: `+X.message+`
`+X.stack}return{value:I,source:d,stack:V}}function Yy(I,d){try{console.error(d.value)}catch(y){setTimeout(function(){throw y})}}var E5=typeof WeakMap=="function"?WeakMap:Map;function DR(I,d,y){y=Io(-1,y),y.tag=3,y.payload={element:null};var v=d.value;return y.callback=function(){$A||($A=!0,iB=v),Yy(I,d)},y}function PR(I,d,y){y=Io(-1,y),y.tag=3;var v=I.type.getDerivedStateFromError;if(typeof v=="function"){var V=d.value;y.payload=function(){return v(V)},y.callback=function(){Yy(I,d)}}var X=I.stateNode;return X!==null&&typeof X.componentDidCatch=="function"&&(y.callback=function(){Yy(I,d),typeof v!="function"&&(cl===null?cl=new Set([this]):cl.add(this));var O=d.stack;this.componentDidCatch(d.value,{componentStack:O!==null?O:""})}),y}function UR(I,d,y){var v=I.pingCache;if(v===null){v=I.pingCache=new E5;var V=new Set;v.set(d,V)}else V=v.get(d),V===void 0&&(V=new Set,v.set(d,V));V.has(y)||(V.add(y),I=q5.bind(null,I,d,y),d.then(I,I))}function JR(I){do{var d;if((d=I.tag===13)&&(d=I.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return I;I=I.return}while(I!==null);return null}function OR(I,d,y,v,V){return I.mode&1?(I.flags|=65536,I.lanes=V,I):(I===d?I.flags|=65536:(I.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(d=Io(-1,1),d.tag=2,gr(y,d))),y.lanes|=1),I)}function Kr(I){I.flags|=4}function QR(I,d){if(I!==null&&I.child===d.child)return!0;if(d.flags&16)return!1;for(I=d.child;I!==null;){if(I.flags&12854||I.subtreeFlags&12854)return!1;I=I.sibling}return!0}var Fd,Hd,EA,YA;if(Ue)Fd=function(I,d){for(var y=d.child;y!==null;){if(y.tag===5||y.tag===6)be(I,y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===d)break;for(;y.sibling===null;){if(y.return===null||y.return===d)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},Hd=function(){},EA=function(I,d,y,v,V){if(I=I.memoizedProps,I!==v){var X=d.stateNode,O=Er(Xo.current);y=ce(X,y,I,v,V,O),(d.updateQueue=y)&&Kr(d)}},YA=function(I,d,y,v){y!==v&&Kr(d)};else if(we){Fd=function(I,d,y,v){for(var V=d.child;V!==null;){if(V.tag===5){var X=V.stateNode;y&&v&&(X=bn(X,V.type,V.memoizedProps,V)),be(I,X)}else if(V.tag===6)X=V.stateNode,y&&v&&(X=ri(X,V.memoizedProps,V)),be(I,X);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)X=V.child,X!==null&&(X.return=V),Fd(I,V,!0,!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===d)break;for(;V.sibling===null;){if(V.return===null||V.return===d)return;V=V.return}V.sibling.return=V.return,V=V.sibling}};var jR=function(I,d,y,v){for(var V=d.child;V!==null;){if(V.tag===5){var X=V.stateNode;y&&v&&(X=bn(X,V.type,V.memoizedProps,V)),$t(I,X)}else if(V.tag===6)X=V.stateNode,y&&v&&(X=ri(X,V.memoizedProps,V)),$t(I,X);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)X=V.child,X!==null&&(X.return=V),jR(I,V,!0,!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===d)break;for(;V.sibling===null;){if(V.return===null||V.return===d)return;V=V.return}V.sibling.return=V.return,V=V.sibling}};Hd=function(I,d){var y=d.stateNode;if(!QR(I,d)){I=y.containerInfo;var v=Wt(I);jR(v,d,!1,!1),y.pendingChildren=v,Kr(d),An(I,v)}},EA=function(I,d,y,v,V){var X=I.stateNode,O=I.memoizedProps;if((I=QR(I,d))&&O===v)d.stateNode=X;else{var te=d.stateNode,Ge=Er(Xo.current),ze=null;O!==v&&(ze=ce(te,y,O,v,V,Ge)),I&&ze===null?d.stateNode=X:(X=qe(X,ze,y,O,v,d,I,te),me(X,y,v,V,Ge)&&Kr(d),d.stateNode=X,I?Kr(d):Fd(X,d,!1,!1))}},YA=function(I,d,y,v){y!==v?(I=Er(wu.current),y=Er(Xo.current),d.stateNode=He(v,I,y,d),Kr(d)):d.stateNode=I.stateNode}}else Hd=function(){},EA=function(){},YA=function(){};function Xd(I,d){if(!tn)switch(I.tailMode){case"hidden":d=I.tail;for(var y=null;d!==null;)d.alternate!==null&&(y=d),d=d.sibling;y===null?I.tail=null:y.sibling=null;break;case"collapsed":y=I.tail;for(var v=null;y!==null;)y.alternate!==null&&(v=y),y=y.sibling;v===null?d||I.tail===null?I.tail=null:I.tail.sibling=null:v.sibling=null}}function ss(I){var d=I.alternate!==null&&I.alternate.child===I.child,y=0,v=0;if(d)for(var V=I.child;V!==null;)y|=V.lanes|V.childLanes,v|=V.subtreeFlags&14680064,v|=V.flags&14680064,V.return=I,V=V.sibling;else for(V=I.child;V!==null;)y|=V.lanes|V.childLanes,v|=V.subtreeFlags,v|=V.flags,V.return=I,V=V.sibling;return I.subtreeFlags|=v,I.childLanes=y,d}function Y5(I,d,y){var v=d.pendingProps;switch(hi(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ss(d),null;case 1:return pn(d.type)&&rr(),ss(d),null;case 3:return v=d.stateNode,Zu(),Tt(xt),Tt(Ut),Wy(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(I===null||I.child===null)&&(Zd(d)?Kr(d):I===null||I.memoizedState.isDehydrated&&!(d.flags&256)||(d.flags|=1024,Ss!==null&&(rB(Ss),Ss=null))),Hd(I,d),ss(d),null;case 5:xy(d),y=Er(wu.current);var V=d.type;if(I!==null&&d.stateNode!=null)EA(I,d,V,v,y),I.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!v){if(d.stateNode===null)throw Error(r(166));return ss(d),null}if(I=Er(Xo.current),Zd(d)){if(!D)throw Error(r(175));I=bg(d.stateNode,d.type,d.memoizedProps,y,I,d,!Tr),d.updateQueue=I,I!==null&&Kr(d)}else{var X=ae(V,v,y,I,d);Fd(X,d,!1,!1),d.stateNode=X,me(X,V,v,y,I)&&Kr(d)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return ss(d),null;case 6:if(I&&d.stateNode!=null)YA(I,d,I.memoizedProps,v);else{if(typeof v!="string"&&d.stateNode===null)throw Error(r(166));if(I=Er(wu.current),y=Er(Xo.current),Zd(d)){if(!D)throw Error(r(176));if(I=d.stateNode,v=d.memoizedProps,(y=yg(I,v,d,!Tr))&&(V=mn,V!==null))switch(X=(V.mode&1)!==0,V.tag){case 3:ke(V.stateNode.containerInfo,I,v,X);break;case 5:tt(V.type,V.memoizedProps,V.stateNode,I,v,X)}y&&Kr(d)}else d.stateNode=He(v,I,y,d)}return ss(d),null;case 13:if(Tt(Ln),v=d.memoizedState,tn&&Ai!==null&&d.mode&1&&!(d.flags&128)){for(I=Ai;I;)I=Yi(I);return Gu(),d.flags|=98560,d}if(v!==null&&v.dehydrated!==null){if(v=Zd(d),I===null){if(!v)throw Error(r(318));if(!D)throw Error(r(344));if(I=d.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(r(317));rl(I,d)}else Gu(),!(d.flags&128)&&(d.memoizedState=null),d.flags|=4;return ss(d),null}return Ss!==null&&(rB(Ss),Ss=null),d.flags&128?(d.lanes=y,d):(v=v!==null,y=!1,I===null?Zd(d):y=I.memoizedState!==null,v&&!y&&(d.child.flags|=8192,d.mode&1&&(I===null||Ln.current&1?Gi===0&&(Gi=3):lB())),d.updateQueue!==null&&(d.flags|=4),ss(d),null);case 4:return Zu(),Hd(I,d),I===null&&Ye(d.stateNode.containerInfo),ss(d),null;case 10:return mu(d.type._context),ss(d),null;case 17:return pn(d.type)&&rr(),ss(d),null;case 19:if(Tt(Ln),V=d.memoizedState,V===null)return ss(d),null;if(v=(d.flags&128)!==0,X=V.rendering,X===null)if(v)Xd(V,!1);else{if(Gi!==0||I!==null&&I.flags&128)for(I=d.child;I!==null;){if(X=VA(I),X!==null){for(d.flags|=128,Xd(V,!1),I=X.updateQueue,I!==null&&(d.updateQueue=I,d.flags|=4),d.subtreeFlags=0,I=y,v=d.child;v!==null;)y=v,V=I,y.flags&=14680066,X=y.alternate,X===null?(y.childLanes=0,y.lanes=V,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=X.childLanes,y.lanes=X.lanes,y.child=X.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=X.memoizedProps,y.memoizedState=X.memoizedState,y.updateQueue=X.updateQueue,y.type=X.type,V=X.dependencies,y.dependencies=V===null?null:{lanes:V.lanes,firstContext:V.firstContext}),v=v.sibling;return At(Ln,Ln.current&1|2),d.child}I=I.sibling}V.tail!==null&&di()>nB&&(d.flags|=128,v=!0,Xd(V,!1),d.lanes=4194304)}else{if(!v)if(I=VA(X),I!==null){if(d.flags|=128,v=!0,I=I.updateQueue,I!==null&&(d.updateQueue=I,d.flags|=4),Xd(V,!0),V.tail===null&&V.tailMode==="hidden"&&!X.alternate&&!tn)return ss(d),null}else 2*di()-V.renderingStartTime>nB&&y!==1073741824&&(d.flags|=128,v=!0,Xd(V,!1),d.lanes=4194304);V.isBackwards?(X.sibling=d.child,d.child=X):(I=V.last,I!==null?I.sibling=X:d.child=X,V.last=X)}return V.tail!==null?(d=V.tail,V.rendering=d,V.tail=d.sibling,V.renderingStartTime=di(),d.sibling=null,I=Ln.current,At(Ln,v?I&1|2:I&1),d):(ss(d),null);case 22:case 23:return aB(),v=d.memoizedState!==null,I!==null&&I.memoizedState!==null!==v&&(d.flags|=8192),v&&d.mode&1?Ao&1073741824&&(ss(d),Ue&&d.subtreeFlags&6&&(d.flags|=8192)):ss(d),null;case 24:return null;case 25:return null}throw Error(r(156,d.tag))}var K5=a.ReactCurrentOwner,ho=!1;function Rs(I,d,y,v){d.child=I===null?wR(d,null,y,v):vu(d,I.child,y,v)}function qR(I,d,y,v,V){y=y.render;var X=d.ref;return gl(d,V),v=Ny(I,d,y,v,X,V),y=Fy(),I!==null&&!ho?(d.updateQueue=I.updateQueue,d.flags&=-2053,I.lanes&=~V,ma(I,d,V)):(tn&&y&&en(d),d.flags|=1,Rs(I,d,v,V),d.child)}function $R(I,d,y,v,V){if(I===null){var X=y.type;return typeof X=="function"&&!gB(X)&&X.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(d.tag=15,d.type=X,ex(I,d,X,v,V)):(I=rp(y.type,null,v,d,d.mode,V),I.ref=d.ref,I.return=d,d.child=I)}if(X=I.child,!(I.lanes&V)){var O=X.memoizedProps;if(y=y.compare,y=y!==null?y:Ca,y(O,v)&&I.ref===d.ref)return ma(I,d,V)}return d.flags|=1,I=Cl(X,v),I.ref=d.ref,I.return=d,d.child=I}function ex(I,d,y,v,V){if(I!==null&&Ca(I.memoizedProps,v)&&I.ref===d.ref)if(ho=!1,(I.lanes&V)!==0)I.flags&131072&&(ho=!0);else return d.lanes=I.lanes,ma(I,d,V);return Ky(I,d,y,v,V)}function tx(I,d,y){var v=d.pendingProps,V=v.children,X=I!==null?I.memoizedState:null;if(v.mode==="hidden")if(!(d.mode&1))d.memoizedState={baseLanes:0,cachePool:null},At(Ru,Ao),Ao|=y;else if(y&1073741824)d.memoizedState={baseLanes:0,cachePool:null},v=X!==null?X.baseLanes:y,At(Ru,Ao),Ao|=v;else return I=X!==null?X.baseLanes|y:y,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:I,cachePool:null},d.updateQueue=null,At(Ru,Ao),Ao|=I,null;else X!==null?(v=X.baseLanes|y,d.memoizedState=null):v=y,At(Ru,Ao),Ao|=v;return Rs(I,d,V,y),d.child}function nx(I,d){var y=d.ref;(I===null&&y!==null||I!==null&&I.ref!==y)&&(d.flags|=512,d.flags|=2097152)}function Ky(I,d,y,v,V){var X=pn(y)?On:Ut.current;return X=ws(d,X),gl(d,V),y=Ny(I,d,y,v,X,V),v=Fy(),I!==null&&!ho?(d.updateQueue=I.updateQueue,d.flags&=-2053,I.lanes&=~V,ma(I,d,V)):(tn&&v&&en(d),d.flags|=1,Rs(I,d,y,V),d.child)}function ix(I,d,y,v,V){if(pn(y)){var X=!0;$i(d)}else X=!1;if(gl(d,V),d.stateNode===null)I!==null&&(I.alternate=null,d.alternate=null,d.flags|=2),Mg(d,y,v),Bu(d,y,v,V),v=!0;else if(I===null){var O=d.stateNode,te=d.memoizedProps;O.props=te;var Ge=O.context,ze=y.contextType;typeof ze=="object"&&ze!==null?ze=Zs(ze):(ze=pn(y)?On:Ut.current,ze=ws(d,ze));var It=y.getDerivedStateFromProps,Ht=typeof It=="function"||typeof O.getSnapshotBeforeUpdate=="function";Ht||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(te!==v||Ge!==ze)&&ts(d,O,v,ze),lr=!1;var Zt=d.memoizedState;O.state=Zt,Vg(d,v,O,V),Ge=d.memoizedState,te!==v||Zt!==Ge||xt.current||lr?(typeof It=="function"&&(yu(d,y,It,v),Ge=d.memoizedState),(te=lr||wd(d,y,te,v,Zt,Ge,ze))?(Ht||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(d.flags|=4194308)):(typeof O.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=v,d.memoizedState=Ge),O.props=v,O.state=Ge,O.context=ze,v=te):(typeof O.componentDidMount=="function"&&(d.flags|=4194308),v=!1)}else{O=d.stateNode,bu(I,d),te=d.memoizedProps,ze=d.type===d.elementType?te:ai(d.type,te),O.props=ze,Ht=d.pendingProps,Zt=O.context,Ge=y.contextType,typeof Ge=="object"&&Ge!==null?Ge=Zs(Ge):(Ge=pn(y)?On:Ut.current,Ge=ws(d,Ge));var Rn=y.getDerivedStateFromProps;(It=typeof Rn=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(te!==Ht||Zt!==Ge)&&ts(d,O,v,Ge),lr=!1,Zt=d.memoizedState,O.state=Zt,Vg(d,v,O,V);var yt=d.memoizedState;te!==Ht||Zt!==yt||xt.current||lr?(typeof Rn=="function"&&(yu(d,y,Rn,v),yt=d.memoizedState),(ze=lr||wd(d,y,ze,v,Zt,yt,Ge)||!1)?(It||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(v,yt,Ge),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(v,yt,Ge)),typeof O.componentDidUpdate=="function"&&(d.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof O.componentDidUpdate!="function"||te===I.memoizedProps&&Zt===I.memoizedState||(d.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||te===I.memoizedProps&&Zt===I.memoizedState||(d.flags|=1024),d.memoizedProps=v,d.memoizedState=yt),O.props=v,O.state=yt,O.context=Ge,v=ze):(typeof O.componentDidUpdate!="function"||te===I.memoizedProps&&Zt===I.memoizedState||(d.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||te===I.memoizedProps&&Zt===I.memoizedState||(d.flags|=1024),v=!1)}return _y(I,d,y,v,X,V)}function _y(I,d,y,v,V,X){nx(I,d);var O=(d.flags&128)!==0;if(!v&&!O)return V&&Hn(d,y,!1),ma(I,d,X);v=d.stateNode,K5.current=d;var te=O&&typeof y.getDerivedStateFromError!="function"?null:v.render();return d.flags|=1,I!==null&&O?(d.child=vu(d,I.child,null,X),d.child=vu(d,null,te,X)):Rs(I,d,te,X),d.memoizedState=v.state,V&&Hn(d,y,!0),d.child}function sx(I){var d=I.stateNode;d.pendingContext?wn(I,d.pendingContext,d.pendingContext!==d.context):d.context&&wn(I,d.context,!1),Ry(I,d.containerInfo)}function ox(I,d,y,v,V){return Gu(),Sy(V),d.flags|=256,Rs(I,d,y,v),d.child}var KA={dehydrated:null,treeContext:null,retryLane:0};function _A(I){return{baseLanes:I,cachePool:null}}function rx(I,d,y){var v=d.pendingProps,V=Ln.current,X=!1,O=(d.flags&128)!==0,te;if((te=O)||(te=I!==null&&I.memoizedState===null?!1:(V&2)!==0),te?(X=!0,d.flags&=-129):(I===null||I.memoizedState!==null)&&(V|=1),At(Ln,V&1),I===null)return Zy(d),I=d.memoizedState,I!==null&&(I=I.dehydrated,I!==null)?(d.mode&1?sl(I)?d.lanes=8:d.lanes=1073741824:d.lanes=1,null):(V=v.children,I=v.fallback,X?(v=d.mode,X=d.child,V={mode:"hidden",children:V},!(v&1)&&X!==null?(X.childLanes=0,X.pendingProps=V):X=ap(V,v,0,null),I=Yg(I,v,y,null),X.return=d,I.return=d,X.sibling=I,d.child=X,d.child.memoizedState=_A(y),d.memoizedState=KA,I):Ly(d,V));if(V=I.memoizedState,V!==null){if(te=V.dehydrated,te!==null){if(O)return d.flags&256?(d.flags&=-257,LA(I,d,y,Error(r(422)))):d.memoizedState!==null?(d.child=I.child,d.flags|=128,null):(X=v.fallback,V=d.mode,v=ap({mode:"visible",children:v.children},V,0,null),X=Yg(X,V,y,null),X.flags|=2,v.return=d,X.return=d,v.sibling=X,d.child=v,d.mode&1&&vu(d,I.child,null,y),d.child.memoizedState=_A(y),d.memoizedState=KA,X);if(!(d.mode&1))d=LA(I,d,y,null);else if(sl(te))d=LA(I,d,y,Error(r(419)));else if(v=(y&I.childLanes)!==0,ho||v){if(v=pi,v!==null){switch(y&-y){case 4:X=2;break;case 16:X=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:X=32;break;case 536870912:X=268435456;break;default:X=0}v=X&(v.suspendedLanes|y)?0:X,v!==0&&v!==V.retryLane&&(V.retryLane=v,Eo(I,v,-1))}lB(),d=LA(I,d,y,Error(r(421)))}else Wo(te)?(d.flags|=128,d.child=I.child,d=$5.bind(null,I),uu(te,d),d=null):(y=V.treeContext,D&&(Ai=ca(te),mn=d,tn=!0,Ss=null,Tr=!1,y!==null&&(H[K++]=pe,H[K++]=Le,H[K++]=le,pe=y.id,Le=y.overflow,le=d)),d=Ly(d,d.pendingProps.children),d.flags|=4096);return d}return X?(v=lx(I,d,v.children,v.fallback,y),X=d.child,V=I.child.memoizedState,X.memoizedState=V===null?_A(y):{baseLanes:V.baseLanes|y,cachePool:null},X.childLanes=I.childLanes&~y,d.memoizedState=KA,v):(y=ax(I,d,v.children,y),d.memoizedState=null,y)}return X?(v=lx(I,d,v.children,v.fallback,y),X=d.child,V=I.child.memoizedState,X.memoizedState=V===null?_A(y):{baseLanes:V.baseLanes|y,cachePool:null},X.childLanes=I.childLanes&~y,d.memoizedState=KA,v):(y=ax(I,d,v.children,y),d.memoizedState=null,y)}function Ly(I,d){return d=ap({mode:"visible",children:d},I.mode,0,null),d.return=I,I.child=d}function ax(I,d,y,v){var V=I.child;return I=V.sibling,y=Cl(V,{mode:"visible",children:y}),!(d.mode&1)&&(y.lanes=v),y.return=d,y.sibling=null,I!==null&&(v=d.deletions,v===null?(d.deletions=[I],d.flags|=16):v.push(I)),d.child=y}function lx(I,d,y,v,V){var X=d.mode;I=I.child;var O=I.sibling,te={mode:"hidden",children:y};return!(X&1)&&d.child!==I?(y=d.child,y.childLanes=0,y.pendingProps=te,d.deletions=null):(y=Cl(I,te),y.subtreeFlags=I.subtreeFlags&14680064),O!==null?v=Cl(O,v):(v=Yg(v,X,V,null),v.flags|=2),v.return=d,y.return=d,y.sibling=v,d.child=y,v}function LA(I,d,y,v){return v!==null&&Sy(v),vu(d,I.child,null,y),I=Ly(d,d.pendingProps.children),I.flags|=2,d.memoizedState=null,I}function gx(I,d,y){I.lanes|=d;var v=I.alternate;v!==null&&(v.lanes|=d),ll(I.return,d,y)}function ky(I,d,y,v,V){var X=I.memoizedState;X===null?I.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:v,tail:y,tailMode:V}:(X.isBackwards=d,X.rendering=null,X.renderingStartTime=0,X.last=v,X.tail=y,X.tailMode=V)}function cx(I,d,y){var v=d.pendingProps,V=v.revealOrder,X=v.tail;if(Rs(I,d,v.children,y),v=Ln.current,v&2)v=v&1|2,d.flags|=128;else{if(I!==null&&I.flags&128)e:for(I=d.child;I!==null;){if(I.tag===13)I.memoizedState!==null&&gx(I,y,d);else if(I.tag===19)gx(I,y,d);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===d)break e;for(;I.sibling===null;){if(I.return===null||I.return===d)break e;I=I.return}I.sibling.return=I.return,I=I.sibling}v&=1}if(At(Ln,v),!(d.mode&1))d.memoizedState=null;else switch(V){case"forwards":for(y=d.child,V=null;y!==null;)I=y.alternate,I!==null&&VA(I)===null&&(V=y),y=y.sibling;y=V,y===null?(V=d.child,d.child=null):(V=y.sibling,y.sibling=null),ky(d,!1,V,y,X);break;case"backwards":for(y=null,V=d.child,d.child=null;V!==null;){if(I=V.alternate,I!==null&&VA(I)===null){d.child=V;break}I=V.sibling,V.sibling=y,y=V,V=I}ky(d,!0,y,null,X);break;case"together":ky(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function ma(I,d,y){if(I!==null&&(d.dependencies=I.dependencies),xu|=d.lanes,!(y&d.childLanes))return null;if(I!==null&&d.child!==I.child)throw Error(r(153));if(d.child!==null){for(I=d.child,y=Cl(I,I.pendingProps),d.child=y,y.return=d;I.sibling!==null;)I=I.sibling,y=y.sibling=Cl(I,I.pendingProps),y.return=d;y.sibling=null}return d.child}function _5(I,d,y){switch(d.tag){case 3:sx(d),Gu();break;case 5:ZR(d);break;case 1:pn(d.type)&&$i(d);break;case 4:Ry(d,d.stateNode.containerInfo);break;case 10:xg(d,d.type._context,d.memoizedProps.value);break;case 13:var v=d.memoizedState;if(v!==null)return v.dehydrated!==null?(At(Ln,Ln.current&1),d.flags|=128,null):y&d.child.childLanes?rx(I,d,y):(At(Ln,Ln.current&1),I=ma(I,d,y),I!==null?I.sibling:null);At(Ln,Ln.current&1);break;case 19:if(v=(y&d.childLanes)!==0,I.flags&128){if(v)return cx(I,d,y);d.flags|=128}var V=d.memoizedState;if(V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),At(Ln,Ln.current),v)break;return null;case 22:case 23:return d.lanes=0,tx(I,d,y)}return ma(I,d,y)}function L5(I,d){switch(hi(d),d.tag){case 1:return pn(d.type)&&rr(),I=d.flags,I&65536?(d.flags=I&-65537|128,d):null;case 3:return Zu(),Tt(xt),Tt(Ut),Wy(),I=d.flags,I&65536&&!(I&128)?(d.flags=I&-65537|128,d):null;case 5:return xy(d),null;case 13:if(Tt(Ln),I=d.memoizedState,I!==null&&I.dehydrated!==null){if(d.alternate===null)throw Error(r(340));Gu()}return I=d.flags,I&65536?(d.flags=I&-65537|128,d):null;case 19:return Tt(Ln),null;case 4:return Zu(),null;case 10:return mu(d.type._context),null;case 22:case 23:return aB(),null;case 24:return null;default:return null}}var kA=!1,Fg=!1,k5=typeof WeakSet=="function"?WeakSet:Set,$e=null;function zA(I,d){var y=I.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(v){Ds(I,d,v)}else y.current=null}function zy(I,d,y){try{y()}catch(v){Ds(I,d,v)}}var ux=!1;function z5(I,d){for(ee(I.containerInfo),$e=d;$e!==null;)if(I=$e,d=I.child,(I.subtreeFlags&1028)!==0&&d!==null)d.return=I,$e=d;else for(;$e!==null;){I=$e;try{var y=I.alternate;if(I.flags&1024)switch(I.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var v=y.memoizedProps,V=y.memoizedState,X=I.stateNode,O=X.getSnapshotBeforeUpdate(I.elementType===I.type?v:ai(I.type,v),V);X.__reactInternalSnapshotBeforeUpdate=O}break;case 3:Ue&&De(I.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(te){Ds(I,I.return,te)}if(d=I.sibling,d!==null){d.return=I.return,$e=d;break}$e=I.return}return y=ux,ux=!1,y}function Hg(I,d,y){var v=d.updateQueue;if(v=v!==null?v.lastEffect:null,v!==null){var V=v=v.next;do{if((V.tag&I)===I){var X=V.destroy;V.destroy=void 0,X!==void 0&&zy(d,y,X)}V=V.next}while(V!==v)}}function Td(I,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var y=d=d.next;do{if((y.tag&I)===I){var v=y.create;y.destroy=v()}y=y.next}while(y!==d)}}function Dy(I){var d=I.ref;if(d!==null){var y=I.stateNode;switch(I.tag){case 5:I=se(y);break;default:I=y}typeof d=="function"?d(I):d.current=I}}function Ix(I,d,y){if(lo&&typeof lo.onCommitFiberUnmount=="function")try{lo.onCommitFiberUnmount(da,d)}catch{}switch(d.tag){case 0:case 11:case 14:case 15:if(I=d.updateQueue,I!==null&&(I=I.lastEffect,I!==null)){var v=I=I.next;do{var V=v,X=V.destroy;V=V.tag,X!==void 0&&(V&2||V&4)&&zy(d,y,X),v=v.next}while(v!==I)}break;case 1:if(zA(d,y),I=d.stateNode,typeof I.componentWillUnmount=="function")try{I.props=d.memoizedProps,I.state=d.memoizedState,I.componentWillUnmount()}catch(O){Ds(d,y,O)}break;case 5:zA(d,y);break;case 4:Ue?mx(I,d,y):we&&we&&(d=d.stateNode.containerInfo,y=Wt(d),Ft(d,y))}}function dx(I,d,y){for(var v=d;;)if(Ix(I,v,y),v.child===null||Ue&&v.tag===4){if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return;v=v.return}v.sibling.return=v.return,v=v.sibling}else v.child.return=v,v=v.child}function Cx(I){var d=I.alternate;d!==null&&(I.alternate=null,Cx(d)),I.child=null,I.deletions=null,I.sibling=null,I.tag===5&&(d=I.stateNode,d!==null&&_e(d)),I.stateNode=null,I.return=null,I.dependencies=null,I.memoizedProps=null,I.memoizedState=null,I.pendingProps=null,I.stateNode=null,I.updateQueue=null}function hx(I){return I.tag===5||I.tag===3||I.tag===4}function Ax(I){e:for(;;){for(;I.sibling===null;){if(I.return===null||hx(I.return))return null;I=I.return}for(I.sibling.return=I.return,I=I.sibling;I.tag!==5&&I.tag!==6&&I.tag!==18;){if(I.flags&2||I.child===null||I.tag===4)continue e;I.child.return=I,I=I.child}if(!(I.flags&2))return I.stateNode}}function px(I){if(Ue){e:{for(var d=I.return;d!==null;){if(hx(d))break e;d=d.return}throw Error(r(160))}var y=d;switch(y.tag){case 5:d=y.stateNode,y.flags&32&&(xe(d),y.flags&=-33),y=Ax(I),Uy(I,y,d);break;case 3:case 4:d=y.stateNode.containerInfo,y=Ax(I),Py(I,y,d);break;default:throw Error(r(161))}}}function Py(I,d,y){var v=I.tag;if(v===5||v===6)I=I.stateNode,d?it(y,I,d):Kt(y,I);else if(v!==4&&(I=I.child,I!==null))for(Py(I,d,y),I=I.sibling;I!==null;)Py(I,d,y),I=I.sibling}function Uy(I,d,y){var v=I.tag;if(v===5||v===6)I=I.stateNode,d?wt(y,I,d):Qe(y,I);else if(v!==4&&(I=I.child,I!==null))for(Uy(I,d,y),I=I.sibling;I!==null;)Uy(I,d,y),I=I.sibling}function mx(I,d,y){for(var v=d,V=!1,X,O;;){if(!V){V=v.return;e:for(;;){if(V===null)throw Error(r(160));switch(X=V.stateNode,V.tag){case 5:O=!1;break e;case 3:X=X.containerInfo,O=!0;break e;case 4:X=X.containerInfo,O=!0;break e}V=V.return}V=!0}if(v.tag===5||v.tag===6)dx(I,v,y),O?q(X,v.stateNode):Nt(X,v.stateNode);else if(v.tag===18)O?Ae(X,v.stateNode):de(X,v.stateNode);else if(v.tag===4){if(v.child!==null){X=v.stateNode.containerInfo,O=!0,v.child.return=v,v=v.child;continue}}else if(Ix(I,v,y),v.child!==null){v.child.return=v,v=v.child;continue}if(v===d)break;for(;v.sibling===null;){if(v.return===null||v.return===d)return;v=v.return,v.tag===4&&(V=!1)}v.sibling.return=v.return,v=v.sibling}}function Jy(I,d){if(Ue){switch(d.tag){case 0:case 11:case 14:case 15:Hg(3,d,d.return),Td(3,d),Hg(5,d,d.return);return;case 1:return;case 5:var y=d.stateNode;if(y!=null){var v=d.memoizedProps;I=I!==null?I.memoizedProps:v;var V=d.type,X=d.updateQueue;d.updateQueue=null,X!==null&&Gt(y,X,V,I,v,d)}return;case 6:if(d.stateNode===null)throw Error(r(162));y=d.memoizedProps,Xe(d.stateNode,I!==null?I.memoizedProps:y,y);return;case 3:D&&I!==null&&I.memoizedState.isDehydrated&&L(d.stateNode.containerInfo);return;case 12:return;case 13:DA(d);return;case 19:DA(d);return;case 17:return}throw Error(r(163))}switch(d.tag){case 0:case 11:case 14:case 15:Hg(3,d,d.return),Td(3,d),Hg(5,d,d.return);return;case 12:return;case 13:DA(d);return;case 19:DA(d);return;case 3:D&&I!==null&&I.memoizedState.isDehydrated&&L(d.stateNode.containerInfo);break;case 22:case 23:return}e:if(we){switch(d.tag){case 1:case 5:case 6:break e;case 3:case 4:d=d.stateNode,Ft(d.containerInfo,d.pendingChildren);break e}throw Error(r(163))}}function DA(I){var d=I.updateQueue;if(d!==null){I.updateQueue=null;var y=I.stateNode;y===null&&(y=I.stateNode=new k5),d.forEach(function(v){var V=e_.bind(null,I,v);y.has(v)||(y.add(v),v.then(V,V))})}}function D5(I,d){for($e=d;$e!==null;){d=$e;var y=d.deletions;if(y!==null)for(var v=0;v<y.length;v++){var V=y[v];try{var X=I;Ue?mx(X,V,d):dx(X,V,d);var O=V.alternate;O!==null&&(O.return=null),V.return=null}catch(mt){Ds(V,d,mt)}}if(y=d.child,d.subtreeFlags&12854&&y!==null)y.return=d,$e=y;else for(;$e!==null;){d=$e;try{var te=d.flags;if(te&32&&Ue&&xe(d.stateNode),te&512){var Ge=d.alternate;if(Ge!==null){var ze=Ge.ref;ze!==null&&(typeof ze=="function"?ze(null):ze.current=null)}}if(te&8192)switch(d.tag){case 13:if(d.memoizedState!==null){var It=d.alternate;(It===null||It.memoizedState===null)&&(tB=di())}break;case 22:var Ht=d.memoizedState!==null,Zt=d.alternate,Rn=Zt!==null&&Zt.memoizedState!==null;if(y=d,Ue){e:if(v=y,V=Ht,X=null,Ue)for(var yt=v;;){if(yt.tag===5){if(X===null){X=yt;var os=yt.stateNode;V?Q(os):Ce(yt.stateNode,yt.memoizedProps)}}else if(yt.tag===6){if(X===null){var Ko=yt.stateNode;V?Me(Ko):Re(Ko,yt.memoizedProps)}}else if((yt.tag!==22&&yt.tag!==23||yt.memoizedState===null||yt===v)&&yt.child!==null){yt.child.return=yt,yt=yt.child;continue}if(yt===v)break;for(;yt.sibling===null;){if(yt.return===null||yt.return===v)break e;X===yt&&(X=null),yt=yt.return}X===yt&&(X=null),yt.sibling.return=yt.return,yt=yt.sibling}}if(Ht&&!Rn&&y.mode&1){$e=y;for(var he=y.child;he!==null;){for(y=$e=he;$e!==null;){v=$e;var oe=v.child;switch(v.tag){case 0:case 11:case 14:case 15:Hg(4,v,v.return);break;case 1:zA(v,v.return);var fe=v.stateNode;if(typeof fe.componentWillUnmount=="function"){var nt=v.return;try{fe.props=v.memoizedProps,fe.state=v.memoizedState,fe.componentWillUnmount()}catch(mt){Ds(v,nt,mt)}}break;case 5:zA(v,v.return);break;case 22:if(v.memoizedState!==null){yx(y);continue}}oe!==null?(oe.return=v,$e=oe):yx(y)}he=he.sibling}}}switch(te&4102){case 2:px(d),d.flags&=-3;break;case 6:px(d),d.flags&=-3,Jy(d.alternate,d);break;case 4096:d.flags&=-4097;break;case 4100:d.flags&=-4097,Jy(d.alternate,d);break;case 4:Jy(d.alternate,d)}}catch(mt){Ds(d,d.return,mt)}if(y=d.sibling,y!==null){y.return=d.return,$e=y;break}$e=d.return}}}function P5(I,d,y){$e=I,fx(I)}function fx(I,d,y){for(var v=(I.mode&1)!==0;$e!==null;){var V=$e,X=V.child;if(V.tag===22&&v){var O=V.memoizedState!==null||kA;if(!O){var te=V.alternate,Ge=te!==null&&te.memoizedState!==null||Fg;te=kA;var ze=Fg;if(kA=O,(Fg=Ge)&&!ze)for($e=V;$e!==null;)O=$e,Ge=O.child,O.tag===22&&O.memoizedState!==null?Bx(V):Ge!==null?(Ge.return=O,$e=Ge):Bx(V);for(;X!==null;)$e=X,fx(X),X=X.sibling;$e=V,kA=te,Fg=ze}bx(I)}else V.subtreeFlags&8772&&X!==null?(X.return=V,$e=X):bx(I)}}function bx(I){for(;$e!==null;){var d=$e;if(d.flags&8772){var y=d.alternate;try{if(d.flags&8772)switch(d.tag){case 0:case 11:case 15:Fg||Td(5,d);break;case 1:var v=d.stateNode;if(d.flags&4&&!Fg)if(y===null)v.componentDidMount();else{var V=d.elementType===d.type?y.memoizedProps:ai(d.type,y.memoizedProps);v.componentDidUpdate(V,y.memoizedState,v.__reactInternalSnapshotBeforeUpdate)}var X=d.updateQueue;X!==null&&Xr(d,X,v);break;case 3:var O=d.updateQueue;if(O!==null){if(y=null,d.child!==null)switch(d.child.tag){case 5:y=se(d.child.stateNode);break;case 1:y=d.child.stateNode}Xr(d,O,y)}break;case 5:var te=d.stateNode;y===null&&d.flags&4&&et(te,d.type,d.memoizedProps,d);break;case 6:break;case 4:break;case 12:break;case 13:if(D&&d.memoizedState===null){var Ge=d.alternate;if(Ge!==null){var ze=Ge.memoizedState;if(ze!==null){var It=ze.dehydrated;It!==null&&ie(It)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(r(163))}Fg||d.flags&512&&Dy(d)}catch(Ht){Ds(d,d.return,Ht)}}if(d===I){$e=null;break}if(y=d.sibling,y!==null){y.return=d.return,$e=y;break}$e=d.return}}function yx(I){for(;$e!==null;){var d=$e;if(d===I){$e=null;break}var y=d.sibling;if(y!==null){y.return=d.return,$e=y;break}$e=d.return}}function Bx(I){for(;$e!==null;){var d=$e;try{switch(d.tag){case 0:case 11:case 15:var y=d.return;try{Td(4,d)}catch(Ge){Ds(d,y,Ge)}break;case 1:var v=d.stateNode;if(typeof v.componentDidMount=="function"){var V=d.return;try{v.componentDidMount()}catch(Ge){Ds(d,V,Ge)}}var X=d.return;try{Dy(d)}catch(Ge){Ds(d,X,Ge)}break;case 5:var O=d.return;try{Dy(d)}catch(Ge){Ds(d,O,Ge)}}}catch(Ge){Ds(d,d.return,Ge)}if(d===I){$e=null;break}var te=d.sibling;if(te!==null){te.return=d.return,$e=te;break}$e=d.return}}var PA=0,UA=1,JA=2,OA=3,QA=4;if(typeof Symbol=="function"&&Symbol.for){var Ed=Symbol.for;PA=Ed("selector.component"),UA=Ed("selector.has_pseudo_class"),JA=Ed("selector.role"),OA=Ed("selector.test_id"),QA=Ed("selector.text")}function Oy(I){var d=Ee(I);if(d!=null){if(typeof d.memoizedProps["data-testname"]!="string")throw Error(r(364));return d}if(I=E(I),I===null)throw Error(r(362));return I.stateNode.current}function Qy(I,d){switch(d.$$typeof){case PA:if(I.type===d.value)return!0;break;case UA:e:{d=d.value,I=[I,0];for(var y=0;y<I.length;){var v=I[y++],V=I[y++],X=d[V];if(v.tag!==5||!Se(v)){for(;X!=null&&Qy(v,X);)V++,X=d[V];if(V===d.length){d=!0;break e}else for(v=v.child;v!==null;)I.push(v,V),v=v.sibling}}d=!1}return d;case JA:if(I.tag===5&&Ze(I.stateNode,d.value))return!0;break;case QA:if((I.tag===5||I.tag===6)&&(I=ve(I),I!==null&&0<=I.indexOf(d.value)))return!0;break;case OA:if(I.tag===5&&(I=I.memoizedProps["data-testname"],typeof I=="string"&&I.toLowerCase()===d.value.toLowerCase()))return!0;break;default:throw Error(r(365))}return!1}function jy(I){switch(I.$$typeof){case PA:return"<"+(R(I.value)||"Unknown")+">";case UA:return":has("+(jy(I)||"")+")";case JA:return'[role="'+I.value+'"]';case QA:return'"'+I.value+'"';case OA:return'[data-testname="'+I.value+'"]';default:throw Error(r(365))}}function Gx(I,d){var y=[];I=[I,0];for(var v=0;v<I.length;){var V=I[v++],X=I[v++],O=d[X];if(V.tag!==5||!Se(V)){for(;O!=null&&Qy(V,O);)X++,O=d[X];if(X===d.length)y.push(V);else for(V=V.child;V!==null;)I.push(V,X),V=V.sibling}}return y}function qy(I,d){if(!P)throw Error(r(363));I=Oy(I),I=Gx(I,d),d=[],I=Array.from(I);for(var y=0;y<I.length;){var v=I[y++];if(v.tag===5)Se(v)||d.push(v.stateNode);else for(v=v.child;v!==null;)I.push(v),v=v.sibling}return d}var U5=Math.ceil,jA=a.ReactCurrentDispatcher,$y=a.ReactCurrentOwner,li=a.ReactCurrentBatchConfig,Dt=0,pi=null,mi=null,Ki=0,Ao=0,Ru=ln(0),Gi=0,Yd=null,xu=0,qA=0,eB=0,Kd=null,ks=null,tB=0,nB=1/0;function Vu(){nB=di()+500}var $A=!1,iB=null,cl=null,ep=!1,ul=null,tp=0,_d=0,sB=null,np=-1,ip=0;function xs(){return Dt&6?di():np!==-1?np:np=di()}function Il(I){return I.mode&1?Dt&2&&Ki!==0?Ki&-Ki:SA.transition!==null?(ip===0&&(I=ua,ua<<=1,!(ua&4194240)&&(ua=64),ip=I),ip):(I=nn,I!==0?I:Ne()):1}function Eo(I,d,y){if(50<_d)throw _d=0,sB=null,Error(r(185));var v=sp(I,d);return v===null?null:(Gg(v,d,y),(!(Dt&2)||v!==pi)&&(v===pi&&(!(Dt&2)&&(qA|=d),Gi===4&&dl(v,Ki)),zs(v,y),d===1&&Dt===0&&!(I.mode&1)&&(Vu(),Sn&&uo())),v)}function sp(I,d){I.lanes|=d;var y=I.alternate;for(y!==null&&(y.lanes|=d),y=I,I=I.return;I!==null;)I.childLanes|=d,y=I.alternate,y!==null&&(y.childLanes|=d),y=I,I=I.return;return y.tag===3?y.stateNode:null}function zs(I,d){var y=I.callbackNode;yy(I,d);var v=du(I,I===pi?Ki:0);if(v===0)y!==null&&Ia(y),I.callbackNode=null,I.callbackPriority=0;else if(d=v&-v,I.callbackPriority!==d){if(y!=null&&Ia(y),d===1)I.tag===0?ZA(wx.bind(null,I)):wA(wx.bind(null,I)),ut?Oe(function(){Dt===0&&uo()}):Cu(Fo,uo),y=null;else{switch(bd(v)){case 1:y=Fo;break;case 4:y=vy;break;case 16:y=yd;break;case 536870912:y=hu;break;default:y=yd}y=Fx(y,vx.bind(null,I))}I.callbackPriority=d,I.callbackNode=y}}function vx(I,d){if(np=-1,ip=0,Dt&6)throw Error(r(327));var y=I.callbackNode;if(Eg()&&I.callbackNode!==y)return null;var v=du(I,I===pi?Ki:0);if(v===0)return null;if(v&30||v&I.expiredLanes||d)d=op(I,v);else{d=v;var V=Dt;Dt|=2;var X=Rx();(pi!==I||Ki!==d)&&(Vu(),Xg(I,d));do try{Q5();break}catch(te){Sx(I,te)}while(!0);Rg(),jA.current=X,Dt=V,mi!==null?d=0:(pi=null,Ki=0,d=Gi)}if(d!==0){if(d===2&&(V=md(I),V!==0&&(v=V,d=oB(I,V))),d===1)throw y=Yd,Xg(I,0),dl(I,v),zs(I,di()),y;if(d===6)dl(I,v);else{if(V=I.current.alternate,!(v&30)&&!J5(V)&&(d=op(I,v),d===2&&(X=md(I),X!==0&&(v=X,d=oB(I,X))),d===1))throw y=Yd,Xg(I,0),dl(I,v),zs(I,di()),y;switch(I.finishedWork=V,I.finishedLanes=v,d){case 0:case 1:throw Error(r(345));case 2:Tg(I,ks);break;case 3:if(dl(I,v),(v&130023424)===v&&(d=tB+500-di(),10<d)){if(du(I,0)!==0)break;if(V=I.suspendedLanes,(V&v)!==v){xs(),I.pingedLanes|=I.suspendedLanes&V;break}I.timeoutHandle=Fe(Tg.bind(null,I,ks),d);break}Tg(I,ks);break;case 4:if(dl(I,v),(v&4194240)===v)break;for(d=I.eventTimes,V=-1;0<v;){var O=31-Ii(v);X=1<<O,O=d[O],O>V&&(V=O),v&=~X}if(v=V,v=di()-v,v=(120>v?120:480>v?480:1080>v?1080:1920>v?1920:3e3>v?3e3:4320>v?4320:1960*U5(v/1960))-v,10<v){I.timeoutHandle=Fe(Tg.bind(null,I,ks),v);break}Tg(I,ks);break;case 5:Tg(I,ks);break;default:throw Error(r(329))}}}return zs(I,di()),I.callbackNode===y?vx.bind(null,I):null}function oB(I,d){var y=Kd;return I.current.memoizedState.isDehydrated&&(Xg(I,d).flags|=256),I=op(I,d),I!==2&&(d=ks,ks=y,d!==null&&rB(d)),I}function rB(I){ks===null?ks=I:ks.push.apply(ks,I)}function J5(I){for(var d=I;;){if(d.flags&16384){var y=d.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var v=0;v<y.length;v++){var V=y[v],X=V.getSnapshot;V=V.value;try{if(!go(X(),V))return!1}catch{return!1}}}if(y=d.child,d.subtreeFlags&16384&&y!==null)y.return=d,d=y;else{if(d===I)break;for(;d.sibling===null;){if(d.return===null||d.return===I)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function dl(I,d){for(d&=~eB,d&=~qA,I.suspendedLanes|=d,I.pingedLanes&=~d,I=I.expirationTimes;0<d;){var y=31-Ii(d),v=1<<y;I[y]=-1,d&=~v}}function wx(I){if(Dt&6)throw Error(r(327));Eg();var d=du(I,0);if(!(d&1))return zs(I,di()),null;var y=op(I,d);if(I.tag!==0&&y===2){var v=md(I);v!==0&&(d=v,y=oB(I,v))}if(y===1)throw y=Yd,Xg(I,0),dl(I,d),zs(I,di()),y;if(y===6)throw Error(r(345));return I.finishedWork=I.current.alternate,I.finishedLanes=d,Tg(I,ks),zs(I,di()),null}function Zx(I){ul!==null&&ul.tag===0&&!(Dt&6)&&Eg();var d=Dt;Dt|=1;var y=li.transition,v=nn;try{if(li.transition=null,nn=1,I)return I()}finally{nn=v,li.transition=y,Dt=d,!(Dt&6)&&uo()}}function aB(){Ao=Ru.current,Tt(Ru)}function Xg(I,d){I.finishedWork=null,I.finishedLanes=0;var y=I.timeoutHandle;if(y!==pt&&(I.timeoutHandle=pt,Ct(y)),mi!==null)for(y=mi.return;y!==null;){var v=y;switch(hi(v),v.tag){case 1:v=v.type.childContextTypes,v!=null&&rr();break;case 3:Zu(),Tt(xt),Tt(Ut),Wy();break;case 5:xy(v);break;case 4:Zu();break;case 13:Tt(Ln);break;case 19:Tt(Ln);break;case 10:mu(v.type._context);break;case 22:case 23:aB()}y=y.return}if(pi=I,mi=I=Cl(I.current,null),Ki=Ao=d,Gi=0,Yd=null,eB=qA=xu=0,ks=Kd=null,es!==null){for(d=0;d<es.length;d++)if(y=es[d],v=y.interleaved,v!==null){y.interleaved=null;var V=v.next,X=y.pending;if(X!==null){var O=X.next;X.next=V,v.next=O}y.pending=v}es=null}return I}function Sx(I,d){do{var y=mi;try{if(Rg(),WA.current=TA,MA){for(var v=Qn.memoizedState;v!==null;){var V=v.queue;V!==null&&(V.pending=null),v=v.next}MA=!1}if(Su=0,xi=ns=Qn=null,Vd=!1,Wd=0,$y.current=null,y===null||y.return===null){Gi=1,Yd=d,mi=null;break}e:{var X=I,O=y.return,te=y,Ge=d;if(d=Ki,te.flags|=32768,Ge!==null&&typeof Ge=="object"&&typeof Ge.then=="function"){var ze=Ge,It=te,Ht=It.tag;if(!(It.mode&1)&&(Ht===0||Ht===11||Ht===15)){var Zt=It.alternate;Zt?(It.updateQueue=Zt.updateQueue,It.memoizedState=Zt.memoizedState,It.lanes=Zt.lanes):(It.updateQueue=null,It.memoizedState=null)}var Rn=JR(O);if(Rn!==null){Rn.flags&=-257,OR(Rn,O,te,X,d),Rn.mode&1&&UR(X,ze,d),d=Rn,Ge=ze;var yt=d.updateQueue;if(yt===null){var os=new Set;os.add(Ge),d.updateQueue=os}else yt.add(Ge);break e}else{if(!(d&1)){UR(X,ze,d),lB();break e}Ge=Error(r(426))}}else if(tn&&te.mode&1){var Ko=JR(O);if(Ko!==null){!(Ko.flags&65536)&&(Ko.flags|=256),OR(Ko,O,te,X,d),Sy(Ge);break e}}X=Ge,Gi!==4&&(Gi=2),Kd===null?Kd=[X]:Kd.push(X),Ge=Ey(Ge,te),te=O;do{switch(te.tag){case 3:te.flags|=65536,d&=-d,te.lanes|=d;var he=DR(te,Ge,d);Gd(te,he);break e;case 1:X=Ge;var oe=te.type,fe=te.stateNode;if(!(te.flags&128)&&(typeof oe.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(cl===null||!cl.has(fe)))){te.flags|=65536,d&=-d,te.lanes|=d;var nt=PR(te,X,d);Gd(te,nt);break e}}te=te.return}while(te!==null)}Vx(y)}catch(mt){d=mt,mi===y&&y!==null&&(mi=y=y.return);continue}break}while(!0)}function Rx(){var I=jA.current;return jA.current=TA,I===null?TA:I}function lB(){(Gi===0||Gi===3||Gi===2)&&(Gi=4),pi===null||!(xu&268435455)&&!(qA&268435455)||dl(pi,Ki)}function op(I,d){var y=Dt;Dt|=2;var v=Rx();pi===I&&Ki===d||Xg(I,d);do try{O5();break}catch(V){Sx(I,V)}while(!0);if(Rg(),Dt=y,jA.current=v,mi!==null)throw Error(r(261));return pi=null,Ki=0,Gi}function O5(){for(;mi!==null;)xx(mi)}function Q5(){for(;mi!==null&&!By();)xx(mi)}function xx(I){var d=Nx(I.alternate,I,Ao);I.memoizedProps=I.pendingProps,d===null?Vx(I):mi=d,$y.current=null}function Vx(I){var d=I;do{var y=d.alternate;if(I=d.return,d.flags&32768){if(y=L5(y,d),y!==null){y.flags&=32767,mi=y;return}if(I!==null)I.flags|=32768,I.subtreeFlags=0,I.deletions=null;else{Gi=6,mi=null;return}}else if(y=Y5(y,d,Ao),y!==null){mi=y;return}if(d=d.sibling,d!==null){mi=d;return}mi=d=I}while(d!==null);Gi===0&&(Gi=5)}function Tg(I,d){var y=nn,v=li.transition;try{li.transition=null,nn=1,j5(I,d,y)}finally{li.transition=v,nn=y}return null}function j5(I,d,y){do Eg();while(ul!==null);if(Dt&6)throw Error(r(327));var v=I.finishedWork,V=I.finishedLanes;if(v===null)return null;if(I.finishedWork=null,I.finishedLanes=0,v===I.current)throw Error(r(177));I.callbackNode=null,I.callbackPriority=0;var X=v.lanes|v.childLanes;if(vg(I,X),I===pi&&(mi=pi=null,Ki=0),!(v.subtreeFlags&2064)&&!(v.flags&2064)||ep||(ep=!0,Fx(yd,function(){return Eg(),null})),X=(v.flags&15990)!==0,v.subtreeFlags&15990||X){X=li.transition,li.transition=null;var O=nn;nn=1;var te=Dt;Dt|=4,$y.current=null,z5(I,v),D5(I,v),$(I.containerInfo),I.current=v,P5(v),Gy(),Dt=te,nn=O,li.transition=X}else I.current=v;if(ep&&(ep=!1,ul=I,tp=V),X=I.pendingLanes,X===0&&(cl=null),wg(v.stateNode),zs(I,di()),d!==null)for(y=I.onRecoverableError,v=0;v<d.length;v++)y(d[v]);if($A)throw $A=!1,I=iB,iB=null,I;return tp&1&&I.tag!==0&&Eg(),X=I.pendingLanes,X&1?I===sB?_d++:(_d=0,sB=I):_d=0,uo(),null}function Eg(){if(ul!==null){var I=bd(tp),d=li.transition,y=nn;try{if(li.transition=null,nn=16>I?16:I,ul===null)var v=!1;else{if(I=ul,ul=null,tp=0,Dt&6)throw Error(r(331));var V=Dt;for(Dt|=4,$e=I.current;$e!==null;){var X=$e,O=X.child;if($e.flags&16){var te=X.deletions;if(te!==null){for(var Ge=0;Ge<te.length;Ge++){var ze=te[Ge];for($e=ze;$e!==null;){var It=$e;switch(It.tag){case 0:case 11:case 15:Hg(8,It,X)}var Ht=It.child;if(Ht!==null)Ht.return=It,$e=Ht;else for(;$e!==null;){It=$e;var Zt=It.sibling,Rn=It.return;if(Cx(It),It===ze){$e=null;break}if(Zt!==null){Zt.return=Rn,$e=Zt;break}$e=Rn}}}var yt=X.alternate;if(yt!==null){var os=yt.child;if(os!==null){yt.child=null;do{var Ko=os.sibling;os.sibling=null,os=Ko}while(os!==null)}}$e=X}}if(X.subtreeFlags&2064&&O!==null)O.return=X,$e=O;else e:for(;$e!==null;){if(X=$e,X.flags&2048)switch(X.tag){case 0:case 11:case 15:Hg(9,X,X.return)}var he=X.sibling;if(he!==null){he.return=X.return,$e=he;break e}$e=X.return}}var oe=I.current;for($e=oe;$e!==null;){O=$e;var fe=O.child;if(O.subtreeFlags&2064&&fe!==null)fe.return=O,$e=fe;else e:for(O=oe;$e!==null;){if(te=$e,te.flags&2048)try{switch(te.tag){case 0:case 11:case 15:Td(9,te)}}catch(mt){Ds(te,te.return,mt)}if(te===O){$e=null;break e}var nt=te.sibling;if(nt!==null){nt.return=te.return,$e=nt;break e}$e=te.return}}if(Dt=V,uo(),lo&&typeof lo.onPostCommitFiberRoot=="function")try{lo.onPostCommitFiberRoot(da,I)}catch{}v=!0}return v}finally{nn=y,li.transition=d}}return!1}function Wx(I,d,y){d=Ey(y,d),d=DR(I,d,1),gr(I,d),d=xs(),I=sp(I,1),I!==null&&(Gg(I,1,d),zs(I,d))}function Ds(I,d,y){if(I.tag===3)Wx(I,I,y);else for(;d!==null;){if(d.tag===3){Wx(d,I,y);break}else if(d.tag===1){var v=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof v.componentDidCatch=="function"&&(cl===null||!cl.has(v))){I=Ey(y,I),I=PR(d,I,1),gr(d,I),I=xs(),d=sp(d,1),d!==null&&(Gg(d,1,I),zs(d,I));break}}d=d.return}}function q5(I,d,y){var v=I.pingCache;v!==null&&v.delete(d),d=xs(),I.pingedLanes|=I.suspendedLanes&y,pi===I&&(Ki&y)===y&&(Gi===4||Gi===3&&(Ki&130023424)===Ki&&500>di()-tB?Xg(I,0):eB|=y),zs(I,d)}function Mx(I,d){d===0&&(I.mode&1?(d=Hr,Hr<<=1,!(Hr&130023424)&&(Hr=4194304)):d=1);var y=xs();I=sp(I,d),I!==null&&(Gg(I,d,y),zs(I,y))}function $5(I){var d=I.memoizedState,y=0;d!==null&&(y=d.retryLane),Mx(I,y)}function e_(I,d){var y=0;switch(I.tag){case 13:var v=I.stateNode,V=I.memoizedState;V!==null&&(y=V.retryLane);break;case 19:v=I.stateNode;break;default:throw Error(r(314))}v!==null&&v.delete(d),Mx(I,y)}var Nx;Nx=function(I,d,y){if(I!==null)if(I.memoizedProps!==d.pendingProps||xt.current)ho=!0;else{if(!(I.lanes&y)&&!(d.flags&128))return ho=!1,_5(I,d,y);ho=!!(I.flags&131072)}else ho=!1,tn&&d.flags&1048576&&Ci(d,W,d.index);switch(d.lanes=0,d.tag){case 2:var v=d.type;I!==null&&(I.alternate=null,d.alternate=null,d.flags|=2),I=d.pendingProps;var V=ws(d,Ut.current);gl(d,y),V=Ny(null,d,v,I,V,y);var X=Fy();return d.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,pn(v)?(X=!0,$i(d)):X=!1,d.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,fu(d),V.updater=Wg,d.stateNode=V,V._reactInternals=d,Bu(d,v,I,y),d=_y(null,d,v,!0,X,y)):(d.tag=0,tn&&X&&en(d),Rs(null,d,V,y),d=d.child),d;case 16:v=d.elementType;e:{switch(I!==null&&(I.alternate=null,d.alternate=null,d.flags|=2),I=d.pendingProps,V=v._init,v=V(v._payload),d.type=v,V=d.tag=n_(v),I=ai(v,I),V){case 0:d=Ky(null,d,v,I,y);break e;case 1:d=ix(null,d,v,I,y);break e;case 11:d=qR(null,d,v,I,y);break e;case 14:d=$R(null,d,v,ai(v.type,I),y);break e}throw Error(r(306,v,""))}return d;case 0:return v=d.type,V=d.pendingProps,V=d.elementType===v?V:ai(v,V),Ky(I,d,v,V,y);case 1:return v=d.type,V=d.pendingProps,V=d.elementType===v?V:ai(v,V),ix(I,d,v,V,y);case 3:e:{if(sx(d),I===null)throw Error(r(387));v=d.pendingProps,X=d.memoizedState,V=X.element,bu(I,d),Vg(d,v,null,y);var O=d.memoizedState;if(v=O.element,D&&X.isDehydrated)if(X={element:v,isDehydrated:!1,cache:O.cache,transitions:O.transitions},d.updateQueue.baseState=X,d.memoizedState=X,d.flags&256){V=Error(r(423)),d=ox(I,d,v,y,V);break e}else if(v!==V){V=Error(r(424)),d=ox(I,d,v,y,V);break e}else for(D&&(Ai=ol(d.stateNode.containerInfo),mn=d,tn=!0,Ss=null,Tr=!1),y=wR(d,null,v,y),d.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(Gu(),v===V){d=ma(I,d,y);break e}Rs(I,d,v,y)}d=d.child}return d;case 5:return ZR(d),I===null&&Zy(d),v=d.type,V=d.pendingProps,X=I!==null?I.memoizedProps:null,O=V.children,Be(v,V)?O=null:X!==null&&Be(v,X)&&(d.flags|=32),nx(I,d),Rs(I,d,O,y),d.child;case 6:return I===null&&Zy(d),null;case 13:return rx(I,d,y);case 4:return Ry(d,d.stateNode.containerInfo),v=d.pendingProps,I===null?d.child=vu(d,null,v,y):Rs(I,d,v,y),d.child;case 11:return v=d.type,V=d.pendingProps,V=d.elementType===v?V:ai(v,V),qR(I,d,v,V,y);case 7:return Rs(I,d,d.pendingProps,y),d.child;case 8:return Rs(I,d,d.pendingProps.children,y),d.child;case 12:return Rs(I,d,d.pendingProps.children,y),d.child;case 10:e:{if(v=d.type._context,V=d.pendingProps,X=d.memoizedProps,O=V.value,xg(d,v,O),X!==null)if(go(X.value,O)){if(X.children===V.children&&!xt.current){d=ma(I,d,y);break e}}else for(X=d.child,X!==null&&(X.return=d);X!==null;){var te=X.dependencies;if(te!==null){O=X.child;for(var Ge=te.firstContext;Ge!==null;){if(Ge.context===v){if(X.tag===1){Ge=Io(-1,y&-y),Ge.tag=2;var ze=X.updateQueue;if(ze!==null){ze=ze.shared;var It=ze.pending;It===null?Ge.next=Ge:(Ge.next=It.next,It.next=Ge),ze.pending=Ge}}X.lanes|=y,Ge=X.alternate,Ge!==null&&(Ge.lanes|=y),ll(X.return,y,d),te.lanes|=y;break}Ge=Ge.next}}else if(X.tag===10)O=X.type===d.type?null:X.child;else if(X.tag===18){if(O=X.return,O===null)throw Error(r(341));O.lanes|=y,te=O.alternate,te!==null&&(te.lanes|=y),ll(O,y,d),O=X.sibling}else O=X.child;if(O!==null)O.return=X;else for(O=X;O!==null;){if(O===d){O=null;break}if(X=O.sibling,X!==null){X.return=O.return,O=X;break}O=O.return}X=O}Rs(I,d,V.children,y),d=d.child}return d;case 9:return V=d.type,v=d.pendingProps.children,gl(d,y),V=Zs(V),v=v(V),d.flags|=1,Rs(I,d,v,y),d.child;case 14:return v=d.type,V=ai(v,d.pendingProps),V=ai(v.type,V),$R(I,d,v,V,y);case 15:return ex(I,d,d.type,d.pendingProps,y);case 17:return v=d.type,V=d.pendingProps,V=d.elementType===v?V:ai(v,V),I!==null&&(I.alternate=null,d.alternate=null,d.flags|=2),d.tag=1,pn(v)?(I=!0,$i(d)):I=!1,gl(d,y),Mg(d,v,V),Bu(d,v,V,y),_y(null,d,v,!0,I,y);case 19:return cx(I,d,y);case 22:return tx(I,d,y)}throw Error(r(156,d.tag))};function Fx(I,d){return Cu(I,d)}function t_(I,d,y,v){this.tag=I,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=v,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yo(I,d,y,v){return new t_(I,d,y,v)}function gB(I){return I=I.prototype,!(!I||!I.isReactComponent)}function n_(I){if(typeof I=="function")return gB(I)?1:0;if(I!=null){if(I=I.$$typeof,I===b)return 11;if(I===B)return 14}return 2}function Cl(I,d){var y=I.alternate;return y===null?(y=Yo(I.tag,d,I.key,I.mode),y.elementType=I.elementType,y.type=I.type,y.stateNode=I.stateNode,y.alternate=I,I.alternate=y):(y.pendingProps=d,y.type=I.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=I.flags&14680064,y.childLanes=I.childLanes,y.lanes=I.lanes,y.child=I.child,y.memoizedProps=I.memoizedProps,y.memoizedState=I.memoizedState,y.updateQueue=I.updateQueue,d=I.dependencies,y.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},y.sibling=I.sibling,y.index=I.index,y.ref=I.ref,y}function rp(I,d,y,v,V,X){var O=2;if(v=I,typeof I=="function")gB(I)&&(O=1);else if(typeof I=="string")O=5;else e:switch(I){case c:return Yg(y.children,V,X,d);case u:O=8,V|=8;break;case C:return I=Yo(12,y,d,V|2),I.elementType=C,I.lanes=X,I;case m:return I=Yo(13,y,d,V),I.elementType=m,I.lanes=X,I;case A:return I=Yo(19,y,d,V),I.elementType=A,I.lanes=X,I;case w:return ap(y,V,X,d);default:if(typeof I=="object"&&I!==null)switch(I.$$typeof){case h:O=10;break e;case p:O=9;break e;case b:O=11;break e;case B:O=14;break e;case G:O=16,v=null;break e}throw Error(r(130,I==null?I:typeof I,""))}return d=Yo(O,y,d,V),d.elementType=I,d.type=v,d.lanes=X,d}function Yg(I,d,y,v){return I=Yo(7,I,v,d),I.lanes=y,I}function ap(I,d,y,v){return I=Yo(22,I,v,d),I.elementType=w,I.lanes=y,I.stateNode={},I}function cB(I,d,y){return I=Yo(6,I,null,d),I.lanes=y,I}function uB(I,d,y){return d=Yo(4,I.children!==null?I.children:[],I.key,d),d.lanes=y,d.stateNode={containerInfo:I.containerInfo,pendingChildren:null,implementation:I.implementation},d}function i_(I,d,y,v,V){this.tag=d,this.containerInfo=I,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=pt,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=fd(0),this.expirationTimes=fd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fd(0),this.identifierPrefix=v,this.onRecoverableError=V,D&&(this.mutableSourceEagerHydrationData=null)}function Hx(I,d,y,v,V,X,O,te,Ge){return I=new i_(I,d,y,te,Ge),d===1?(d=1,X===!0&&(d|=8)):d=0,X=Yo(3,null,null,d),I.current=X,X.stateNode=I,X.memoizedState={element:v,isDehydrated:y,cache:null,transitions:null},fu(X),I}function Xx(I){if(!I)return at;I=I._reactInternals;e:{if(F(I)!==I||I.tag!==1)throw Error(r(170));var d=I;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(pn(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(r(171))}if(I.tag===1){var y=I.type;if(pn(y))return ao(I,y,d)}return d}function Tx(I){var d=I._reactInternals;if(d===void 0)throw typeof I.render=="function"?Error(r(188)):(I=Object.keys(I).join(","),Error(r(268,I)));return I=Y(d),I===null?null:I.stateNode}function Ex(I,d){if(I=I.memoizedState,I!==null&&I.dehydrated!==null){var y=I.retryLane;I.retryLane=y!==0&&y<d?y:d}}function IB(I,d){Ex(I,d),(I=I.alternate)&&Ex(I,d)}function s_(I){return I=Y(I),I===null?null:I.stateNode}function o_(){return null}return t.attemptContinuousHydration=function(I){if(I.tag===13){var d=xs();Eo(I,134217728,d),IB(I,134217728)}},t.attemptHydrationAtCurrentPriority=function(I){if(I.tag===13){var d=xs(),y=Il(I);Eo(I,y,d),IB(I,y)}},t.attemptSynchronousHydration=function(I){switch(I.tag){case 3:var d=I.stateNode;if(d.current.memoizedState.isDehydrated){var y=ar(d.pendingLanes);y!==0&&(No(d,y|1),zs(d,di()),!(Dt&6)&&(Vu(),uo()))}break;case 13:var v=xs();Zx(function(){return Eo(I,1,v)}),IB(I,1)}},t.batchedUpdates=function(I,d){var y=Dt;Dt|=1;try{return I(d)}finally{Dt=y,Dt===0&&(Vu(),Sn&&uo())}},t.createComponentSelector=function(I){return{$$typeof:PA,value:I}},t.createContainer=function(I,d,y,v,V,X,O){return Hx(I,d,!1,null,y,v,V,X,O)},t.createHasPseudoClassSelector=function(I){return{$$typeof:UA,value:I}},t.createHydrationContainer=function(I,d,y,v,V,X,O,te,Ge){return I=Hx(y,v,!0,I,V,X,O,te,Ge),I.context=Xx(null),y=I.current,v=xs(),V=Il(y),X=Io(v,V),X.callback=d??null,gr(y,X),I.current.lanes=V,Gg(I,V,v),zs(I,v),I},t.createPortal=function(I,d,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:g,key:v==null?null:""+v,children:I,containerInfo:d,implementation:y}},t.createRoleSelector=function(I){return{$$typeof:JA,value:I}},t.createTestNameSelector=function(I){return{$$typeof:OA,value:I}},t.createTextSelector=function(I){return{$$typeof:QA,value:I}},t.deferredUpdates=function(I){var d=nn,y=li.transition;try{return li.transition=null,nn=16,I()}finally{nn=d,li.transition=y}},t.discreteUpdates=function(I,d,y,v,V){var X=nn,O=li.transition;try{return li.transition=null,nn=1,I(d,y,v,V)}finally{nn=X,li.transition=O,Dt===0&&Vu()}},t.findAllNodes=qy,t.findBoundingRects=function(I,d){if(!P)throw Error(r(363));d=qy(I,d),I=[];for(var y=0;y<d.length;y++)I.push(ge(d[y]));for(d=I.length-1;0<d;d--){y=I[d];for(var v=y.x,V=v+y.width,X=y.y,O=X+y.height,te=d-1;0<=te;te--)if(d!==te){var Ge=I[te],ze=Ge.x,It=ze+Ge.width,Ht=Ge.y,Zt=Ht+Ge.height;if(v>=ze&&X>=Ht&&V<=It&&O<=Zt){I.splice(d,1);break}else if(v!==ze||y.width!==Ge.width||Zt<X||Ht>O){if(!(X!==Ht||y.height!==Ge.height||It<v||ze>V)){ze>v&&(Ge.width+=ze-v,Ge.x=v),It<V&&(Ge.width=V-ze),I.splice(d,1);break}}else{Ht>X&&(Ge.height+=Ht-X,Ge.y=X),Zt<O&&(Ge.height=O-Ht),I.splice(d,1);break}}}return I},t.findHostInstance=Tx,t.findHostInstanceWithNoPortals=function(I){return I=x(I),I=I!==null?ne(I):null,I===null?null:I.stateNode},t.findHostInstanceWithWarning=function(I){return Tx(I)},t.flushControlled=function(I){var d=Dt;Dt|=1;var y=li.transition,v=nn;try{li.transition=null,nn=1,I()}finally{nn=v,li.transition=y,Dt=d,Dt===0&&(Vu(),uo())}},t.flushPassiveEffects=Eg,t.flushSync=Zx,t.focusWithin=function(I,d){if(!P)throw Error(r(363));for(I=Oy(I),d=Gx(I,d),d=Array.from(d),I=0;I<d.length;){var y=d[I++];if(!Se(y)){if(y.tag===5&&Je(y.stateNode))return!0;for(y=y.child;y!==null;)d.push(y),y=y.sibling}}return!1},t.getCurrentUpdatePriority=function(){return nn},t.getFindAllNodesFailureDescription=function(I,d){if(!P)throw Error(r(363));var y=0,v=[];I=[Oy(I),0];for(var V=0;V<I.length;){var X=I[V++],O=I[V++],te=d[O];if((X.tag!==5||!Se(X))&&(Qy(X,te)&&(v.push(jy(te)),O++,O>y&&(y=O)),O<d.length))for(X=X.child;X!==null;)I.push(X,O),X=X.sibling}if(y<d.length){for(I=[];y<d.length;y++)I.push(jy(d[y]));return`findAllNodes was able to match part of the selector:
  `+(v.join(" > ")+`

No matching component was found for:
  `)+I.join(" > ")}return null},t.getPublicRootInstance=function(I){if(I=I.current,!I.child)return null;switch(I.child.tag){case 5:return se(I.child.stateNode);default:return I.child.stateNode}},t.injectIntoDevTools=function(I){if(I={bundleType:I.bundleType,version:I.version,rendererPackageName:I.rendererPackageName,rendererConfig:I.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:s_,findFiberByHostInstance:I.findFiberByHostInstance||o_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")I=!1;else{var d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(d.isDisabled||!d.supportsFiber)I=!0;else{try{da=d.inject(I),lo=d}catch{}I=!!d.checkDCE}}return I},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(I,d,y,v){if(!P)throw Error(r(363));I=qy(I,d);var V=We(I,y,v).disconnect;return{disconnect:function(){V()}}},t.registerMutableSourceForHydration=function(I,d){var y=d._getVersion;y=y(d._source),I.mutableSourceEagerHydrationData==null?I.mutableSourceEagerHydrationData=[d,y]:I.mutableSourceEagerHydrationData.push(d,y)},t.runWithPriority=function(I,d){var y=nn;try{return nn=I,d()}finally{nn=y}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(I,d,y,v){var V=d.current,X=xs(),O=Il(V);return y=Xx(y),d.context===null?d.context=y:d.pendingContext=y,d=Io(X,O),d.payload={element:I},v=v===void 0?null:v,v!==null&&(d.callback=v),gr(V,d),I=Eo(V,O,X),I!==null&&ha(I,V,O),O},t};bE.exports=yj;var Bj=bE.exports;const Gj=Bw(Bj),rS={},GE=n=>void Object.assign(rS,n);function vj(n,e){function t(c,{args:u=[],attach:C,...h},p){let b=`${c[0].toUpperCase()}${c.slice(1)}`,m;if(c==="primitive"){if(h.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const A=h.object;m=ju(A,{type:c,root:p,attach:C,primitive:!0})}else{const A=rS[b];if(!A)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(u))throw new Error("R3F: The args prop must be an array!");m=ju(new A(...u),{type:c,root:p,attach:C,memoizedProps:{args:u}})}return m.__r3f.attach===void 0&&(m instanceof Mt?m.__r3f.attach="geometry":m instanceof Un&&(m.__r3f.attach="material")),b!=="inject"&&MG(m,h),m}function i(c,u){let C=!1;if(u){var h,p;(h=u.__r3f)!=null&&h.attach?WG(c,u,u.__r3f.attach):u.isObject3D&&c.isObject3D&&(c.add(u),C=!0),C||(p=c.__r3f)==null||p.objects.push(u),u.__r3f||ju(u,{}),u.__r3f.parent=c,W2(u),qu(u)}}function s(c,u,C){let h=!1;if(u){var p,b;if((p=u.__r3f)!=null&&p.attach)WG(c,u,u.__r3f.attach);else if(u.isObject3D&&c.isObject3D){u.parent=c,u.dispatchEvent({type:"added"}),c.dispatchEvent({type:"childadded",child:u});const m=c.children.filter(B=>B!==u),A=m.indexOf(C);c.children=[...m.slice(0,A),u,...m.slice(A)],h=!0}h||(b=c.__r3f)==null||b.objects.push(u),u.__r3f||ju(u,{}),u.__r3f.parent=c,W2(u),qu(u)}}function o(c,u,C=!1){c&&[...c].forEach(h=>r(u,h,C))}function r(c,u,C){if(u){var h,p,b;if(u.__r3f&&(u.__r3f.parent=null),(h=c.__r3f)!=null&&h.objects&&(c.__r3f.objects=c.__r3f.objects.filter(w=>w!==u)),(p=u.__r3f)!=null&&p.attach)XW(c,u,u.__r3f.attach);else if(u.isObject3D&&c.isObject3D){var m;c.remove(u),(m=u.__r3f)!=null&&m.root&&Nj(ef(u),u)}const B=(b=u.__r3f)==null?void 0:b.primitive,G=!B&&(C===void 0?u.dispose!==null:C);if(!B){var A;o((A=u.__r3f)==null?void 0:A.objects,u,G),o(u.children,u,G)}if(delete u.__r3f,G&&u.dispose&&u.type!=="Scene"){const w=()=>{try{u.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?x2.unstable_scheduleCallback(x2.unstable_IdlePriority,w):w()}qu(c)}}function a(c,u,C,h){var p;const b=(p=c.__r3f)==null?void 0:p.parent;if(!b)return;const m=t(u,C,c.__r3f.root);if(c.children){for(const A of c.children)A.__r3f&&i(m,A);c.children=c.children.filter(A=>!A.__r3f)}c.__r3f.objects.forEach(A=>i(m,A)),c.__r3f.objects=[],c.__r3f.autoRemovedBeforeAppend||r(b,c),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),i(b,m),m.raycast&&m.__r3f.eventCount&&ef(m).getState().internal.interaction.push(m),[h,h.alternate].forEach(A=>{A!==null&&(A.stateNode=m,A.ref&&(typeof A.ref=="function"?A.ref(m):A.ref.current=m))})}const l=()=>{};return{reconciler:Gj({createInstance:t,removeChild:r,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(c,u)=>{if(!u)return;const C=c.getState().scene;C.__r3f&&(C.__r3f.root=c,i(C,u))},removeChildFromContainer:(c,u)=>{u&&r(c.getState().scene,u)},insertInContainerBefore:(c,u,C)=>{if(!u||!C)return;const h=c.getState().scene;h.__r3f&&s(h,u,C)},getRootHostContext:()=>null,getChildHostContext:c=>c,finalizeInitialChildren(c){var u;return!!((u=c==null?void 0:c.__r3f)!=null?u:{}).handlers},prepareUpdate(c,u,C,h){var p;if(((p=c==null?void 0:c.__r3f)!=null?p:{}).primitive&&h.object&&h.object!==c)return[!0];{const{args:m=[],children:A,...B}=h,{args:G=[],children:w,...N}=C;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((R,S)=>R!==G[S]))return[!0];const M=VE(c,B,N,!0);return M.changes.length?[!1,M]:null}},commitUpdate(c,[u,C],h,p,b,m){u?a(c,h,b,m):MG(c,C)},commitMount(c,u,C,h){var p;const b=(p=c.__r3f)!=null?p:{};c.raycast&&b.handlers&&b.eventCount&&ef(c).getState().internal.interaction.push(c)},getPublicInstance:c=>c,prepareForCommit:()=>null,preparePortalMount:c=>ju(c.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(c){var u;const{attach:C,parent:h}=(u=c.__r3f)!=null?u:{};C&&h&&XW(h,c,C),c.isObject3D&&(c.visible=!1),qu(c)},unhideInstance(c,u){var C;const{attach:h,parent:p}=(C=c.__r3f)!=null?C:{};h&&p&&WG(p,c,h),(c.isObject3D&&u.visible==null||u.visible)&&(c.visible=!0),qu(c)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():pI.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Vn.fun(performance.now)?performance.now:Vn.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Vn.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Vn.fun(clearTimeout)?clearTimeout:void 0}),applyProps:MG}}var MW,NW;const VG=n=>"colorSpace"in n||"outputColorSpace"in n,vE=()=>{var n;return(n=rS.ColorManagement)!=null?n:null},wE=n=>n&&n.isOrthographicCamera,wj=n=>n&&n.hasOwnProperty("current"),dA=typeof window<"u"&&((MW=window.document)!=null&&MW.createElement||((NW=window.navigator)==null?void 0:NW.product)==="ReactNative")?z.useLayoutEffect:z.useEffect;function ZE(n){const e=z.useRef(n);return dA(()=>void(e.current=n),[n]),e}function Zj({set:n}){return dA(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class SE extends z.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}SE.getDerivedStateFromError=()=>({error:!0});const RE="__default",FW=new Map,Sj=n=>n&&!!n.memoized&&!!n.changes;function xE(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const gC=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()};function ef(n){let e=n.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const Vn={obj:n=>n===Object(n)&&!Vn.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:i="reference",strict:s=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(Vn.str(n)||Vn.num(n)||Vn.boo(n))return n===e;const o=Vn.obj(n);if(o&&i==="reference")return n===e;const r=Vn.arr(n);if(r&&t==="reference")return n===e;if((r||o)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(o&&t==="shallow"&&i==="shallow"){for(a in s?e:n)if(!Vn.equ(n[a],e[a],{strict:s,objects:"reference"}))return!1}else for(a in s?e:n)if(n[a]!==e[a])return!1;if(Vn.und(a)){if(r&&n.length===0&&e.length===0||o&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function Rj(n){const e={nodes:{},materials:{}};return n&&n.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material)}),e}function xj(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function ju(n,e){const t=n;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},n}function V2(n,e){let t=n;if(e.includes("-")){const i=e.split("-"),s=i.pop();return t=i.reduce((o,r)=>o[r],n),{target:t,key:s}}else return{target:t,key:e}}const HW=/-\d+$/;function WG(n,e,t){if(Vn.str(t)){if(HW.test(t)){const o=t.replace(HW,""),{target:r,key:a}=V2(n,o);Array.isArray(r[a])||(r[a]=[])}const{target:i,key:s}=V2(n,t);e.__r3f.previousAttach=i[s],i[s]=e}else e.__r3f.previousAttach=t(n,e)}function XW(n,e,t){var i,s;if(Vn.str(t)){const{target:o,key:r}=V2(n,t),a=e.__r3f.previousAttach;a===void 0?delete o[r]:o[r]=a}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(n,e);(s=e.__r3f)==null||delete s.previousAttach}function VE(n,{children:e,key:t,ref:i,...s},{children:o,key:r,ref:a,...l}={},g=!1){const c=n.__r3f,u=Object.entries(s),C=[];if(g){const p=Object.keys(l);for(let b=0;b<p.length;b++)s.hasOwnProperty(p[b])||u.unshift([p[b],RE+"remove"])}u.forEach(([p,b])=>{var m;if((m=n.__r3f)!=null&&m.primitive&&p==="object"||Vn.equ(b,l[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return C.push([p,b,!0,[]]);let A=[];p.includes("-")&&(A=p.split("-")),C.push([p,b,!1,A]);for(const B in s){const G=s[B];B.startsWith(`${p}-`)&&C.push([B,G,!1,B.split("-")])}});const h={...s};return c!=null&&c.memoizedProps&&c!=null&&c.memoizedProps.args&&(h.args=c.memoizedProps.args),c!=null&&c.memoizedProps&&c!=null&&c.memoizedProps.attach&&(h.attach=c.memoizedProps.attach),{memoized:h,changes:C}}const Vj=typeof process<"u"&&!1;function MG(n,e){var t;const i=n.__r3f,s=i==null?void 0:i.root,o=s==null||s.getState==null?void 0:s.getState(),{memoized:r,changes:a}=Sj(e)?e:VE(n,e),l=i==null?void 0:i.eventCount;n.__r3f&&(n.__r3f.memoizedProps=r);for(let c=0;c<a.length;c++){let[u,C,h,p]=a[c];if(VG(n)){const B="srgb",G="srgb-linear";u==="encoding"?(u="colorSpace",C=C===3001?B:G):u==="outputEncoding"&&(u="outputColorSpace",C=C===3001?B:G)}let b=n,m=b[u];if(p.length&&(m=p.reduce((A,B)=>A[B],n),!(m&&m.set))){const[A,...B]=p.reverse();b=B.reverse().reduce((G,w)=>G[w],n),u=A}if(C===RE+"remove")if(b.constructor){let A=FW.get(b.constructor);A||(A=new b.constructor,FW.set(b.constructor,A)),C=A[u]}else C=0;if(h&&i)C?i.handlers[u]=C:delete i.handlers[u],i.eventCount=Object.keys(i.handlers).length;else if(m&&m.set&&(m.copy||m instanceof Wc)){if(Array.isArray(C))m.fromArray?m.fromArray(C):m.set(...C);else if(m.copy&&C&&C.constructor&&(Vj?m.constructor.name===C.constructor.name:m.constructor===C.constructor))m.copy(C);else if(C!==void 0){const A=m instanceof Pe;!A&&m.setScalar?m.setScalar(C):m instanceof Wc&&C instanceof Wc?m.mask=C.mask:m.set(C),!vE()&&o&&!o.linear&&A&&m.convertSRGBToLinear()}}else if(b[u]=C,b[u]instanceof Bn&&b[u].format===fs&&b[u].type===Vr&&o){const A=b[u];VG(A)&&VG(o.gl)?A.colorSpace=o.gl.outputColorSpace:A.encoding=o.gl.outputEncoding}qu(n)}if(i&&i.parent&&n.raycast&&l!==i.eventCount){const c=ef(n).getState().internal,u=c.interaction.indexOf(n);u>-1&&c.interaction.splice(u,1),i.eventCount&&c.interaction.push(n)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=n.__r3f)!=null&&t.parent&&W2(n),n}function qu(n){var e,t;const i=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();i&&i.internal.frames===0&&i.invalidate()}function W2(n){n.onUpdate==null||n.onUpdate(n)}function Wj(n,e){n.manual||(wE(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function Am(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function Mj(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return pI.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return pI.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return pI.ContinuousEventPriority;default:return pI.DefaultEventPriority}}function WE(n,e,t,i){const s=t.get(e);s&&(t.delete(e),t.size===0&&(n.delete(i),s.target.releasePointerCapture(i)))}function Nj(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,s)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(s)}),t.capturedMap.forEach((i,s)=>{WE(t.capturedMap,e,i,s)})}function Fj(n){function e(l){const{internal:g}=n.getState(),c=l.offsetX-g.initialClick[0],u=l.offsetY-g.initialClick[1];return Math.round(Math.sqrt(c*c+u*u))}function t(l){return l.filter(g=>["Move","Over","Enter","Out","Leave"].some(c=>{var u;return(u=g.__r3f)==null?void 0:u.handlers["onPointer"+c]}))}function i(l,g){const c=n.getState(),u=new Set,C=[],h=g?g(c.internal.interaction):c.internal.interaction;for(let A=0;A<h.length;A++){const B=gC(h[A]);B&&(B.raycaster.camera=void 0)}c.previousRoot||c.events.compute==null||c.events.compute(l,c);function p(A){const B=gC(A);if(!B||!B.events.enabled||B.raycaster.camera===null)return[];if(B.raycaster.camera===void 0){var G;B.events.compute==null||B.events.compute(l,B,(G=B.previousRoot)==null?void 0:G.getState()),B.raycaster.camera===void 0&&(B.raycaster.camera=null)}return B.raycaster.camera?B.raycaster.intersectObject(A,!0):[]}let b=h.flatMap(p).sort((A,B)=>{const G=gC(A.object),w=gC(B.object);return!G||!w?A.distance-B.distance:w.events.priority-G.events.priority||A.distance-B.distance}).filter(A=>{const B=Am(A);return u.has(B)?!1:(u.add(B),!0)});c.events.filter&&(b=c.events.filter(b,c));for(const A of b){let B=A.object;for(;B;){var m;(m=B.__r3f)!=null&&m.eventCount&&C.push({...A,eventObject:B}),B=B.parent}}if("pointerId"in l&&c.internal.capturedMap.has(l.pointerId))for(let A of c.internal.capturedMap.get(l.pointerId).values())u.has(Am(A.intersection))||C.push(A.intersection);return C}function s(l,g,c,u){const C=n.getState();if(l.length){const h={stopped:!1};for(const p of l){const b=gC(p.object)||C,{raycaster:m,pointer:A,camera:B,internal:G}=b,w=new _(A.x,A.y,0).unproject(B),N=Z=>{var x,Y;return(x=(Y=G.capturedMap.get(Z))==null?void 0:Y.has(p.eventObject))!=null?x:!1},M=Z=>{const x={intersection:p,target:g.target};G.capturedMap.has(Z)?G.capturedMap.get(Z).set(p.eventObject,x):G.capturedMap.set(Z,new Map([[p.eventObject,x]])),g.target.setPointerCapture(Z)},R=Z=>{const x=G.capturedMap.get(Z);x&&WE(G.capturedMap,p.eventObject,x,Z)};let S={};for(let Z in g){let x=g[Z];typeof x!="function"&&(S[Z]=x)}let F={...p,...S,pointer:A,intersections:l,stopped:h.stopped,delta:c,unprojectedPoint:w,ray:m.ray,camera:B,stopPropagation(){const Z="pointerId"in g&&G.capturedMap.get(g.pointerId);if((!Z||Z.has(p.eventObject))&&(F.stopped=h.stopped=!0,G.hovered.size&&Array.from(G.hovered.values()).find(x=>x.eventObject===p.eventObject))){const x=l.slice(0,l.indexOf(p));o([...x,p])}},target:{hasPointerCapture:N,setPointerCapture:M,releasePointerCapture:R},currentTarget:{hasPointerCapture:N,setPointerCapture:M,releasePointerCapture:R},nativeEvent:g};if(u(F),h.stopped===!0)break}}return l}function o(l){const{internal:g}=n.getState();for(const c of g.hovered.values())if(!l.length||!l.find(u=>u.object===c.object&&u.index===c.index&&u.instanceId===c.instanceId)){const C=c.eventObject.__r3f,h=C==null?void 0:C.handlers;if(g.hovered.delete(Am(c)),C!=null&&C.eventCount){const p={...c,intersections:l};h.onPointerOut==null||h.onPointerOut(p),h.onPointerLeave==null||h.onPointerLeave(p)}}}function r(l,g){for(let c=0;c<g.length;c++){const u=g[c].__r3f;u==null||u.handlers.onPointerMissed==null||u.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>o([]);case"onLostPointerCapture":return g=>{const{internal:c}=n.getState();"pointerId"in g&&c.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{c.capturedMap.has(g.pointerId)&&(c.capturedMap.delete(g.pointerId),o([]))})}}return function(c){const{onPointerMissed:u,internal:C}=n.getState();C.lastEvent.current=c;const h=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",m=i(c,h?t:void 0),A=p?e(c):0;l==="onPointerDown"&&(C.initialClick=[c.offsetX,c.offsetY],C.initialHits=m.map(G=>G.eventObject)),p&&!m.length&&A<=2&&(r(c,C.interaction),u&&u(c)),h&&o(m);function B(G){const w=G.eventObject,N=w.__r3f,M=N==null?void 0:N.handlers;if(N!=null&&N.eventCount)if(h){if(M.onPointerOver||M.onPointerEnter||M.onPointerOut||M.onPointerLeave){const R=Am(G),S=C.hovered.get(R);S?S.stopped&&G.stopPropagation():(C.hovered.set(R,G),M.onPointerOver==null||M.onPointerOver(G),M.onPointerEnter==null||M.onPointerEnter(G))}M.onPointerMove==null||M.onPointerMove(G)}else{const R=M[l];R?(!p||C.initialHits.includes(w))&&(r(c,C.interaction.filter(S=>!C.initialHits.includes(S))),R(G)):p&&C.initialHits.includes(w)&&r(c,C.interaction.filter(S=>!C.initialHits.includes(S)))}}s(m,c,A,B)}}return{handlePointer:a}}const ME=n=>!!(n!=null&&n.render),NE=z.createContext(null),Hj=(n,e)=>{const t=Aj((a,l)=>{const g=new _,c=new _,u=new _;function C(A=l().camera,B=c,G=l().size){const{width:w,height:N,top:M,left:R}=G,S=w/N;B instanceof _?u.copy(B):u.set(...B);const F=A.getWorldPosition(g).distanceTo(u);if(wE(A))return{width:w/A.zoom,height:N/A.zoom,top:M,left:R,factor:1,distance:F,aspect:S};{const Z=A.fov*Math.PI/180,x=2*Math.tan(Z/2)*F,Y=x*(w/N);return{width:Y,height:x,top:M,left:R,factor:w/Y,distance:F,aspect:S}}}let h;const p=A=>a(B=>({performance:{...B.performance,current:A}})),b=new ye;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(A=1)=>n(l(),A),advance:(A,B)=>e(A,B,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new nS,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const A=l();h&&clearTimeout(h),A.performance.current!==A.performance.min&&p(A.performance.min),h=setTimeout(()=>p(l().performance.max),A.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:C},setEvents:A=>a(B=>({...B,events:{...B.events,...A}})),setSize:(A,B,G,w,N)=>{const M=l().camera,R={width:A,height:B,top:w||0,left:N||0,updateStyle:G};a(S=>({size:R,viewport:{...S.viewport,...C(M,c,R)}}))},setDpr:A=>a(B=>{const G=xE(A);return{viewport:{...B.viewport,dpr:G,initialDpr:B.viewport.initialDpr||G}}}),setFrameloop:(A="always")=>{const B=l().clock;B.stop(),B.elapsedTime=0,A!=="never"&&(B.start(),B.elapsedTime=0),a(()=>({frameloop:A}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:z.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(A,B,G)=>{const w=l().internal;return w.priority=w.priority+(B>0?1:0),w.subscribers.push({ref:A,priority:B,store:G}),w.subscribers=w.subscribers.sort((N,M)=>N.priority-M.priority),()=>{const N=l().internal;N!=null&&N.subscribers&&(N.priority=N.priority-(B>0?1:0),N.subscribers=N.subscribers.filter(M=>M.ref!==A))}}}}}),i=t.getState();let s=i.size,o=i.viewport.dpr,r=i.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:g,gl:c,set:u}=t.getState();if(l.width!==s.width||l.height!==s.height||g.dpr!==o){var C;s=l,o=g.dpr,Wj(a,l),c.setPixelRatio(g.dpr);const h=(C=l.updateStyle)!=null?C:typeof HTMLCanvasElement<"u"&&c.domElement instanceof HTMLCanvasElement;c.setSize(l.width,l.height,h)}a!==r&&(r=a,u(h=>({viewport:{...h.viewport,...h.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};let pm,Xj=new Set,Tj=new Set,Ej=new Set;function NG(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function cC(n,e){switch(n){case"before":return NG(Xj,e);case"after":return NG(Tj,e);case"tail":return NG(Ej,e)}}let FG,HG;function XG(n,e,t){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(i=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),FG=e.internal.subscribers,pm=0;pm<FG.length;pm++)HG=FG[pm],HG.ref.current(HG.store.getState(),i,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function Yj(n){let e=!1,t=!1,i,s,o;function r(g){s=requestAnimationFrame(r),e=!0,i=0,cC("before",g),t=!0;for(const u of n.values()){var c;o=u.store.getState(),o.internal.active&&(o.frameloop==="always"||o.internal.frames>0)&&!((c=o.gl.xr)!=null&&c.isPresenting)&&(i+=XG(g,o))}if(t=!1,cC("after",g),i===0)return cC("tail",g),e=!1,cancelAnimationFrame(s)}function a(g,c=1){var u;if(!g)return n.forEach(C=>a(C.store.getState(),c));(u=g.gl.xr)!=null&&u.isPresenting||!g.internal.active||g.frameloop==="never"||(c>1?g.internal.frames=Math.min(60,g.internal.frames+c):t?g.internal.frames=2:g.internal.frames=1,e||(e=!0,requestAnimationFrame(r)))}function l(g,c=!0,u,C){if(c&&cC("before",g),u)XG(g,u,C);else for(const h of n.values())XG(g,h.store.getState());c&&cC("after",g)}return{loop:r,invalidate:a,advance:l}}function FE(){const n=z.useContext(NE);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function ei(n=t=>t,e){return FE()(n,e)}function ga(n,e=0){const t=FE(),i=t.getState().internal.subscribe,s=ZE(n);return dA(()=>i(s,e,t),[e,i,t]),null}const TW=new WeakMap;function HE(n,e){return function(t,...i){let s=TW.get(t);return s||(s=new t,TW.set(t,s)),n&&n(s),Promise.all(i.map(o=>new Promise((r,a)=>s.load(o,l=>{l.scene&&Object.assign(l,Rj(l.scene)),r(l)},e,l=>a(new Error(`Could not load ${o}: ${l==null?void 0:l.message}`))))))}}function Vo(n,e,t,i){const s=Array.isArray(e)?e:[e],o=mj(HE(t,i),[n,...s],{equal:Vn.equ});return Array.isArray(e)?o:o[0]}Vo.preload=function(n,e,t){const i=Array.isArray(e)?e:[e];return fj(HE(t),[n,...i])};Vo.clear=function(n,e){const t=Array.isArray(e)?e:[e];return bj([n,...t])};const DI=new Map,{invalidate:EW,advance:YW}=Yj(DI),{reconciler:B0,applyProps:Or}=vj(DI,Mj),Qu={objects:"shallow",strict:!1},Kj=(n,e)=>{const t=typeof n=="function"?n(e):n;return ME(t)?t:new WT({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function _j(n,e){const t=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(e){const{width:i,height:s,top:o,left:r,updateStyle:a=t}=e;return{width:i,height:s,top:o,left:r,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:i,height:s,top:o,left:r}=n.parentElement.getBoundingClientRect();return{width:i,height:s,top:o,left:r,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function Lj(n){const e=DI.get(n),t=e==null?void 0:e.fiber,i=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,o=i||Hj(EW,YW),r=t||B0.createContainer(o,pI.ConcurrentRoot,null,!1,null,"",s,null);e||DI.set(n,{fiber:r,store:o});let a,l=!1,g;return{configure(c={}){let{gl:u,size:C,scene:h,events:p,onCreated:b,shadows:m=!1,linear:A=!1,flat:B=!1,legacy:G=!1,orthographic:w=!1,frameloop:N="always",dpr:M=[1,2],performance:R,raycaster:S,camera:F,onPointerMissed:Z}=c,x=o.getState(),Y=x.gl;x.gl||x.set({gl:Y=Kj(u,n)});let T=x.raycaster;T||x.set({raycaster:T=new hE});const{params:ne,...ue}=S||{};if(Vn.equ(ue,T,Qu)||Or(T,{...ue}),Vn.equ(ne,T.params,Qu)||Or(T,{params:{...T.params,...ne}}),!x.camera||x.camera===g&&!Vn.equ(g,F,Qu)){g=F;const $=F instanceof rd,ae=$?F:w?new qo(0,0,0,0,.1,1e3):new Wn(75,0,.1,1e3);$||(ae.position.z=5,F&&(Or(ae,F),("aspect"in F||"left"in F||"right"in F||"bottom"in F||"top"in F)&&(ae.manual=!0,ae.updateProjectionMatrix())),!x.camera&&!(F!=null&&F.rotation)&&ae.lookAt(0,0,0)),x.set({camera:ae}),T.camera=ae}if(!x.scene){let $;h instanceof Wh?$=h:($=new Wh,h&&Or($,h)),x.set({scene:ju($)})}if(!x.xr){var se;const $=(me,ce)=>{const Be=o.getState();Be.frameloop!=="never"&&YW(me,!0,Be,ce)},ae=()=>{const me=o.getState();me.gl.xr.enabled=me.gl.xr.isPresenting,me.gl.xr.setAnimationLoop(me.gl.xr.isPresenting?$:null),me.gl.xr.isPresenting||EW(me)},be={connect(){const me=o.getState().gl;me.xr.addEventListener("sessionstart",ae),me.xr.addEventListener("sessionend",ae)},disconnect(){const me=o.getState().gl;me.xr.removeEventListener("sessionstart",ae),me.xr.removeEventListener("sessionend",ae)}};typeof((se=Y.xr)==null?void 0:se.addEventListener)=="function"&&be.connect(),x.set({xr:be})}if(Y.shadowMap){const $=Y.shadowMap.enabled,ae=Y.shadowMap.type;if(Y.shadowMap.enabled=!!m,Vn.boo(m))Y.shadowMap.type=_C;else if(Vn.str(m)){var Ie;const be={basic:VX,percentage:db,soft:_C,variance:pr};Y.shadowMap.type=(Ie=be[m])!=null?Ie:_C}else Vn.obj(m)&&Object.assign(Y.shadowMap,m);($!==Y.shadowMap.enabled||ae!==Y.shadowMap.type)&&(Y.shadowMap.needsUpdate=!0)}const k=vE();k&&("enabled"in k?k.enabled=!G:"legacyMode"in k&&(k.legacyMode=G)),l||Or(Y,{outputEncoding:A?3e3:3001,toneMapping:B?ta:bZ}),x.legacy!==G&&x.set(()=>({legacy:G})),x.linear!==A&&x.set(()=>({linear:A})),x.flat!==B&&x.set(()=>({flat:B})),u&&!Vn.fun(u)&&!ME(u)&&!Vn.equ(u,Y,Qu)&&Or(Y,u),p&&!x.events.handlers&&x.set({events:p(o)});const ee=_j(n,C);return Vn.equ(ee,x.size,Qu)||x.setSize(ee.width,ee.height,ee.updateStyle,ee.top,ee.left),M&&x.viewport.dpr!==xE(M)&&x.setDpr(M),x.frameloop!==N&&x.setFrameloop(N),x.onPointerMissed||x.set({onPointerMissed:Z}),R&&!Vn.equ(R,x.performance,Qu)&&x.set($=>({performance:{...$.performance,...R}})),a=b,l=!0,this},render(c){return l||this.configure(),B0.updateContainer(j.jsx(kj,{store:o,children:c,onCreated:a,rootElement:n}),r,null,()=>{}),o},unmount(){XE(n)}}}function kj({store:n,children:e,onCreated:t,rootElement:i}){return dA(()=>{const s=n.getState();s.set(o=>({internal:{...o.internal,active:!0}})),t&&t(s),n.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),j.jsx(NE.Provider,{value:n,children:e})}function XE(n,e){const t=DI.get(n),i=t==null?void 0:t.fiber;if(i){const s=t==null?void 0:t.store.getState();s&&(s.internal.active=!1),B0.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var o,r,a,l;s.events.disconnect==null||s.events.disconnect(),(o=s.gl)==null||(r=o.renderLists)==null||r.dispose==null||r.dispose(),(a=s.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=s.gl)!=null&&l.xr&&s.xr.disconnect(),xj(s),DI.delete(n)}catch{}},500)})}}B0.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:z.version});const TG={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function zj(n){const{handlePointer:e}=Fj(n);return{priority:1,enabled:!0,compute(t,i,s){i.pointer.set(t.offsetX/i.size.width*2-1,-(t.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(TG).reduce((t,i)=>({...t,[i]:e(i)}),{}),update:()=>{var t;const{events:i,internal:s}=n.getState();(t=s.lastEvent)!=null&&t.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:t=>{var i;const{set:s,events:o}=n.getState();o.disconnect==null||o.disconnect(),s(r=>({events:{...r.events,connected:t}})),Object.entries((i=o.handlers)!=null?i:[]).forEach(([r,a])=>{const[l,g]=TG[r];t.addEventListener(l,a,{passive:g})})},disconnect:()=>{const{set:t,events:i}=n.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([o,r])=>{if(i&&i.connected instanceof HTMLElement){const[a]=TG[o];i.connected.removeEventListener(a,r)}}),t(o=>({events:{...o.events,connected:void 0}}))}}}}function M2(n,e,t){var i,s,o,r,a;e==null&&(e=100);function l(){var c=Date.now()-r;c<e&&c>=0?i=setTimeout(l,e-c):(i=null,t||(a=n.apply(o,s),o=s=null))}var g=function(){o=this,s=arguments,r=Date.now();var c=t&&!i;return i||(i=setTimeout(l,e)),c&&(a=n.apply(o,s),o=s=null),a};return g.clear=function(){i&&(clearTimeout(i),i=null)},g.flush=function(){i&&(a=n.apply(o,s),o=s=null,clearTimeout(i),i=null)},g}M2.debounce=M2;var Dj=M2;const KW=Bw(Dj);var Pj=Object.defineProperty,Uj=Object.defineProperties,Jj=Object.getOwnPropertyDescriptors,_W=Object.getOwnPropertySymbols,Oj=Object.prototype.hasOwnProperty,Qj=Object.prototype.propertyIsEnumerable,LW=(n,e,t)=>e in n?Pj(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,kW=(n,e)=>{for(var t in e||(e={}))Oj.call(e,t)&&LW(n,t,e[t]);if(_W)for(var t of _W(e))Qj.call(e,t)&&LW(n,t,e[t]);return n},jj=(n,e)=>Uj(n,Jj(e)),zW,DW;typeof window<"u"&&((zW=window.document)!=null&&zW.createElement||((DW=window.navigator)==null?void 0:DW.product)==="ReactNative")?z.useLayoutEffect:z.useEffect;function TE(n,e,t){if(!n)return;if(t(n)===!0)return n;let i=n.child;for(;i;){const s=TE(i,e,t);if(s)return s;i=i.sibling}}function EE(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const PW=console.error;console.error=function(){const n=[...arguments].join("");if(n!=null&&n.startsWith("Warning:")&&n.includes("useContext")){console.error=PW;return}return PW.apply(this,arguments)};const aS=EE(z.createContext(null));class YE extends z.Component{render(){return z.createElement(aS.Provider,{value:this._reactInternals},this.props.children)}}function qj(){const n=z.useContext(aS);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=z.useId();return z.useMemo(()=>{for(const i of[n,n==null?void 0:n.alternate]){if(!i)continue;const s=TE(i,!1,o=>{let r=o.memoizedState;for(;r;){if(r.memoizedState===e)return!0;r=r.next}});if(s)return s}},[n,e])}function $j(){const n=qj(),[e]=z.useState(()=>new Map);e.clear();let t=n;for(;t;){if(t.type&&typeof t.type=="object"){const s=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;s&&s!==aS&&!e.has(s)&&e.set(s,z.useContext(EE(s)))}t=t.return}return e}function e7(){const n=$j();return z.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>i=>z.createElement(e,null,z.createElement(t.Provider,jj(kW({},i),{value:n.get(t)}))),e=>z.createElement(YE,kW({},e))),[n])}function t7({debounce:n,scroll:e,polyfill:t,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const s=t||typeof window<"u"&&window.ResizeObserver,[o,r]=z.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!s)return o.width=1280,o.height=800,[()=>{},o,()=>{}];const a=z.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:o,orientationHandler:null}),l=n?typeof n=="number"?n:n.scroll:null,g=n?typeof n=="number"?n:n.resize:null,c=z.useRef(!1);z.useEffect(()=>(c.current=!0,()=>void(c.current=!1)));const[u,C,h]=z.useMemo(()=>{const A=()=>{if(!a.current.element)return;const{left:B,top:G,width:w,height:N,bottom:M,right:R,x:S,y:F}=a.current.element.getBoundingClientRect(),Z={left:B,top:G,width:w,height:N,bottom:M,right:R,x:S,y:F};a.current.element instanceof HTMLElement&&i&&(Z.height=a.current.element.offsetHeight,Z.width=a.current.element.offsetWidth),Object.freeze(Z),c.current&&!o7(a.current.lastBounds,Z)&&r(a.current.lastBounds=Z)};return[A,g?KW(A,g):A,l?KW(A,l):A]},[r,i,l,g]);function p(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(A=>A.removeEventListener("scroll",h,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function b(){var A;a.current.element&&(a.current.resizeObserver=new s(C),(A=a.current.resizeObserver)==null||A.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(B=>B.addEventListener("scroll",h,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{h()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const m=A=>{!A||A===a.current.element||(p(),a.current.element=A,a.current.scrollContainers=KE(A),b())};return i7(h,!!e),n7(C),z.useEffect(()=>{p(),b()},[e,h,C]),z.useEffect(()=>p,[]),[m,o,u]}function n7(n){z.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function i7(n,e){z.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function KE(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:i,overflowY:s}=window.getComputedStyle(n);return[t,i,s].some(o=>o==="auto"||o==="scroll")&&e.push(n),[...e,...KE(n.parentElement)]}const s7=["x","y","top","bottom","left","right","width","height"],o7=(n,e)=>s7.every(t=>n[t]===e[t]),r7=z.forwardRef(function({children:e,fallback:t,resize:i,style:s,gl:o,events:r=zj,eventSource:a,eventPrefix:l,shadows:g,linear:c,flat:u,legacy:C,orthographic:h,frameloop:p,dpr:b,performance:m,raycaster:A,camera:B,scene:G,onPointerMissed:w,onCreated:N,...M},R){z.useMemo(()=>GE(dj),[]);const S=e7(),[F,Z]=t7({scroll:!0,debounce:{scroll:50,resize:0},...i}),x=z.useRef(null),Y=z.useRef(null);z.useImperativeHandle(R,()=>x.current);const T=ZE(w),[ne,ue]=z.useState(!1),[se,Ie]=z.useState(!1);if(ne)throw ne;if(se)throw se;const k=z.useRef(null);dA(()=>{const $=x.current;Z.width>0&&Z.height>0&&$&&(k.current||(k.current=Lj($)),k.current.configure({gl:o,events:r,shadows:g,linear:c,flat:u,legacy:C,orthographic:h,frameloop:p,dpr:b,performance:m,raycaster:A,camera:B,scene:G,size:Z,onPointerMissed:(...ae)=>T.current==null?void 0:T.current(...ae),onCreated:ae=>{ae.events.connect==null||ae.events.connect(a?wj(a)?a.current:a:Y.current),l&&ae.setEvents({compute:(be,me)=>{const ce=be[l+"X"],Be=be[l+"Y"];me.pointer.set(ce/me.size.width*2-1,-(Be/me.size.height)*2+1),me.raycaster.setFromCamera(me.pointer,me.camera)}}),N==null||N(ae)}}),k.current.render(j.jsx(S,{children:j.jsx(SE,{set:Ie,children:j.jsx(z.Suspense,{fallback:j.jsx(Zj,{set:ue}),children:e})})})))}),z.useEffect(()=>{const $=x.current;if($)return()=>XE($)},[]);const ee=a?"none":"auto";return j.jsx("div",{ref:Y,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ee,...s},...M,children:j.jsx("div",{ref:F,style:{width:"100%",height:"100%"},children:j.jsx("canvas",{ref:x,style:{display:"block"},children:t})})})}),Qb=z.forwardRef(function(e,t){return j.jsx(YE,{children:j.jsx(r7,{...e,ref:t})})});function nr(){return nr=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},nr.apply(null,arguments)}const CA=new _,lS=new _,a7=new _,UW=new ye;function l7(n,e,t){const i=CA.setFromMatrixPosition(n.matrixWorld);i.project(e);const s=t.width/2,o=t.height/2;return[i.x*s+s,-(i.y*o)+o]}function g7(n,e){const t=CA.setFromMatrixPosition(n.matrixWorld),i=lS.setFromMatrixPosition(e.matrixWorld),s=t.sub(i),o=e.getWorldDirection(a7);return s.angleTo(o)>Math.PI/2}function c7(n,e,t,i){const s=CA.setFromMatrixPosition(n.matrixWorld),o=s.clone();o.project(e),UW.set(o.x,o.y),t.setFromCamera(UW,e);const r=t.intersectObjects(i,!0);if(r.length){const a=r[0].distance;return s.distanceTo(t.ray.origin)<a}return!0}function u7(n,e){if(e instanceof qo)return e.zoom;if(e instanceof Wn){const t=CA.setFromMatrixPosition(n.matrixWorld),i=lS.setFromMatrixPosition(e.matrixWorld),s=e.fov*Math.PI/180,o=t.distanceTo(i);return 1/(2*Math.tan(s/2)*o)}else return 1}function I7(n,e,t){if(e instanceof Wn||e instanceof qo){const i=CA.setFromMatrixPosition(n.matrixWorld),s=lS.setFromMatrixPosition(e.matrixWorld),o=i.distanceTo(s),r=(t[1]-t[0])/(e.far-e.near),a=t[1]-r*e.far;return Math.round(r*o+a)}}const N2=n=>Math.abs(n)<1e-10?0:n;function _E(n,e,t=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=N2(e[s]*n.elements[s])+(s!==15?",":")");return t+i}const d7=(n=>e=>_E(e,n))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),C7=(n=>(e,t)=>_E(e,n(t),"translate(-50%,-50%)"))(n=>[1/n,1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1]);function h7(n){return n&&typeof n=="object"&&"current"in n}const A7=z.forwardRef(({children:n,eps:e=.001,style:t,className:i,prepend:s,center:o,fullscreen:r,portal:a,distanceFactor:l,sprite:g=!1,transform:c=!1,occlude:u,onOcclude:C,castShadow:h,receiveShadow:p,material:b,geometry:m,zIndexRange:A=[16777271,0],calculatePosition:B=l7,as:G="div",wrapperClass:w,pointerEvents:N="auto",...M},R)=>{const{gl:S,camera:F,scene:Z,size:x,raycaster:Y,events:T,viewport:ne}=ei(),[ue]=z.useState(()=>document.createElement(G)),se=z.useRef(),Ie=z.useRef(null),k=z.useRef(0),ee=z.useRef([0,0]),$=z.useRef(null),ae=z.useRef(null),be=(a==null?void 0:a.current)||T.connected||S.domElement.parentNode,me=z.useRef(null),ce=z.useRef(!1),Be=z.useMemo(()=>u&&u!=="blending"||Array.isArray(u)&&u.length&&h7(u[0]),[u]);z.useLayoutEffect(()=>{const ot=S.domElement;u&&u==="blending"?(ot.style.zIndex=`${Math.floor(A[0]/2)}`,ot.style.position="absolute",ot.style.pointerEvents="none"):(ot.style.zIndex=null,ot.style.position=null,ot.style.pointerEvents=null)},[u]),z.useLayoutEffect(()=>{if(Ie.current){const ot=se.current=pZ(ue);if(Z.updateMatrixWorld(),c)ue.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const Ue=B(Ie.current,F,x);ue.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${Ue[0]}px,${Ue[1]}px,0);transform-origin:0 0;`}return be&&(s?be.prepend(ue):be.appendChild(ue)),()=>{be&&be.removeChild(ue),ot.unmount()}}},[be,c]),z.useLayoutEffect(()=>{w&&(ue.className=w)},[w]);const He=z.useMemo(()=>c?{position:"absolute",top:0,left:0,width:x.width,height:x.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:o?"translate3d(-50%,-50%,0)":"none",...r&&{top:-x.height/2,left:-x.width/2,width:x.width,height:x.height},...t},[t,o,r,x,c]),Fe=z.useMemo(()=>({position:"absolute",pointerEvents:N}),[N]);z.useLayoutEffect(()=>{if(ce.current=!1,c){var ot;(ot=se.current)==null||ot.render(z.createElement("div",{ref:$,style:He},z.createElement("div",{ref:ae,style:Fe},z.createElement("div",{ref:R,className:i,style:t,children:n}))))}else{var Ue;(Ue=se.current)==null||Ue.render(z.createElement("div",{ref:R,style:He,className:i,children:n}))}});const Ct=z.useRef(!0);ga(ot=>{if(Ie.current){F.updateMatrixWorld(),Ie.current.updateWorldMatrix(!0,!1);const Ue=c?ee.current:B(Ie.current,F,x);if(c||Math.abs(k.current-F.zoom)>e||Math.abs(ee.current[0]-Ue[0])>e||Math.abs(ee.current[1]-Ue[1])>e){const we=g7(Ie.current,F);let D=!1;Be&&(Array.isArray(u)?D=u.map(_e=>_e.current):u!=="blending"&&(D=[Z]));const Ee=Ct.current;if(D){const _e=c7(Ie.current,F,Y,D);Ct.current=_e&&!we}else Ct.current=!we;Ee!==Ct.current&&(C?C(!Ct.current):ue.style.display=Ct.current?"block":"none");const Ye=Math.floor(A[0]/2),Ne=u?Be?[A[0],Ye]:[Ye-1,0]:A;if(ue.style.zIndex=`${I7(Ie.current,F,Ne)}`,c){const[_e,ut]=[x.width/2,x.height/2],Oe=F.projectionMatrix.elements[5]*ut,{isOrthographicCamera:P,top:E,left:ge,bottom:ve,right:Se}=F,Ze=d7(F.matrixWorldInverse),Je=P?`scale(${Oe})translate(${N2(-(Se+ge)/2)}px,${N2((E+ve)/2)}px)`:`translateZ(${Oe}px)`;let We=Ie.current.matrixWorld;g&&(We=F.matrixWorldInverse.clone().transpose().copyPosition(We).scale(Ie.current.scale),We.elements[3]=We.elements[7]=We.elements[11]=0,We.elements[15]=1),ue.style.width=x.width+"px",ue.style.height=x.height+"px",ue.style.perspective=P?"":`${Oe}px`,$.current&&ae.current&&($.current.style.transform=`${Je}${Ze}translate(${_e}px,${ut}px)`,ae.current.style.transform=C7(We,1/((l||10)/400)))}else{const _e=l===void 0?1:u7(Ie.current,F)*l;ue.style.transform=`translate3d(${Ue[0]}px,${Ue[1]}px,0) scale(${_e})`}ee.current=Ue,k.current=F.zoom}}if(!Be&&me.current&&!ce.current)if(c){if($.current){const Ue=$.current.children[0];if(Ue!=null&&Ue.clientWidth&&Ue!=null&&Ue.clientHeight){const{isOrthographicCamera:we}=F;if(we||m)M.scale&&(Array.isArray(M.scale)?M.scale instanceof _?me.current.scale.copy(M.scale.clone().divideScalar(1)):me.current.scale.set(1/M.scale[0],1/M.scale[1],1/M.scale[2]):me.current.scale.setScalar(1/M.scale));else{const D=(l||10)/400,Ee=Ue.clientWidth*D,Ye=Ue.clientHeight*D;me.current.scale.set(Ee,Ye,1)}ce.current=!0}}}else{const Ue=ue.children[0];if(Ue!=null&&Ue.clientWidth&&Ue!=null&&Ue.clientHeight){const we=1/ne.factor,D=Ue.clientWidth*we,Ee=Ue.clientHeight*we;me.current.scale.set(D,Ee,1),ce.current=!0}me.current.lookAt(ot.camera.position)}});const pt=z.useMemo(()=>({vertexShader:c?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[c]);return z.createElement("group",nr({},M,{ref:Ie}),u&&!Be&&z.createElement("mesh",{castShadow:h,receiveShadow:p,ref:me},m||z.createElement("planeGeometry",null),b||z.createElement("shaderMaterial",{side:bo,vertexShader:pt.vertexShader,fragmentShader:pt.fragmentShader})))}),JW=n=>{let e;const t=new Set,i=(g,c)=>{const u=typeof g=="function"?g(e):g;if(!Object.is(u,e)){const C=e;e=c??(typeof u!="object"||u===null)?u:Object.assign({},e,u),t.forEach(h=>h(e,C))}},s=()=>e,a={setState:i,getState:s,getInitialState:()=>l,subscribe:g=>(t.add(g),()=>t.delete(g))},l=e=n(i,s,a);return a},p7=n=>n?JW(n):JW,m7=n=>n;function f7(n,e=m7){const t=uf.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return uf.useDebugValue(t),t}const OW=n=>{const e=p7(n),t=i=>f7(e,i);return Object.assign(t,e),t},b7=n=>n?OW(n):OW;let uC=0;const y7=b7(n=>(AI.onStart=(e,t,i)=>{n({active:!0,item:e,loaded:t,total:i,progress:(t-uC)/(i-uC)*100})},AI.onLoad=()=>{n({active:!1})},AI.onError=e=>n(t=>({errors:[...t.errors,e]})),AI.onProgress=(e,t,i)=>{t===i&&(uC=i),n({active:!0,item:e,loaded:t,total:i,progress:(t-uC)/(i-uC)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function VI(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function QW(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable})),t.push.apply(t,i)}return t}function jW(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?QW(Object(t),!0).forEach(function(i){VI(n,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):QW(Object(t)).forEach(function(i){Object.defineProperty(n,i,Object.getOwnPropertyDescriptor(t,i))})}return n}new ye;new ye;function LE(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var Lo=function n(e,t,i){var s=this;LE(this,n),VI(this,"dot2",function(o,r){return s.x*o+s.y*r}),VI(this,"dot3",function(o,r,a){return s.x*o+s.y*r+s.z*a}),this.x=e,this.y=t,this.z=i},B7=[new Lo(1,1,0),new Lo(-1,1,0),new Lo(1,-1,0),new Lo(-1,-1,0),new Lo(1,0,1),new Lo(-1,0,1),new Lo(1,0,-1),new Lo(-1,0,-1),new Lo(0,1,1),new Lo(0,-1,1),new Lo(0,1,-1),new Lo(0,-1,-1)],qW=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],$W=new Array(512),eM=new Array(512),G7=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var t=0;t<256;t++){var i;t&1?i=qW[t]^e&255:i=qW[t]^e>>8&255,$W[t]=$W[t+256]=i,eM[t]=eM[t+256]=B7[i%12]}};G7(0);function v7(n){if(typeof n=="number")n=Math.abs(n);else if(typeof n=="string"){var e=n;n=0;for(var t=0;t<e.length;t++)n=(n+(t+1)*(e.charCodeAt(t)%96))%2147483647}return n===0&&(n=311),n}function tM(n){var e=v7(n);return function(){var t=e*48271%2147483647;return e=t,t/2147483647}}var w7=function n(e){var t=this;LE(this,n),VI(this,"seed",0),VI(this,"init",function(i){t.seed=i,t.value=tM(i)}),VI(this,"value",tM(this.seed)),this.init(e)},Z7=new w7(Math.random()),S7={radius:1,center:[0,0,0]};function R7(n,e){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Z7,i=jW(jW({},S7),e),s=i.radius,o=i.center,r=0;r<n.length;r+=3){var a=Math.pow(t.value(),.3333333333333333),l=t.value()*2-1,g=t.value()*2-1,c=t.value()*2-1,u=Math.sqrt(l*l+g*g+c*c);l=a*l/u,g=a*g/u,c=a*c/u,n[r]=l*s+o[0],n[r+1]=g*s+o[1],n[r+2]=c*s+o[2]}return n}const x7=parseInt(sd.replace(/\D+/g,""));function nM(n,e){if(e===WZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Uc||e===sA){let t=n.getIndex();if(t===null){const r=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)r.push(l);n.setIndex(r),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(t)if(e===Uc)for(let r=1;r<=i;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}var V7=Object.defineProperty,W7=(n,e,t)=>e in n?V7(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,St=(n,e,t)=>(W7(n,typeof e!="symbol"?e+"":e,t),t);const mm=new nu,iM=new Jr,M7=Math.cos(70*(Math.PI/180)),sM=(n,e)=>(n%e+e)%e;let N7=class extends Mr{constructor(e,t){super(),St(this,"object"),St(this,"domElement"),St(this,"enabled",!0),St(this,"target",new _),St(this,"minDistance",0),St(this,"maxDistance",1/0),St(this,"minZoom",0),St(this,"maxZoom",1/0),St(this,"minPolarAngle",0),St(this,"maxPolarAngle",Math.PI),St(this,"minAzimuthAngle",-1/0),St(this,"maxAzimuthAngle",1/0),St(this,"enableDamping",!1),St(this,"dampingFactor",.05),St(this,"enableZoom",!0),St(this,"zoomSpeed",1),St(this,"enableRotate",!0),St(this,"rotateSpeed",1),St(this,"enablePan",!0),St(this,"panSpeed",1),St(this,"screenSpacePanning",!0),St(this,"keyPanSpeed",7),St(this,"zoomToCursor",!1),St(this,"autoRotate",!1),St(this,"autoRotateSpeed",2),St(this,"reverseOrbit",!1),St(this,"reverseHorizontalOrbit",!1),St(this,"reverseVerticalOrbit",!1),St(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),St(this,"mouseButtons",{LEFT:sc.ROTATE,MIDDLE:sc.DOLLY,RIGHT:sc.PAN}),St(this,"touches",{ONE:oc.ROTATE,TWO:oc.DOLLY_PAN}),St(this,"target0"),St(this,"position0"),St(this,"zoom0"),St(this,"_domElementKeyEvents",null),St(this,"getPolarAngle"),St(this,"getAzimuthalAngle"),St(this,"setPolarAngle"),St(this,"setAzimuthalAngle"),St(this,"getDistance"),St(this,"getZoomScale"),St(this,"listenToKeyEvents"),St(this,"stopListenToKeyEvents"),St(this,"saveState"),St(this,"reset"),St(this,"update"),St(this,"connect"),St(this,"dispose"),St(this,"dollyIn"),St(this,"dollyOut"),St(this,"getScale"),St(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=q=>{let xe=sM(q,2*Math.PI),Q=c.phi;Q<0&&(Q+=2*Math.PI),xe<0&&(xe+=2*Math.PI);let Me=Math.abs(xe-Q);2*Math.PI-Me<Me&&(xe<Q?xe+=2*Math.PI:Q+=2*Math.PI),u.phi=xe-Q,i.update()},this.setAzimuthalAngle=q=>{let xe=sM(q,2*Math.PI),Q=c.theta;Q<0&&(Q+=2*Math.PI),xe<0&&(xe+=2*Math.PI);let Me=Math.abs(xe-Q);2*Math.PI-Me<Me&&(xe<Q?xe+=2*Math.PI:Q+=2*Math.PI),u.theta=xe-Q,i.update()},this.getDistance=()=>i.object.position.distanceTo(i.target),this.listenToKeyEvents=q=>{q.addEventListener("keydown",Qe),this._domElementKeyEvents=q},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Qe),this._domElementKeyEvents=null},this.saveState=()=>{i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=()=>{i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(s),i.update(),l=a.NONE},this.update=(()=>{const q=new _,xe=new _(0,1,0),Q=new ii().setFromUnitVectors(e.up,xe),Me=Q.clone().invert(),Ce=new _,Re=new ii,De=2*Math.PI;return function(){const Wt=i.object.position;Q.setFromUnitVectors(e.up,xe),Me.copy(Q).invert(),q.copy(Wt).sub(i.target),q.applyQuaternion(Q),c.setFromVector3(q),i.autoRotate&&l===a.NONE&&ne(Y()),i.enableDamping?(c.theta+=u.theta*i.dampingFactor,c.phi+=u.phi*i.dampingFactor):(c.theta+=u.theta,c.phi+=u.phi);let $t=i.minAzimuthAngle,An=i.maxAzimuthAngle;isFinite($t)&&isFinite(An)&&($t<-Math.PI?$t+=De:$t>Math.PI&&($t-=De),An<-Math.PI?An+=De:An>Math.PI&&(An-=De),$t<=An?c.theta=Math.max($t,Math.min(An,c.theta)):c.theta=c.theta>($t+An)/2?Math.max($t,c.theta):Math.min(An,c.theta)),c.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,c.phi)),c.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(h,i.dampingFactor):i.target.add(h),i.zoomToCursor&&F||i.object.isOrthographicCamera?c.radius=me(c.radius):c.radius=me(c.radius*C),q.setFromSpherical(c),q.applyQuaternion(Me),Wt.copy(i.target).add(q),i.object.matrixAutoUpdate||i.object.updateMatrix(),i.object.lookAt(i.target),i.enableDamping===!0?(u.theta*=1-i.dampingFactor,u.phi*=1-i.dampingFactor,h.multiplyScalar(1-i.dampingFactor)):(u.set(0,0,0),h.set(0,0,0));let Ft=!1;if(i.zoomToCursor&&F){let bn=null;if(i.object instanceof Wn&&i.object.isPerspectiveCamera){const ri=q.length();bn=me(ri*C);const Fn=ri-bn;i.object.position.addScaledVector(R,Fn),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const ri=new _(S.x,S.y,0);ri.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/C)),i.object.updateProjectionMatrix(),Ft=!0;const Fn=new _(S.x,S.y,0);Fn.unproject(i.object),i.object.position.sub(Fn).add(ri),i.object.updateMatrixWorld(),bn=q.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;bn!==null&&(i.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(bn).add(i.object.position):(mm.origin.copy(i.object.position),mm.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(mm.direction))<M7?e.lookAt(i.target):(iM.setFromNormalAndCoplanarPoint(i.object.up,i.target),mm.intersectPlane(iM,i.target))))}else i.object instanceof qo&&i.object.isOrthographicCamera&&(Ft=C!==1,Ft&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/C)),i.object.updateProjectionMatrix()));return C=1,F=!1,Ft||Ce.distanceToSquared(i.object.position)>g||8*(1-Re.dot(i.object.quaternion))>g?(i.dispatchEvent(s),Ce.copy(i.object.position),Re.copy(i.object.quaternion),Ft=!1,!0):!1}})(),this.connect=q=>{i.domElement=q,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",et),i.domElement.addEventListener("pointerdown",ge),i.domElement.addEventListener("pointercancel",Se),i.domElement.addEventListener("wheel",We)},this.dispose=()=>{var q,xe,Q,Me,Ce,Re;i.domElement&&(i.domElement.style.touchAction="auto"),(q=i.domElement)==null||q.removeEventListener("contextmenu",et),(xe=i.domElement)==null||xe.removeEventListener("pointerdown",ge),(Q=i.domElement)==null||Q.removeEventListener("pointercancel",Se),(Me=i.domElement)==null||Me.removeEventListener("wheel",We),(Ce=i.domElement)==null||Ce.ownerDocument.removeEventListener("pointermove",ve),(Re=i.domElement)==null||Re.ownerDocument.removeEventListener("pointerup",Se),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",Qe)};const i=this,s={type:"change"},o={type:"start"},r={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const g=1e-6,c=new R2,u=new R2;let C=1;const h=new _,p=new ye,b=new ye,m=new ye,A=new ye,B=new ye,G=new ye,w=new ye,N=new ye,M=new ye,R=new _,S=new ye;let F=!1;const Z=[],x={};function Y(){return 2*Math.PI/60/60*i.autoRotateSpeed}function T(){return Math.pow(.95,i.zoomSpeed)}function ne(q){i.reverseOrbit||i.reverseHorizontalOrbit?u.theta+=q:u.theta-=q}function ue(q){i.reverseOrbit||i.reverseVerticalOrbit?u.phi+=q:u.phi-=q}const se=(()=>{const q=new _;return function(Q,Me){q.setFromMatrixColumn(Me,0),q.multiplyScalar(-Q),h.add(q)}})(),Ie=(()=>{const q=new _;return function(Q,Me){i.screenSpacePanning===!0?q.setFromMatrixColumn(Me,1):(q.setFromMatrixColumn(Me,0),q.crossVectors(i.object.up,q)),q.multiplyScalar(Q),h.add(q)}})(),k=(()=>{const q=new _;return function(Q,Me){const Ce=i.domElement;if(Ce&&i.object instanceof Wn&&i.object.isPerspectiveCamera){const Re=i.object.position;q.copy(Re).sub(i.target);let De=q.length();De*=Math.tan(i.object.fov/2*Math.PI/180),se(2*Q*De/Ce.clientHeight,i.object.matrix),Ie(2*Me*De/Ce.clientHeight,i.object.matrix)}else Ce&&i.object instanceof qo&&i.object.isOrthographicCamera?(se(Q*(i.object.right-i.object.left)/i.object.zoom/Ce.clientWidth,i.object.matrix),Ie(Me*(i.object.top-i.object.bottom)/i.object.zoom/Ce.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function ee(q){i.object instanceof Wn&&i.object.isPerspectiveCamera||i.object instanceof qo&&i.object.isOrthographicCamera?C=q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function $(q){ee(C/q)}function ae(q){ee(C*q)}function be(q){if(!i.zoomToCursor||!i.domElement)return;F=!0;const xe=i.domElement.getBoundingClientRect(),Q=q.clientX-xe.left,Me=q.clientY-xe.top,Ce=xe.width,Re=xe.height;S.x=Q/Ce*2-1,S.y=-(Me/Re)*2+1,R.set(S.x,S.y,1).unproject(i.object).sub(i.object.position).normalize()}function me(q){return Math.max(i.minDistance,Math.min(i.maxDistance,q))}function ce(q){p.set(q.clientX,q.clientY)}function Be(q){be(q),w.set(q.clientX,q.clientY)}function He(q){A.set(q.clientX,q.clientY)}function Fe(q){b.set(q.clientX,q.clientY),m.subVectors(b,p).multiplyScalar(i.rotateSpeed);const xe=i.domElement;xe&&(ne(2*Math.PI*m.x/xe.clientHeight),ue(2*Math.PI*m.y/xe.clientHeight)),p.copy(b),i.update()}function Ct(q){N.set(q.clientX,q.clientY),M.subVectors(N,w),M.y>0?$(T()):M.y<0&&ae(T()),w.copy(N),i.update()}function pt(q){B.set(q.clientX,q.clientY),G.subVectors(B,A).multiplyScalar(i.panSpeed),k(G.x,G.y),A.copy(B),i.update()}function ot(q){be(q),q.deltaY<0?ae(T()):q.deltaY>0&&$(T()),i.update()}function Ue(q){let xe=!1;switch(q.code){case i.keys.UP:k(0,i.keyPanSpeed),xe=!0;break;case i.keys.BOTTOM:k(0,-i.keyPanSpeed),xe=!0;break;case i.keys.LEFT:k(i.keyPanSpeed,0),xe=!0;break;case i.keys.RIGHT:k(-i.keyPanSpeed,0),xe=!0;break}xe&&(q.preventDefault(),i.update())}function we(){if(Z.length==1)p.set(Z[0].pageX,Z[0].pageY);else{const q=.5*(Z[0].pageX+Z[1].pageX),xe=.5*(Z[0].pageY+Z[1].pageY);p.set(q,xe)}}function D(){if(Z.length==1)A.set(Z[0].pageX,Z[0].pageY);else{const q=.5*(Z[0].pageX+Z[1].pageX),xe=.5*(Z[0].pageY+Z[1].pageY);A.set(q,xe)}}function Ee(){const q=Z[0].pageX-Z[1].pageX,xe=Z[0].pageY-Z[1].pageY,Q=Math.sqrt(q*q+xe*xe);w.set(0,Q)}function Ye(){i.enableZoom&&Ee(),i.enablePan&&D()}function Ne(){i.enableZoom&&Ee(),i.enableRotate&&we()}function _e(q){if(Z.length==1)b.set(q.pageX,q.pageY);else{const Q=Nt(q),Me=.5*(q.pageX+Q.x),Ce=.5*(q.pageY+Q.y);b.set(Me,Ce)}m.subVectors(b,p).multiplyScalar(i.rotateSpeed);const xe=i.domElement;xe&&(ne(2*Math.PI*m.x/xe.clientHeight),ue(2*Math.PI*m.y/xe.clientHeight)),p.copy(b)}function ut(q){if(Z.length==1)B.set(q.pageX,q.pageY);else{const xe=Nt(q),Q=.5*(q.pageX+xe.x),Me=.5*(q.pageY+xe.y);B.set(Q,Me)}G.subVectors(B,A).multiplyScalar(i.panSpeed),k(G.x,G.y),A.copy(B)}function Oe(q){const xe=Nt(q),Q=q.pageX-xe.x,Me=q.pageY-xe.y,Ce=Math.sqrt(Q*Q+Me*Me);N.set(0,Ce),M.set(0,Math.pow(N.y/w.y,i.zoomSpeed)),$(M.y),w.copy(N)}function P(q){i.enableZoom&&Oe(q),i.enablePan&&ut(q)}function E(q){i.enableZoom&&Oe(q),i.enableRotate&&_e(q)}function ge(q){var xe,Q;i.enabled!==!1&&(Z.length===0&&((xe=i.domElement)==null||xe.ownerDocument.addEventListener("pointermove",ve),(Q=i.domElement)==null||Q.ownerDocument.addEventListener("pointerup",Se)),Gt(q),q.pointerType==="touch"?Kt(q):Ze(q))}function ve(q){i.enabled!==!1&&(q.pointerType==="touch"?Xe(q):Je(q))}function Se(q){var xe,Q,Me;wt(q),Z.length===0&&((xe=i.domElement)==null||xe.releasePointerCapture(q.pointerId),(Q=i.domElement)==null||Q.ownerDocument.removeEventListener("pointermove",ve),(Me=i.domElement)==null||Me.ownerDocument.removeEventListener("pointerup",Se)),i.dispatchEvent(r),l=a.NONE}function Ze(q){let xe;switch(q.button){case 0:xe=i.mouseButtons.LEFT;break;case 1:xe=i.mouseButtons.MIDDLE;break;case 2:xe=i.mouseButtons.RIGHT;break;default:xe=-1}switch(xe){case sc.DOLLY:if(i.enableZoom===!1)return;Be(q),l=a.DOLLY;break;case sc.ROTATE:if(q.ctrlKey||q.metaKey||q.shiftKey){if(i.enablePan===!1)return;He(q),l=a.PAN}else{if(i.enableRotate===!1)return;ce(q),l=a.ROTATE}break;case sc.PAN:if(q.ctrlKey||q.metaKey||q.shiftKey){if(i.enableRotate===!1)return;ce(q),l=a.ROTATE}else{if(i.enablePan===!1)return;He(q),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(o)}function Je(q){if(i.enabled!==!1)switch(l){case a.ROTATE:if(i.enableRotate===!1)return;Fe(q);break;case a.DOLLY:if(i.enableZoom===!1)return;Ct(q);break;case a.PAN:if(i.enablePan===!1)return;pt(q);break}}function We(q){i.enabled===!1||i.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||(q.preventDefault(),i.dispatchEvent(o),ot(q),i.dispatchEvent(r))}function Qe(q){i.enabled===!1||i.enablePan===!1||Ue(q)}function Kt(q){switch(it(q),Z.length){case 1:switch(i.touches.ONE){case oc.ROTATE:if(i.enableRotate===!1)return;we(),l=a.TOUCH_ROTATE;break;case oc.PAN:if(i.enablePan===!1)return;D(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(i.touches.TWO){case oc.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;Ye(),l=a.TOUCH_DOLLY_PAN;break;case oc.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Ne(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(o)}function Xe(q){switch(it(q),l){case a.TOUCH_ROTATE:if(i.enableRotate===!1)return;_e(q),i.update();break;case a.TOUCH_PAN:if(i.enablePan===!1)return;ut(q),i.update();break;case a.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;P(q),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;E(q),i.update();break;default:l=a.NONE}}function et(q){i.enabled!==!1&&q.preventDefault()}function Gt(q){Z.push(q)}function wt(q){delete x[q.pointerId];for(let xe=0;xe<Z.length;xe++)if(Z[xe].pointerId==q.pointerId){Z.splice(xe,1);return}}function it(q){let xe=x[q.pointerId];xe===void 0&&(xe=new ye,x[q.pointerId]=xe),xe.set(q.pageX,q.pageY)}function Nt(q){const xe=q.pointerId===Z[0].pointerId?Z[1]:Z[0];return x[xe.pointerId]}this.dollyIn=(q=T())=>{ae(q),i.update()},this.dollyOut=(q=T())=>{$(q),i.update()},this.getScale=()=>C,this.setScale=q=>{ee(q),i.update()},this.getZoomScale=()=>T(),t!==void 0&&this.connect(t),this.update()}};function G0(n){if(typeof TextDecoder<"u")return new TextDecoder().decode(n);let e="";for(let t=0,i=n.length;t<i;t++)e+=String.fromCharCode(n[t]);try{return decodeURIComponent(escape(e))}catch{return e}}const Gc="srgb",Ea="srgb-linear",oM=3001,F7=3e3;let gS=class extends qi{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Y7(t)}),this.register(function(t){return new K7(t)}),this.register(function(t){return new O7(t)}),this.register(function(t){return new Q7(t)}),this.register(function(t){return new j7(t)}),this.register(function(t){return new L7(t)}),this.register(function(t){return new k7(t)}),this.register(function(t){return new z7(t)}),this.register(function(t){return new D7(t)}),this.register(function(t){return new E7(t)}),this.register(function(t){return new P7(t)}),this.register(function(t){return new _7(t)}),this.register(function(t){return new J7(t)}),this.register(function(t){return new U7(t)}),this.register(function(t){return new X7(t)}),this.register(function(t){return new q7(t)}),this.register(function(t){return new $7(t)})}load(e,t,i,s){const o=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const g=vo.extractUrlBase(e);r=vo.resolveURL(g,this.path)}else r=vo.extractUrlBase(e);this.manager.itemStart(e);const a=function(g){s?s(g):console.error(g),o.manager.itemError(e),o.manager.itemEnd(e)},l=new Ks(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(g){try{o.parse(g,r,function(c){t(c),o.manager.itemEnd(e)},a)}catch(c){a(c)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let o;const r={},a={};if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(G0(new Uint8Array(e.slice(0,4)))===kE){try{r[Qt.KHR_BINARY_GLTF]=new e8(e)}catch(c){s&&s(c);return}o=JSON.parse(r[Qt.KHR_BINARY_GLTF].content)}else o=JSON.parse(G0(new Uint8Array(e)));else o=e;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new d8(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let g=0;g<this.pluginCallbacks.length;g++){const c=this.pluginCallbacks[g](l);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[c.name]=c,r[c.name]=!0}if(o.extensionsUsed)for(let g=0;g<o.extensionsUsed.length;++g){const c=o.extensionsUsed[g],u=o.extensionsRequired||[];switch(c){case Qt.KHR_MATERIALS_UNLIT:r[c]=new T7;break;case Qt.KHR_DRACO_MESH_COMPRESSION:r[c]=new t8(o,this.dracoLoader);break;case Qt.KHR_TEXTURE_TRANSFORM:r[c]=new n8;break;case Qt.KHR_MESH_QUANTIZATION:r[c]=new i8;break;default:u.indexOf(c)>=0&&a[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,o){i.parse(e,t,s,o)})}};function H7(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Qt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};let X7=class{constructor(e){this.parser=e,this.name=Qt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const o=t[i];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const o=t.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let g;const c=new Pe(16777215);l.color!==void 0&&c.setRGB(l.color[0],l.color[1],l.color[2],Ea);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":g=new Jb(c),g.target.position.set(0,0,-1),g.add(g.target);break;case"point":g=new Ub(c),g.distance=u;break;case"spot":g=new Pb(c),g.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,g.angle=l.spot.outerConeAngle,g.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,g.target.position.set(0,0,-1),g.add(g.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return g.position.set(0,0,0),g.decay=2,Za(g,l),l.intensity!==void 0&&(g.intensity=l.intensity),g.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(g),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,o=i.json.nodes[e],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}},T7=class{constructor(){this.name=Qt.KHR_MATERIALS_UNLIT}getMaterialType(){return Hi}extendParams(e,t,i){const s=[];e.color=new Pe(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const r=o.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],Ea),e.opacity=r[3]}o.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",o.baseColorTexture,Gc))}return Promise.all(s)}},E7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}},Y7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(o.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ye(a,a)}return Promise.all(o)}},K7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}},_7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(o)}},L7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new Pe(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ea)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&o.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Gc)),r.sheenRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}},k7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&o.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)}},z7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&o.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new Pe().setRGB(a[0],a[1],a[2],Ea),Promise.all(o)}},D7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}},P7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&o.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new Pe().setRGB(a[0],a[1],a[2],Ea),r.specularColorTexture!==void 0&&o.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,Gc)),Promise.all(o)}},U7=class{constructor(e){this.parser=e,this.name=Qt.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&o.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(o)}},J7=class{constructor(e){this.parser=e,this.name=Qt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&o.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(o)}},O7=class{constructor(e){this.parser=e,this.name=Qt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,r)}},Q7=class{constructor(e){this.parser=e,this.name=Qt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=s.images[r.source];let l=i.textureLoader;if(a.uri){const g=i.options.manager.getHandler(a.uri);g!==null&&(l=g)}return this.detectSupport().then(function(g){if(g)return i.loadTextureImage(e,r.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},j7=class{constructor(e){this.parser=e,this.name=Qt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=s.images[r.source];let l=i.textureLoader;if(a.uri){const g=i.options.manager.getHandler(a.uri);g!==null&&(l=g)}return this.detectSupport().then(function(g){if(g)return i.loadTextureImage(e,r.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}},q7=class{constructor(e){this.name=Qt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(a){const l=s.byteOffset||0,g=s.byteLength||0,c=s.count,u=s.byteStride,C=new Uint8Array(a,l,g);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(c,u,C,s.mode,s.filter).then(function(h){return h.buffer}):r.ready.then(function(){const h=new ArrayBuffer(c*u);return r.decodeGltfBuffer(new Uint8Array(h),c,u,C,s.mode,s.filter),h})})}else return null}},$7=class{constructor(e){this.name=Qt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const g of s.primitives)if(g.mode!==Do.TRIANGLES&&g.mode!==Do.TRIANGLE_STRIP&&g.mode!==Do.TRIANGLE_FAN&&g.mode!==void 0)return null;const r=i.extensions[this.name].attributes,a=[],l={};for(const g in r)a.push(this.parser.getDependency("accessor",r[g]).then(c=>(l[g]=c,l[g])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(g=>{const c=g.pop(),u=c.isGroup?c.children:[c],C=g[0].count,h=[];for(const p of u){const b=new ct,m=new _,A=new ii,B=new _(1,1,1),G=new Jl(p.geometry,p.material,C);for(let w=0;w<C;w++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&A.fromBufferAttribute(l.ROTATION,w),l.SCALE&&B.fromBufferAttribute(l.SCALE,w),G.setMatrixAt(w,b.compose(m,A,B));for(const w in l)if(w==="_COLOR_0"){const N=l[w];G.instanceColor=new ng(N.array,N.itemSize,N.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&p.geometry.setAttribute(w,l[w]);Lt.prototype.copy.call(G,p),this.parser.assignFinalMaterial(G),h.push(G)}return c.isGroup?(c.clear(),c.add(...h),c):h[0]}))}};const kE="glTF",IC=12,rM={JSON:1313821514,BIN:5130562};let e8=class{constructor(e){this.name=Qt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,IC);if(this.header={magic:G0(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==kE)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-IC,s=new DataView(e,IC);let o=0;for(;o<i;){const r=s.getUint32(o,!0);o+=4;const a=s.getUint32(o,!0);if(o+=4,a===rM.JSON){const l=new Uint8Array(e,IC+o,r);this.content=G0(l)}else if(a===rM.BIN){const l=IC+o;this.body=e.slice(l,l+r)}o+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}},t8=class{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Qt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},l={},g={};for(const c in r){const u=F2[c]||c.toLowerCase();a[u]=r[c]}for(const c in e.attributes){const u=F2[c]||c.toLowerCase();if(r[c]!==void 0){const C=i.accessors[e.attributes[c]],h=WI[C.componentType];g[u]=h.name,l[u]=C.normalized===!0}}return t.getDependency("bufferView",o).then(function(c){return new Promise(function(u,C){s.decodeDracoFile(c,function(h){for(const p in h.attributes){const b=h.attributes[p],m=l[p];m!==void 0&&(b.normalized=m)}u(h)},a,g,Ea,C)})})}},n8=class{constructor(){this.name=Qt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}},i8=class{constructor(){this.name=Qt.KHR_MESH_QUANTIZATION}},zE=class extends su{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=e*s*3+s;for(let r=0;r!==s;r++)t[r]=i[o+r];return t}interpolate_(e,t,i,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=a*2,g=a*3,c=s-t,u=(i-t)/c,C=u*u,h=C*u,p=e*g,b=p-g,m=-2*h+3*C,A=h-C,B=1-m,G=A-C+u;for(let w=0;w!==a;w++){const N=r[b+w+a],M=r[b+w+l]*c,R=r[p+w+a],S=r[p+w]*c;o[w]=B*N+G*M+m*R+A*S}return o}};const s8=new ii;let o8=class extends zE{interpolate_(e,t,i,s){const o=super.interpolate_(e,t,i,s);return s8.fromArray(o).normalize().toArray(o),o}};const Do={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WI={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},aM={9728:Bi,9729:fn,9984:nA,9985:xc,9986:Tl,9987:no},lM={33071:to,33648:Lc,10497:xr},EG={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},F2={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...x7>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},wl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},r8={CUBICSPLINE:void 0,LINEAR:tg,STEP:Pc},YG={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function a8(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new hg({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Rr})),n.DefaultMaterial}function qg(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Za(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function l8(n,e,t){let i=!1,s=!1,o=!1;for(let g=0,c=e.length;g<c;g++){const u=e[g];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(o=!0),i&&s&&o)break}if(!i&&!s&&!o)return Promise.resolve(n);const r=[],a=[],l=[];for(let g=0,c=e.length;g<c;g++){const u=e[g];if(i){const C=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):n.attributes.position;r.push(C)}if(s){const C=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(C)}if(o){const C=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):n.attributes.color;l.push(C)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l)]).then(function(g){const c=g[0],u=g[1],C=g[2];return i&&(n.morphAttributes.position=c),s&&(n.morphAttributes.normal=u),o&&(n.morphAttributes.color=C),n.morphTargetsRelative=!0,n})}function g8(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function c8(n){let e;const t=n.extensions&&n.extensions[Qt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+KG(t.attributes):e=n.indices+":"+KG(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+KG(n.targets[i]);return e}function KG(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function H2(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function u8(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const I8=new ct;let d8=class{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new H7,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=!1,o=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,o=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||s&&o<98?this.textureLoader=new au(this.options.manager):this.textureLoader=new eS(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ks(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:i,userData:{}};return qg(o,a,s),Za(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,o=t.length;s<o;s++){const r=t[s].joints;for(let a=0,l=r.length;a<l;a++)e[r[a]].isBone=!0}for(let s=0,o=e.length;s<o;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),o=(r,a)=>{const l=this.associations.get(r);l!=null&&this.associations.set(a,l);for(const[g,c]of r.children.entries())o(c,a.children[g])};return o(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const o=e(t[s]);o&&i.push(o)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(o,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Qt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,r){i.load(vo.resolveURL(t.uri,s.path),o,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,o=t.byteOffset||0;return i.slice(o,o+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const r=EG[s.type],a=WI[s.componentType],l=s.normalized===!0,g=new a(s.count*r);return Promise.resolve(new Pt(g,r,l))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(r){const a=r[0],l=EG[s.type],g=WI[s.componentType],c=g.BYTES_PER_ELEMENT,u=c*l,C=s.byteOffset||0,h=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let b,m;if(h&&h!==u){const A=Math.floor(C/h),B="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+A+":"+s.count;let G=t.cache.get(B);G||(b=new g(a,A*h,s.count*h/c),G=new gd(b,h/c),t.cache.add(B,G)),m=new ja(G,l,C%h/c,p)}else a===null?b=new g(s.count*l):b=new g(a,C,s.count*l),m=new Pt(b,l,p);if(s.sparse!==void 0){const A=EG.SCALAR,B=WI[s.sparse.indices.componentType],G=s.sparse.indices.byteOffset||0,w=s.sparse.values.byteOffset||0,N=new B(r[1],G,s.sparse.count*A),M=new g(r[2],w,s.sparse.count*l);a!==null&&(m=new Pt(m.array.slice(),m.itemSize,m.normalized));for(let R=0,S=N.length;R<S;R++){const F=N[R];if(m.setX(F,M[R*l]),l>=2&&m.setY(F,M[R*l+1]),l>=3&&m.setZ(F,M[R*l+2]),l>=4&&m.setW(F,M[R*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,i=this.options,o=t.textures[e].source,r=t.images[o];let a=this.textureLoader;if(r.uri){const l=i.manager.getHandler(r.uri);l!==null&&(a=l)}return this.loadTextureImage(e,o,a)}loadTextureImage(e,t,i){const s=this,o=this.json,r=o.textures[e],a=o.images[t],l=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const g=this.loadImageSource(t,i).then(function(c){c.flipY=!1,c.name=r.name||a.name||"",c.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(c.name=a.uri);const C=(o.samplers||{})[r.sampler]||{};return c.magFilter=aM[C.magFilter]||fn,c.minFilter=aM[C.minFilter]||no,c.wrapS=lM[C.wrapS]||xr,c.wrapT=lM[C.wrapT]||xr,s.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[l]=g,g}loadImageSource(e,t){const i=this,s=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=s.images[e],a=self.URL||self.webkitURL;let l=r.uri||"",g=!1;if(r.bufferView!==void 0)l=i.getDependency("bufferView",r.bufferView).then(function(u){g=!0;const C=new Blob([u],{type:r.mimeType});return l=a.createObjectURL(C),l});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(l).then(function(u){return new Promise(function(C,h){let p=C;t.isImageBitmapLoader===!0&&(p=function(b){const m=new Bn(b);m.needsUpdate=!0,C(m)}),t.load(vo.resolveURL(u,o.path),p,void 0,h)})}).then(function(u){return g===!0&&a.revokeObjectURL(l),Za(u,r),u.userData.mimeType=r.mimeType||u8(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=c,c}assignTexture(e,t,i,s){const o=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(r=r.clone(),r.channel=i.texCoord),o.extensions[Qt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[Qt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=o.associations.get(r);r=o.extensions[Qt.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),o.associations.set(r,l)}}return s!==void 0&&(typeof s=="number"&&(s=s===oM?Gc:Ea),"colorSpace"in r?r.colorSpace=s:r.encoding=s===Gc?oM:F7),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new ud,Un.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new ji,Un.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||o||r){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),o&&(l.vertexColors=!0),r&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return hg}loadMaterial(e){const t=this,i=this.json,s=this.extensions,o=i.materials[e];let r;const a={},l=o.extensions||{},g=[];if(l[Qt.KHR_MATERIALS_UNLIT]){const u=s[Qt.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),g.push(u.extendParams(a,o,t))}else{const u=o.pbrMetallicRoughness||{};if(a.color=new Pe(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const C=u.baseColorFactor;a.color.setRGB(C[0],C[1],C[2],Ea),a.opacity=C[3]}u.baseColorTexture!==void 0&&g.push(t.assignTexture(a,"map",u.baseColorTexture,Gc)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(g.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),g.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(C){return C.getMaterialType&&C.getMaterialType(e)}),g.push(Promise.all(this._invokeAll(function(C){return C.extendMaterialParams&&C.extendMaterialParams(e,a)})))}o.doubleSided===!0&&(a.side=bo);const c=o.alphaMode||YG.OPAQUE;if(c===YG.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,c===YG.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&r!==Hi&&(g.push(t.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new ye(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;a.normalScale.set(u,u)}if(o.occlusionTexture!==void 0&&r!==Hi&&(g.push(t.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&r!==Hi){const u=o.emissiveFactor;a.emissive=new Pe().setRGB(u[0],u[1],u[2],Ea)}return o.emissiveTexture!==void 0&&r!==Hi&&g.push(t.assignTexture(a,"emissiveMap",o.emissiveTexture,Gc)),Promise.all(g).then(function(){const u=new r(a);return o.name&&(u.name=o.name),Za(u,o),t.associations.set(u,{materials:e}),o.extensions&&qg(s,u,o),u})}createUniqueName(e){const t=on.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function o(a){return i[Qt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return gM(l,a,t)})}const r=[];for(let a=0,l=e.length;a<l;a++){const g=e[a],c=c8(g),u=s[c];if(u)r.push(u.promise);else{let C;g.extensions&&g.extensions[Qt.KHR_DRACO_MESH_COMPRESSION]?C=o(g):C=gM(new Mt,g,t),s[c]={primitive:g,promise:C},r.push(C)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,s=this.extensions,o=i.meshes[e],r=o.primitives,a=[];for(let l=0,g=r.length;l<g;l++){const c=r[l].material===void 0?a8(this.cache):this.getDependency("material",r[l].material);a.push(c)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(l){const g=l.slice(0,l.length-1),c=l[l.length-1],u=[];for(let h=0,p=c.length;h<p;h++){const b=c[h],m=r[h];let A;const B=g[h];if(m.mode===Do.TRIANGLES||m.mode===Do.TRIANGLE_STRIP||m.mode===Do.TRIANGLE_FAN||m.mode===void 0)A=o.isSkinnedMesh===!0?new Rb(b,B):new _n(b,B),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),m.mode===Do.TRIANGLE_STRIP?A.geometry=nM(A.geometry,sA):m.mode===Do.TRIANGLE_FAN&&(A.geometry=nM(A.geometry,Uc));else if(m.mode===Do.LINES)A=new ir(b,B);else if(m.mode===Do.LINE_STRIP)A=new ra(b,B);else if(m.mode===Do.LINE_LOOP)A=new xb(b,B);else if(m.mode===Do.POINTS)A=new Vb(b,B);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(A.geometry.morphAttributes).length>0&&g8(A,o),A.name=t.createUniqueName(o.name||"mesh_"+e),Za(A,o),m.extensions&&qg(s,A,m),t.assignFinalMaterial(A),u.push(A)}for(let h=0,p=u.length;h<p;h++)t.associations.set(u[h],{meshes:e,primitives:h});if(u.length===1)return o.extensions&&qg(s,u[0],o),u[0];const C=new Qo;o.extensions&&qg(s,C,o),t.associations.set(C,{meshes:e});for(let h=0,p=u.length;h<p;h++)C.add(u[h]);return C})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Wn(Gb.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new qo(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Za(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,o=t.joints.length;s<o;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const o=s.pop(),r=s,a=[],l=[];for(let g=0,c=r.length;g<c;g++){const u=r[g];if(u){a.push(u);const C=new ct;o!==null&&C.fromArray(o.array,g*16),l.push(C)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[g])}return new cd(a,l)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],o=s.name?s.name:"animation_"+e,r=[],a=[],l=[],g=[],c=[];for(let u=0,C=s.channels.length;u<C;u++){const h=s.channels[u],p=s.samplers[h.sampler],b=h.target,m=b.node,A=s.parameters!==void 0?s.parameters[p.input]:p.input,B=s.parameters!==void 0?s.parameters[p.output]:p.output;b.node!==void 0&&(r.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",A)),l.push(this.getDependency("accessor",B)),g.push(p),c.push(b))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l),Promise.all(g),Promise.all(c)]).then(function(u){const C=u[0],h=u[1],p=u[2],b=u[3],m=u[4],A=[];for(let B=0,G=C.length;B<G;B++){const w=C[B],N=h[B],M=p[B],R=b[B],S=m[B];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const F=i._createAnimationTracks(w,N,M,R,S);if(F)for(let Z=0;Z<F.length;Z++)A.push(F[Z])}return new Oc(o,void 0,A)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(o){const r=i._getNodeRef(i.meshCache,s.mesh,o);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let l=0,g=s.weights.length;l<g;l++)a.morphTargetInfluences[l]=s.weights[l]}),r})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],o=i._loadNodeShallow(e),r=[],a=s.children||[];for(let g=0,c=a.length;g<c;g++)r.push(i.getDependency("node",a[g]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([o,Promise.all(r),l]).then(function(g){const c=g[0],u=g[1],C=g[2];C!==null&&c.traverse(function(h){h.isSkinnedMesh&&h.bind(C,I8)});for(let h=0,p=u.length;h<p;h++)c.add(u[h]);return c})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],r=o.name?s.createUniqueName(o.name):"",a=[],l=s._invokeOne(function(g){return g.createNodeMesh&&g.createNodeMesh(e)});return l&&a.push(l),o.camera!==void 0&&a.push(s.getDependency("camera",o.camera).then(function(g){return s._getNodeRef(s.cameraCache,o.camera,g)})),s._invokeAll(function(g){return g.createNodeAttachment&&g.createNodeAttachment(e)}).forEach(function(g){a.push(g)}),this.nodeCache[e]=Promise.all(a).then(function(g){let c;if(o.isBone===!0?c=new gA:g.length>1?c=new Qo:g.length===1?c=g[0]:c=new Lt,c!==g[0])for(let u=0,C=g.length;u<C;u++)c.add(g[u]);if(o.name&&(c.userData.name=o.name,c.name=r),Za(c,o),o.extensions&&qg(i,c,o),o.matrix!==void 0){const u=new ct;u.fromArray(o.matrix),c.applyMatrix4(u)}else o.translation!==void 0&&c.position.fromArray(o.translation),o.rotation!==void 0&&c.quaternion.fromArray(o.rotation),o.scale!==void 0&&c.scale.fromArray(o.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,o=new Qo;i.name&&(o.name=s.createUniqueName(i.name)),Za(o,i),i.extensions&&qg(t,o,i);const r=i.nodes||[],a=[];for(let l=0,g=r.length;l<g;l++)a.push(s.getDependency("node",r[l]));return Promise.all(a).then(function(l){for(let c=0,u=l.length;c<u;c++)o.add(l[c]);const g=c=>{const u=new Map;for(const[C,h]of s.associations)(C instanceof Un||C instanceof Bn)&&u.set(C,h);return c.traverse(C=>{const h=s.associations.get(C);h!=null&&u.set(C,h)}),u};return s.associations=g(o),o})}_createAnimationTracks(e,t,i,s,o){const r=[],a=e.name?e.name:e.uuid,l=[];wl[o.path]===wl.weights?e.traverse(function(C){C.morphTargetInfluences&&l.push(C.name?C.name:C.uuid)}):l.push(a);let g;switch(wl[o.path]){case wl.weights:g=qa;break;case wl.rotation:g=$a;break;case wl.position:case wl.scale:g=el;break;default:switch(i.itemSize){case 1:g=qa;break;case 2:case 3:default:g=el;break}break}const c=s.interpolation!==void 0?r8[s.interpolation]:tg,u=this._getArrayFromAccessor(i);for(let C=0,h=l.length;C<h;C++){const p=new g(l[C]+"."+wl[o.path],t.array,u,c);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),r.push(p)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=H2(t.constructor),s=new Float32Array(t.length);for(let o=0,r=t.length;o<r;o++)s[o]=t[o]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof $a?o8:zE;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}};function C8(n,e,t){const i=e.attributes,s=new Ji;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,g=a.max;if(l!==void 0&&g!==void 0){if(s.set(new _(l[0],l[1],l[2]),new _(g[0],g[1],g[2])),a.normalized){const c=H2(WI[a.componentType]);s.min.multiplyScalar(c),s.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const a=new _,l=new _;for(let g=0,c=o.length;g<c;g++){const u=o[g];if(u.POSITION!==void 0){const C=t.json.accessors[u.POSITION],h=C.min,p=C.max;if(h!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),C.normalized){const b=H2(WI[C.componentType]);l.multiplyScalar(b)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const r=new Ti;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=r}function gM(n,e,t){const i=e.attributes,s=[];function o(r,a){return t.getDependency("accessor",r).then(function(l){n.setAttribute(a,l)})}for(const r in i){const a=F2[r]||r.toLowerCase();a in n.attributes||s.push(o(i[r],a))}if(e.indices!==void 0&&!n.index){const r=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(r)}return Za(n,e),C8(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?l8(n,e.targets,t):n})}class h8 extends Mt{constructor(e,t,i,s){super();const o=[],r=[],a=[],l=new _,g=new ct;g.makeRotationFromEuler(i),g.setPosition(t);const c=new ct;c.copy(g).invert(),u(),this.setAttribute("position",new dt(o,3)),this.setAttribute("normal",new dt(r,3)),this.setAttribute("uv",new dt(a,2));function u(){let b,m=[];const A=new _,B=new _;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const G=e.geometry,w=G.attributes.position,N=G.attributes.normal;if(G.index!==null){const M=G.index;for(b=0;b<M.count;b++)A.fromBufferAttribute(w,M.getX(b)),B.fromBufferAttribute(N,M.getX(b)),C(m,A,B)}else for(b=0;b<w.count;b++)A.fromBufferAttribute(w,b),B.fromBufferAttribute(N,b),C(m,A,B);for(m=h(m,l.set(1,0,0)),m=h(m,l.set(-1,0,0)),m=h(m,l.set(0,1,0)),m=h(m,l.set(0,-1,0)),m=h(m,l.set(0,0,1)),m=h(m,l.set(0,0,-1)),b=0;b<m.length;b++){const M=m[b];a.push(.5+M.position.x/s.x,.5+M.position.y/s.y),M.position.applyMatrix4(g),o.push(M.position.x,M.position.y,M.position.z),r.push(M.normal.x,M.normal.y,M.normal.z)}}function C(b,m,A){m.applyMatrix4(e.matrixWorld),m.applyMatrix4(c),A.transformDirection(e.matrixWorld),b.push(new cM(m.clone(),A.clone()))}function h(b,m){const A=[],B=.5*Math.abs(s.dot(m));for(let G=0;G<b.length;G+=3){let w,N,M,R=0,S,F,Z,x;const Y=b[G+0].position.dot(m)-B,T=b[G+1].position.dot(m)-B,ne=b[G+2].position.dot(m)-B;switch(w=Y>0,N=T>0,M=ne>0,R=(w?1:0)+(N?1:0)+(M?1:0),R){case 0:{A.push(b[G]),A.push(b[G+1]),A.push(b[G+2]);break}case 1:{if(w&&(S=b[G+1],F=b[G+2],Z=p(b[G],S,m,B),x=p(b[G],F,m,B)),N){S=b[G],F=b[G+2],Z=p(b[G+1],S,m,B),x=p(b[G+1],F,m,B),A.push(Z),A.push(F.clone()),A.push(S.clone()),A.push(F.clone()),A.push(Z.clone()),A.push(x);break}M&&(S=b[G],F=b[G+1],Z=p(b[G+2],S,m,B),x=p(b[G+2],F,m,B)),A.push(S.clone()),A.push(F.clone()),A.push(Z),A.push(x),A.push(Z.clone()),A.push(F.clone());break}case 2:{w||(S=b[G].clone(),F=p(S,b[G+1],m,B),Z=p(S,b[G+2],m,B),A.push(S),A.push(F),A.push(Z)),N||(S=b[G+1].clone(),F=p(S,b[G+2],m,B),Z=p(S,b[G],m,B),A.push(S),A.push(F),A.push(Z)),M||(S=b[G+2].clone(),F=p(S,b[G],m,B),Z=p(S,b[G+1],m,B),A.push(S),A.push(F),A.push(Z));break}}}return A}function p(b,m,A,B){const G=b.position.dot(A)-B,w=m.position.dot(A)-B,N=G/(G-w);return new cM(new _(b.position.x+N*(m.position.x-b.position.x),b.position.y+N*(m.position.y-b.position.y),b.position.z+N*(m.position.z-b.position.z)),new _(b.normal.x+N*(m.normal.x-b.normal.x),b.normal.y+N*(m.normal.y-b.normal.y),b.normal.z+N*(m.normal.z-b.normal.z)))}}}class cM{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const _G=new WeakMap;class A8 extends qi{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,i,s){const o=new Ks(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,r=>{const a={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(r,a).then(t).catch(s)},i,s)}decodeDracoFile(e,t,i,s){const o={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){for(const l in t.attributeTypes){const g=t.attributeTypes[l];g.BYTES_PER_ELEMENT!==void 0&&(t.attributeTypes[l]=g.name)}const i=JSON.stringify(t);if(_G.has(e)){const l=_G.get(e);if(l.key===i)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let s;const o=this.workerNextTaskID++,r=e.byteLength,a=this._getWorker(o,r).then(l=>(s=l,new Promise((g,c)=>{s._callbacks[o]={resolve:g,reject:c},s.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return a.catch(()=>!0).then(()=>{s&&o&&this._releaseTask(s,o)}),_G.set(e,{key:i,promise:a}),a}_createGeometry(e){const t=new Mt;e.index&&t.setIndex(new Pt(e.index.array,1));for(let i=0;i<e.attributes.length;i++){const s=e.attributes[i],o=s.name,r=s.array,a=s.itemSize;t.setAttribute(o,new Pt(r,a))}return t}_loadLibrary(e,t){const i=new Ks(this.manager);return i.setPath(this.decoderPath),i.setResponseType(t),i.setWithCredentials(this.withCredentials),new Promise((s,o)=>{i.load(e,s,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(i=>{const s=i[0];e||(this.decoderConfig.wasmBinary=i[1]);const o=p8.toString(),r=["/* draco decoder */",s,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",decoderConfig:this.decoderConfig}),s.onmessage=function(o){const r=o.data;switch(r.type){case"decode":s._callbacks[r.id].resolve(r);break;case"error":s._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,o){return s._taskLoad>o._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[e]=t,i._taskLoad+=t,i})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function p8(){let n,e;onmessage=function(r){const a=r.data;switch(a.type){case"init":n=a.decoderConfig,e=new Promise(function(c){n.onModuleLoaded=function(u){c({draco:u})},DracoDecoderModule(n)});break;case"decode":const l=a.buffer,g=a.taskConfig;e.then(c=>{const u=c.draco,C=new u.Decoder,h=new u.DecoderBuffer;h.Init(new Int8Array(l),l.byteLength);try{const p=t(u,C,h,g),b=p.attributes.map(m=>m.array.buffer);p.index&&b.push(p.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:p},b)}catch(p){console.error(p),self.postMessage({type:"error",id:a.id,error:p.message})}finally{u.destroy(h),u.destroy(C)}});break}};function t(r,a,l,g){const c=g.attributeIDs,u=g.attributeTypes;let C,h;const p=a.GetEncodedGeometryType(l);if(p===r.TRIANGULAR_MESH)C=new r.Mesh,h=a.DecodeBufferToMesh(l,C);else if(p===r.POINT_CLOUD)C=new r.PointCloud,h=a.DecodeBufferToPointCloud(l,C);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!h.ok()||C.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+h.error_msg());const b={index:null,attributes:[]};for(const m in c){const A=self[u[m]];let B,G;if(g.useUniqueIDs)G=c[m],B=a.GetAttributeByUniqueId(C,G);else{if(G=a.GetAttributeId(C,r[c[m]]),G===-1)continue;B=a.GetAttribute(C,G)}b.attributes.push(s(r,a,C,m,A,B))}return p===r.TRIANGULAR_MESH&&(b.index=i(r,a,C)),r.destroy(C),b}function i(r,a,l){const c=l.num_faces()*3,u=c*4,C=r._malloc(u);a.GetTrianglesUInt32Array(l,u,C);const h=new Uint32Array(r.HEAPF32.buffer,C,c).slice();return r._free(C),{array:h,itemSize:1}}function s(r,a,l,g,c,u){const C=u.num_components(),p=l.num_points()*C,b=p*c.BYTES_PER_ELEMENT,m=o(r,c),A=r._malloc(b);a.GetAttributeDataArrayForAllPoints(l,u,m,b,A);const B=new c(r.HEAPF32.buffer,A,p).slice();return r._free(A),{name:g,array:B,itemSize:C}}function o(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}let fm;const LG=()=>{if(fm)return fm;const n="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",e="B9h9z9tFBBBFiI9gBB9gLaaaaaFa9gEaaaB9gFaFaEMcBBFBFFGGGEILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBOn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBNI9z9iqlBVc+N9IcIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMk8lLbaE97F9+FaL978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAeDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAeDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAeDeBJAiCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPAPDQBFGENVcMILKOSQfbHeD8dBh+BsxoxoUwN0AeD8dFhxoUwkwk+gUa0sHnhTkAnsHnhNkAnsHn7CgFZHiCEWCxkUUBJDBEBAiCx+YUUBJDBBBHeAeDQBBBBBBBBBBBBBBBBAnhAk7CgFZHiCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAeDeBJAiCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBReCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBH8ZCFD9tA8ZAPD9OD9hD9RH8ZDQBTFtGmEYIPLdKeOnHpAIAQJDBIBHyCFD9tAyAPD9OD9hD9RHyAIASJDBIBH8cCFD9tA8cAPD9OD9hD9RH8cDQBTFtGmEYIPLdKeOnH8dDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAeD9uHeDyBjGBAEAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeApA8dDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNiV8ZcpMyS8cQ8df8eb8fHdAyA8cDQNiV8ZcpMyS8cQ8df8eb8fH8ZDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJHIAeAdA8ZDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHeDyBjGBAIAGJHIAeAPAPDQILKOILKOILKOILKOD9uHeDyBjGBAIAGJHIAeAPAPDQNVcMNVcMNVcMNVcMD9uHeDyBjGBAIAGJHIAeAPAPDQSQfbSQfbSQfbSQfbD9uHeDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/dLEK97FaF97GXGXAGCI9HQBAF9FQFCBRGEXABABDBBBHECiD+rFCiD+sFD/6FHIAECND+rFCiD+sFD/6FAID/gFAECTD+rFCiD+sFD/6FHLD/gFD/kFD/lFHKCBDtD+2FHOAICUUUU94DtHND9OD9RD/kFHI9DBB/+hDYAIAID/mFAKAKD/mFALAOALAND9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHLD/mF9DBBX9LDYHOD/kFCgFDtD9OAECUUU94DtD9OD9QAIALD/mFAOD/kFCND+rFCU/+EDtD9OD9QAKALD/mFAOD/kFCTD+rFCUU/8ODtD9OD9QDMBBABCTJRBAGCIJHGAF9JQBSGMMAF9FQBCBRGEXABCTJHVAVDBBBHECBDtHOCUU98D8cFCUU98D8cEHND9OABDBBBHKAEDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAKAEDQBFGENVcMTtmYi8ZpyHECTD+sFD/6FHID/gFAECTD+rFCTD+sFD/6FHLD/gFD/kFD/lFHE9DB/+g6DYALAEAOD+2FHOALCUUUU94DtHcD9OD9RD/kFHLALD/mFAEAED/mFAIAOAIAcD9OD9RD/kFHEAED/mFD/kFD/kFD/jFD/nFHID/mF9DBBX9LDYHOD/kFCTD+rFALAID/mFAOD/kFCggEDtD9OD9QHLAEAID/mFAOD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHEDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAKAND9OALAEDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM/hEIGaF97FaL978jUUUUBCTlREGXAF9FQBCBRIEXAEABDBBBHLABCTJHKDBBBHODQILKOSQfbPden8c8d8e8fHNCTD+sFHVCID+rFDMIBAB9DBBU8/DY9D/zI818/DYAVCEDtD9QD/6FD/nFHVALAODQBFGENVcMTtmYi8ZpyHLCTD+rFCTD+sFD/6FD/mFHOAOD/mFAVALCTD+sFD/6FD/mFHcAcD/mFAVANCTD+rFCTD+sFD/6FD/mFHNAND/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHVD/mF9DBBX9LDYHLD/kFCggEDtHMD9OAcAVD/mFALD/kFCTD+rFD9QHcANAVD/mFALD/kFCTD+rFAOAVD/mFALD/kFAMD9OD9QHVDQBFTtGEmYILPdKOenHLD8dBAEDBIBDyB+t+J83EBABCNJALD8dFAEDBIBDyF+t+J83EBAKAcAVDQNVi8ZcMpySQ8c8dfb8e8fHVD8dBAEDBIBDyG+t+J83EBABCiJAVD8dFAEDBIBDyE+t+J83EBABCAJRBAICIJHIAF9JQBMMM9jFF97GXAGCGrAF9sHG9FQBCBRFEXABABDBBBHECND+rFCND+sFD/6FAECiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBABCTJRBAFCIJHFAG9JQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),i=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let s=n;WebAssembly.validate(t)&&(s=e);let o;const r=WebAssembly.instantiate(a(s),{}).then(u=>{o=u.instance,o.exports.__wasm_call_ctors()});function a(u){const C=new Uint8Array(u.length);for(let p=0;p<u.length;++p){const b=u.charCodeAt(p);C[p]=b>96?b-71:b>64?b-65:b>47?b+4:b>46?63:62}let h=0;for(let p=0;p<u.length;++p)C[h++]=C[p]<60?i[C[p]]:(C[p]-60)*64+C[++p];return C.buffer.slice(0,h)}function l(u,C,h,p,b,m){const A=o.exports.sbrk,B=h+3&-4,G=A(B*p),w=A(b.length),N=new Uint8Array(o.exports.memory.buffer);N.set(b,w);const M=u(G,h,p,w,b.length);if(M===0&&m&&m(G,B,p),C.set(N.subarray(G,G+h*p)),A(G-A(0)),M!==0)throw new Error(`Malformed buffer data: ${M}`)}const g={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},c={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return fm={ready:r,supported:!0,decodeVertexBuffer(u,C,h,p,b){l(o.exports.meshopt_decodeVertexBuffer,u,C,h,p,o.exports[g[b]])},decodeIndexBuffer(u,C,h,p){l(o.exports.meshopt_decodeIndexBuffer,u,C,h,p)},decodeIndexSequence(u,C,h,p){l(o.exports.meshopt_decodeIndexSequence,u,C,h,p)},decodeGltfBuffer(u,C,h,p,b,m){l(o.exports[c[b]],u,C,h,p,o.exports[g[m]])}},fm},kG=n=>n===Object(n)&&!Array.isArray(n)&&typeof n!="function";function cS(n,e){const t=ei(o=>o.gl),i=Vo(au,kG(n)?Object.values(n):n);return z.useLayoutEffect(()=>{e==null||e(i)},[e]),z.useEffect(()=>{if("initTexture"in t){let o=[];Array.isArray(i)?o=i:i instanceof Bn?o=[i]:kG(i)&&(o=Object.values(i)),o.forEach(r=>{r instanceof Bn&&t.initTexture(r)})}},[t,i]),z.useMemo(()=>{if(kG(n)){const o={};let r=0;for(const a in n)o[a]=i[r++];return o}else return i},[n,i])}cS.preload=n=>Vo.preload(au,n);cS.clear=n=>Vo.clear(au,n);const m8=()=>parseInt(sd.replace(/\D+/g,"")),uS=m8();function f8(n){return Array.isArray(n)}function zG(n=[0,0,0]){return f8(n)?n:n instanceof _||n instanceof Gs?[n.x,n.y,n.z]:[n,n,n]}const b8=z.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:i=-10,map:s,mesh:o,children:r,position:a,rotation:l,scale:g,...c},u){const C=z.useRef(null);z.useImperativeHandle(u,()=>C.current);const h=z.useRef(null),p=z.useRef({position:new _,rotation:new Gs,scale:new _(1,1,1)});return z.useLayoutEffect(()=>{const b=(o==null?void 0:o.current)||C.current.parent,m=C.current;if(!(b instanceof _n))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(b){Or(p.current,{position:a,scale:g});const A=b.matrixWorld.clone();if(b.matrixWorld.identity(),!l||typeof l=="number"){const B=new Lt;B.position.copy(p.current.position);const G=b.geometry.attributes.position.array;b.geometry.attributes.normal===void 0&&b.geometry.computeVertexNormals();const w=b.geometry.attributes.normal.array;let N=1/0;new _;let M=new _;const R=B.position.x,S=B.position.y,F=B.position.z,Z=G.length;let x=-1;for(let Y=0;Y<Z;Y+=3){const T=G[Y],ne=G[Y+1],ue=G[Y+2],se=T-R,Ie=ne-S,k=ue-F,ee=se*se+Ie*Ie+k*k;ee<N&&(N=ee,x=Y)}M.fromArray(w,x),B.lookAt(B.position.clone().add(M)),B.rotateZ(Math.PI),B.rotateY(Math.PI),typeof l=="number"&&B.rotateZ(l),Or(p.current,{rotation:B.rotation})}else Or(p.current,{rotation:l});return m.geometry=new h8(b,p.current.position,p.current.rotation,p.current.scale),b.matrixWorld=A,()=>{m.geometry.dispose()}}},[o,...zG(a),...zG(g),...zG(l)]),z.useLayoutEffect(()=>{h.current&&(Or(h.current,p.current),h.current.traverse(b=>b.raycast=()=>null))},[e]),z.createElement("mesh",nr({ref:C,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":t,"material-map":s},c),r,e&&z.createElement("mesh",{ref:h},z.createElement("boxGeometry",null),z.createElement("meshNormalMaterial",{wireframe:!0}),z.createElement("axesHelper",null)))});let bm=null,DE="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function PE(n=!0,e=!0,t){return i=>{t&&t(i),n&&(bm||(bm=new A8),bm.setDecoderPath(typeof n=="string"?n:DE),i.setDRACOLoader(bm)),e&&i.setMeshoptDecoder(typeof LG=="function"?LG():LG)}}const dd=(n,e,t,i)=>Vo(gS,n,PE(e,t,i));dd.preload=(n,e,t,i)=>Vo.preload(gS,n,PE(e,t,i));dd.clear=n=>Vo.clear(gS,n);dd.setDecoderPath=n=>{DE=n};function y8(n,e,t){const i=ei(C=>C.size),s=ei(C=>C.viewport),o=typeof n=="number"?n:i.width*s.dpr,r=i.height*s.dpr,a=(typeof n=="number"?t:n)||{},{samples:l=0,depth:g,...c}=a,u=z.useMemo(()=>{const C=new Ys(o,r,{minFilter:fn,magFilter:fn,type:il,...c});return g&&(C.depthTexture=new lA(o,r,Xs)),C.samples=l,C},[]);return z.useLayoutEffect(()=>{u.setSize(o,r),l&&(u.samples=l)},[l,u,o,r]),z.useEffect(()=>()=>u.dispose(),[]),u}const B8=n=>typeof n=="function",G8=z.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,makeDefault:i,children:s,...o},r)=>{const a=ei(({set:m})=>m),l=ei(({camera:m})=>m),g=ei(({size:m})=>m),c=z.useRef(null);z.useImperativeHandle(r,()=>c.current,[]);const u=z.useRef(null),C=y8(e);z.useLayoutEffect(()=>{o.manual||(c.current.aspect=g.width/g.height)},[g,o]),z.useLayoutEffect(()=>{c.current.updateProjectionMatrix()});let h=0,p=null;const b=B8(s);return ga(m=>{b&&(t===1/0||h<t)&&(u.current.visible=!1,m.gl.setRenderTarget(C),p=m.scene.background,n&&(m.scene.background=n),m.gl.render(m.scene,c.current),m.scene.background=p,m.gl.setRenderTarget(null),u.current.visible=!0,h++)}),z.useLayoutEffect(()=>{if(i){const m=l;return a(()=>({camera:c.current})),()=>a(()=>({camera:m}))}},[c,i,a]),z.createElement(z.Fragment,null,z.createElement("perspectiveCamera",nr({ref:c},o),!b&&s),z.createElement("group",{ref:u},b&&s(C.texture)))}),jb=z.forwardRef(({makeDefault:n,camera:e,regress:t,domElement:i,enableDamping:s=!0,keyEvents:o=!1,onChange:r,onStart:a,onEnd:l,...g},c)=>{const u=ei(M=>M.invalidate),C=ei(M=>M.camera),h=ei(M=>M.gl),p=ei(M=>M.events),b=ei(M=>M.setEvents),m=ei(M=>M.set),A=ei(M=>M.get),B=ei(M=>M.performance),G=e||C,w=i||p.connected||h.domElement,N=z.useMemo(()=>new N7(G),[G]);return ga(()=>{N.enabled&&N.update()},-1),z.useEffect(()=>(o&&N.connect(o===!0?w:o),N.connect(w),()=>void N.dispose()),[o,w,t,N,u]),z.useEffect(()=>{const M=F=>{u(),t&&B.regress(),r&&r(F)},R=F=>{a&&a(F)},S=F=>{l&&l(F)};return N.addEventListener("change",M),N.addEventListener("start",R),N.addEventListener("end",S),()=>{N.removeEventListener("start",R),N.removeEventListener("end",S),N.removeEventListener("change",M)}},[r,a,l,N,u,b]),z.useEffect(()=>{if(n){const M=A().controls;return m({controls:N}),()=>m({controls:M})}},[n,N]),z.createElement("primitive",nr({ref:c,object:N,enableDamping:s},g))});var UE={exports:{}},v8="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",w8=v8,Z8=w8;function JE(){}function OE(){}OE.resetWarningCache=JE;var S8=function(){function n(i,s,o,r,a,l){if(l!==Z8){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:OE,resetWarningCache:JE};return t.PropTypes=t,t};UE.exports=S8();var QE=UE.exports;class R8 extends tr{constructor(e=new ye){super({uniforms:{inputBuffer:new Is(null),depthBuffer:new Is(null),resolution:new Is(new ye),texelSize:new Is(new ye),halfTexelSize:new Is(new ye),kernel:new Is(0),scale:new Is(1),cameraNear:new Is(0),cameraFar:new Is(1),minDepthThreshold:new Is(0),maxDepthThreshold:new Is(1),depthScale:new Is(0),depthToBlurRatioBias:new Is(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${uS>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:ea,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class x8{constructor({gl:e,resolution:t,width:i=500,height:s=500,minDepthThreshold:o=0,maxDepthThreshold:r=1,depthScale:a=0,depthToBlurRatioBias:l=.25}){this.renderToScreen=!1,this.renderTargetA=new Ys(t,t,{minFilter:fn,magFilter:fn,stencilBuffer:!1,depthBuffer:!1,type:il}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new R8,this.convolutionMaterial.setTexelSize(1/i,1/s),this.convolutionMaterial.setResolution(new ye(i,s)),this.scene=new Wh,this.camera=new rd,this.convolutionMaterial.uniforms.minDepthThreshold.value=o,this.convolutionMaterial.uniforms.maxDepthThreshold.value=r,this.convolutionMaterial.uniforms.depthScale.value=a,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=l,this.convolutionMaterial.defines.USE_DEPTH=a>0;const g=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),u=new Mt;u.setAttribute("position",new Pt(g,3)),u.setAttribute("uv",new Pt(c,2)),this.screen=new _n(u,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,i){const s=this.scene,o=this.camera,r=this.renderTargetA,a=this.renderTargetB;let l=this.convolutionMaterial,g=l.uniforms;g.depthBuffer.value=t.depthTexture;const c=l.kernel;let u=t,C,h,p;for(h=0,p=c.length-1;h<p;++h)C=h&1?a:r,g.kernel.value=c[h],g.inputBuffer.value=u.texture,e.setRenderTarget(C),e.render(s,o),u=C;g.kernel.value=c[h],g.inputBuffer.value=u.texture,e.setRenderTarget(this.renderToScreen?null:i),e.render(s,o)}}let V8=class extends hg{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;(t=e.defines)!=null&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}};const W8=z.forwardRef(({mixBlur:n=0,mixStrength:e=1,resolution:t=256,blur:i=[0,0],minDepthThreshold:s=.9,maxDepthThreshold:o=1,depthScale:r=0,depthToBlurRatioBias:a=.25,mirror:l=0,distortion:g=1,mixContrast:c=1,distortionMap:u,reflectorOffset:C=0,...h},p)=>{GE({MeshReflectorMaterialImpl:V8});const b=ei(({gl:ae})=>ae),m=ei(({camera:ae})=>ae),A=ei(({scene:ae})=>ae);i=Array.isArray(i)?i:[i,i];const B=i[0]+i[1]>0,G=z.useRef(null);z.useImperativeHandle(p,()=>G.current,[]);const[w]=z.useState(()=>new Jr),[N]=z.useState(()=>new _),[M]=z.useState(()=>new _),[R]=z.useState(()=>new _),[S]=z.useState(()=>new ct),[F]=z.useState(()=>new _(0,0,-1)),[Z]=z.useState(()=>new rn),[x]=z.useState(()=>new _),[Y]=z.useState(()=>new _),[T]=z.useState(()=>new rn),[ne]=z.useState(()=>new ct),[ue]=z.useState(()=>new Wn),se=z.useCallback(()=>{var ae;const be=G.current.parent||((ae=G.current)==null?void 0:ae.__r3f.parent);if(!be||(M.setFromMatrixPosition(be.matrixWorld),R.setFromMatrixPosition(m.matrixWorld),S.extractRotation(be.matrixWorld),N.set(0,0,1),N.applyMatrix4(S),M.addScaledVector(N,C),x.subVectors(M,R),x.dot(N)>0))return;x.reflect(N).negate(),x.add(M),S.extractRotation(m.matrixWorld),F.set(0,0,-1),F.applyMatrix4(S),F.add(R),Y.subVectors(M,F),Y.reflect(N).negate(),Y.add(M),ue.position.copy(x),ue.up.set(0,1,0),ue.up.applyMatrix4(S),ue.up.reflect(N),ue.lookAt(Y),ue.far=m.far,ue.updateMatrixWorld(),ue.projectionMatrix.copy(m.projectionMatrix),ne.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ne.multiply(ue.projectionMatrix),ne.multiply(ue.matrixWorldInverse),ne.multiply(be.matrixWorld),w.setFromNormalAndCoplanarPoint(N,M),w.applyMatrix4(ue.matrixWorldInverse),Z.set(w.normal.x,w.normal.y,w.normal.z,w.constant);const me=ue.projectionMatrix;T.x=(Math.sign(Z.x)+me.elements[8])/me.elements[0],T.y=(Math.sign(Z.y)+me.elements[9])/me.elements[5],T.z=-1,T.w=(1+me.elements[10])/me.elements[14],Z.multiplyScalar(2/Z.dot(T)),me.elements[2]=Z.x,me.elements[6]=Z.y,me.elements[10]=Z.z+1,me.elements[14]=Z.w},[m,C]),[Ie,k,ee,$]=z.useMemo(()=>{const ae={minFilter:fn,magFilter:fn,type:il},be=new Ys(t,t,ae);be.depthBuffer=!0,be.depthTexture=new lA(t,t),be.depthTexture.format=Pl,be.depthTexture.type=kc;const me=new Ys(t,t,ae),ce=new x8({gl:b,resolution:t,width:i[0],height:i[1],minDepthThreshold:s,maxDepthThreshold:o,depthScale:r,depthToBlurRatioBias:a}),Be={mirror:l,textureMatrix:ne,mixBlur:n,tDiffuse:be.texture,tDepth:be.depthTexture,tDiffuseBlur:me.texture,hasBlur:B,mixStrength:e,minDepthThreshold:s,maxDepthThreshold:o,depthScale:r,depthToBlurRatioBias:a,distortion:g,distortionMap:u,mixContrast:c,"defines-USE_BLUR":B?"":void 0,"defines-USE_DEPTH":r>0?"":void 0,"defines-USE_DISTORTION":u?"":void 0};return[be,me,ce,Be]},[b,i,ne,t,l,B,n,e,s,o,r,a,g,u,c]);return ga(()=>{var ae;const be=G.current.parent||((ae=G.current)==null?void 0:ae.__r3f.parent);if(!be)return;be.visible=!1;const me=b.xr.enabled,ce=b.shadowMap.autoUpdate;se(),b.xr.enabled=!1,b.shadowMap.autoUpdate=!1,b.setRenderTarget(Ie),b.state.buffers.depth.setMask(!0),b.autoClear||b.clear(),b.render(A,ue),B&&ee.render(b,Ie,k),b.xr.enabled=me,b.shadowMap.autoUpdate=ce,be.visible=!0,b.setRenderTarget(null)}),z.createElement("meshReflectorMaterialImpl",nr({attach:"material",key:"key"+$["defines-USE_BLUR"]+$["defines-USE_DEPTH"]+$["defines-USE_DISTORTION"],ref:G},$,h))}),DG=uS>=154?"opaque_fragment":"output_fragment";class M8 extends ud{constructor(e){super(e),this.onBeforeCompile=(t,i)=>{const{isWebGL2:s}=i.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${DG}>`,`
        ${s?`#include <${DG}>`:`#extension GL_OES_standard_derivatives : enable
#include <${DG}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${uS>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const N8=z.forwardRef((n,e)=>{const[t]=z.useState(()=>new M8(null));return z.createElement("primitive",nr({},n,{object:t,ref:e,attach:"material"}))}),F8=z.forwardRef(({children:n,enabled:e=!0,speed:t=1,rotationIntensity:i=1,floatIntensity:s=1,floatingRange:o=[-.1,.1],autoInvalidate:r=!1,...a},l)=>{const g=z.useRef(null);z.useImperativeHandle(l,()=>g.current,[]);const c=z.useRef(Math.random()*1e4);return ga(u=>{var C,h;if(!e||t===0)return;r&&u.invalidate();const p=c.current+u.clock.getElapsedTime();g.current.rotation.x=Math.cos(p/4*t)/8*i,g.current.rotation.y=Math.sin(p/4*t)/8*i,g.current.rotation.z=Math.sin(p/4*t)/20*i;let b=Math.sin(p/4*t)/10;b=Gb.mapLinear(b,-.1,.1,(C=o==null?void 0:o[0])!==null&&C!==void 0?C:-.1,(h=o==null?void 0:o[1])!==null&&h!==void 0?h:.1),g.current.position.y=b*s,g.current.updateMatrix()}),z.createElement("group",a,z.createElement("group",{ref:g,matrixAutoUpdate:!1},n))});let $g,dC;const H8=z.createContext(null),uM=new ct,IM=new _,X8=z.forwardRef(({children:n,range:e,limit:t=1e3,...i},s)=>{const o=z.useRef(null);z.useImperativeHandle(s,()=>o.current,[]);const[r,a]=z.useState([]),[[l,g,c]]=z.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);z.useEffect(()=>{o.current.geometry.attributes.position.needsUpdate=!0}),ga(()=>{for(o.current.updateMatrix(),o.current.updateMatrixWorld(),uM.copy(o.current.matrixWorld).invert(),o.current.geometry.drawRange.count=Math.min(t,e!==void 0?e:t,r.length),$g=0;$g<r.length;$g++)dC=r[$g].current,dC.getWorldPosition(IM).applyMatrix4(uM),IM.toArray(l,$g*3),o.current.geometry.attributes.position.needsUpdate=!0,dC.matrixWorldNeedsUpdate=!0,dC.color.toArray(g,$g*3),o.current.geometry.attributes.color.needsUpdate=!0,c.set([dC.size],$g),o.current.geometry.attributes.size.needsUpdate=!0});const u=z.useMemo(()=>({getParent:()=>o,subscribe:C=>(a(h=>[...h,C]),()=>a(h=>h.filter(p=>p.current!==C.current)))}),[]);return z.createElement("points",nr({userData:{instances:r},matrixAutoUpdate:!1,ref:o,raycast:()=>null},i),z.createElement("bufferGeometry",null,z.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:Ul}),z.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:Ul}),z.createElement("bufferAttribute",{attach:"attributes-size",count:c.length,array:c,itemSize:1,usage:Ul})),z.createElement(H8.Provider,{value:u},n))}),T8=z.forwardRef(({children:n,positions:e,colors:t,sizes:i,stride:s=3,...o},r)=>{const a=z.useRef(null);return z.useImperativeHandle(r,()=>a.current,[]),ga(()=>{const l=a.current.geometry.attributes;l.position.needsUpdate=!0,t&&(l.color.needsUpdate=!0),i&&(l.size.needsUpdate=!0)}),z.createElement("points",nr({ref:a},o),z.createElement("bufferGeometry",null,z.createElement("bufferAttribute",{attach:"attributes-position",count:e.length/s,array:e,itemSize:s,usage:Ul}),t&&z.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/s,array:t,itemSize:3,usage:Ul}),i&&z.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:Ul})),n)}),E8=z.forwardRef((n,e)=>n.positions instanceof Float32Array?z.createElement(T8,nr({},n,{ref:e})):z.createElement(X8,nr({},n,{ref:e})));function qb({all:n,scene:e,camera:t}){const i=ei(({gl:r})=>r),s=ei(({camera:r})=>r),o=ei(({scene:r})=>r);return z.useLayoutEffect(()=>{const r=[];n&&(e||o).traverse(g=>{g.visible===!1&&(r.push(g),g.visible=!0)}),i.compile(e||o,t||s);const a=new EZ(128);new TZ(.01,1e5,a).update(i,e||o),a.dispose(),r.forEach(g=>g.visible=!1)},[]),null}const $b=()=>{const{progress:n}=y7();return j.jsxs(A7,{as:"div",center:!0,style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[j.jsx("span",{className:"canvas-loader"}),j.jsxs("p",{style:{fontSize:14,color:"#F1F1F1",fontWeight:800,marginTop:40},children:[n.toFixed(2),"%"]})]})};var IS={exports:{}},MI=typeof Reflect=="object"?Reflect:null,dM=MI&&typeof MI.apply=="function"?MI.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},tf;MI&&typeof MI.ownKeys=="function"?tf=MI.ownKeys:Object.getOwnPropertySymbols?tf=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:tf=function(e){return Object.getOwnPropertyNames(e)};function Y8(n){console&&console.warn&&console.warn(n)}var jE=Number.isNaN||function(e){return e!==e};function vn(){vn.init.call(this)}IS.exports=vn;IS.exports.once=k8;vn.EventEmitter=vn;vn.prototype._events=void 0;vn.prototype._eventsCount=0;vn.prototype._maxListeners=void 0;var CM=10;function ey(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(vn,"defaultMaxListeners",{enumerable:!0,get:function(){return CM},set:function(n){if(typeof n!="number"||n<0||jE(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");CM=n}});vn.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};vn.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||jE(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function qE(n){return n._maxListeners===void 0?vn.defaultMaxListeners:n._maxListeners}vn.prototype.getMaxListeners=function(){return qE(this)};vn.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var r;if(t.length>0&&(r=t[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var l=o[e];if(l===void 0)return!1;if(typeof l=="function")dM(l,this,t);else for(var g=l.length,c=iY(l,g),i=0;i<g;++i)dM(c[i],this,t);return!0};function $E(n,e,t,i){var s,o,r;if(ey(t),o=n._events,o===void 0?(o=n._events=Object.create(null),n._eventsCount=0):(o.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),o=n._events),r=o[e]),r===void 0)r=o[e]=t,++n._eventsCount;else if(typeof r=="function"?r=o[e]=i?[t,r]:[r,t]:i?r.unshift(t):r.push(t),s=qE(n),s>0&&r.length>s&&!r.warned){r.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=r.length,Y8(a)}return n}vn.prototype.addListener=function(e,t){return $E(this,e,t,!1)};vn.prototype.on=vn.prototype.addListener;vn.prototype.prependListener=function(e,t){return $E(this,e,t,!0)};function K8(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function eY(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},s=K8.bind(i);return s.listener=t,i.wrapFn=s,s}vn.prototype.once=function(e,t){return ey(t),this.on(e,eY(this,e,t)),this};vn.prototype.prependOnceListener=function(e,t){return ey(t),this.prependListener(e,eY(this,e,t)),this};vn.prototype.removeListener=function(e,t){var i,s,o,r,a;if(ey(t),s=this._events,s===void 0)return this;if(i=s[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(o=-1,r=i.length-1;r>=0;r--)if(i[r]===t||i[r].listener===t){a=i[r].listener,o=r;break}if(o<0)return this;o===0?i.shift():_8(i,o),i.length===1&&(s[e]=i[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};vn.prototype.off=vn.prototype.removeListener;vn.prototype.removeAllListeners=function(e){var t,i,s;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var o=Object.keys(i),r;for(s=0;s<o.length;++s)r=o[s],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(s=t.length-1;s>=0;s--)this.removeListener(e,t[s]);return this};function tY(n,e,t){var i=n._events;if(i===void 0)return[];var s=i[e];return s===void 0?[]:typeof s=="function"?t?[s.listener||s]:[s]:t?L8(s):iY(s,s.length)}vn.prototype.listeners=function(e){return tY(this,e,!0)};vn.prototype.rawListeners=function(e){return tY(this,e,!1)};vn.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):nY.call(n,e)};vn.prototype.listenerCount=nY;function nY(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}vn.prototype.eventNames=function(){return this._eventsCount>0?tf(this._events):[]};function iY(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function _8(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function L8(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function k8(n,e){return new Promise(function(t,i){function s(r){n.removeListener(e,o),i(r)}function o(){typeof n.removeListener=="function"&&n.removeListener("error",s),t([].slice.call(arguments))}sY(n,e,o,{once:!0}),e!=="error"&&z8(n,s,{once:!0})})}function z8(n,e,t){typeof n.on=="function"&&sY(n,"error",e,t)}function sY(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function s(o){i.once&&n.removeEventListener(e,s),t(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var D8=IS.exports;function P8(n,e){var t=atob(n);return t}function U8(n,e,t){var i=P8(n),s=i.indexOf(`
`,10)+1,o=i.substring(s)+"",r=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(r)}function J8(n,e,t){var i;return function(o){return i=i||U8(n),new Worker(i,o)}}var O8=J8("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK");class Q8 extends D8{constructor(t){let{allowSleep:i=!1,axisIndex:s=0,broadphase:o="Naive",defaultContactMaterial:r={contactEquationStiffness:1e6},frictionGravity:a=null,gravity:l=[0,-9.81,0],iterations:g=5,quatNormalizeFast:c=!1,quatNormalizeSkip:u=0,size:C=1e3,solver:h="GS",tolerance:p=.001}=t;super();dB(this,"messageQueue",[]);dB(this,"worker",null);this.config={allowSleep:i,axisIndex:s,broadphase:o,defaultContactMaterial:r,frictionGravity:a,gravity:l,iterations:g,quatNormalizeFast:c,quatNormalizeSkip:u,size:C,solver:h,tolerance:p},this.buffers={positions:new Float32Array(C*3),quaternions:new Float32Array(C*4)}}get axisIndex(){return this.config.axisIndex}set axisIndex(t){this.config.axisIndex=t,this.postMessage({op:"setAxisIndex",props:t})}get broadphase(){return this.config.broadphase}set broadphase(t){this.config.broadphase=t,this.postMessage({op:"setBroadphase",props:t})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(t){this.config.frictionGravity=t,this.postMessage({op:"setFrictionGravity",props:t})}get gravity(){return this.config.gravity}set gravity(t){this.config.gravity=t,this.postMessage({op:"setGravity",props:t})}get iterations(){return this.config.iterations}set iterations(t){this.config.iterations=t,this.postMessage({op:"setIterations",props:t})}get tolerance(){return this.config.tolerance}set tolerance(t){this.config.tolerance=t,this.postMessage({op:"setTolerance",props:t})}addBodies(t){let{props:i,type:s,uuid:o}=t;this.postMessage({op:"addBodies",props:i,type:s,uuid:o})}addConstraint(t){let{props:[i,s,o],type:r,uuid:a}=t;this.postMessage({op:"addConstraint",props:[i,s,o],type:r,uuid:a})}addContactMaterial(t){let{props:i,uuid:s}=t;this.postMessage({op:"addContactMaterial",props:i,uuid:s})}addRay(t){let{props:i,uuid:s}=t;this.postMessage({op:"addRay",props:i,uuid:s})}addRaycastVehicle(t){let{props:[i,s,o,r,a,l],uuid:g}=t;this.postMessage({op:"addRaycastVehicle",props:[i,s,o,r,a,l],uuid:g})}addSpring(t){let{props:[i,s,o],uuid:r}=t;this.postMessage({op:"addSpring",props:[i,s,o],uuid:r})}applyForce(t){let{props:i,uuid:s}=t;this.postMessage({op:"applyForce",props:i,uuid:s})}applyImpulse(t){let{props:i,uuid:s}=t;this.postMessage({op:"applyImpulse",props:i,uuid:s})}applyLocalForce(t){let{props:i,uuid:s}=t;this.postMessage({op:"applyLocalForce",props:i,uuid:s})}applyLocalImpulse(t){let{props:i,uuid:s}=t;this.postMessage({op:"applyLocalImpulse",props:i,uuid:s})}applyRaycastVehicleEngineForce(t){let{props:i,uuid:s}=t;this.postMessage({op:"applyRaycastVehicleEngineForce",props:i,uuid:s})}applyTorque(t){let{props:i,uuid:s}=t;this.postMessage({op:"applyTorque",props:i,uuid:s})}connect(){this.worker=new O8,this.worker.onmessage=t=>{if(t.data.op==="frame"){this.buffers.positions=t.data.positions,this.buffers.quaternions=t.data.quaternions,this.emit(t.data.op,t.data);return}this.emit(t.data.type,t.data)};for(const t of this.messageQueue)this.worker.postMessage(t);this.messageQueue.length=0}disableConstraint(t){let{uuid:i}=t;this.postMessage({op:"disableConstraint",uuid:i})}disableConstraintMotor(t){let{uuid:i}=t;this.postMessage({op:"disableConstraintMotor",uuid:i})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(t){let{uuid:i}=t;this.postMessage({op:"enableConstraint",uuid:i})}enableConstraintMotor(t){let{uuid:i}=t;this.postMessage({op:"enableConstraintMotor",uuid:i})}init(){const{allowSleep:t,axisIndex:i,broadphase:s,defaultContactMaterial:o,frictionGravity:r,gravity:a,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:c,solver:u,tolerance:C}=this.config;this.postMessage({op:"init",props:{allowSleep:t,axisIndex:i,broadphase:s,defaultContactMaterial:o,frictionGravity:r,gravity:a,iterations:l,quatNormalizeFast:g,quatNormalizeSkip:c,solver:u,tolerance:C}})}removeBodies(t){let{uuid:i}=t;this.postMessage({op:"removeBodies",uuid:i})}removeConstraint(t){let{uuid:i}=t;this.postMessage({op:"removeConstraint",uuid:i})}removeContactMaterial(t){let{uuid:i}=t;this.postMessage({op:"removeContactMaterial",uuid:i})}removeRay(t){let{uuid:i}=t;this.postMessage({op:"removeRay",uuid:i})}removeRaycastVehicle(t){let{uuid:i}=t;this.postMessage({op:"removeRaycastVehicle",uuid:i})}removeSpring(t){let{uuid:i}=t;this.postMessage({op:"removeSpring",uuid:i})}setAllowSleep(t){let{props:i,uuid:s}=t;this.postMessage({op:"setAllowSleep",props:i,uuid:s})}setAngularDamping(t){let{props:i,uuid:s}=t;this.postMessage({op:"setAngularDamping",props:i,uuid:s})}setAngularFactor(t){let{props:i,uuid:s}=t;this.postMessage({op:"setAngularFactor",props:i,uuid:s})}setAngularVelocity(t){let{props:i,uuid:s}=t;this.postMessage({op:"setAngularVelocity",props:i,uuid:s})}setCollisionFilterGroup(t){let{props:i,uuid:s}=t;this.postMessage({op:"setCollisionFilterGroup",props:i,uuid:s})}setCollisionFilterMask(t){let{props:i,uuid:s}=t;this.postMessage({op:"setCollisionFilterMask",props:i,uuid:s})}setCollisionResponse(t){let{props:i,uuid:s}=t;this.postMessage({op:"setCollisionResponse",props:i,uuid:s})}setConstraintMotorMaxForce(t){let{props:i,uuid:s}=t;this.postMessage({op:"setConstraintMotorMaxForce",props:i,uuid:s})}setConstraintMotorSpeed(t){let{props:i,uuid:s}=t;this.postMessage({op:"setConstraintMotorSpeed",props:i,uuid:s})}setFixedRotation(t){let{props:i,uuid:s}=t;this.postMessage({op:"setFixedRotation",props:i,uuid:s})}setIsTrigger(t){let{props:i,uuid:s}=t;this.postMessage({op:"setIsTrigger",props:i,uuid:s})}setLinearDamping(t){let{props:i,uuid:s}=t;this.postMessage({op:"setLinearDamping",props:i,uuid:s})}setLinearFactor(t){let{props:i,uuid:s}=t;this.postMessage({op:"setLinearFactor",props:i,uuid:s})}setMass(t){let{props:i,uuid:s}=t;this.postMessage({op:"setMass",props:i,uuid:s})}setMaterial(t){let{props:i,uuid:s}=t;this.postMessage({op:"setMaterial",props:i,uuid:s})}setPosition(t){let{props:i,uuid:s}=t;this.postMessage({op:"setPosition",props:i,uuid:s})}setQuaternion(t){let{props:[i,s,o,r],uuid:a}=t;this.postMessage({op:"setQuaternion",props:[i,s,o,r],uuid:a})}setRaycastVehicleBrake(t){let{props:i,uuid:s}=t;this.postMessage({op:"setRaycastVehicleBrake",props:i,uuid:s})}setRaycastVehicleSteeringValue(t){let{props:i,uuid:s}=t;this.postMessage({op:"setRaycastVehicleSteeringValue",props:i,uuid:s})}setRotation(t){let{props:i,uuid:s}=t;this.postMessage({op:"setRotation",props:i,uuid:s})}setSleepSpeedLimit(t){let{props:i,uuid:s}=t;this.postMessage({op:"setSleepSpeedLimit",props:i,uuid:s})}setSleepTimeLimit(t){let{props:i,uuid:s}=t;this.postMessage({op:"setSleepTimeLimit",props:i,uuid:s})}setSpringDamping(t){let{props:i,uuid:s}=t;this.postMessage({op:"setSpringDamping",props:i,uuid:s})}setSpringRestLength(t){let{props:i,uuid:s}=t;this.postMessage({op:"setSpringRestLength",props:i,uuid:s})}setSpringStiffness(t){let{props:i,uuid:s}=t;this.postMessage({op:"setSpringStiffness",props:i,uuid:s})}setUserData(t){let{props:i,uuid:s}=t;this.postMessage({op:"setUserData",props:i,uuid:s})}setVelocity(t){let{props:i,uuid:s}=t;this.postMessage({op:"setVelocity",props:i,uuid:s})}sleep(t){let{uuid:i}=t;this.postMessage({op:"sleep",uuid:i})}step(t){var i;const{buffers:{positions:s,quaternions:o}}=this;!s.byteLength&&!o.byteLength||(i=this.worker)==null||i.postMessage({op:"step",positions:s,props:t,quaternions:o},[s.buffer,o.buffer])}subscribe(t){let{props:{id:i,target:s,type:o},uuid:r}=t;this.postMessage({op:"subscribe",props:{id:i,target:s,type:o},uuid:r})}terminate(){var t;(t=this.worker)==null||t.terminate(),this.worker=null}unsubscribe(t){let{props:i}=t;this.postMessage({op:"unsubscribe",props:i})}wakeUp(t){let{uuid:i}=t;this.postMessage({op:"wakeUp",uuid:i})}postMessage(t){if(this.worker)return this.worker.postMessage(t);this.messageQueue.push(t)}}class Fa{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new U);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new U);const i=this.elements,s=e.x,o=e.y,r=e.z;return t.x=i[0]*s+i[1]*o+i[2]*r,t.y=i[3]*s+i[4]*o+i[5]*r,t.z=i[6]*s+i[7]*o+i[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Fa);const i=this.elements,s=e.elements,o=t.elements,r=i[0],a=i[1],l=i[2],g=i[3],c=i[4],u=i[5],C=i[6],h=i[7],p=i[8],b=s[0],m=s[1],A=s[2],B=s[3],G=s[4],w=s[5],N=s[6],M=s[7],R=s[8];return o[0]=r*b+a*B+l*N,o[1]=r*m+a*G+l*M,o[2]=r*A+a*w+l*R,o[3]=g*b+c*B+u*N,o[4]=g*m+c*G+u*M,o[5]=g*A+c*w+u*R,o[6]=C*b+h*B+p*N,o[7]=C*m+h*G+p*M,o[8]=C*A+h*w+p*R,t}scale(e,t){t===void 0&&(t=new Fa);const i=this.elements,s=t.elements;for(let o=0;o!==3;o++)s[3*o+0]=e.x*i[3*o+0],s[3*o+1]=e.y*i[3*o+1],s[3*o+2]=e.z*i[3*o+2];return t}solve(e,t){t===void 0&&(t=new U);const i=3,s=4,o=[];let r,a;for(r=0;r<i*s;r++)o.push(0);for(r=0;r<3;r++)for(a=0;a<3;a++)o[r+s*a]=this.elements[r+3*a];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let l=3;const g=l;let c;const u=4;let C;do{if(r=g-l,o[r+s*r]===0){for(a=r+1;a<g;a++)if(o[r+s*a]!==0){c=u;do C=u-c,o[C+s*r]+=o[C+s*a];while(--c);break}}if(o[r+s*r]!==0)for(a=r+1;a<g;a++){const h=o[r+s*a]/o[r+s*r];c=u;do C=u-c,o[C+s*a]=C<=r?0:o[C+s*a]-o[C+s*r]*h;while(--c)}}while(--l);if(t.z=o[2*s+3]/o[2*s+2],t.y=(o[1*s+3]-o[1*s+2]*t.z)/o[1*s+1],t.x=(o[0*s+3]-o[0*s+2]*t.z-o[0*s+1]*t.y)/o[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e){e===void 0&&(e=new Fa);const t=3,i=6,s=j8;let o,r;for(o=0;o<3;o++)for(r=0;r<3;r++)s[o+i*r]=this.elements[o+3*r];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let a=3;const l=a;let g;const c=i;let u;do{if(o=l-a,s[o+i*o]===0){for(r=o+1;r<l;r++)if(s[o+i*r]!==0){g=c;do u=c-g,s[u+i*o]+=s[u+i*r];while(--g);break}}if(s[o+i*o]!==0)for(r=o+1;r<l;r++){const C=s[o+i*r]/s[o+i*o];g=c;do u=c-g,s[u+i*r]=u<=o?0:s[u+i*r]-s[u+i*o]*C;while(--g)}}while(--a);o=2;do{r=o-1;do{const C=s[o+i*r]/s[o+i*o];g=i;do u=i-g,s[u+i*r]=s[u+i*r]-s[u+i*o]*C;while(--g)}while(r--)}while(--o);o=2;do{const C=1/s[o+i*o];g=i;do u=i-g,s[u+i*o]=s[u+i*o]*C;while(--g)}while(o--);o=2;do{r=2;do{if(u=s[t+r+i*o],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,r,u)}while(r--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,s=e.z,o=e.w,r=t+t,a=i+i,l=s+s,g=t*r,c=t*a,u=t*l,C=i*a,h=i*l,p=s*l,b=o*r,m=o*a,A=o*l,B=this.elements;return B[3*0+0]=1-(C+p),B[3*0+1]=c-A,B[3*0+2]=u+m,B[3*1+0]=c+A,B[3*1+1]=1-(g+p),B[3*1+2]=h-b,B[3*2+0]=u-m,B[3*2+1]=h+b,B[3*2+2]=1-(g+C),this}transpose(e){e===void 0&&(e=new Fa);const t=this.elements,i=e.elements;let s;return i[0]=t[0],i[4]=t[4],i[8]=t[8],s=t[1],i[1]=t[3],i[3]=s,s=t[2],i[2]=t[6],i[6]=s,s=t[5],i[5]=t[7],i[7]=s,e}}const j8=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class U{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new U);const i=e.x,s=e.y,o=e.z,r=this.x,a=this.y,l=this.z;return t.x=a*o-l*s,t.y=l*i-r*o,t.z=r*s-a*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new U(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new U(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Fa([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,s=Math.sqrt(e*e+t*t+i*i);if(s>0){const o=1/s;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new U);const t=this.x,i=this.y,s=this.z;let o=Math.sqrt(t*t+i*i+s*s);return o>0?(o=1/o,e.x=t*o,e.y=i*o,e.z=s*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,s=this.z,o=e.x,r=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(r-i)*(r-i)+(a-s)*(a-s))}distanceSquared(e){const t=this.x,i=this.y,s=this.z,o=e.x,r=e.y,a=e.z;return(o-t)*(o-t)+(r-i)*(r-i)+(a-s)*(a-s)}scale(e,t){t===void 0&&(t=new U);const i=this.x,s=this.y,o=this.z;return t.x=e*i,t.y=e*s,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new U),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new U),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new U),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const s=q8,o=1/i;s.set(this.x*o,this.y*o,this.z*o);const r=$8;Math.abs(s.x)<.9?(r.set(1,0,0),s.cross(r,e)):(r.set(0,1,0),s.cross(r,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const s=this.x,o=this.y,r=this.z;i.x=s+(e.x-s)*t,i.y=o+(e.y-o)*t,i.z=r+(e.z-r)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(hM),hM.almostEquals(e,t)}clone(){return new U(this.x,this.y,this.z)}}U.ZERO=new U(0,0,0);U.UNIT_X=new U(1,0,0);U.UNIT_Y=new U(0,1,0);U.UNIT_Z=new U(0,0,1);const q8=new U,$8=new U,hM=new U;class sr{constructor(e){e===void 0&&(e={}),this.lowerBound=new U,this.upperBound=new U,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,s){const o=this.lowerBound,r=this.upperBound,a=i;o.copy(e[0]),a&&a.vmult(o,o),r.copy(o);for(let l=1;l<e.length;l++){let g=e[l];a&&(a.vmult(g,AM),g=AM),g.x>r.x&&(r.x=g.x),g.x<o.x&&(o.x=g.x),g.y>r.y&&(r.y=g.y),g.y<o.y&&(o.y=g.y),g.z>r.z&&(r.z=g.z),g.z<o.z&&(o.z=g.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),s&&(o.x-=s,o.y-=s,o.z-=s,r.x+=s,r.y+=s,r.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new sr().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,s=e.lowerBound,o=e.upperBound,r=s.x<=i.x&&i.x<=o.x||t.x<=o.x&&o.x<=i.x,a=s.y<=i.y&&i.y<=o.y||t.y<=o.y&&o.y<=i.y,l=s.z<=i.z&&i.z<=o.z||t.z<=o.z&&o.z<=i.z;return r&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,s=e.lowerBound,o=e.upperBound;return t.x<=s.x&&i.x>=o.x&&t.y<=s.y&&i.y>=o.y&&t.z<=s.z&&i.z>=o.z}getCorners(e,t,i,s,o,r,a,l){const g=this.lowerBound,c=this.upperBound;e.copy(g),t.set(c.x,g.y,g.z),i.set(c.x,c.y,g.z),s.set(g.x,c.y,c.z),o.set(c.x,g.y,c.z),r.set(g.x,c.y,g.z),a.set(g.x,g.y,c.z),l.copy(c)}toLocalFrame(e,t){const i=pM,s=i[0],o=i[1],r=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(s,o,r,a,l,g,c,u);for(let C=0;C!==8;C++){const h=i[C];e.pointToLocal(h,h)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=pM,s=i[0],o=i[1],r=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(s,o,r,a,l,g,c,u);for(let C=0;C!==8;C++){const h=i[C];e.pointToWorld(h,h)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,s=1/t.x,o=1/t.y,r=1/t.z,a=(this.lowerBound.x-i.x)*s,l=(this.upperBound.x-i.x)*s,g=(this.lowerBound.y-i.y)*o,c=(this.upperBound.y-i.y)*o,u=(this.lowerBound.z-i.z)*r,C=(this.upperBound.z-i.z)*r,h=Math.max(Math.max(Math.min(a,l),Math.min(g,c)),Math.min(u,C)),p=Math.min(Math.min(Math.max(a,l),Math.max(g,c)),Math.max(u,C));return!(p<0||h>p)}}const AM=new U,pM=[new U,new U,new U,new U,new U,new U,new U,new U];class Ns{constructor(e,t,i,s){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=i,this.w=s}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new U),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=e6,s=t6;e.tangents(i,s),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Ns);const i=this.x,s=this.y,o=this.z,r=this.w,a=e.x,l=e.y,g=e.z,c=e.w;return t.x=i*c+r*a+s*g-o*l,t.y=s*c+r*l+o*a-i*g,t.z=o*c+r*g+i*l-s*a,t.w=r*c-i*a-s*l-o*g,t}inverse(e){e===void 0&&(e=new Ns);const t=this.x,i=this.y,s=this.z,o=this.w;this.conjugate(e);const r=1/(t*t+i*i+s*s+o*o);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e){return e===void 0&&(e=new Ns),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new U);const i=e.x,s=e.y,o=e.z,r=this.x,a=this.y,l=this.z,g=this.w,c=g*i+a*o-l*s,u=g*s+l*i-r*o,C=g*o+r*s-a*i,h=-r*i-a*s-l*o;return t.x=c*g+h*-r+u*-l-C*-a,t.y=u*g+h*-a+C*-r-c*-l,t.z=C*g+h*-l+c*-a-u*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let i,s,o;const r=this.x,a=this.y,l=this.z,g=this.w;switch(t){case"YZX":const c=r*a+l*g;if(c>.499&&(i=2*Math.atan2(r,g),s=Math.PI/2,o=0),c<-.499&&(i=-2*Math.atan2(r,g),s=-Math.PI/2,o=0),i===void 0){const u=r*r,C=a*a,h=l*l;i=Math.atan2(2*a*g-2*r*l,1-2*C-2*h),s=Math.asin(2*c),o=Math.atan2(2*r*g-2*a*l,1-2*u-2*h)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=i,e.z=s,e.x=o}setFromEuler(e,t,i,s){s===void 0&&(s="XYZ");const o=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(i/2),l=Math.sin(e/2),g=Math.sin(t/2),c=Math.sin(i/2);return s==="XYZ"?(this.x=l*r*a+o*g*c,this.y=o*g*a-l*r*c,this.z=o*r*c+l*g*a,this.w=o*r*a-l*g*c):s==="YXZ"?(this.x=l*r*a+o*g*c,this.y=o*g*a-l*r*c,this.z=o*r*c-l*g*a,this.w=o*r*a+l*g*c):s==="ZXY"?(this.x=l*r*a-o*g*c,this.y=o*g*a+l*r*c,this.z=o*r*c+l*g*a,this.w=o*r*a-l*g*c):s==="ZYX"?(this.x=l*r*a-o*g*c,this.y=o*g*a+l*r*c,this.z=o*r*c-l*g*a,this.w=o*r*a+l*g*c):s==="YZX"?(this.x=l*r*a+o*g*c,this.y=o*g*a+l*r*c,this.z=o*r*c-l*g*a,this.w=o*r*a-l*g*c):s==="XZY"&&(this.x=l*r*a-o*g*c,this.y=o*g*a-l*r*c,this.z=o*r*c+l*g*a,this.w=o*r*a+l*g*c),this}clone(){return new Ns(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new Ns);const s=this.x,o=this.y,r=this.z,a=this.w;let l=e.x,g=e.y,c=e.z,u=e.w,C,h,p,b,m;return h=s*l+o*g+r*c+a*u,h<0&&(h=-h,l=-l,g=-g,c=-c,u=-u),1-h>1e-6?(C=Math.acos(h),p=Math.sin(C),b=Math.sin((1-t)*C)/p,m=Math.sin(t*C)/p):(b=1-t,m=t),i.x=b*s+m*l,i.y=b*o+m*g,i.z=b*r+m*c,i.w=b*a+m*u,i}integrate(e,t,i,s){s===void 0&&(s=new Ns);const o=e.x*i.x,r=e.y*i.y,a=e.z*i.z,l=this.x,g=this.y,c=this.z,u=this.w,C=t*.5;return s.x+=C*(o*u+r*c-a*g),s.y+=C*(r*u+a*l-o*c),s.z+=C*(a*u+o*g-r*l),s.w+=C*(-o*l-r*g-a*c),s}}const e6=new U,t6=new U,n6={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class ft{constructor(e){e===void 0&&(e={}),this.id=ft.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}ft.idCounter=0;ft.types=n6;class Os{constructor(e){e===void 0&&(e={}),this.position=new U,this.quaternion=new Ns,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Os.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Os.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new U),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,s){return s===void 0&&(s=new U),i.vsub(e,s),t.conjugate(mM),mM.vmult(s,s),s}static pointToWorldFrame(e,t,i,s){return s===void 0&&(s=new U),t.vmult(i,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new U),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,s){return s===void 0&&(s=new U),t.w*=-1,t.vmult(i,s),t.w*=-1,s}}const mM=new Ns;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U,new U,new U;new U;new Ns;new sr;new Fa;new Fa;new Fa;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Ns;new U;new U;new U;new U;class X2{constructor(){this.rayFromWorld=new U,this.rayToWorld=new U,this.hitNormalWorld=new U,this.hitPointWorld=new U,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,s,o,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(s),this.shape=o,this.body=r,this.distance=a}}let oY,rY,aY,lY,gY,cY,uY;const dS={CLOSEST:1,ANY:2,ALL:4};oY=ft.types.SPHERE;rY=ft.types.PLANE;aY=ft.types.BOX;lY=ft.types.CYLINDER;gY=ft.types.CONVEXPOLYHEDRON;cY=ft.types.HEIGHTFIELD;uY=ft.types.TRIMESH;class Cs{get[oY](){return this._intersectSphere}get[rY](){return this._intersectPlane}get[aY](){return this._intersectBox}get[lY](){return this._intersectConvex}get[gY](){return this._intersectConvex}get[cY](){return this._intersectHeightfield}get[uY](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new U),t===void 0&&(t=new U),this.from=e.clone(),this.to=t.clone(),this.direction=new U,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Cs.ANY,this.result=new X2,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||Cs.ANY,this.result=t.result||new X2,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(fM),PG.length=0,e.broadphase.aabbQuery(e,fM,PG),this.intersectBodies(PG),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const s=i6,o=s6;for(let r=0,a=e.shapes.length;r<a;r++){const l=e.shapes[r];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],s),s.vadd(e.position,s),this.intersectShape(l,o,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,s=e.length;!this.result.shouldStop&&i<s;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,s){const o=this.from;if(m6(o,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,i,s,e)}_intersectBox(e,t,i,s,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,s,o)}_intersectPlane(e,t,i,s,o){const r=this.from,a=this.to,l=this.direction,g=new U(0,0,1);t.vmult(g,g);const c=new U;r.vsub(i,c);const u=c.dot(g);a.vsub(i,c);const C=c.dot(g);if(u*C>0||r.distanceTo(a)<u)return;const h=g.dot(l);if(Math.abs(h)<this.precision)return;const p=new U,b=new U,m=new U;r.vsub(i,p);const A=-g.dot(p)/h;l.scale(A,b),r.vadd(b,m),this.reportIntersection(g,m,o,s,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,s=this.to,o=this.from;t.x=Math.min(s.x,o.x),t.y=Math.min(s.y,o.y),t.z=Math.min(s.z,o.z),i.x=Math.max(s.x,o.x),i.y=Math.max(s.y,o.y),i.z=Math.max(s.z,o.z)}_intersectHeightfield(e,t,i,s,o){e.data,e.elementSize;const r=o6;r.from.copy(this.from),r.to.copy(this.to),Os.pointToLocalFrame(i,t,r.from,r.from),Os.pointToLocalFrame(i,t,r.to,r.to),r.updateDirection();const a=r6;let l,g,c,u;l=g=0,c=u=e.data.length-1;const C=new sr;r.getAABB(C),e.getIndexOfPosition(C.lowerBound.x,C.lowerBound.y,a,!0),l=Math.max(l,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(C.upperBound.x,C.upperBound.y,a,!0),c=Math.min(c,a[0]+1),u=Math.min(u,a[1]+1);for(let h=l;h<c;h++)for(let p=g;p<u;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,p,C),!!C.overlapsRay(r)){if(e.getConvexTrianglePillar(h,p,!1),Os.pointToWorldFrame(i,t,e.pillarOffset,ym),this._intersectConvex(e.pillarConvex,t,ym,s,o,bM),this.result.shouldStop)return;e.getConvexTrianglePillar(h,p,!0),Os.pointToWorldFrame(i,t,e.pillarOffset,ym),this._intersectConvex(e.pillarConvex,t,ym,s,o,bM)}}}_intersectSphere(e,t,i,s,o){const r=this.from,a=this.to,l=e.radius,g=(a.x-r.x)**2+(a.y-r.y)**2+(a.z-r.z)**2,c=2*((a.x-r.x)*(r.x-i.x)+(a.y-r.y)*(r.y-i.y)+(a.z-r.z)*(r.z-i.z)),u=(r.x-i.x)**2+(r.y-i.y)**2+(r.z-i.z)**2-l**2,C=c**2-4*g*u,h=a6,p=l6;if(!(C<0))if(C===0)r.lerp(a,C,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,o,s,-1);else{const b=(-c-Math.sqrt(C))/(2*g),m=(-c+Math.sqrt(C))/(2*g);if(b>=0&&b<=1&&(r.lerp(a,b,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,o,s,-1)),this.result.shouldStop)return;m>=0&&m<=1&&(r.lerp(a,m,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,o,s,-1))}}_intersectConvex(e,t,i,s,o,r){const a=g6,l=yM,g=r&&r.faceList||null,c=e.faces,u=e.vertices,C=e.faceNormals,h=this.direction,p=this.from,b=this.to,m=p.distanceTo(b),A=g?g.length:c.length,B=this.result;for(let G=0;!B.shouldStop&&G<A;G++){const w=g?g[G]:G,N=c[w],M=C[w],R=t,S=i;l.copy(u[N[0]]),R.vmult(l,l),l.vadd(S,l),l.vsub(p,l),R.vmult(M,a);const F=h.dot(a);if(Math.abs(F)<this.precision)continue;const Z=a.dot(l)/F;if(!(Z<0)){h.scale(Z,Ps),Ps.vadd(p,Ps),Cr.copy(u[N[0]]),R.vmult(Cr,Cr),S.vadd(Cr,Cr);for(let x=1;!B.shouldStop&&x<N.length-1;x++){Lr.copy(u[N[x]]),kr.copy(u[N[x+1]]),R.vmult(Lr,Lr),R.vmult(kr,kr),S.vadd(Lr,Lr),S.vadd(kr,kr);const Y=Ps.distanceTo(p);!(Cs.pointInTriangle(Ps,Cr,Lr,kr)||Cs.pointInTriangle(Ps,Lr,Cr,kr))||Y>m||this.reportIntersection(a,Ps,o,s,w)}}}}_intersectTrimesh(e,t,i,s,o,r){const a=c6,l=A6,g=p6,c=yM,u=u6,C=I6,h=d6,p=h6,b=C6,m=e.indices;e.vertices;const A=this.from,B=this.to,G=this.direction;g.position.copy(i),g.quaternion.copy(t),Os.vectorToLocalFrame(i,t,G,u),Os.pointToLocalFrame(i,t,A,C),Os.pointToLocalFrame(i,t,B,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,h.vsub(C,u),u.normalize();const w=C.distanceSquared(h);e.tree.rayQuery(this,g,l);for(let N=0,M=l.length;!this.result.shouldStop&&N!==M;N++){const R=l[N];e.getNormal(R,a),e.getVertex(m[R*3],Cr),Cr.vsub(C,c);const S=u.dot(a),F=a.dot(c)/S;if(F<0)continue;u.scale(F,Ps),Ps.vadd(C,Ps),e.getVertex(m[R*3+1],Lr),e.getVertex(m[R*3+2],kr);const Z=Ps.distanceSquared(C);!(Cs.pointInTriangle(Ps,Lr,Cr,kr)||Cs.pointInTriangle(Ps,Cr,Lr,kr))||Z>w||(Os.vectorToWorldFrame(t,a,b),Os.pointToWorldFrame(i,t,Ps,p),this.reportIntersection(b,p,o,s,R))}l.length=0}reportIntersection(e,t,i,s,o){const r=this.from,a=this.to,l=r.distanceTo(t),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case Cs.ALL:this.hasHit=!0,g.set(r,a,e,t,i,s,l),g.hasHit=!0,this.callback(g);break;case Cs.CLOSEST:(l<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(r,a,e,t,i,s,l));break;case Cs.ANY:this.hasHit=!0,g.hasHit=!0,g.set(r,a,e,t,i,s,l),g.shouldStop=!0;break}}static pointInTriangle(e,t,i,s){s.vsub(t,Ic),i.vsub(t,CC),e.vsub(t,UG);const o=Ic.dot(Ic),r=Ic.dot(CC),a=Ic.dot(UG),l=CC.dot(CC),g=CC.dot(UG);let c,u;return(c=l*a-r*g)>=0&&(u=o*g-r*a)>=0&&c+u<o*l-r*r}}Cs.CLOSEST=dS.CLOSEST;Cs.ANY=dS.ANY;Cs.ALL=dS.ALL;const fM=new sr,PG=[],CC=new U,UG=new U,i6=new U,s6=new Ns,Ps=new U,Cr=new U,Lr=new U,kr=new U;new U;new X2;const bM={faceList:[0]},ym=new U,o6=new Cs,r6=[],a6=new U,l6=new U,g6=new U;new U;new U;const yM=new U,c6=new U,u6=new U,I6=new U,d6=new U,C6=new U,h6=new U;new sr;const A6=[],p6=new Os,Ic=new U,Bm=new U;function m6(n,e,t){t.vsub(n,Ic);const i=Ic.dot(e);return e.scale(i,Bm),Bm.vadd(n,Bm),t.distanceTo(Bm)}new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Cs;new U;new U;new U;new U(1,0,0),new U(0,1,0),new U(0,0,1);new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new sr;new U;new sr;new U;new U;new U;new U;new U;new U;new U;new sr;new U;new Os;new sr;ft.types.SPHERE,ft.types.SPHERE|ft.types.PLANE,ft.types.BOX|ft.types.BOX,ft.types.SPHERE|ft.types.BOX,ft.types.PLANE|ft.types.BOX,ft.types.CONVEXPOLYHEDRON,ft.types.SPHERE|ft.types.CONVEXPOLYHEDRON,ft.types.PLANE|ft.types.CONVEXPOLYHEDRON,ft.types.BOX|ft.types.CONVEXPOLYHEDRON,ft.types.SPHERE|ft.types.HEIGHTFIELD,ft.types.BOX|ft.types.HEIGHTFIELD,ft.types.CONVEXPOLYHEDRON|ft.types.HEIGHTFIELD,ft.types.PARTICLE|ft.types.SPHERE,ft.types.PLANE|ft.types.PARTICLE,ft.types.BOX|ft.types.PARTICLE,ft.types.PARTICLE|ft.types.CONVEXPOLYHEDRON,ft.types.CYLINDER,ft.types.SPHERE|ft.types.CYLINDER,ft.types.PLANE|ft.types.CYLINDER,ft.types.BOX|ft.types.CYLINDER,ft.types.CONVEXPOLYHEDRON|ft.types.CYLINDER,ft.types.HEIGHTFIELD|ft.types.CYLINDER,ft.types.PARTICLE|ft.types.CYLINDER,ft.types.SPHERE|ft.types.TRIMESH,ft.types.PLANE|ft.types.TRIMESH;new U;new U;new U;new U;new U;new Ns;new Ns;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new sr;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U,new U,new U,new U,new U,new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new U;new Ns;new U;new U;new U;new U;new U;new U;new U;new U;new U;new sr;new Cs;const hC=globalThis.performance||{};if(!hC.now){let n=Date.now();hC.timing&&hC.timing.navigationStart&&(n=hC.timing.navigationStart),hC.now=()=>Date.now()-n}new U;class Ha{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new J);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new J);const i=this.elements,s=e.x,o=e.y,r=e.z;return t.x=i[0]*s+i[1]*o+i[2]*r,t.y=i[3]*s+i[4]*o+i[5]*r,t.z=i[6]*s+i[7]*o+i[8]*r,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Ha);const i=this.elements,s=e.elements,o=t.elements,r=i[0],a=i[1],l=i[2],g=i[3],c=i[4],u=i[5],C=i[6],h=i[7],p=i[8],b=s[0],m=s[1],A=s[2],B=s[3],G=s[4],w=s[5],N=s[6],M=s[7],R=s[8];return o[0]=r*b+a*B+l*N,o[1]=r*m+a*G+l*M,o[2]=r*A+a*w+l*R,o[3]=g*b+c*B+u*N,o[4]=g*m+c*G+u*M,o[5]=g*A+c*w+u*R,o[6]=C*b+h*B+p*N,o[7]=C*m+h*G+p*M,o[8]=C*A+h*w+p*R,t}scale(e,t){t===void 0&&(t=new Ha);const i=this.elements,s=t.elements;for(let o=0;o!==3;o++)s[3*o+0]=e.x*i[3*o+0],s[3*o+1]=e.y*i[3*o+1],s[3*o+2]=e.z*i[3*o+2];return t}solve(e,t){t===void 0&&(t=new J);const i=3,s=4,o=[];let r,a;for(r=0;r<i*s;r++)o.push(0);for(r=0;r<3;r++)for(a=0;a<3;a++)o[r+s*a]=this.elements[r+3*a];o[3+4*0]=e.x,o[3+4*1]=e.y,o[3+4*2]=e.z;let l=3;const g=l;let c;const u=4;let C;do{if(r=g-l,o[r+s*r]===0){for(a=r+1;a<g;a++)if(o[r+s*a]!==0){c=u;do C=u-c,o[C+s*r]+=o[C+s*a];while(--c);break}}if(o[r+s*r]!==0)for(a=r+1;a<g;a++){const h=o[r+s*a]/o[r+s*r];c=u;do C=u-c,o[C+s*a]=C<=r?0:o[C+s*a]-o[C+s*r]*h;while(--c)}}while(--l);if(t.z=o[2*s+3]/o[2*s+2],t.y=(o[1*s+3]-o[1*s+2]*t.z)/o[1*s+1],t.x=(o[0*s+3]-o[0*s+2]*t.z-o[0*s+1]*t.y)/o[0*s+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,i){if(i===void 0)return this.elements[t+3*e];this.elements[t+3*e]=i}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";const t=",";for(let i=0;i<9;i++)e+=this.elements[i]+t;return e}reverse(e){e===void 0&&(e=new Ha);const t=3,i=6,s=f6;let o,r;for(o=0;o<3;o++)for(r=0;r<3;r++)s[o+i*r]=this.elements[o+3*r];s[3+6*0]=1,s[3+6*1]=0,s[3+6*2]=0,s[4+6*0]=0,s[4+6*1]=1,s[4+6*2]=0,s[5+6*0]=0,s[5+6*1]=0,s[5+6*2]=1;let a=3;const l=a;let g;const c=i;let u;do{if(o=l-a,s[o+i*o]===0){for(r=o+1;r<l;r++)if(s[o+i*r]!==0){g=c;do u=c-g,s[u+i*o]+=s[u+i*r];while(--g);break}}if(s[o+i*o]!==0)for(r=o+1;r<l;r++){const C=s[o+i*r]/s[o+i*o];g=c;do u=c-g,s[u+i*r]=u<=o?0:s[u+i*r]-s[u+i*o]*C;while(--g)}}while(--a);o=2;do{r=o-1;do{const C=s[o+i*r]/s[o+i*o];g=i;do u=i-g,s[u+i*r]=s[u+i*r]-s[u+i*o]*C;while(--g)}while(r--)}while(--o);o=2;do{const C=1/s[o+i*o];g=i;do u=i-g,s[u+i*o]=s[u+i*o]*C;while(--g)}while(o--);o=2;do{r=2;do{if(u=s[t+r+i*o],isNaN(u)||u===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(o,r,u)}while(r--)}while(o--);return e}setRotationFromQuaternion(e){const t=e.x,i=e.y,s=e.z,o=e.w,r=t+t,a=i+i,l=s+s,g=t*r,c=t*a,u=t*l,C=i*a,h=i*l,p=s*l,b=o*r,m=o*a,A=o*l,B=this.elements;return B[3*0+0]=1-(C+p),B[3*0+1]=c-A,B[3*0+2]=u+m,B[3*1+0]=c+A,B[3*1+1]=1-(g+p),B[3*1+2]=h-b,B[3*2+0]=u-m,B[3*2+1]=h+b,B[3*2+2]=1-(g+C),this}transpose(e){e===void 0&&(e=new Ha);const t=this.elements,i=e.elements;let s;return i[0]=t[0],i[4]=t[4],i[8]=t[8],s=t[1],i[1]=t[3],i[3]=s,s=t[2],i[2]=t[6],i[6]=s,s=t[5],i[5]=t[7],i[7]=s,e}}const f6=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class J{constructor(e,t,i){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),this.x=e,this.y=t,this.z=i}cross(e,t){t===void 0&&(t=new J);const i=e.x,s=e.y,o=e.z,r=this.x,a=this.y,l=this.z;return t.x=a*o-l*s,t.y=l*i-r*o,t.z=r*s-a*i,t}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new J(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new J(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Ha([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,i=this.z,s=Math.sqrt(e*e+t*t+i*i);if(s>0){const o=1/s;this.x*=o,this.y*=o,this.z*=o}else this.x=0,this.y=0,this.z=0;return s}unit(e){e===void 0&&(e=new J);const t=this.x,i=this.y,s=this.z;let o=Math.sqrt(t*t+i*i+s*s);return o>0?(o=1/o,e.x=t*o,e.y=i*o,e.z=s*o):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,i=this.z;return Math.sqrt(e*e+t*t+i*i)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,i=this.y,s=this.z,o=e.x,r=e.y,a=e.z;return Math.sqrt((o-t)*(o-t)+(r-i)*(r-i)+(a-s)*(a-s))}distanceSquared(e){const t=this.x,i=this.y,s=this.z,o=e.x,r=e.y,a=e.z;return(o-t)*(o-t)+(r-i)*(r-i)+(a-s)*(a-s)}scale(e,t){t===void 0&&(t=new J);const i=this.x,s=this.y,o=this.z;return t.x=e*i,t.y=e*s,t.z=e*o,t}vmul(e,t){return t===void 0&&(t=new J),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,i){return i===void 0&&(i=new J),i.x=this.x+e*t.x,i.y=this.y+e*t.y,i.z=this.z+e*t.z,i}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new J),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const i=this.length();if(i>0){const s=b6,o=1/i;s.set(this.x*o,this.y*o,this.z*o);const r=y6;Math.abs(s.x)<.9?(r.set(1,0,0),s.cross(r,e)):(r.set(0,1,0),s.cross(r,e)),s.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,i){const s=this.x,o=this.y,r=this.z;i.x=s+(e.x-s)*t,i.y=o+(e.y-o)*t,i.z=r+(e.z-r)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(BM),BM.almostEquals(e,t)}clone(){return new J(this.x,this.y,this.z)}}J.ZERO=new J(0,0,0);J.UNIT_X=new J(1,0,0);J.UNIT_Y=new J(0,1,0);J.UNIT_Z=new J(0,0,1);const b6=new J,y6=new J,BM=new J;class or{constructor(e){e===void 0&&(e={}),this.lowerBound=new J,this.upperBound=new J,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,i,s){const o=this.lowerBound,r=this.upperBound,a=i;o.copy(e[0]),a&&a.vmult(o,o),r.copy(o);for(let l=1;l<e.length;l++){let g=e[l];a&&(a.vmult(g,GM),g=GM),g.x>r.x&&(r.x=g.x),g.x<o.x&&(o.x=g.x),g.y>r.y&&(r.y=g.y),g.y<o.y&&(o.y=g.y),g.z>r.z&&(r.z=g.z),g.z<o.z&&(o.z=g.z)}return t&&(t.vadd(o,o),t.vadd(r,r)),s&&(o.x-=s,o.y-=s,o.z-=s,r.x+=s,r.y+=s,r.z+=s),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new or().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,i=this.upperBound,s=e.lowerBound,o=e.upperBound,r=s.x<=i.x&&i.x<=o.x||t.x<=o.x&&o.x<=i.x,a=s.y<=i.y&&i.y<=o.y||t.y<=o.y&&o.y<=i.y,l=s.z<=i.z&&i.z<=o.z||t.z<=o.z&&o.z<=i.z;return r&&a&&l}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,i=this.upperBound,s=e.lowerBound,o=e.upperBound;return t.x<=s.x&&i.x>=o.x&&t.y<=s.y&&i.y>=o.y&&t.z<=s.z&&i.z>=o.z}getCorners(e,t,i,s,o,r,a,l){const g=this.lowerBound,c=this.upperBound;e.copy(g),t.set(c.x,g.y,g.z),i.set(c.x,c.y,g.z),s.set(g.x,c.y,c.z),o.set(c.x,g.y,c.z),r.set(g.x,c.y,g.z),a.set(g.x,g.y,c.z),l.copy(c)}toLocalFrame(e,t){const i=vM,s=i[0],o=i[1],r=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(s,o,r,a,l,g,c,u);for(let C=0;C!==8;C++){const h=i[C];e.pointToLocal(h,h)}return t.setFromPoints(i)}toWorldFrame(e,t){const i=vM,s=i[0],o=i[1],r=i[2],a=i[3],l=i[4],g=i[5],c=i[6],u=i[7];this.getCorners(s,o,r,a,l,g,c,u);for(let C=0;C!==8;C++){const h=i[C];e.pointToWorld(h,h)}return t.setFromPoints(i)}overlapsRay(e){const{direction:t,from:i}=e,s=1/t.x,o=1/t.y,r=1/t.z,a=(this.lowerBound.x-i.x)*s,l=(this.upperBound.x-i.x)*s,g=(this.lowerBound.y-i.y)*o,c=(this.upperBound.y-i.y)*o,u=(this.lowerBound.z-i.z)*r,C=(this.upperBound.z-i.z)*r,h=Math.max(Math.max(Math.min(a,l),Math.min(g,c)),Math.min(u,C)),p=Math.min(Math.min(Math.max(a,l),Math.max(g,c)),Math.max(u,C));return!(p<0||h>p)}}const GM=new J,vM=[new J,new J,new J,new J,new J,new J,new J,new J];class Fs{constructor(e,t,i,s){e===void 0&&(e=0),t===void 0&&(t=0),i===void 0&&(i=0),s===void 0&&(s=1),this.x=e,this.y=t,this.z=i,this.w=s}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const i=Math.sin(t*.5);return this.x=e.x*i,this.y=e.y*i,this.z=e.z*i,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new J),this.normalize();const t=2*Math.acos(this.w),i=Math.sqrt(1-this.w*this.w);return i<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/i,e.y=this.y/i,e.z=this.z/i),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const i=B6,s=G6;e.tangents(i,s),this.setFromAxisAngle(i,Math.PI)}else{const i=e.cross(t);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new Fs);const i=this.x,s=this.y,o=this.z,r=this.w,a=e.x,l=e.y,g=e.z,c=e.w;return t.x=i*c+r*a+s*g-o*l,t.y=s*c+r*l+o*a-i*g,t.z=o*c+r*g+i*l-s*a,t.w=r*c-i*a-s*l-o*g,t}inverse(e){e===void 0&&(e=new Fs);const t=this.x,i=this.y,s=this.z,o=this.w;this.conjugate(e);const r=1/(t*t+i*i+s*s+o*o);return e.x*=r,e.y*=r,e.z*=r,e.w*=r,e}conjugate(e){return e===void 0&&(e=new Fs),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new J);const i=e.x,s=e.y,o=e.z,r=this.x,a=this.y,l=this.z,g=this.w,c=g*i+a*o-l*s,u=g*s+l*i-r*o,C=g*o+r*s-a*i,h=-r*i-a*s-l*o;return t.x=c*g+h*-r+u*-l-C*-a,t.y=u*g+h*-a+C*-r-c*-l,t.z=C*g+h*-l+c*-a-u*-r,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let i,s,o;const r=this.x,a=this.y,l=this.z,g=this.w;switch(t){case"YZX":const c=r*a+l*g;if(c>.499&&(i=2*Math.atan2(r,g),s=Math.PI/2,o=0),c<-.499&&(i=-2*Math.atan2(r,g),s=-Math.PI/2,o=0),i===void 0){const u=r*r,C=a*a,h=l*l;i=Math.atan2(2*a*g-2*r*l,1-2*C-2*h),s=Math.asin(2*c),o=Math.atan2(2*r*g-2*a*l,1-2*u-2*h)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=i,e.z=s,e.x=o}setFromEuler(e,t,i,s){s===void 0&&(s="XYZ");const o=Math.cos(e/2),r=Math.cos(t/2),a=Math.cos(i/2),l=Math.sin(e/2),g=Math.sin(t/2),c=Math.sin(i/2);return s==="XYZ"?(this.x=l*r*a+o*g*c,this.y=o*g*a-l*r*c,this.z=o*r*c+l*g*a,this.w=o*r*a-l*g*c):s==="YXZ"?(this.x=l*r*a+o*g*c,this.y=o*g*a-l*r*c,this.z=o*r*c-l*g*a,this.w=o*r*a+l*g*c):s==="ZXY"?(this.x=l*r*a-o*g*c,this.y=o*g*a+l*r*c,this.z=o*r*c+l*g*a,this.w=o*r*a-l*g*c):s==="ZYX"?(this.x=l*r*a-o*g*c,this.y=o*g*a+l*r*c,this.z=o*r*c-l*g*a,this.w=o*r*a+l*g*c):s==="YZX"?(this.x=l*r*a+o*g*c,this.y=o*g*a+l*r*c,this.z=o*r*c-l*g*a,this.w=o*r*a-l*g*c):s==="XZY"&&(this.x=l*r*a-o*g*c,this.y=o*g*a-l*r*c,this.z=o*r*c+l*g*a,this.w=o*r*a+l*g*c),this}clone(){return new Fs(this.x,this.y,this.z,this.w)}slerp(e,t,i){i===void 0&&(i=new Fs);const s=this.x,o=this.y,r=this.z,a=this.w;let l=e.x,g=e.y,c=e.z,u=e.w,C,h,p,b,m;return h=s*l+o*g+r*c+a*u,h<0&&(h=-h,l=-l,g=-g,c=-c,u=-u),1-h>1e-6?(C=Math.acos(h),p=Math.sin(C),b=Math.sin((1-t)*C)/p,m=Math.sin(t*C)/p):(b=1-t,m=t),i.x=b*s+m*l,i.y=b*o+m*g,i.z=b*r+m*c,i.w=b*a+m*u,i}integrate(e,t,i,s){s===void 0&&(s=new Fs);const o=e.x*i.x,r=e.y*i.y,a=e.z*i.z,l=this.x,g=this.y,c=this.z,u=this.w,C=t*.5;return s.x+=C*(o*u+r*c-a*g),s.y+=C*(r*u+a*l-o*c),s.z+=C*(a*u+o*g-r*l),s.w+=C*(-o*l-r*g-a*c),s}}const B6=new J,G6=new J,v6={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class bt{constructor(e){e===void 0&&(e={}),this.id=bt.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,i,s){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}bt.idCounter=0;bt.types=v6;class Qs{constructor(e){e===void 0&&(e={}),this.position=new J,this.quaternion=new Fs,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return Qs.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return Qs.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new J),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,i,s){return s===void 0&&(s=new J),i.vsub(e,s),t.conjugate(wM),wM.vmult(s,s),s}static pointToWorldFrame(e,t,i,s){return s===void 0&&(s=new J),t.vmult(i,s),s.vadd(e,s),s}static vectorToWorldFrame(e,t,i){return i===void 0&&(i=new J),e.vmult(t,i),i}static vectorToLocalFrame(e,t,i,s){return s===void 0&&(s=new J),t.w*=-1,t.vmult(i,s),t.w*=-1,s}}const wM=new Fs;new J;new J;new J;new J;new J,new J,new J,new J,new J,new J,new J,new J;new J;new Fs;new or;new Ha;new Ha;new Ha;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new Fs;new J;new J;new J;new J;class T2{constructor(){this.rayFromWorld=new J,this.rayToWorld=new J,this.hitNormalWorld=new J,this.hitPointWorld=new J,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,i,s,o,r,a){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(i),this.hitPointWorld.copy(s),this.shape=o,this.body=r,this.distance=a}}let IY,dY,CY,hY,AY,pY,mY;const CS={CLOSEST:1,ANY:2,ALL:4};IY=bt.types.SPHERE;dY=bt.types.PLANE;CY=bt.types.BOX;hY=bt.types.CYLINDER;AY=bt.types.CONVEXPOLYHEDRON;pY=bt.types.HEIGHTFIELD;mY=bt.types.TRIMESH;class hs{get[IY](){return this._intersectSphere}get[dY](){return this._intersectPlane}get[CY](){return this._intersectBox}get[hY](){return this._intersectConvex}get[AY](){return this._intersectConvex}get[pY](){return this._intersectHeightfield}get[mY](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new J),t===void 0&&(t=new J),this.from=e.clone(),this.to=t.clone(),this.direction=new J,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=hs.ANY,this.result=new T2,this.hasHit=!1,this.callback=i=>{}}intersectWorld(e,t){return this.mode=t.mode||hs.ANY,this.result=t.result||new T2,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(ZM),JG.length=0,e.broadphase.aabbQuery(e,ZM,JG),this.intersectBodies(JG),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const i=this.checkCollisionResponse;if(i&&!e.collisionResponse||!(this.collisionFilterGroup&e.collisionFilterMask)||!(e.collisionFilterGroup&this.collisionFilterMask))return;const s=w6,o=Z6;for(let r=0,a=e.shapes.length;r<a;r++){const l=e.shapes[r];if(!(i&&!l.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[r],o),e.quaternion.vmult(e.shapeOffsets[r],s),s.vadd(e.position,s),this.intersectShape(l,o,s,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let i=0,s=e.length;!this.result.shouldStop&&i<s;i++)this.intersectBody(e[i])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,i,s){const o=this.from;if(K6(o,this.direction,i)>e.boundingSphereRadius)return;const a=this[e.type];a&&a.call(this,e,t,i,s,e)}_intersectBox(e,t,i,s,o){return this._intersectConvex(e.convexPolyhedronRepresentation,t,i,s,o)}_intersectPlane(e,t,i,s,o){const r=this.from,a=this.to,l=this.direction,g=new J(0,0,1);t.vmult(g,g);const c=new J;r.vsub(i,c);const u=c.dot(g);a.vsub(i,c);const C=c.dot(g);if(u*C>0||r.distanceTo(a)<u)return;const h=g.dot(l);if(Math.abs(h)<this.precision)return;const p=new J,b=new J,m=new J;r.vsub(i,p);const A=-g.dot(p)/h;l.scale(A,b),r.vadd(b,m),this.reportIntersection(g,m,o,s,-1)}getAABB(e){const{lowerBound:t,upperBound:i}=e,s=this.to,o=this.from;t.x=Math.min(s.x,o.x),t.y=Math.min(s.y,o.y),t.z=Math.min(s.z,o.z),i.x=Math.max(s.x,o.x),i.y=Math.max(s.y,o.y),i.z=Math.max(s.z,o.z)}_intersectHeightfield(e,t,i,s,o){e.data,e.elementSize;const r=S6;r.from.copy(this.from),r.to.copy(this.to),Qs.pointToLocalFrame(i,t,r.from,r.from),Qs.pointToLocalFrame(i,t,r.to,r.to),r.updateDirection();const a=R6;let l,g,c,u;l=g=0,c=u=e.data.length-1;const C=new or;r.getAABB(C),e.getIndexOfPosition(C.lowerBound.x,C.lowerBound.y,a,!0),l=Math.max(l,a[0]),g=Math.max(g,a[1]),e.getIndexOfPosition(C.upperBound.x,C.upperBound.y,a,!0),c=Math.min(c,a[0]+1),u=Math.min(u,a[1]+1);for(let h=l;h<c;h++)for(let p=g;p<u;p++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(h,p,C),!!C.overlapsRay(r)){if(e.getConvexTrianglePillar(h,p,!1),Qs.pointToWorldFrame(i,t,e.pillarOffset,Gm),this._intersectConvex(e.pillarConvex,t,Gm,s,o,SM),this.result.shouldStop)return;e.getConvexTrianglePillar(h,p,!0),Qs.pointToWorldFrame(i,t,e.pillarOffset,Gm),this._intersectConvex(e.pillarConvex,t,Gm,s,o,SM)}}}_intersectSphere(e,t,i,s,o){const r=this.from,a=this.to,l=e.radius,g=(a.x-r.x)**2+(a.y-r.y)**2+(a.z-r.z)**2,c=2*((a.x-r.x)*(r.x-i.x)+(a.y-r.y)*(r.y-i.y)+(a.z-r.z)*(r.z-i.z)),u=(r.x-i.x)**2+(r.y-i.y)**2+(r.z-i.z)**2-l**2,C=c**2-4*g*u,h=x6,p=V6;if(!(C<0))if(C===0)r.lerp(a,C,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,o,s,-1);else{const b=(-c-Math.sqrt(C))/(2*g),m=(-c+Math.sqrt(C))/(2*g);if(b>=0&&b<=1&&(r.lerp(a,b,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,o,s,-1)),this.result.shouldStop)return;m>=0&&m<=1&&(r.lerp(a,m,h),h.vsub(i,p),p.normalize(),this.reportIntersection(p,h,o,s,-1))}}_intersectConvex(e,t,i,s,o,r){const a=W6,l=RM,g=r&&r.faceList||null,c=e.faces,u=e.vertices,C=e.faceNormals,h=this.direction,p=this.from,b=this.to,m=p.distanceTo(b),A=g?g.length:c.length,B=this.result;for(let G=0;!B.shouldStop&&G<A;G++){const w=g?g[G]:G,N=c[w],M=C[w],R=t,S=i;l.copy(u[N[0]]),R.vmult(l,l),l.vadd(S,l),l.vsub(p,l),R.vmult(M,a);const F=h.dot(a);if(Math.abs(F)<this.precision)continue;const Z=a.dot(l)/F;if(!(Z<0)){h.scale(Z,Us),Us.vadd(p,Us),hr.copy(u[N[0]]),R.vmult(hr,hr),S.vadd(hr,hr);for(let x=1;!B.shouldStop&&x<N.length-1;x++){zr.copy(u[N[x]]),Dr.copy(u[N[x+1]]),R.vmult(zr,zr),R.vmult(Dr,Dr),S.vadd(zr,zr),S.vadd(Dr,Dr);const Y=Us.distanceTo(p);!(hs.pointInTriangle(Us,hr,zr,Dr)||hs.pointInTriangle(Us,zr,hr,Dr))||Y>m||this.reportIntersection(a,Us,o,s,w)}}}}_intersectTrimesh(e,t,i,s,o,r){const a=M6,l=E6,g=Y6,c=RM,u=N6,C=F6,h=H6,p=T6,b=X6,m=e.indices;e.vertices;const A=this.from,B=this.to,G=this.direction;g.position.copy(i),g.quaternion.copy(t),Qs.vectorToLocalFrame(i,t,G,u),Qs.pointToLocalFrame(i,t,A,C),Qs.pointToLocalFrame(i,t,B,h),h.x*=e.scale.x,h.y*=e.scale.y,h.z*=e.scale.z,C.x*=e.scale.x,C.y*=e.scale.y,C.z*=e.scale.z,h.vsub(C,u),u.normalize();const w=C.distanceSquared(h);e.tree.rayQuery(this,g,l);for(let N=0,M=l.length;!this.result.shouldStop&&N!==M;N++){const R=l[N];e.getNormal(R,a),e.getVertex(m[R*3],hr),hr.vsub(C,c);const S=u.dot(a),F=a.dot(c)/S;if(F<0)continue;u.scale(F,Us),Us.vadd(C,Us),e.getVertex(m[R*3+1],zr),e.getVertex(m[R*3+2],Dr);const Z=Us.distanceSquared(C);!(hs.pointInTriangle(Us,zr,hr,Dr)||hs.pointInTriangle(Us,hr,zr,Dr))||Z>w||(Qs.vectorToWorldFrame(t,a,b),Qs.pointToWorldFrame(i,t,Us,p),this.reportIntersection(b,p,o,s,R))}l.length=0}reportIntersection(e,t,i,s,o){const r=this.from,a=this.to,l=r.distanceTo(t),g=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(g.hitFaceIndex=typeof o<"u"?o:-1,this.mode){case hs.ALL:this.hasHit=!0,g.set(r,a,e,t,i,s,l),g.hasHit=!0,this.callback(g);break;case hs.CLOSEST:(l<g.distance||!g.hasHit)&&(this.hasHit=!0,g.hasHit=!0,g.set(r,a,e,t,i,s,l));break;case hs.ANY:this.hasHit=!0,g.hasHit=!0,g.set(r,a,e,t,i,s,l),g.shouldStop=!0;break}}static pointInTriangle(e,t,i,s){s.vsub(t,dc),i.vsub(t,AC),e.vsub(t,OG);const o=dc.dot(dc),r=dc.dot(AC),a=dc.dot(OG),l=AC.dot(AC),g=AC.dot(OG);let c,u;return(c=l*a-r*g)>=0&&(u=o*g-r*a)>=0&&c+u<o*l-r*r}}hs.CLOSEST=CS.CLOSEST;hs.ANY=CS.ANY;hs.ALL=CS.ALL;const ZM=new or,JG=[],AC=new J,OG=new J,w6=new J,Z6=new Fs,Us=new J,hr=new J,zr=new J,Dr=new J;new J;new T2;const SM={faceList:[0]},Gm=new J,S6=new hs,R6=[],x6=new J,V6=new J,W6=new J;new J;new J;const RM=new J,M6=new J,N6=new J,F6=new J,H6=new J,X6=new J,T6=new J;new or;const E6=[],Y6=new Qs,dc=new J,vm=new J;function K6(n,e,t){t.vsub(n,dc);const i=dc.dot(e);return e.scale(i,vm),vm.vadd(n,vm),t.distanceTo(vm)}new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new hs;new J;new J;new J;new J(1,0,0),new J(0,1,0),new J(0,0,1);new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new or;new J;new or;new J;new J;new J;new J;new J;new J;new J;new or;new J;new Qs;new or;bt.types.SPHERE,bt.types.SPHERE|bt.types.PLANE,bt.types.BOX|bt.types.BOX,bt.types.SPHERE|bt.types.BOX,bt.types.PLANE|bt.types.BOX,bt.types.CONVEXPOLYHEDRON,bt.types.SPHERE|bt.types.CONVEXPOLYHEDRON,bt.types.PLANE|bt.types.CONVEXPOLYHEDRON,bt.types.BOX|bt.types.CONVEXPOLYHEDRON,bt.types.SPHERE|bt.types.HEIGHTFIELD,bt.types.BOX|bt.types.HEIGHTFIELD,bt.types.CONVEXPOLYHEDRON|bt.types.HEIGHTFIELD,bt.types.PARTICLE|bt.types.SPHERE,bt.types.PLANE|bt.types.PARTICLE,bt.types.BOX|bt.types.PARTICLE,bt.types.PARTICLE|bt.types.CONVEXPOLYHEDRON,bt.types.CYLINDER,bt.types.SPHERE|bt.types.CYLINDER,bt.types.PLANE|bt.types.CYLINDER,bt.types.BOX|bt.types.CYLINDER,bt.types.CONVEXPOLYHEDRON|bt.types.CYLINDER,bt.types.HEIGHTFIELD|bt.types.CYLINDER,bt.types.PARTICLE|bt.types.CYLINDER,bt.types.SPHERE|bt.types.TRIMESH,bt.types.PLANE|bt.types.TRIMESH;new J;new J;new J;new J;new J;new Fs;new Fs;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new or;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J,new J,new J,new J,new J,new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new J;new Fs;new J;new J;new J;new J;new J;new J;new J;new J;new J;new or;new hs;const pC=globalThis.performance||{};if(!pC.now){let n=Date.now();pC.timing&&pC.timing.navigationStart&&(n=pC.timing.navigationStart),pC.now=()=>Date.now()-n}new J;const _6=z.createContext(null),L6=()=>z.useContext(_6),fY=z.createContext(null),bY=()=>{const n=z.useContext(fY);if(!n)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return n};new _(1,1,1);new _;new ct;const xM=new Lt;function yY(n){const e=z.useRef(null);return n&&typeof n!="function"?n:e}function VM(n){return n.charAt(0).toUpperCase()+n.slice(1)}function qn(n,e){const t=e===void 0?"":`/${e}`;return typeof n=="function"?null:n&&n.current&&`${n.current.uuid}${t}`}const k6=new Gs,z6=new ii,D6=n=>e=>n(k6.setFromQuaternion(z6.fromArray(e)).toArray());let BY=0;function nf(n,e,t,i,s,o){return o===void 0&&(o="bodies"),r=>{const a=BY++;t[a]={[i]:r};const l=qn(n,s);return l&&e.subscribe({props:{id:a,target:o,type:i},uuid:l}),()=>{delete t[a],e.unsubscribe({props:a})}}}function WM(n,e){let{position:t=[0,0,0],rotation:i=[0,0,0],userData:s={}}=e;n.userData=s,n.position.set(...t),n.rotation.set(...i),n.updateMatrix()}function MM(n,e,t){let{onCollide:i,onCollideBegin:s,onCollideEnd:o}=e;n[t]={collide:i,collideBegin:s,collideEnd:o}}function ty(n,e,t,i,s){i===void 0&&(i=null),s===void 0&&(s=[]);const o=yY(i),{events:r,refs:a,scaleOverrides:l,subscriptions:g,worker:c}=bY(),u=L6();z.useLayoutEffect(()=>{o.current||(o.current=new Lt);const h=o.current,p=c,b=h instanceof Jl?(h.instanceMatrix.setUsage(Ul),h.count):1,m=h instanceof Jl?new Array(b).fill(0).map((B,G)=>`${h.uuid}/${G}`):[h.uuid],A=h instanceof Jl?m.map((B,G)=>{const w=e(G);return WM(xM,w),h.setMatrixAt(G,xM.matrix),h.instanceMatrix.needsUpdate=!0,a[B]=h,u==null||u.add(B,w,n),MM(r,w,B),{...w,args:t(w.args)}}):m.map((B,G)=>{const w=e(G);return WM(h,w),a[B]=h,u==null||u.add(B,w,n),MM(r,w,B),{...w,args:t(w.args)}});return p.addBodies({props:A.map(B=>{let{onCollide:G,onCollideBegin:w,onCollideEnd:N,...M}=B;return{onCollide:!!G,...M}}),type:n,uuid:m}),()=>{m.forEach(B=>{delete a[B],u==null||u.remove(B),delete r[B]}),p.removeBodies({uuid:m})}},s);const C=z.useMemo(()=>{const h=(G,w)=>{const N=`set${VM(G)}`;return{set:M=>{const R=qn(o,w);R&&c[N]({props:M,uuid:R})},subscribe:nf(o,c,g,G,w)}},p=G=>({copy:N=>{let{w:M,x:R,y:S,z:F}=N;const Z=qn(o,G);Z&&c.setQuaternion({props:[R,S,F,M],uuid:Z})},set:(N,M,R,S)=>{const F=qn(o,G);F&&c.setQuaternion({props:[N,M,R,S],uuid:F})},subscribe:nf(o,c,g,"quaternion",G)}),b=G=>({copy:w=>{let{x:N,y:M,z:R}=w;const S=qn(o,G);S&&c.setRotation({props:[N,M,R],uuid:S})},set:(w,N,M)=>{const R=qn(o,G);R&&c.setRotation({props:[w,N,M],uuid:R})},subscribe:w=>{const N=BY++,M="bodies",R="quaternion",S=qn(o,G);return g[N]={[R]:D6(w)},S&&c.subscribe({props:{id:N,target:M,type:R},uuid:S}),()=>{delete g[N],c.unsubscribe({props:N})}}}),m=(G,w)=>{const N=`set${VM(G)}`;return{copy:M=>{let{x:R,y:S,z:F}=M;const Z=qn(o,w);Z&&c[N]({props:[R,S,F],uuid:Z})},set:(M,R,S)=>{const F=qn(o,w);F&&c[N]({props:[M,R,S],uuid:F})},subscribe:nf(o,c,g,G,w)}};function A(G){return{allowSleep:h("allowSleep",G),angularDamping:h("angularDamping",G),angularFactor:m("angularFactor",G),angularVelocity:m("angularVelocity",G),applyForce(w,N){const M=qn(o,G);M&&c.applyForce({props:[w,N],uuid:M})},applyImpulse(w,N){const M=qn(o,G);M&&c.applyImpulse({props:[w,N],uuid:M})},applyLocalForce(w,N){const M=qn(o,G);M&&c.applyLocalForce({props:[w,N],uuid:M})},applyLocalImpulse(w,N){const M=qn(o,G);M&&c.applyLocalImpulse({props:[w,N],uuid:M})},applyTorque(w){const N=qn(o,G);N&&c.applyTorque({props:[w],uuid:N})},collisionFilterGroup:h("collisionFilterGroup",G),collisionFilterMask:h("collisionFilterMask",G),collisionResponse:h("collisionResponse",G),fixedRotation:h("fixedRotation",G),isTrigger:h("isTrigger",G),linearDamping:h("linearDamping",G),linearFactor:m("linearFactor",G),mass:h("mass",G),material:h("material",G),position:m("position",G),quaternion:p(G),rotation:b(G),scaleOverride(w){const N=qn(o,G);N&&(l[N]=new _(...w))},sleep(){const w=qn(o,G);w&&c.sleep({uuid:w})},sleepSpeedLimit:h("sleepSpeedLimit",G),sleepTimeLimit:h("sleepTimeLimit",G),userData:h("userData",G),velocity:m("velocity",G),wakeUp(){const w=qn(o,G);w&&c.wakeUp({uuid:w})}}}const B={};return{...A(void 0),at:G=>B[G]||(B[G]=A(G))}},[]);return[o,C]}function P6(n,e,t){return ty("Plane",n,()=>[],e,t)}function GY(n,e,t){const i=[1,1,1];return ty("Box",n,function(s){return s===void 0&&(s=i),s},e,t)}function hS(n,e,t){return ty("Trimesh",n,i=>i,e,t)}function wm(n,e,t){return ty("Compound",n,i=>i,e,t)}function U6(n){return typeof n=="string"}function J6(n,e,t){e===void 0&&(e=null),t===void 0&&(t=[]);const i=yY(e),{worker:s,subscriptions:o}=bY();z.useLayoutEffect(()=>{i.current||(i.current=new Lt);const a=s,l=i.current.uuid,{chassisBody:g,indexForwardAxis:c=2,indexRightAxis:u=0,indexUpAxis:C=1,wheelInfos:h,wheels:p}=n(),b=qn(g),m=p.map(A=>qn(A));if(!(!b||!m.every(U6)))return a.addRaycastVehicle({props:[b,m,h,c,u,C],uuid:l}),()=>{a.removeRaycastVehicle({uuid:l})}},t);const r=z.useMemo(()=>({applyEngineForce(a,l){const g=qn(i);g&&s.applyRaycastVehicleEngineForce({props:[a,l],uuid:g})},setBrake(a,l){const g=qn(i);g&&s.setRaycastVehicleBrake({props:[a,l],uuid:g})},setSteeringValue(a,l){const g=qn(i);g&&s.setRaycastVehicleSteeringValue({props:[a,l],uuid:g})},sliding:{subscribe:nf(i,s,o,"sliding",void 0,"vehicles")}}),t);return[i,r]}const O6=new _,Q6=new _(1,1,1),j6=new ii,Zm=new ct;function NM(n,e,t,i,s){return i===void 0&&(i=Q6),n!==void 0?(Zm.compose(O6.fromArray(e,n*3),j6.fromArray(t,n*4),i),s&&(s.matrixAutoUpdate=!1,s.matrix.copy(Zm)),Zm):Zm.identity()}const q6=()=>{const n=[];return e=>n.includes(e)?!1:!!n.push(e)};function $6(n){let{allowSleep:e=!1,axisIndex:t=0,broadphase:i="Naive",children:s,defaultContactMaterial:o={contactEquationStiffness:1e6},frictionGravity:r=null,gravity:a=[0,-9.81,0],isPaused:l=!1,iterations:g=5,maxSubSteps:c=10,quatNormalizeFast:u=!1,quatNormalizeSkip:C=0,shouldInvalidate:h=!0,size:p=1e3,solver:b="GS",stepSize:m=1/60,tolerance:A=.001}=n;const{invalidate:B}=ei(),[{bodies:G,events:w,refs:N,scaleOverrides:M,subscriptions:R,worker:S}]=z.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new Q8({allowSleep:e,axisIndex:t,broadphase:i,defaultContactMaterial:o,frictionGravity:r,gravity:a,iterations:g,quatNormalizeFast:u,quatNormalizeSkip:C,size:p,solver:b,tolerance:A})}));let F=0;const Z=z.useCallback((Ie,k)=>{l||(F+=k,S.step({maxSubSteps:c,stepSize:m,timeSinceLastCalled:F}),F=0)},[l,c,m]),x=Ie=>{var k;let{body:ee,contact:{bi:$,bj:ae,...be},target:me,...ce}=Ie;const Be=(k=w[me])==null?void 0:k.collide;Be&&Be({body:N[ee],contact:{bi:N[$],bj:N[ae],...be},target:N[me],...ce})},Y=Ie=>{var k,ee;let{bodyA:$,bodyB:ae}=Ie;const be=(k=w[$])==null?void 0:k.collideBegin;be&&be({body:N[ae],op:"event",target:N[$],type:"collideBegin"});const me=(ee=w[ae])==null?void 0:ee.collideBegin;me&&me({body:N[$],op:"event",target:N[ae],type:"collideBegin"})},T=Ie=>{var k,ee;let{bodyA:$,bodyB:ae}=Ie;const be=(k=w[$])==null?void 0:k.collideEnd;be&&be({body:N[ae],op:"event",target:N[$],type:"collideEnd"});const me=(ee=w[ae])==null?void 0:ee.collideEnd;me&&me({body:N[$],op:"event",target:N[ae],type:"collideEnd"})},ne=Ie=>{let{active:k,bodies:ee=[],observations:$,positions:ae,quaternions:be}=Ie;for(let me=0;me<ee.length;me++)G[ee[me]]=me;if($.forEach(me=>{let[ce,Be,He]=me;const Ct=(R[ce]||{})[He];Ct&&Ct(Be)}),!!k){for(const me of Object.values(N).filter(q6()))if(me instanceof Jl)for(let ce=0;ce<me.count;ce++){const Be=`${me.uuid}/${ce}`,He=G[Be];He!==void 0&&(me.setMatrixAt(ce,NM(He,ae,be,M[Be])),me.instanceMatrix.needsUpdate=!0)}else{const ce=M[me.uuid]||me.scale;NM(G[me.uuid],ae,be,ce,me)}h&&B()}},ue=Ie=>{var k;let{body:ee,ray:{uuid:$,...ae},...be}=Ie;const me=(k=w[$])==null?void 0:k.rayhit;me&&me({body:ee?N[ee]:null,ray:{uuid:$,...ae},...be})};ga(Z),z.useEffect(()=>(S.connect(),S.init(),S.on("collide",x),S.on("collideBegin",Y),S.on("collideEnd",T),S.on("frame",ne),S.on("rayhit",ue),()=>{S.terminate(),S.removeAllListeners()}),[]),z.useEffect(()=>{S.axisIndex=t},[t]),z.useEffect(()=>{S.broadphase=i},[i]),z.useEffect(()=>{S.gravity=a},[a]),z.useEffect(()=>{S.iterations=g},[g]),z.useEffect(()=>{S.tolerance=A},[A]);const se=z.useMemo(()=>({bodies:G,events:w,refs:N,scaleOverrides:M,subscriptions:R,worker:S}),[G,w,N,R,S]);return j.jsx(fY.Provider,{value:se,children:s})}function FM(n,e){if(e===WZ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===Uc||e===sA){let t=n.getIndex();if(t===null){const r=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)r.push(l);n.setIndex(r),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,s=[];if(e===Uc)for(let r=1;r<=i;r++)s.push(t.getX(0)),s.push(t.getX(r)),s.push(t.getX(r+1));else for(let r=0;r<i;r++)r%2===0?(s.push(t.getX(r)),s.push(t.getX(r+1)),s.push(t.getX(r+2))):(s.push(t.getX(r+2)),s.push(t.getX(r+1)),s.push(t.getX(r)));s.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=n.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class ny extends qi{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new sq(t)}),this.register(function(t){return new oq(t)}),this.register(function(t){return new Cq(t)}),this.register(function(t){return new hq(t)}),this.register(function(t){return new Aq(t)}),this.register(function(t){return new aq(t)}),this.register(function(t){return new lq(t)}),this.register(function(t){return new gq(t)}),this.register(function(t){return new cq(t)}),this.register(function(t){return new iq(t)}),this.register(function(t){return new uq(t)}),this.register(function(t){return new rq(t)}),this.register(function(t){return new dq(t)}),this.register(function(t){return new Iq(t)}),this.register(function(t){return new tq(t)}),this.register(function(t){return new pq(t)}),this.register(function(t){return new mq(t)})}load(e,t,i,s){const o=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const g=vo.extractUrlBase(e);r=vo.resolveURL(g,this.path)}else r=vo.extractUrlBase(e);this.manager.itemStart(e);const a=function(g){s?s(g):console.error(g),o.manager.itemError(e),o.manager.itemEnd(e)},l=new Ks(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(g){try{o.parse(g,r,function(c){t(c),o.manager.itemEnd(e)},a)}catch(c){a(c)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,s){let o;const r={},a={},l=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===vY){try{r[jt.KHR_BINARY_GLTF]=new fq(e)}catch(u){s&&s(u);return}o=JSON.parse(r[jt.KHR_BINARY_GLTF].content)}else o=JSON.parse(l.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const g=new Mq(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});g.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](g);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,r[u.name]=!0}if(o.extensionsUsed)for(let c=0;c<o.extensionsUsed.length;++c){const u=o.extensionsUsed[c],C=o.extensionsRequired||[];switch(u){case jt.KHR_MATERIALS_UNLIT:r[u]=new nq;break;case jt.KHR_DRACO_MESH_COMPRESSION:r[u]=new bq(o,this.dracoLoader);break;case jt.KHR_TEXTURE_TRANSFORM:r[u]=new yq;break;case jt.KHR_MESH_QUANTIZATION:r[u]=new Bq;break;default:C.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}g.setExtensions(r),g.setPlugins(a),g.parse(i,s)}parseAsync(e,t){const i=this;return new Promise(function(s,o){i.parse(e,t,s,o)})}}function eq(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const jt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class tq{constructor(e){this.parser=e,this.name=jt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,s=t.length;i<s;i++){const o=t[i];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let s=t.cache.get(i);if(s)return s;const o=t.json,l=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let g;const c=new Pe(16777215);l.color!==void 0&&c.setRGB(l.color[0],l.color[1],l.color[2],Ei);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":g=new Jb(c),g.target.position.set(0,0,-1),g.add(g.target);break;case"point":g=new Ub(c),g.distance=u;break;case"spot":g=new Pb(c),g.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,g.angle=l.spot.outerConeAngle,g.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,g.target.position.set(0,0,-1),g.add(g.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return g.position.set(0,0,0),g.decay=2,Sa(g,l),l.intensity!==void 0&&(g.intensity=l.intensity),g.name=t.createUniqueName(l.name||"light_"+e),s=Promise.resolve(g),t.cache.add(i,s),s}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,o=i.json.nodes[e],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return i._getNodeRef(t.cache,a,l)})}}class nq{constructor(){this.name=jt.KHR_MATERIALS_UNLIT}getMaterialType(){return Hi}extendParams(e,t,i){const s=[];e.color=new Pe(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const r=o.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],Ei),e.opacity=r[3]}o.baseColorTexture!==void 0&&s.push(i.assignTexture(e,"map",o.baseColorTexture,Di))}return Promise.all(s)}}class iq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class sq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(o.push(i.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new ye(a,a)}return Promise.all(o)}}class oq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class rq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&o.push(i.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(o)}}class aq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new Pe(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=s.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],Ei)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&o.push(i.assignTexture(t,"sheenColorMap",r.sheenColorTexture,Di)),r.sheenRoughnessTexture!==void 0&&o.push(i.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(o)}}class lq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&o.push(i.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)}}class gq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&o.push(i.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new Pe().setRGB(a[0],a[1],a[2],Ei),Promise.all(o)}}class cq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class uq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&o.push(i.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new Pe().setRGB(a[0],a[1],a[2],Ei),r.specularColorTexture!==void 0&&o.push(i.assignTexture(t,"specularColorMap",r.specularColorTexture,Di)),Promise.all(o)}}class Iq{constructor(e){this.parser=e,this.name=jt.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&o.push(i.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(o)}}class dq{constructor(e){this.parser=e,this.name=jt.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:oi}extendMaterialParams(e,t){const i=this.parser,s=i.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],r=s.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&o.push(i.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(o)}}class Cq{constructor(e){this.parser=e,this.name=jt.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,s=i.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,r)}}class hq{constructor(e){this.parser=e,this.name=jt.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=s.images[r.source];let l=i.textureLoader;if(a.uri){const g=i.options.manager.getHandler(a.uri);g!==null&&(l=g)}return this.detectSupport().then(function(g){if(g)return i.loadTextureImage(e,r.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Aq{constructor(e){this.parser=e,this.name=jt.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,s=i.json,o=s.textures[e];if(!o.extensions||!o.extensions[t])return null;const r=o.extensions[t],a=s.images[r.source];let l=i.textureLoader;if(a.uri){const g=i.options.manager.getHandler(a.uri);g!==null&&(l=g)}return this.detectSupport().then(function(g){if(g)return i.loadTextureImage(e,r.source,l);if(s.extensionsRequired&&s.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class pq{constructor(e){this.name=jt.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(a){const l=s.byteOffset||0,g=s.byteLength||0,c=s.count,u=s.byteStride,C=new Uint8Array(a,l,g);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(c,u,C,s.mode,s.filter).then(function(h){return h.buffer}):r.ready.then(function(){const h=new ArrayBuffer(c*u);return r.decodeGltfBuffer(new Uint8Array(h),c,u,C,s.mode,s.filter),h})})}else return null}}class mq{constructor(e){this.name=jt.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=t.meshes[i.mesh];for(const g of s.primitives)if(g.mode!==Po.TRIANGLES&&g.mode!==Po.TRIANGLE_STRIP&&g.mode!==Po.TRIANGLE_FAN&&g.mode!==void 0)return null;const r=i.extensions[this.name].attributes,a=[],l={};for(const g in r)a.push(this.parser.getDependency("accessor",r[g]).then(c=>(l[g]=c,l[g])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(g=>{const c=g.pop(),u=c.isGroup?c.children:[c],C=g[0].count,h=[];for(const p of u){const b=new ct,m=new _,A=new ii,B=new _(1,1,1),G=new Jl(p.geometry,p.material,C);for(let w=0;w<C;w++)l.TRANSLATION&&m.fromBufferAttribute(l.TRANSLATION,w),l.ROTATION&&A.fromBufferAttribute(l.ROTATION,w),l.SCALE&&B.fromBufferAttribute(l.SCALE,w),G.setMatrixAt(w,b.compose(m,A,B));for(const w in l)if(w==="_COLOR_0"){const N=l[w];G.instanceColor=new ng(N.array,N.itemSize,N.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&p.geometry.setAttribute(w,l[w]);Lt.prototype.copy.call(G,p),this.parser.assignFinalMaterial(G),h.push(G)}return c.isGroup?(c.clear(),c.add(...h),c):h[0]}))}}const vY="glTF",mC=12,HM={JSON:1313821514,BIN:5130562};class fq{constructor(e){this.name=jt.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,mC),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==vY)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-mC,o=new DataView(e,mC);let r=0;for(;r<s;){const a=o.getUint32(r,!0);r+=4;const l=o.getUint32(r,!0);if(r+=4,l===HM.JSON){const g=new Uint8Array(e,mC+r,a);this.content=i.decode(g)}else if(l===HM.BIN){const g=mC+r;this.body=e.slice(g,g+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class bq{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=jt.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,s=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},l={},g={};for(const c in r){const u=E2[c]||c.toLowerCase();a[u]=r[c]}for(const c in e.attributes){const u=E2[c]||c.toLowerCase();if(r[c]!==void 0){const C=i.accessors[e.attributes[c]],h=NI[C.componentType];g[u]=h.name,l[u]=C.normalized===!0}}return t.getDependency("bufferView",o).then(function(c){return new Promise(function(u,C){s.decodeDracoFile(c,function(h){for(const p in h.attributes){const b=h.attributes[p],m=l[p];m!==void 0&&(b.normalized=m)}u(h)},a,g,Ei,C)})})}}class yq{constructor(){this.name=jt.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Bq{constructor(){this.name=jt.KHR_MESH_QUANTIZATION}}class wY extends su{constructor(e,t,i,s){super(e,t,i,s)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,s=this.valueSize,o=e*s*3+s;for(let r=0;r!==s;r++)t[r]=i[o+r];return t}interpolate_(e,t,i,s){const o=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=a*2,g=a*3,c=s-t,u=(i-t)/c,C=u*u,h=C*u,p=e*g,b=p-g,m=-2*h+3*C,A=h-C,B=1-m,G=A-C+u;for(let w=0;w!==a;w++){const N=r[b+w+a],M=r[b+w+l]*c,R=r[p+w+a],S=r[p+w]*c;o[w]=B*N+G*M+m*R+A*S}return o}}const Gq=new ii;class vq extends wY{interpolate_(e,t,i,s){const o=super.interpolate_(e,t,i,s);return Gq.fromArray(o).normalize().toArray(o),o}}const Po={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},NI={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XM={9728:Bi,9729:fn,9984:nA,9985:xc,9986:Tl,9987:no},TM={33071:to,33648:Lc,10497:xr},QG={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E2={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Zl={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},wq={CUBICSPLINE:void 0,LINEAR:tg,STEP:Pc},jG={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Zq(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new hg({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Rr})),n.DefaultMaterial}function ec(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Sa(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Sq(n,e,t){let i=!1,s=!1,o=!1;for(let g=0,c=e.length;g<c;g++){const u=e[g];if(u.POSITION!==void 0&&(i=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(o=!0),i&&s&&o)break}if(!i&&!s&&!o)return Promise.resolve(n);const r=[],a=[],l=[];for(let g=0,c=e.length;g<c;g++){const u=e[g];if(i){const C=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):n.attributes.position;r.push(C)}if(s){const C=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(C)}if(o){const C=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):n.attributes.color;l.push(C)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l)]).then(function(g){const c=g[0],u=g[1],C=g[2];return i&&(n.morphAttributes.position=c),s&&(n.morphAttributes.normal=u),o&&(n.morphAttributes.color=C),n.morphTargetsRelative=!0,n})}function Rq(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,s=t.length;i<s;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function xq(n){let e;const t=n.extensions&&n.extensions[jt.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+qG(t.attributes):e=n.indices+":"+qG(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,s=n.targets.length;i<s;i++)e+=":"+qG(n.targets[i]);return e}function qG(n){let e="";const t=Object.keys(n).sort();for(let i=0,s=t.length;i<s;i++)e+=t[i]+":"+n[t[i]]+";";return e}function Y2(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Vq(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Wq=new ct;class Mq{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new eq,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,o=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);s=i&&l?parseInt(l[1],10):-1,o=a.indexOf("Firefox")>-1,r=o?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||o&&r<98?this.textureLoader=new au(this.options.manager):this.textureLoader=new eS(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ks(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,s=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(r){const a={scene:r[0][s.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:s.asset,parser:i,userData:{}};return ec(o,a,s),Sa(a,s),Promise.all(i._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let s=0,o=t.length;s<o;s++){const r=t[s].joints;for(let a=0,l=r.length;a<l;a++)e[r[a]].isBone=!0}for(let s=0,o=e.length;s<o;s++){const r=e[s];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(i[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const s=i.clone(),o=(r,a)=>{const l=this.associations.get(r);l!=null&&this.associations.set(a,l);for(const[g,c]of r.children.entries())o(c,a.children[g])};return o(i,s),s.name+="_instance_"+e.uses[t]++,s}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const s=e(t[i]);if(s)return s}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let s=0;s<t.length;s++){const o=e(t[s]);o&&i.push(o)}return i}getDependency(e,t){const i=e+":"+t;let s=this.cache.get(i);if(!s){switch(e){case"scene":s=this.loadScene(t);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":s=this.loadAccessor(t);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":s=this.loadBuffer(t);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":s=this.loadSkin(t);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":s=this.loadCamera(t);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(i,s)}return s}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(s.map(function(o,r){return i.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[jt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,r){i.load(vo.resolveURL(t.uri,s.path),o,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const s=t.byteLength||0,o=t.byteOffset||0;return i.slice(o,o+s)})}loadAccessor(e){const t=this,i=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const r=QG[s.type],a=NI[s.componentType],l=s.normalized===!0,g=new a(s.count*r);return Promise.resolve(new Pt(g,r,l))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(r){const a=r[0],l=QG[s.type],g=NI[s.componentType],c=g.BYTES_PER_ELEMENT,u=c*l,C=s.byteOffset||0,h=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,p=s.normalized===!0;let b,m;if(h&&h!==u){const A=Math.floor(C/h),B="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+A+":"+s.count;let G=t.cache.get(B);G||(b=new g(a,A*h,s.count*h/c),G=new gd(b,h/c),t.cache.add(B,G)),m=new ja(G,l,C%h/c,p)}else a===null?b=new g(s.count*l):b=new g(a,C,s.count*l),m=new Pt(b,l,p);if(s.sparse!==void 0){const A=QG.SCALAR,B=NI[s.sparse.indices.componentType],G=s.sparse.indices.byteOffset||0,w=s.sparse.values.byteOffset||0,N=new B(r[1],G,s.sparse.count*A),M=new g(r[2],w,s.sparse.count*l);a!==null&&(m=new Pt(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let R=0,S=N.length;R<S;R++){const F=N[R];if(m.setX(F,M[R*l]),l>=2&&m.setY(F,M[R*l+1]),l>=3&&m.setZ(F,M[R*l+2]),l>=4&&m.setW(F,M[R*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=p}return m})}loadTexture(e){const t=this.json,i=this.options,o=t.textures[e].source,r=t.images[o];let a=this.textureLoader;if(r.uri){const l=i.manager.getHandler(r.uri);l!==null&&(a=l)}return this.loadTextureImage(e,o,a)}loadTextureImage(e,t,i){const s=this,o=this.json,r=o.textures[e],a=o.images[t],l=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const g=this.loadImageSource(t,i).then(function(c){c.flipY=!1,c.name=r.name||a.name||"",c.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(c.name=a.uri);const C=(o.samplers||{})[r.sampler]||{};return c.magFilter=XM[C.magFilter]||fn,c.minFilter=XM[C.minFilter]||no,c.wrapS=TM[C.wrapS]||xr,c.wrapT=TM[C.wrapT]||xr,s.associations.set(c,{textures:e}),c}).catch(function(){return null});return this.textureCache[l]=g,g}loadImageSource(e,t){const i=this,s=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=s.images[e],a=self.URL||self.webkitURL;let l=r.uri||"",g=!1;if(r.bufferView!==void 0)l=i.getDependency("bufferView",r.bufferView).then(function(u){g=!0;const C=new Blob([u],{type:r.mimeType});return l=a.createObjectURL(C),l});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(l).then(function(u){return new Promise(function(C,h){let p=C;t.isImageBitmapLoader===!0&&(p=function(b){const m=new Bn(b);m.needsUpdate=!0,C(m)}),t.load(vo.resolveURL(u,o.path),p,void 0,h)})}).then(function(u){return g===!0&&a.revokeObjectURL(l),Sa(u,r),u.userData.mimeType=r.mimeType||Vq(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=c,c}assignTexture(e,t,i,s){const o=this;return this.getDependency("texture",i.index).then(function(r){if(!r)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(r=r.clone(),r.channel=i.texCoord),o.extensions[jt.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[jt.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=o.associations.get(r);r=o.extensions[jt.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),o.associations.set(r,l)}}return s!==void 0&&(r.colorSpace=s),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const s=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new ud,Un.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,l.sizeAttenuation=!1,this.cache.add(a,l)),i=l}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let l=this.cache.get(a);l||(l=new ji,Un.prototype.copy.call(l,i),l.color.copy(i.color),l.map=i.map,this.cache.add(a,l)),i=l}if(s||o||r){let a="ClonedMaterial:"+i.uuid+":";s&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=i.clone(),o&&(l.vertexColors=!0),r&&(l.flatShading=!0),s&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(i))),i=l}e.material=i}getMaterialType(){return hg}loadMaterial(e){const t=this,i=this.json,s=this.extensions,o=i.materials[e];let r;const a={},l=o.extensions||{},g=[];if(l[jt.KHR_MATERIALS_UNLIT]){const u=s[jt.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),g.push(u.extendParams(a,o,t))}else{const u=o.pbrMetallicRoughness||{};if(a.color=new Pe(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const C=u.baseColorFactor;a.color.setRGB(C[0],C[1],C[2],Ei),a.opacity=C[3]}u.baseColorTexture!==void 0&&g.push(t.assignTexture(a,"map",u.baseColorTexture,Di)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(g.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),g.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(C){return C.getMaterialType&&C.getMaterialType(e)}),g.push(Promise.all(this._invokeAll(function(C){return C.extendMaterialParams&&C.extendMaterialParams(e,a)})))}o.doubleSided===!0&&(a.side=bo);const c=o.alphaMode||jG.OPAQUE;if(c===jG.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,c===jG.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&r!==Hi&&(g.push(t.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new ye(1,1),o.normalTexture.scale!==void 0)){const u=o.normalTexture.scale;a.normalScale.set(u,u)}if(o.occlusionTexture!==void 0&&r!==Hi&&(g.push(t.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&r!==Hi){const u=o.emissiveFactor;a.emissive=new Pe().setRGB(u[0],u[1],u[2],Ei)}return o.emissiveTexture!==void 0&&r!==Hi&&g.push(t.assignTexture(a,"emissiveMap",o.emissiveTexture,Di)),Promise.all(g).then(function(){const u=new r(a);return o.name&&(u.name=o.name),Sa(u,o),t.associations.set(u,{materials:e}),o.extensions&&ec(s,u,o),u})}createUniqueName(e){const t=on.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,s=this.primitiveCache;function o(a){return i[jt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return EM(l,a,t)})}const r=[];for(let a=0,l=e.length;a<l;a++){const g=e[a],c=xq(g),u=s[c];if(u)r.push(u.promise);else{let C;g.extensions&&g.extensions[jt.KHR_DRACO_MESH_COMPRESSION]?C=o(g):C=EM(new Mt,g,t),s[c]={primitive:g,promise:C},r.push(C)}}return Promise.all(r)}loadMesh(e){const t=this,i=this.json,s=this.extensions,o=i.meshes[e],r=o.primitives,a=[];for(let l=0,g=r.length;l<g;l++){const c=r[l].material===void 0?Zq(this.cache):this.getDependency("material",r[l].material);a.push(c)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(l){const g=l.slice(0,l.length-1),c=l[l.length-1],u=[];for(let h=0,p=c.length;h<p;h++){const b=c[h],m=r[h];let A;const B=g[h];if(m.mode===Po.TRIANGLES||m.mode===Po.TRIANGLE_STRIP||m.mode===Po.TRIANGLE_FAN||m.mode===void 0)A=o.isSkinnedMesh===!0?new Rb(b,B):new _n(b,B),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),m.mode===Po.TRIANGLE_STRIP?A.geometry=FM(A.geometry,sA):m.mode===Po.TRIANGLE_FAN&&(A.geometry=FM(A.geometry,Uc));else if(m.mode===Po.LINES)A=new ir(b,B);else if(m.mode===Po.LINE_STRIP)A=new ra(b,B);else if(m.mode===Po.LINE_LOOP)A=new xb(b,B);else if(m.mode===Po.POINTS)A=new Vb(b,B);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(A.geometry.morphAttributes).length>0&&Rq(A,o),A.name=t.createUniqueName(o.name||"mesh_"+e),Sa(A,o),m.extensions&&ec(s,A,m),t.assignFinalMaterial(A),u.push(A)}for(let h=0,p=u.length;h<p;h++)t.associations.set(u[h],{meshes:e,primitives:h});if(u.length===1)return o.extensions&&ec(s,u[0],o),u[0];const C=new Qo;o.extensions&&ec(s,C,o),t.associations.set(C,{meshes:e});for(let h=0,p=u.length;h<p;h++)C.add(u[h]);return C})}loadCamera(e){let t;const i=this.json.cameras[e],s=i[i.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Wn(Gb.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(t=new qo(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Sa(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let s=0,o=t.joints.length;s<o;s++)i.push(this._loadNodeShallow(t.joints[s]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const o=s.pop(),r=s,a=[],l=[];for(let g=0,c=r.length;g<c;g++){const u=r[g];if(u){a.push(u);const C=new ct;o!==null&&C.fromArray(o.array,g*16),l.push(C)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[g])}return new cd(a,l)})}loadAnimation(e){const t=this.json,i=this,s=t.animations[e],o=s.name?s.name:"animation_"+e,r=[],a=[],l=[],g=[],c=[];for(let u=0,C=s.channels.length;u<C;u++){const h=s.channels[u],p=s.samplers[h.sampler],b=h.target,m=b.node,A=s.parameters!==void 0?s.parameters[p.input]:p.input,B=s.parameters!==void 0?s.parameters[p.output]:p.output;b.node!==void 0&&(r.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",A)),l.push(this.getDependency("accessor",B)),g.push(p),c.push(b))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l),Promise.all(g),Promise.all(c)]).then(function(u){const C=u[0],h=u[1],p=u[2],b=u[3],m=u[4],A=[];for(let B=0,G=C.length;B<G;B++){const w=C[B],N=h[B],M=p[B],R=b[B],S=m[B];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const F=i._createAnimationTracks(w,N,M,R,S);if(F)for(let Z=0;Z<F.length;Z++)A.push(F[Z])}return new Oc(o,void 0,A)})}createNodeMesh(e){const t=this.json,i=this,s=t.nodes[e];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(o){const r=i._getNodeRef(i.meshCache,s.mesh,o);return s.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let l=0,g=s.weights.length;l<g;l++)a.morphTargetInfluences[l]=s.weights[l]}),r})}loadNode(e){const t=this.json,i=this,s=t.nodes[e],o=i._loadNodeShallow(e),r=[],a=s.children||[];for(let g=0,c=a.length;g<c;g++)r.push(i.getDependency("node",a[g]));const l=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([o,Promise.all(r),l]).then(function(g){const c=g[0],u=g[1],C=g[2];C!==null&&c.traverse(function(h){h.isSkinnedMesh&&h.bind(C,Wq)});for(let h=0,p=u.length;h<p;h++)c.add(u[h]);return c})}_loadNodeShallow(e){const t=this.json,i=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],r=o.name?s.createUniqueName(o.name):"",a=[],l=s._invokeOne(function(g){return g.createNodeMesh&&g.createNodeMesh(e)});return l&&a.push(l),o.camera!==void 0&&a.push(s.getDependency("camera",o.camera).then(function(g){return s._getNodeRef(s.cameraCache,o.camera,g)})),s._invokeAll(function(g){return g.createNodeAttachment&&g.createNodeAttachment(e)}).forEach(function(g){a.push(g)}),this.nodeCache[e]=Promise.all(a).then(function(g){let c;if(o.isBone===!0?c=new gA:g.length>1?c=new Qo:g.length===1?c=g[0]:c=new Lt,c!==g[0])for(let u=0,C=g.length;u<C;u++)c.add(g[u]);if(o.name&&(c.userData.name=o.name,c.name=r),Sa(c,o),o.extensions&&ec(i,c,o),o.matrix!==void 0){const u=new ct;u.fromArray(o.matrix),c.applyMatrix4(u)}else o.translation!==void 0&&c.position.fromArray(o.translation),o.rotation!==void 0&&c.quaternion.fromArray(o.rotation),o.scale!==void 0&&c.scale.fromArray(o.scale);return s.associations.has(c)||s.associations.set(c,{}),s.associations.get(c).nodes=e,c}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],s=this,o=new Qo;i.name&&(o.name=s.createUniqueName(i.name)),Sa(o,i),i.extensions&&ec(t,o,i);const r=i.nodes||[],a=[];for(let l=0,g=r.length;l<g;l++)a.push(s.getDependency("node",r[l]));return Promise.all(a).then(function(l){for(let c=0,u=l.length;c<u;c++)o.add(l[c]);const g=c=>{const u=new Map;for(const[C,h]of s.associations)(C instanceof Un||C instanceof Bn)&&u.set(C,h);return c.traverse(C=>{const h=s.associations.get(C);h!=null&&u.set(C,h)}),u};return s.associations=g(o),o})}_createAnimationTracks(e,t,i,s,o){const r=[],a=e.name?e.name:e.uuid,l=[];Zl[o.path]===Zl.weights?e.traverse(function(C){C.morphTargetInfluences&&l.push(C.name?C.name:C.uuid)}):l.push(a);let g;switch(Zl[o.path]){case Zl.weights:g=qa;break;case Zl.rotation:g=$a;break;case Zl.position:case Zl.scale:g=el;break;default:switch(i.itemSize){case 1:g=qa;break;case 2:case 3:default:g=el;break}break}const c=s.interpolation!==void 0?wq[s.interpolation]:tg,u=this._getArrayFromAccessor(i);for(let C=0,h=l.length;C<h;C++){const p=new g(l[C]+"."+Zl[o.path],t.array,u,c);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),r.push(p)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=Y2(t.constructor),s=new Float32Array(t.length);for(let o=0,r=t.length;o<r;o++)s[o]=t[o]*i;t=s}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const s=this instanceof $a?vq:wY;return new s(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Nq(n,e,t){const i=e.attributes,s=new Ji;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],l=a.min,g=a.max;if(l!==void 0&&g!==void 0){if(s.set(new _(l[0],l[1],l[2]),new _(g[0],g[1],g[2])),a.normalized){const c=Y2(NI[a.componentType]);s.min.multiplyScalar(c),s.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const a=new _,l=new _;for(let g=0,c=o.length;g<c;g++){const u=o[g];if(u.POSITION!==void 0){const C=t.json.accessors[u.POSITION],h=C.min,p=C.max;if(h!==void 0&&p!==void 0){if(l.setX(Math.max(Math.abs(h[0]),Math.abs(p[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(p[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(p[2]))),C.normalized){const b=Y2(NI[C.componentType]);l.multiplyScalar(b)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}n.boundingBox=s;const r=new Ti;s.getCenter(r.center),r.radius=s.min.distanceTo(s.max)/2,n.boundingSphere=r}function EM(n,e,t){const i=e.attributes,s=[];function o(r,a){return t.getDependency("accessor",r).then(function(l){n.setAttribute(a,l)})}for(const r in i){const a=E2[r]||r.toLowerCase();a in n.attributes||s.push(o(i[r],a))}if(e.indices!==void 0&&!n.index){const r=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});s.push(r)}return cn.workingColorSpace!==Ei&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${cn.workingColorSpace}" not supported.`),Sa(n,e),Nq(n,e,t),Promise.all(s).then(function(){return e.targets!==void 0?Sq(n,e.targets,t):n})}const Fq=(n,e,t,i)=>{let[s,o]=z.useState({});return z.useEffect(()=>{const r=l=>{o(g=>({...g,[l.key.toLowerCase()]:!0}))},a=l=>{o(g=>({...g,[l.key.toLowerCase()]:!1}))};return window.addEventListener("keydown",r),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",a)}},[]),z.useEffect(()=>{if(!n||!e||!t||i===void 0)return;const r=new _;if(e.position.subscribe(a=>{r.set(a[0],a[1],a[2])}),r&&t&&r.distanceTo(t)<=i)if(s.z?(n.applyEngineForce(150,2),n.applyEngineForce(150,3)):s.s?(n.applyEngineForce(-150,2),n.applyEngineForce(-150,3)):(n.applyEngineForce(0,2),n.applyEngineForce(0,3)),s.q)n.setSteeringValue(.35,2),n.setSteeringValue(.35,3),n.setSteeringValue(-.1,0),n.setSteeringValue(-.1,1);else if(s.d)n.setSteeringValue(-.35,2),n.setSteeringValue(-.35,3),n.setSteeringValue(.1,0),n.setSteeringValue(.1,1);else for(let l=0;l<4;l++)n.setSteeringValue(0,l);s.r&&(e.position.set(-1.5,2,3),e.velocity.set(0,0,0),e.angularVelocity.set(0,0,0),e.rotation.set(0,0,0))},[s,n,e,t,i]),s},Hq=(n,e,t,i)=>{const s=[z.useRef(null),z.useRef(null),z.useRef(null),z.useRef(null)],o={radius:i,directionLocal:[0,-1,0],axleLocal:[1,0,0],suspensionStiffness:60,suspensionRestLength:.2,frictionSlip:5,dampingRelaxation:2.3,dampingCompression:4.4,maxSuspensionForce:1e5,rollInfluence:.01,maxSuspensionTravel:.2,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0},r=[{...o,chassisConnectionPointLocal:[-n*.65,e*.4,t],isFrontWheel:!0},{...o,chassisConnectionPointLocal:[n*.65,e*.4,t],isFrontWheel:!0},{...o,chassisConnectionPointLocal:[-n*.65,e*.4,-t],isFrontWheel:!1},{...o,chassisConnectionPointLocal:[n*.65,e*.4,-t],isFrontWheel:!1}],a=()=>({collisionFilterGroup:0,mass:5,shapes:[{args:[o.radius,o.radius,.1,16],rotation:[0,0,-Math.PI/2],type:"Cylinder"}],type:"Dynamic"});return wm(a,s[0]),wm(a,s[1]),wm(a,s[2]),wm(a,s[3]),[s,r]},Xq=!1,Sm=({radius:n,wheelRef:e})=>Xq;function Tq(){const n=Vo(ny,"/car/car.glb").scene,e=[-1.5,2,3],t=.15,i=.07,s=.15,o=.05,r=new _(-2.285,-.015,-1.325),a=19,l=[t,i,s*2],[g,c]=GY(()=>({allowSleep:!1,args:l,mass:150,position:e})),[u,C]=Hq(t,i,s,o),[h,p]=J6(()=>({chassisBody:g,wheelInfos:C,wheels:u}),z.useRef(null));return Fq(p,c,r,a),ga(()=>{const b=new _;if(b.setFromMatrixPosition(g.current.matrixWorld),b.distanceTo(r)>a){const A=b.clone().sub(r).normalize(),B=r.clone().add(A.multiplyScalar(a-.1));c.position.set(B.x,B.y,B.z),c.velocity.set(0,0,0),c.angularVelocity.set(0,0,0)}}),z.useEffect(()=>{if(!n)return;const b=n;b.scale.set(.0019,.0019,.0019),b.children[0].position.set(-365,-18,-67)},[n]),j.jsxs("group",{ref:h,name:"vehicle",children:[j.jsx("group",{ref:g,name:"chassisBody",children:j.jsx("primitive",{object:n,"rotation-y":Math.PI,position:[0,-.09,0]})}),j.jsx(Sm,{wheelRef:u[0],radius:o}),j.jsx(Sm,{wheelRef:u[1],radius:o}),j.jsx(Sm,{wheelRef:u[2],radius:o}),j.jsx(Sm,{wheelRef:u[3],radius:o})]})}function Eq(){P6(()=>({type:"Static",rotation:[-Math.PI/2,0,0]}),z.useRef(null));const n=Vo(au,"/car/grid.png"),e=z.useRef(null),t=z.useRef(null);z.useEffect(()=>{n&&(n.anisotropy=16)},[n]),z.useEffect(()=>{if(e.current){const o=e.current.geometry.attributes.uv.array;e.current.geometry.setAttribute("uv2",new Pt(o,2))}},[e]);const i=new _(-2.285,-.015,-1.325),s=19;return GY(()=>({type:"Static",position:[.19,1.05,-2.2],args:[8.9,0,1.8]})),j.jsxs(j.Fragment,{children:[j.jsxs("mesh",{ref:e,position:[-2.285,-.015,-1.325],"rotation-x":-Math.PI*.5,children:[j.jsx("circleGeometry",{args:[20,50]}),j.jsx(W8,{color:"#56ab2f",envMapIntensity:1,metalness:.05,roughness:.4,dithering:!0,blur:[1024,512],mixBlur:3,mixStrength:30,mixContrast:1,resolution:1024,mirror:0,depthScale:0,minDepthThreshold:.9,maxDepthThreshold:1,depthToBlurRatioBias:.25,debug:0,reflectorOffset:.02})]}),j.jsxs("mesh",{ref:t,position:i,"rotation-y":Math.PI/2,children:[j.jsx("sphereGeometry",{args:[s,32,16,0,Math.PI*2,0,Math.PI/2]}),j.jsx("meshBasicMaterial",{map:n,side:2,transparent:!0,opacity:.25,color:"white"})]})]})}function YM({position:n=[0,0,0],rotation:e=[0,0,0],scale:t=[1,1,1]}){const i=Vo(ny,"/car/ramp.glb"),s=z.useMemo(()=>{var l,g;return(g=(l=i.scene)==null?void 0:l.children)!=null&&g.length?i.scene.children[0].geometry:null},[i]),{vertices:o,indices:r}=z.useMemo(()=>{if(!s)return{vertices:[],indices:[]};const l=Array.from(s.attributes.position.array),g=Array.from(s.index.array);return{vertices:l.map((u,C)=>u*t[C%3]),indices:g}},[s,t]),[a]=hS(()=>({args:[o,r],mass:0,position:n,rotation:e}),z.useRef(null));return s&&j.jsx("mesh",{ref:a,geometry:s,scale:t,position:n,rotation:e,castShadow:!0,receiveShadow:!0,children:j.jsx("meshStandardMaterial",{attach:"material",color:"gray"})})}function Yq({position:n=[-4,1.2,.1],rotation:e=[0,0,0],scale:t=[27.19,25,22.6]}){const s=Vo(ny,"/car/floating.glb").scene.children[0].geometry,o=s.attributes.position.array,r=s.index.array,a=new Float32Array(o.length);for(let g=0;g<o.length;g+=3)a[g]=o[g]*t[0],a[g+1]=o[g+1]*t[1],a[g+2]=o[g+2]*t[2];const[l]=hS(()=>({args:[a,r],mass:0,position:n,rotation:e,type:"Static"}),z.useRef(null));return z.useEffect(()=>{},[l]),j.jsx("mesh",{ref:l,geometry:s,scale:t,position:n,rotation:e,castShadow:!0,receiveShadow:!0,children:j.jsx("meshStandardMaterial",{attach:"material",color:"#8B4513"})})}function Kq({position:n=[-4.49,0,-2.2],rotation:e=[0,0,0],scale:t=[.059,.059,.059]}){const s=Vo(ny,"/car/new1.glb").scene.children[0].geometry,o=s.attributes.position.array,r=s.index.array,a=new Float32Array(o.length);for(let g=0;g<o.length;g+=3)a[g]=o[g]*t[0],a[g+1]=o[g+1]*t[1],a[g+2]=o[g+2]*t[2];const[l]=hS(()=>({args:[a,r],mass:0,position:n,rotation:e,type:"Static"}),z.useRef(null));z.useEffect(()=>{},[l])}function _q(){const{scene:n}=dd("/car/xx.glb"),e={position:[3.8,0,4.55],rotation:[0,Math.PI/2,0],scale:[3.7,4,4]},t={position:[1.6,0,11.9],rotation:[0,-Math.PI/2,0],scale:[3.7,4,4]};return j.jsxs(j.Fragment,{children:[j.jsx("hemisphereLight",{intensity:1.15,groundColor:"black"}),j.jsx("spotLight",{position:[-20,50,10],angle:.12,penumbra:1,intensity:1,castShadow:!0,"shadow-mapSize":1024}),j.jsx("pointLight",{intensity:1}),j.jsx("primitive",{object:n,scale:.059,position:[-4,-.12,-11]}),j.jsx(YM,{...e}),j.jsx(YM,{...t}),j.jsx(Yq,{}),j.jsx(Kq,{})]})}function Lq({cameraPosition:n=[40,130,-140]}){return j.jsx($6,{broadphase:"SAP",gravity:[0,-5,0],substeps:3,children:j.jsxs(z.Suspense,{fallback:j.jsx($b,{}),children:[j.jsx("ambientLight",{intensity:3}),j.jsx("directionalLight",{position:[5,5,5],intensity:.5}),j.jsxs("group",{children:[j.jsx(G8,{makeDefault:!0,position:n,fov:20}),j.jsx(jb,{maxPolarAngle:Math.PI/2}),j.jsx(Eq,{}),j.jsx(_q,{}),j.jsx(Tq,{})]})]})})}const kq=({scale:n})=>{const e=dd("/planet/scene.gltf");return j.jsx("primitive",{object:e.scene,scale:n,"position-y":0,"rotation-y":0})},zq=()=>{const[n,e]=z.useState(!1);return z.useEffect(()=>{const t=window.matchMedia("(max-width: 500px)"),i=s=>{e(s.matches)};return i(t),t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[]),j.jsx(Qb,{shadows:!0,frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},camera:{fov:30,near:.1,far:200,position:[-4,100,6]},children:j.jsxs(z.Suspense,{fallback:j.jsx($b,{}),children:[n?j.jsxs(j.Fragment,{children:[j.jsx(jb,{autoRotate:!0,enableZoom:!1,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2}),j.jsx(kq,{scale:22})]}):j.jsx(Lq,{scale:2.5}),j.jsx(qb,{all:!0})]})})},Dq=n=>{const[e]=cS([n.imgUrl]);return j.jsxs(F8,{speed:1.75,rotationIntensity:1,floatIntensity:2,children:[j.jsx("ambientLight",{intensity:.96}),j.jsx("directionalLight",{position:[0,0,.05]}),j.jsxs("mesh",{castShadow:!0,receiveShadow:!0,scale:2.75,children:[j.jsx("icosahedronGeometry",{args:[1,2]}),j.jsx("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),j.jsx(b8,{position:[0,0,1],rotation:[2*Math.PI,0,6.25],scale:1,map:e,flatShading:!0})]})]})},Pq=({icon:n})=>j.jsxs(Qb,{frameloop:"demand",dpr:[1,2],gl:{preserveDrawingBuffer:!0},children:[j.jsxs(z.Suspense,{fallback:j.jsx($b,{}),children:[j.jsx(jb,{enableZoom:!1}),j.jsx(Dq,{imgUrl:n})]}),j.jsx(qb,{all:!0})]}),Uq=({isMobile:n})=>{const e=dd("/Nouveau dossier (2)/scene.gltf");return j.jsxs("mesh",{children:[j.jsx("hemisphereLight",{intensity:3.15,groundColor:"black"}),j.jsx("spotLight",{position:[-20,50,10],angle:.12,penumbra:1,intensity:1,castShadow:!0,"shadow-mapSize":1024}),j.jsx("pointLight",{intensity:1}),j.jsx("primitive",{object:e.scene,scale:n?1.1:1.9,position:n?[0,-.52,0]:[0,-1.5,0],rotation:[-0,0,-.1]})]})},Jq=()=>{const[n,e]=z.useState(!1);return z.useEffect(()=>{const t=window.matchMedia("(max-width: 500px)");e(t.matches);const i=s=>{e(s.matches)};return t.addEventListener("change",i),()=>{t.removeEventListener("change",i)}},[]),j.jsxs(Qb,{frameloop:"demand",shadows:!0,dpr:[1,2],camera:{position:[20,3,5],fov:25},gl:{preserveDrawingBuffer:!0},children:[j.jsxs(z.Suspense,{fallback:j.jsx($b,{}),children:[j.jsx(jb,{autoRotate:!0,enableZoom:!1,maxPolarAngle:Math.PI/2,minPolarAngle:Math.PI/2}),j.jsx(Uq,{isMobile:n})]}),j.jsx(qb,{all:!0})]})},Oq=n=>{const e=z.useRef(),[t]=z.useState(()=>R7(new Float32Array(5e3),{radius:1.2}));return ga((i,s)=>{e.current.rotation.x-=s/10,e.current.rotation.y-=s/15}),j.jsx("group",{rotation:[0,0,Math.PI/4],children:j.jsx(E8,{ref:e,positions:t,stride:3,frustumCulled:!0,...n,children:j.jsx(N8,{transparent:!0,color:"#f272c8",size:.002,sizeAttenuation:!0,depthWrite:!1})})})},ZY=()=>j.jsx("div",{className:"w-full h-auto absolute inset-0 z-[-1]",children:j.jsxs(Qb,{camera:{position:[0,0,1]},children:[j.jsx(z.Suspense,{fallback:null,children:j.jsx(Oq,{})}),j.jsx(qb,{all:!0})]})});function Qq(n){if(typeof Proxy>"u")return n;const e=new Map,t=(...i)=>n(...i);return new Proxy(t,{get:(i,s)=>s==="create"?n:(e.has(s)||e.set(s,n(s)),e.get(s))})}function Th(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const K2=n=>Array.isArray(n);function SY(n,e){if(!Array.isArray(e))return!1;const t=e.length;if(t!==n.length)return!1;for(let i=0;i<t;i++)if(e[i]!==n[i])return!1;return!0}function Eh(n){return typeof n=="string"||Array.isArray(n)}function KM(n){const e=[{},{}];return n==null||n.values.forEach((t,i)=>{e[0][i]=t.get(),e[1][i]=t.getVelocity()}),e}function AS(n,e,t,i){if(typeof e=="function"){const[s,o]=KM(i);e=e(t!==void 0?t:n.custom,s,o)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[s,o]=KM(i);e=e(t!==void 0?t:n.custom,s,o)}return e}function iy(n,e,t){const i=n.getProps();return AS(i,e,t!==void 0?t:i.custom,n)}const pS=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],mS=["initial",...pS],hA=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],pg=new Set(hA),Ya=n=>n*1e3,Ka=n=>n/1e3,jq={type:"spring",stiffness:500,damping:25,restSpeed:10},qq=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),$q={type:"keyframes",duration:.8},e$={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},t$=(n,{keyframes:e})=>e.length>2?$q:pg.has(n)?n.startsWith("scale")?qq(e[1]):jq:e$;function fS(n,e){return n?n[e]||n.default||n:void 0}const n$={skipAnimations:!1,useManualTiming:!1},i$=n=>n!==null;function sy(n,{repeat:e,repeatType:t="loop"},i){const s=n.filter(i$),o=e&&t!=="loop"&&e%2===1?0:s.length-1;return!o||i===void 0?s[o]:i}const ys=n=>n;function s$(n){let e=new Set,t=new Set,i=!1,s=!1;const o=new WeakSet;let r={delta:0,timestamp:0,isProcessing:!1};function a(g){o.has(g)&&(l.schedule(g),n()),g(r)}const l={schedule:(g,c=!1,u=!1)=>{const h=u&&i?e:t;return c&&o.add(g),h.has(g)||h.add(g),g},cancel:g=>{t.delete(g),o.delete(g)},process:g=>{if(r=g,i){s=!0;return}i=!0,[e,t]=[t,e],t.clear(),e.forEach(a),i=!1,s&&(s=!1,l.process(g))}};return l}const Rm=["read","resolveKeyframes","update","preRender","render","postRender"],o$=40;function RY(n,e){let t=!1,i=!0;const s={delta:0,timestamp:0,isProcessing:!1},o=()=>t=!0,r=Rm.reduce((A,B)=>(A[B]=s$(o),A),{}),{read:a,resolveKeyframes:l,update:g,preRender:c,render:u,postRender:C}=r,h=()=>{const A=performance.now();t=!1,s.delta=i?1e3/60:Math.max(Math.min(A-s.timestamp,o$),1),s.timestamp=A,s.isProcessing=!0,a.process(s),l.process(s),g.process(s),c.process(s),u.process(s),C.process(s),s.isProcessing=!1,t&&e&&(i=!1,n(h))},p=()=>{t=!0,i=!0,s.isProcessing||n(h)};return{schedule:Rm.reduce((A,B)=>{const G=r[B];return A[B]=(w,N=!1,M=!1)=>(t||p(),G.schedule(w,N,M)),A},{}),cancel:A=>{for(let B=0;B<Rm.length;B++)r[Rm[B]].cancel(A)},state:s,steps:r}}const{schedule:Gn,cancel:ig,state:Li,steps:$G}=RY(typeof requestAnimationFrame<"u"?requestAnimationFrame:ys,!0),xY=(n,e,t)=>(((1-3*t+3*e)*n+(3*t-6*e))*n+3*e)*n,r$=1e-7,a$=12;function l$(n,e,t,i,s){let o,r,a=0;do r=e+(t-e)/2,o=xY(r,i,s)-n,o>0?t=r:e=r;while(Math.abs(o)>r$&&++a<a$);return r}function AA(n,e,t,i){if(n===e&&t===i)return ys;const s=o=>l$(o,0,1,n,t);return o=>o===0||o===1?o:xY(s(o),e,i)}const VY=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,WY=n=>e=>1-n(1-e),MY=AA(.33,1.53,.69,.99),bS=WY(MY),NY=VY(bS),FY=n=>(n*=2)<1?.5*bS(n):.5*(2-Math.pow(2,-10*(n-1))),yS=n=>1-Math.sin(Math.acos(n)),HY=WY(yS),XY=VY(yS),TY=n=>/^0[^.\s]+$/u.test(n);function g$(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||TY(n):!0}let _2=ys;const EY=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),YY=n=>e=>typeof e=="string"&&e.startsWith(n),KY=YY("--"),c$=YY("var(--"),BS=n=>c$(n)?u$.test(n.split("/*")[0].trim()):!1,u$=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,I$=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function d$(n){const e=I$.exec(n);if(!e)return[,];const[,t,i,s]=e;return[`--${t??i}`,s]}function _Y(n,e,t=1){const[i,s]=d$(n);if(!i)return;const o=window.getComputedStyle(e).getPropertyValue(i);if(o){const r=o.trim();return EY(r)?parseFloat(r):r}return BS(s)?_Y(s,e,t+1):s}const sg=(n,e,t)=>t>e?e:t<n?n:t,Cd={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},Yh={...Cd,transform:n=>sg(0,1,n)},xm={...Cd,default:1},pA=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),xl=pA("deg"),sa=pA("%"),Rt=pA("px"),C$=pA("vh"),h$=pA("vw"),_M={...sa,parse:n=>sa.parse(n)/100,transform:n=>sa.transform(n*100)},A$=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),LM=n=>n===Cd||n===Rt,kM=(n,e)=>parseFloat(n.split(", ")[e]),zM=(n,e)=>(t,{transform:i})=>{if(i==="none"||!i)return 0;const s=i.match(/^matrix3d\((.+)\)$/u);if(s)return kM(s[1],e);{const o=i.match(/^matrix\((.+)\)$/u);return o?kM(o[1],n):0}},p$=new Set(["x","y","z"]),m$=hA.filter(n=>!p$.has(n));function f$(n){const e=[];return m$.forEach(t=>{const i=n.getValue(t);i!==void 0&&(e.push([t,i.get()]),i.set(t.startsWith("scale")?1:0))}),e}const PI={width:({x:n},{paddingLeft:e="0",paddingRight:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),height:({y:n},{paddingTop:e="0",paddingBottom:t="0"})=>n.max-n.min-parseFloat(e)-parseFloat(t),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:zM(4,13),y:zM(5,14)};PI.translateX=PI.x;PI.translateY=PI.y;const LY=n=>e=>e.test(n),b$={test:n=>n==="auto",parse:n=>n},kY=[Cd,Rt,sa,xl,h$,C$,b$],DM=n=>kY.find(LY(n)),Nc=new Set;let L2=!1,k2=!1;function zY(){if(k2){const n=Array.from(Nc).filter(i=>i.needsMeasurement),e=new Set(n.map(i=>i.element)),t=new Map;e.forEach(i=>{const s=f$(i);s.length&&(t.set(i,s),i.render())}),n.forEach(i=>i.measureInitialState()),e.forEach(i=>{i.render();const s=t.get(i);s&&s.forEach(([o,r])=>{var a;(a=i.getValue(o))===null||a===void 0||a.set(r)})}),n.forEach(i=>i.measureEndState()),n.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}k2=!1,L2=!1,Nc.forEach(n=>n.complete()),Nc.clear()}function DY(){Nc.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(k2=!0)})}function y$(){DY(),zY()}class GS{constructor(e,t,i,s,o,r=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=t,this.name=i,this.motionValue=s,this.element=o,this.isAsync=r}scheduleResolve(){this.isScheduled=!0,this.isAsync?(Nc.add(this),L2||(L2=!0,Gn.read(DY),Gn.resolveKeyframes(zY))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:t,element:i,motionValue:s}=this;for(let o=0;o<e.length;o++)if(e[o]===null)if(o===0){const r=s==null?void 0:s.get(),a=e[e.length-1];if(r!==void 0)e[0]=r;else if(i&&t){const l=i.readValue(t,a);l!=null&&(e[0]=l)}e[0]===void 0&&(e[0]=a),s&&r===void 0&&s.set(e[0])}else e[o]=e[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),Nc.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,Nc.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const QC=n=>Math.round(n*1e5)/1e5,vS=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function B$(n){return n==null}const G$=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,wS=(n,e)=>t=>!!(typeof t=="string"&&G$.test(t)&&t.startsWith(n)||e&&!B$(t)&&Object.prototype.hasOwnProperty.call(t,e)),PY=(n,e,t)=>i=>{if(typeof i!="string")return i;const[s,o,r,a]=i.match(vS);return{[n]:parseFloat(s),[e]:parseFloat(o),[t]:parseFloat(r),alpha:a!==void 0?parseFloat(a):1}},v$=n=>sg(0,255,n),ev={...Cd,transform:n=>Math.round(v$(n))},vc={test:wS("rgb","red"),parse:PY("red","green","blue"),transform:({red:n,green:e,blue:t,alpha:i=1})=>"rgba("+ev.transform(n)+", "+ev.transform(e)+", "+ev.transform(t)+", "+QC(Yh.transform(i))+")"};function w$(n){let e="",t="",i="",s="";return n.length>5?(e=n.substring(1,3),t=n.substring(3,5),i=n.substring(5,7),s=n.substring(7,9)):(e=n.substring(1,2),t=n.substring(2,3),i=n.substring(3,4),s=n.substring(4,5),e+=e,t+=t,i+=i,s+=s),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(i,16),alpha:s?parseInt(s,16)/255:1}}const z2={test:wS("#"),parse:w$,transform:vc.transform},mI={test:wS("hsl","hue"),parse:PY("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:t,alpha:i=1})=>"hsla("+Math.round(n)+", "+sa.transform(QC(e))+", "+sa.transform(QC(t))+", "+QC(Yh.transform(i))+")"},ds={test:n=>vc.test(n)||z2.test(n)||mI.test(n),parse:n=>vc.test(n)?vc.parse(n):mI.test(n)?mI.parse(n):z2.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?vc.transform(n):mI.transform(n)},Z$=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function S$(n){var e,t;return isNaN(n)&&typeof n=="string"&&(((e=n.match(vS))===null||e===void 0?void 0:e.length)||0)+(((t=n.match(Z$))===null||t===void 0?void 0:t.length)||0)>0}const UY="number",JY="color",R$="var",x$="var(",PM="${}",V$=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Kh(n){const e=n.toString(),t=[],i={color:[],number:[],var:[]},s=[];let o=0;const a=e.replace(V$,l=>(ds.test(l)?(i.color.push(o),s.push(JY),t.push(ds.parse(l))):l.startsWith(x$)?(i.var.push(o),s.push(R$),t.push(l)):(i.number.push(o),s.push(UY),t.push(parseFloat(l))),++o,PM)).split(PM);return{values:t,split:a,indexes:i,types:s}}function OY(n){return Kh(n).values}function QY(n){const{split:e,types:t}=Kh(n),i=e.length;return s=>{let o="";for(let r=0;r<i;r++)if(o+=e[r],s[r]!==void 0){const a=t[r];a===UY?o+=QC(s[r]):a===JY?o+=ds.transform(s[r]):o+=s[r]}return o}}const W$=n=>typeof n=="number"?0:n;function M$(n){const e=OY(n);return QY(n)(e.map(W$))}const og={test:S$,parse:OY,createTransformer:QY,getAnimatableNone:M$},N$=new Set(["brightness","contrast","saturate","opacity"]);function F$(n){const[e,t]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[i]=t.match(vS)||[];if(!i)return n;const s=t.replace(i,"");let o=N$.has(e)?1:0;return i!==t&&(o*=100),e+"("+o+s+")"}const H$=/\b([a-z-]*)\(.*?\)/gu,D2={...og,getAnimatableNone:n=>{const e=n.match(H$);return e?e.map(F$).join(" "):n}},X$={borderWidth:Rt,borderTopWidth:Rt,borderRightWidth:Rt,borderBottomWidth:Rt,borderLeftWidth:Rt,borderRadius:Rt,radius:Rt,borderTopLeftRadius:Rt,borderTopRightRadius:Rt,borderBottomRightRadius:Rt,borderBottomLeftRadius:Rt,width:Rt,maxWidth:Rt,height:Rt,maxHeight:Rt,top:Rt,right:Rt,bottom:Rt,left:Rt,padding:Rt,paddingTop:Rt,paddingRight:Rt,paddingBottom:Rt,paddingLeft:Rt,margin:Rt,marginTop:Rt,marginRight:Rt,marginBottom:Rt,marginLeft:Rt,backgroundPositionX:Rt,backgroundPositionY:Rt},T$={rotate:xl,rotateX:xl,rotateY:xl,rotateZ:xl,scale:xm,scaleX:xm,scaleY:xm,scaleZ:xm,skew:xl,skewX:xl,skewY:xl,distance:Rt,translateX:Rt,translateY:Rt,translateZ:Rt,x:Rt,y:Rt,z:Rt,perspective:Rt,transformPerspective:Rt,opacity:Yh,originX:_M,originY:_M,originZ:Rt},UM={...Cd,transform:Math.round},ZS={...X$,...T$,zIndex:UM,size:Rt,fillOpacity:Yh,strokeOpacity:Yh,numOctaves:UM},E$={...ZS,color:ds,backgroundColor:ds,outlineColor:ds,fill:ds,stroke:ds,borderColor:ds,borderTopColor:ds,borderRightColor:ds,borderBottomColor:ds,borderLeftColor:ds,filter:D2,WebkitFilter:D2},SS=n=>E$[n];function jY(n,e){let t=SS(n);return t!==D2&&(t=og),t.getAnimatableNone?t.getAnimatableNone(e):void 0}const Y$=new Set(["auto","none","0"]);function K$(n,e,t){let i=0,s;for(;i<n.length&&!s;){const o=n[i];typeof o=="string"&&!Y$.has(o)&&Kh(o).values.length&&(s=n[i]),i++}if(s&&t)for(const o of e)n[o]=jY(t,s)}class qY extends GS{constructor(e,t,i,s,o){super(e,t,i,s,o,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:t,name:i}=this;if(!t||!t.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let g=e[l];if(typeof g=="string"&&(g=g.trim(),BS(g))){const c=_Y(g,t.current);c!==void 0&&(e[l]=c),l===e.length-1&&(this.finalKeyframe=g)}}if(this.resolveNoneKeyframes(),!A$.has(i)||e.length!==2)return;const[s,o]=e,r=DM(s),a=DM(o);if(r!==a)if(LM(r)&&LM(a))for(let l=0;l<e.length;l++){const g=e[l];typeof g=="string"&&(e[l]=parseFloat(g))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:t}=this,i=[];for(let s=0;s<e.length;s++)g$(e[s])&&i.push(s);i.length&&K$(e,i,t)}measureInitialState(){const{element:e,unresolvedKeyframes:t,name:i}=this;if(!e||!e.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=PI[i](e.measureViewportBox(),window.getComputedStyle(e.current)),t[0]=this.measuredOrigin;const s=t[t.length-1];s!==void 0&&e.getValue(i,s).jump(s,!1)}measureEndState(){var e;const{element:t,name:i,unresolvedKeyframes:s}=this;if(!t||!t.current)return;const o=t.getValue(i);o&&o.jump(this.measuredOrigin,!1);const r=s.length-1,a=s[r];s[r]=PI[i](t.measureViewportBox(),window.getComputedStyle(t.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([l,g])=>{t.getValue(l).set(g)}),this.resolveNoneKeyframes()}}function RS(n){return typeof n=="function"}let sf;function _$(){sf=void 0}const oa={now:()=>(sf===void 0&&oa.set(Li.isProcessing||n$.useManualTiming?Li.timestamp:performance.now()),sf),set:n=>{sf=n,queueMicrotask(_$)}},JM=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(og.test(n)||n==="0")&&!n.startsWith("url("));function L$(n){const e=n[0];if(n.length===1)return!0;for(let t=0;t<n.length;t++)if(n[t]!==e)return!0}function k$(n,e,t,i){const s=n[0];if(s===null)return!1;if(e==="display"||e==="visibility")return!0;const o=n[n.length-1],r=JM(s,e),a=JM(o,e);return!r||!a?!1:L$(n)||(t==="spring"||RS(t))&&i}const z$=40;class $Y{constructor({autoplay:e=!0,delay:t=0,type:i="keyframes",repeat:s=0,repeatDelay:o=0,repeatType:r="loop",...a}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=oa.now(),this.options={autoplay:e,delay:t,type:i,repeat:s,repeatDelay:o,repeatType:r,...a},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>z$?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&y$(),this._resolved}onKeyframesResolved(e,t){this.resolvedAt=oa.now(),this.hasAttemptedResolve=!0;const{name:i,type:s,velocity:o,delay:r,onComplete:a,onUpdate:l,isGenerator:g}=this.options;if(!g&&!k$(e,i,s,o))if(r)this.options.duration=0;else{l==null||l(sy(e,this.options,t)),a==null||a(),this.resolveFinishedPromise();return}const c=this.initPlayback(e,t);c!==!1&&(this._resolved={keyframes:e,finalKeyframe:t,...c},this.onPostResolved())}onPostResolved(){}then(e,t){return this.currentFinishedPromise.then(e,t)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}function eK(n,e){return e?n*(1e3/e):0}const D$=5;function tK(n,e,t){const i=Math.max(e-D$,0);return eK(t-n(i),e-i)}const tv=.001,P$=.01,U$=10,J$=.05,O$=1;function Q$({duration:n=800,bounce:e=.25,velocity:t=0,mass:i=1}){let s,o,r=1-e;r=sg(J$,O$,r),n=sg(P$,U$,Ka(n)),r<1?(s=g=>{const c=g*r,u=c*n,C=c-t,h=P2(g,r),p=Math.exp(-u);return tv-C/h*p},o=g=>{const u=g*r*n,C=u*t+t,h=Math.pow(r,2)*Math.pow(g,2)*n,p=Math.exp(-u),b=P2(Math.pow(g,2),r);return(-s(g)+tv>0?-1:1)*((C-h)*p)/b}):(s=g=>{const c=Math.exp(-g*n),u=(g-t)*n+1;return-tv+c*u},o=g=>{const c=Math.exp(-g*n),u=(t-g)*(n*n);return c*u});const a=5/n,l=q$(s,o,a);if(n=Ya(n),isNaN(l))return{stiffness:100,damping:10,duration:n};{const g=Math.pow(l,2)*i;return{stiffness:g,damping:r*2*Math.sqrt(i*g),duration:n}}}const j$=12;function q$(n,e,t){let i=t;for(let s=1;s<j$;s++)i=i-n(i)/e(i);return i}function P2(n,e){return n*Math.sqrt(1-e*e)}const $$=["duration","bounce"],eee=["stiffness","damping","mass"];function OM(n,e){return e.some(t=>n[t]!==void 0)}function tee(n){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...n};if(!OM(n,eee)&&OM(n,$$)){const t=Q$(n);e={...e,...t,mass:1},e.isResolvedFromDuration=!0}return e}function nK({keyframes:n,restDelta:e,restSpeed:t,...i}){const s=n[0],o=n[n.length-1],r={done:!1,value:s},{stiffness:a,damping:l,mass:g,duration:c,velocity:u,isResolvedFromDuration:C}=tee({...i,velocity:-Ka(i.velocity||0)}),h=u||0,p=l/(2*Math.sqrt(a*g)),b=o-s,m=Ka(Math.sqrt(a/g)),A=Math.abs(b)<5;t||(t=A?.01:2),e||(e=A?.005:.5);let B;if(p<1){const G=P2(m,p);B=w=>{const N=Math.exp(-p*m*w);return o-N*((h+p*m*b)/G*Math.sin(G*w)+b*Math.cos(G*w))}}else if(p===1)B=G=>o-Math.exp(-m*G)*(b+(h+m*b)*G);else{const G=m*Math.sqrt(p*p-1);B=w=>{const N=Math.exp(-p*m*w),M=Math.min(G*w,300);return o-N*((h+p*m*b)*Math.sinh(M)+G*b*Math.cosh(M))/G}}return{calculatedDuration:C&&c||null,next:G=>{const w=B(G);if(C)r.done=G>=c;else{let N=0;p<1&&(N=G===0?Ya(h):tK(B,G,w));const M=Math.abs(N)<=t,R=Math.abs(o-w)<=e;r.done=M&&R}return r.value=r.done?o:w,r}}}function QM({keyframes:n,velocity:e=0,power:t=.8,timeConstant:i=325,bounceDamping:s=10,bounceStiffness:o=500,modifyTarget:r,min:a,max:l,restDelta:g=.5,restSpeed:c}){const u=n[0],C={done:!1,value:u},h=S=>a!==void 0&&S<a||l!==void 0&&S>l,p=S=>a===void 0?l:l===void 0||Math.abs(a-S)<Math.abs(l-S)?a:l;let b=t*e;const m=u+b,A=r===void 0?m:r(m);A!==m&&(b=A-u);const B=S=>-b*Math.exp(-S/i),G=S=>A+B(S),w=S=>{const F=B(S),Z=G(S);C.done=Math.abs(F)<=g,C.value=C.done?A:Z};let N,M;const R=S=>{h(C.value)&&(N=S,M=nK({keyframes:[C.value,p(C.value)],velocity:tK(G,S,C.value),damping:s,stiffness:o,restDelta:g,restSpeed:c}))};return R(0),{calculatedDuration:null,next:S=>{let F=!1;return!M&&N===void 0&&(F=!0,w(S),R(S)),N!==void 0&&S>=N?M.next(S-N):(!F&&w(S),C)}}}const nee=AA(.42,0,1,1),iee=AA(0,0,.58,1),iK=AA(.42,0,.58,1),see=n=>Array.isArray(n)&&typeof n[0]!="number",xS=n=>Array.isArray(n)&&typeof n[0]=="number",jM={linear:ys,easeIn:nee,easeInOut:iK,easeOut:iee,circIn:yS,circInOut:XY,circOut:HY,backIn:bS,backInOut:NY,backOut:MY,anticipate:FY},qM=n=>{if(xS(n)){_2(n.length===4);const[e,t,i,s]=n;return AA(e,t,i,s)}else if(typeof n=="string")return _2(jM[n]!==void 0),jM[n];return n},oee=(n,e)=>t=>e(n(t)),_a=(...n)=>n.reduce(oee),UI=(n,e,t)=>{const i=e-n;return i===0?1:(t-n)/i},Dn=(n,e,t)=>n+(e-n)*t;function nv(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function ree({hue:n,saturation:e,lightness:t,alpha:i}){n/=360,e/=100,t/=100;let s=0,o=0,r=0;if(!e)s=o=r=t;else{const a=t<.5?t*(1+e):t+e-t*e,l=2*t-a;s=nv(l,a,n+1/3),o=nv(l,a,n),r=nv(l,a,n-1/3)}return{red:Math.round(s*255),green:Math.round(o*255),blue:Math.round(r*255),alpha:i}}function v0(n,e){return t=>t>0?e:n}const iv=(n,e,t)=>{const i=n*n,s=t*(e*e-i)+i;return s<0?0:Math.sqrt(s)},aee=[z2,vc,mI],lee=n=>aee.find(e=>e.test(n));function $M(n){const e=lee(n);if(!e)return!1;let t=e.parse(n);return e===mI&&(t=ree(t)),t}const eN=(n,e)=>{const t=$M(n),i=$M(e);if(!t||!i)return v0(n,e);const s={...t};return o=>(s.red=iv(t.red,i.red,o),s.green=iv(t.green,i.green,o),s.blue=iv(t.blue,i.blue,o),s.alpha=Dn(t.alpha,i.alpha,o),vc.transform(s))},U2=new Set(["none","hidden"]);function gee(n,e){return U2.has(n)?t=>t<=0?n:e:t=>t>=1?e:n}function cee(n,e){return t=>Dn(n,e,t)}function VS(n){return typeof n=="number"?cee:typeof n=="string"?BS(n)?v0:ds.test(n)?eN:dee:Array.isArray(n)?sK:typeof n=="object"?ds.test(n)?eN:uee:v0}function sK(n,e){const t=[...n],i=t.length,s=n.map((o,r)=>VS(o)(o,e[r]));return o=>{for(let r=0;r<i;r++)t[r]=s[r](o);return t}}function uee(n,e){const t={...n,...e},i={};for(const s in t)n[s]!==void 0&&e[s]!==void 0&&(i[s]=VS(n[s])(n[s],e[s]));return s=>{for(const o in i)t[o]=i[o](s);return t}}function Iee(n,e){var t;const i=[],s={color:0,var:0,number:0};for(let o=0;o<e.values.length;o++){const r=e.types[o],a=n.indexes[r][s[r]],l=(t=n.values[a])!==null&&t!==void 0?t:0;i[o]=l,s[r]++}return i}const dee=(n,e)=>{const t=og.createTransformer(e),i=Kh(n),s=Kh(e);return i.indexes.var.length===s.indexes.var.length&&i.indexes.color.length===s.indexes.color.length&&i.indexes.number.length>=s.indexes.number.length?U2.has(n)&&!s.values.length||U2.has(e)&&!i.values.length?gee(n,e):_a(sK(Iee(i,s),s.values),t):v0(n,e)};function oK(n,e,t){return typeof n=="number"&&typeof e=="number"&&typeof t=="number"?Dn(n,e,t):VS(n)(n,e)}function Cee(n,e,t){const i=[],s=t||oK,o=n.length-1;for(let r=0;r<o;r++){let a=s(n[r],n[r+1]);if(e){const l=Array.isArray(e)?e[r]||ys:e;a=_a(l,a)}i.push(a)}return i}function hee(n,e,{clamp:t=!0,ease:i,mixer:s}={}){const o=n.length;if(_2(o===e.length),o===1)return()=>e[0];if(o===2&&n[0]===n[1])return()=>e[1];n[0]>n[o-1]&&(n=[...n].reverse(),e=[...e].reverse());const r=Cee(e,i,s),a=r.length,l=g=>{let c=0;if(a>1)for(;c<n.length-2&&!(g<n[c+1]);c++);const u=UI(n[c],n[c+1],g);return r[c](u)};return t?g=>l(sg(n[0],n[o-1],g)):l}function Aee(n,e){const t=n[n.length-1];for(let i=1;i<=e;i++){const s=UI(0,e,i);n.push(Dn(t,1,s))}}function pee(n){const e=[0];return Aee(e,n.length-1),e}function mee(n,e){return n.map(t=>t*e)}function fee(n,e){return n.map(()=>e||iK).splice(0,n.length-1)}function w0({duration:n=300,keyframes:e,times:t,ease:i="easeInOut"}){const s=see(i)?i.map(qM):qM(i),o={done:!1,value:e[0]},r=mee(t&&t.length===e.length?t:pee(e),n),a=hee(r,e,{ease:Array.isArray(s)?s:fee(e,s)});return{calculatedDuration:n,next:l=>(o.value=a(l),o.done=l>=n,o)}}const tN=2e4;function bee(n){let e=0;const t=50;let i=n.next(e);for(;!i.done&&e<tN;)e+=t,i=n.next(e);return e>=tN?1/0:e}const yee=n=>{const e=({timestamp:t})=>n(t);return{start:()=>Gn.update(e,!0),stop:()=>ig(e),now:()=>Li.isProcessing?Li.timestamp:oa.now()}},Bee={decay:QM,inertia:QM,tween:w0,keyframes:w0,spring:nK},Gee=n=>n/100;class WS extends $Y{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:l}=this.options;l&&l()};const{name:t,motionValue:i,element:s,keyframes:o}=this.options,r=(s==null?void 0:s.KeyframeResolver)||GS,a=(l,g)=>this.onKeyframesResolved(l,g);this.resolver=new r(o,a,t,i,s),this.resolver.scheduleResolve()}initPlayback(e){const{type:t="keyframes",repeat:i=0,repeatDelay:s=0,repeatType:o,velocity:r=0}=this.options,a=RS(t)?t:Bee[t]||w0;let l,g;a!==w0&&typeof e[0]!="number"&&(l=_a(Gee,oK(e[0],e[1])),e=[0,100]);const c=a({...this.options,keyframes:e});o==="mirror"&&(g=a({...this.options,keyframes:[...e].reverse(),velocity:-r})),c.calculatedDuration===null&&(c.calculatedDuration=bee(c));const{calculatedDuration:u}=c,C=u+s,h=C*(i+1)-s;return{generator:c,mirroredGenerator:g,mapPercentToKeyframes:l,calculatedDuration:u,resolvedDuration:C,totalDuration:h}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,t=!1){const{resolved:i}=this;if(!i){const{keyframes:S}=this.options;return{done:!0,value:S[S.length-1]}}const{finalKeyframe:s,generator:o,mirroredGenerator:r,mapPercentToKeyframes:a,keyframes:l,calculatedDuration:g,totalDuration:c,resolvedDuration:u}=i;if(this.startTime===null)return o.next(0);const{delay:C,repeat:h,repeatType:p,repeatDelay:b,onUpdate:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-c/this.speed,this.startTime)),t?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const A=this.currentTime-C*(this.speed>=0?1:-1),B=this.speed>=0?A<0:A>c;this.currentTime=Math.max(A,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=c);let G=this.currentTime,w=o;if(h){const S=Math.min(this.currentTime,c)/u;let F=Math.floor(S),Z=S%1;!Z&&S>=1&&(Z=1),Z===1&&F--,F=Math.min(F,h+1),!!(F%2)&&(p==="reverse"?(Z=1-Z,b&&(Z-=b/u)):p==="mirror"&&(w=r)),G=sg(0,1,Z)*u}const N=B?{done:!1,value:l[0]}:w.next(G);a&&(N.value=a(N.value));let{done:M}=N;!B&&g!==null&&(M=this.speed>=0?this.currentTime>=c:this.currentTime<=0);const R=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&M);return R&&s!==void 0&&(N.value=sy(l,this.options,s)),m&&m(N.value),R&&this.finish(),N}get duration(){const{resolved:e}=this;return e?Ka(e.calculatedDuration):0}get time(){return Ka(this.currentTime)}set time(e){e=Ya(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const t=this.playbackSpeed!==e;this.playbackSpeed=e,t&&(this.time=Ka(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=yee,onPlay:t,startTime:i}=this.options;this.driver||(this.driver=e(o=>this.tick(o))),t&&t();const s=this.driver.now();this.holdTime!==null?this.startTime=s-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=s):this.startTime=i??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const rK=new Set(["opacity","clipPath","filter","transform"]),vee=10,wee=(n,e)=>{let t="";const i=Math.max(Math.round(e/vee),2);for(let s=0;s<i;s++)t+=n(UI(0,i-1,s))+", ";return`linear(${t.substring(0,t.length-2)})`};function MS(n){let e;return()=>(e===void 0&&(e=n()),e)}const Zee={linearEasing:void 0};function See(n,e){const t=MS(n);return()=>{var i;return(i=Zee[e])!==null&&i!==void 0?i:t()}}const Z0=See(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function aK(n){return!!(typeof n=="function"&&Z0()||!n||typeof n=="string"&&(n in J2||Z0())||xS(n)||Array.isArray(n)&&n.every(aK))}const xC=([n,e,t,i])=>`cubic-bezier(${n}, ${e}, ${t}, ${i})`,J2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:xC([0,.65,.55,1]),circOut:xC([.55,0,1,.45]),backIn:xC([.31,.01,.66,-.59]),backOut:xC([.33,1.53,.69,.99])};function lK(n,e){if(n)return typeof n=="function"&&Z0()?wee(n,e):xS(n)?xC(n):Array.isArray(n)?n.map(t=>lK(t,e)||J2.easeOut):J2[n]}function Ree(n,e,t,{delay:i=0,duration:s=300,repeat:o=0,repeatType:r="loop",ease:a,times:l}={}){const g={[e]:t};l&&(g.offset=l);const c=lK(a,s);return Array.isArray(c)&&(g.easing=c),n.animate(g,{delay:i,duration:s,easing:Array.isArray(c)?"linear":c,fill:"both",iterations:o+1,direction:r==="reverse"?"alternate":"normal"})}function nN(n,e){n.timeline=e,n.onfinish=null}const xee=MS(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),S0=10,Vee=2e4;function Wee(n){return RS(n.type)||n.type==="spring"||!aK(n.ease)}function Mee(n,e){const t=new WS({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let i={done:!1,value:n[0]};const s=[];let o=0;for(;!i.done&&o<Vee;)i=t.sample(o),s.push(i.value),o+=S0;return{times:void 0,keyframes:s,duration:o-S0,ease:"linear"}}const gK={anticipate:FY,backInOut:NY,circInOut:XY};function Nee(n){return n in gK}class iN extends $Y{constructor(e){super(e);const{name:t,motionValue:i,element:s,keyframes:o}=this.options;this.resolver=new qY(o,(r,a)=>this.onKeyframesResolved(r,a),t,i,s),this.resolver.scheduleResolve()}initPlayback(e,t){var i;let{duration:s=300,times:o,ease:r,type:a,motionValue:l,name:g,startTime:c}=this.options;if(!(!((i=l.owner)===null||i===void 0)&&i.current))return!1;if(typeof r=="string"&&Z0()&&Nee(r)&&(r=gK[r]),Wee(this.options)){const{onComplete:C,onUpdate:h,motionValue:p,element:b,...m}=this.options,A=Mee(e,m);e=A.keyframes,e.length===1&&(e[1]=e[0]),s=A.duration,o=A.times,r=A.ease,a="keyframes"}const u=Ree(l.owner.current,g,e,{...this.options,duration:s,times:o,ease:r});return u.startTime=c??this.calcStartTime(),this.pendingTimeline?(nN(u,this.pendingTimeline),this.pendingTimeline=void 0):u.onfinish=()=>{const{onComplete:C}=this.options;l.set(sy(e,this.options,t)),C&&C(),this.cancel(),this.resolveFinishedPromise()},{animation:u,duration:s,times:o,type:a,ease:r,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:t}=e;return Ka(t)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:t}=e;return Ka(t.currentTime||0)}set time(e){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.currentTime=Ya(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:t}=e;return t.playbackRate}set speed(e){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:t}=e;return t.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:t}=e;return t.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:t}=this;if(!t)return ys;const{animation:i}=t;nN(i,e)}return ys}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.playState==="finished"&&this.updateFinishedPromise(),t.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:t}=e;t.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:t,keyframes:i,duration:s,type:o,ease:r,times:a}=e;if(t.playState==="idle"||t.playState==="finished")return;if(this.time){const{motionValue:g,onUpdate:c,onComplete:u,element:C,...h}=this.options,p=new WS({...h,keyframes:i,duration:s,type:o,ease:r,times:a,isGenerator:!0}),b=Ya(this.time);g.setWithVelocity(p.sample(b-S0).value,p.sample(b).value,S0)}const{onStop:l}=this.options;l&&l(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:t,name:i,repeatDelay:s,repeatType:o,damping:r,type:a}=e;return xee()&&i&&rK.has(i)&&t&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate&&!s&&o!=="mirror"&&r!==0&&a!=="inertia"}}const Fee=MS(()=>window.ScrollTimeline!==void 0);class Hee{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}then(e,t){return Promise.all(this.animations).then(e).catch(t)}getAll(e){return this.animations[0][e]}setAll(e,t){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=t}attachTimeline(e,t){const i=this.animations.map(s=>Fee()&&s.attachTimeline?s.attachTimeline(e):t(s));return()=>{i.forEach((s,o)=>{s&&s(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let t=0;t<this.animations.length;t++)e=Math.max(e,this.animations[t].duration);return e}runAll(e){this.animations.forEach(t=>t[e]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function Xee({when:n,delay:e,delayChildren:t,staggerChildren:i,staggerDirection:s,repeat:o,repeatType:r,repeatDelay:a,from:l,elapsed:g,...c}){return!!Object.keys(c).length}const NS=(n,e,t,i={},s,o)=>r=>{const a=fS(i,n)||{},l=a.delay||i.delay||0;let{elapsed:g=0}=i;g=g-Ya(l);let c={keyframes:Array.isArray(t)?t:[null,t],ease:"easeOut",velocity:e.getVelocity(),...a,delay:-g,onUpdate:C=>{e.set(C),a.onUpdate&&a.onUpdate(C)},onComplete:()=>{r(),a.onComplete&&a.onComplete()},name:n,motionValue:e,element:o?void 0:s};Xee(a)||(c={...c,...t$(n,c)}),c.duration&&(c.duration=Ya(c.duration)),c.repeatDelay&&(c.repeatDelay=Ya(c.repeatDelay)),c.from!==void 0&&(c.keyframes[0]=c.from);let u=!1;if((c.type===!1||c.duration===0&&!c.repeatDelay)&&(c.duration=0,c.delay===0&&(u=!0)),u&&!o&&e.get()!==void 0){const C=sy(c.keyframes,a);if(C!==void 0)return Gn.update(()=>{c.onUpdate(C),c.onComplete()}),new Hee([])}return!o&&iN.supports(c)?new iN(c):new WS(c)},Tee=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),Eee=n=>K2(n)?n[n.length-1]||0:n;function FS(n,e){n.indexOf(e)===-1&&n.push(e)}function HS(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}class XS{constructor(){this.subscriptions=[]}add(e){return FS(this.subscriptions,e),()=>HS(this.subscriptions,e)}notify(e,t,i){const s=this.subscriptions.length;if(s)if(s===1)this.subscriptions[0](e,t,i);else for(let o=0;o<s;o++){const r=this.subscriptions[o];r&&r(e,t,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const sN=30,Yee=n=>!isNaN(parseFloat(n));class Kee{constructor(e,t={}){this.version="11.11.9",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(i,s=!0)=>{const o=oa.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),s&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=oa.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Yee(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new XS);const i=this.events[e].add(t);return e==="change"?()=>{i(),Gn.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e,t=!0){!t||!this.passiveEffect?this.updateAndNotify(e,t):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,t,i){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-i}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=oa.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>sN)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,sN);return eK(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function _h(n,e){return new Kee(n,e)}function _ee(n,e,t){n.hasValue(e)?n.getValue(e).set(t):n.addValue(e,_h(t))}function Lee(n,e){const t=iy(n,e);let{transitionEnd:i={},transition:s={},...o}=t||{};o={...o,...i};for(const r in o){const a=Eee(o[r]);_ee(n,r,a)}}const oy=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),kee="framerAppearId",cK="data-"+oy(kee);function uK(n){return n.props[cK]}const bs=n=>!!(n&&n.getVelocity);function zee(n){return!!(bs(n)&&n.add)}function O2(n,e){if(!n.applyWillChange)return;const t=n.getValue("willChange");if(zee(t))return t.add(e)}function Dee({protectedKeys:n,needsAnimating:e},t){const i=n.hasOwnProperty(t)&&e[t]!==!0;return e[t]=!1,i}function IK(n,e,{delay:t=0,transitionOverride:i,type:s}={}){var o;let{transition:r=n.getDefaultTransition(),transitionEnd:a,...l}=e;i&&(r=i);const g=[],c=s&&n.animationState&&n.animationState.getState()[s];for(const u in l){const C=n.getValue(u,(o=n.latestValues[u])!==null&&o!==void 0?o:null),h=l[u];if(h===void 0||c&&Dee(c,u))continue;const p={delay:t,...fS(r||{},u)};let b=!1;if(window.MotionHandoffAnimation){const A=uK(n);if(A){const B=window.MotionHandoffAnimation(A,u,Gn);B!==null&&(p.startTime=B,b=!0)}}O2(n,u),C.start(NS(u,C,h,n.shouldReduceMotion&&pg.has(u)?{type:!1}:p,n,b));const m=C.animation;m&&g.push(m)}return a&&Promise.all(g).then(()=>{Gn.update(()=>{a&&Lee(n,a)})}),g}function Q2(n,e,t={}){var i;const s=iy(n,e,t.type==="exit"?(i=n.presenceContext)===null||i===void 0?void 0:i.custom:void 0);let{transition:o=n.getDefaultTransition()||{}}=s||{};t.transitionOverride&&(o=t.transitionOverride);const r=s?()=>Promise.all(IK(n,s,t)):()=>Promise.resolve(),a=n.variantChildren&&n.variantChildren.size?(g=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:C}=o;return Pee(n,e,c+g,u,C,t)}:()=>Promise.resolve(),{when:l}=o;if(l){const[g,c]=l==="beforeChildren"?[r,a]:[a,r];return g().then(()=>c())}else return Promise.all([r(),a(t.delay)])}function Pee(n,e,t=0,i=0,s=1,o){const r=[],a=(n.variantChildren.size-1)*i,l=s===1?(g=0)=>g*i:(g=0)=>a-g*i;return Array.from(n.variantChildren).sort(Uee).forEach((g,c)=>{g.notify("AnimationStart",e),r.push(Q2(g,e,{...o,delay:t+l(c)}).then(()=>g.notify("AnimationComplete",e)))}),Promise.all(r)}function Uee(n,e){return n.sortNodePosition(e)}function Jee(n,e,t={}){n.notify("AnimationStart",e);let i;if(Array.isArray(e)){const s=e.map(o=>Q2(n,o,t));i=Promise.all(s)}else if(typeof e=="string")i=Q2(n,e,t);else{const s=typeof e=="function"?iy(n,e,t.custom):e;i=Promise.all(IK(n,s,t))}return i.then(()=>{n.notify("AnimationComplete",e)})}const Oee=mS.length;function dK(n){if(!n)return;if(!n.isControllingVariants){const t=n.parent?dK(n.parent)||{}:{};return n.props.initial!==void 0&&(t.initial=n.props.initial),t}const e={};for(let t=0;t<Oee;t++){const i=mS[t],s=n.props[i];(Eh(s)||s===!1)&&(e[i]=s)}return e}const Qee=[...pS].reverse(),jee=pS.length;function qee(n){return e=>Promise.all(e.map(({animation:t,options:i})=>Jee(n,t,i)))}function $ee(n){let e=qee(n),t=oN(),i=!0;const s=l=>(g,c)=>{var u;const C=iy(n,c,l==="exit"?(u=n.presenceContext)===null||u===void 0?void 0:u.custom:void 0);if(C){const{transition:h,transitionEnd:p,...b}=C;g={...g,...b,...p}}return g};function o(l){e=l(n)}function r(l){const{props:g}=n,c=dK(n.parent)||{},u=[],C=new Set;let h={},p=1/0;for(let m=0;m<jee;m++){const A=Qee[m],B=t[A],G=g[A]!==void 0?g[A]:c[A],w=Eh(G),N=A===l?B.isActive:null;N===!1&&(p=m);let M=G===c[A]&&G!==g[A]&&w;if(M&&i&&n.manuallyAnimateOnMount&&(M=!1),B.protectedKeys={...h},!B.isActive&&N===null||!G&&!B.prevProp||Th(G)||typeof G=="boolean")continue;const R=ete(B.prevProp,G);let S=R||A===l&&B.isActive&&!M&&w||m>p&&w,F=!1;const Z=Array.isArray(G)?G:[G];let x=Z.reduce(s(A),{});N===!1&&(x={});const{prevResolvedValues:Y={}}=B,T={...Y,...x},ne=Ie=>{S=!0,C.has(Ie)&&(F=!0,C.delete(Ie)),B.needsAnimating[Ie]=!0;const k=n.getValue(Ie);k&&(k.liveStyle=!1)};for(const Ie in T){const k=x[Ie],ee=Y[Ie];if(h.hasOwnProperty(Ie))continue;let $=!1;K2(k)&&K2(ee)?$=!SY(k,ee):$=k!==ee,$?k!=null?ne(Ie):C.add(Ie):k!==void 0&&C.has(Ie)?ne(Ie):B.protectedKeys[Ie]=!0}B.prevProp=G,B.prevResolvedValues=x,B.isActive&&(h={...h,...x}),i&&n.blockInitialAnimation&&(S=!1),S&&(!(M&&R)||F)&&u.push(...Z.map(Ie=>({animation:Ie,options:{type:A}})))}if(C.size){const m={};C.forEach(A=>{const B=n.getBaseTarget(A),G=n.getValue(A);G&&(G.liveStyle=!0),m[A]=B??null}),u.push({animation:m})}let b=!!u.length;return i&&(g.initial===!1||g.initial===g.animate)&&!n.manuallyAnimateOnMount&&(b=!1),i=!1,b?e(u):Promise.resolve()}function a(l,g){var c;if(t[l].isActive===g)return Promise.resolve();(c=n.variantChildren)===null||c===void 0||c.forEach(C=>{var h;return(h=C.animationState)===null||h===void 0?void 0:h.setActive(l,g)}),t[l].isActive=g;const u=r(l);for(const C in t)t[C].protectedKeys={};return u}return{animateChanges:r,setActive:a,setAnimateFunction:o,getState:()=>t,reset:()=>{t=oN(),i=!0}}}function ete(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!SY(e,n):!1}function tc(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function oN(){return{animate:tc(!0),whileInView:tc(),whileHover:tc(),whileTap:tc(),whileDrag:tc(),whileFocus:tc(),exit:tc()}}class mg{constructor(e){this.isMounted=!1,this.node=e}update(){}}class tte extends mg{constructor(e){super(e),e.animationState||(e.animationState=$ee(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Th(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:t}=this.node.prevProps||{};e!==t&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let nte=0;class ite extends mg{constructor(){super(...arguments),this.id=nte++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:t}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===i)return;const s=this.node.animationState.setActive("exit",!e);t&&!e&&s.then(()=>t(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const ste={animation:{Feature:tte},exit:{Feature:ite}},CK=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1;function ry(n,e="page"){return{point:{x:n[`${e}X`],y:n[`${e}Y`]}}}const ote=n=>e=>CK(e)&&n(e,ry(e));function Xa(n,e,t,i={passive:!0}){return n.addEventListener(e,t,i),()=>n.removeEventListener(e,t)}function La(n,e,t,i){return Xa(n,e,ote(t),i)}const rN=(n,e)=>Math.abs(n-e);function rte(n,e){const t=rN(n.x,e.x),i=rN(n.y,e.y);return Math.sqrt(t**2+i**2)}class hK{constructor(e,t,{transformPagePoint:i,contextWindow:s,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const u=ov(this.lastMoveEventInfo,this.history),C=this.startEvent!==null,h=rte(u.offset,{x:0,y:0})>=3;if(!C&&!h)return;const{point:p}=u,{timestamp:b}=Li;this.history.push({...p,timestamp:b});const{onStart:m,onMove:A}=this.handlers;C||(m&&m(this.lastMoveEvent,u),this.startEvent=this.lastMoveEvent),A&&A(this.lastMoveEvent,u)},this.handlePointerMove=(u,C)=>{this.lastMoveEvent=u,this.lastMoveEventInfo=sv(C,this.transformPagePoint),Gn.update(this.updatePoint,!0)},this.handlePointerUp=(u,C)=>{this.end();const{onEnd:h,onSessionEnd:p,resumeAnimation:b}=this.handlers;if(this.dragSnapToOrigin&&b&&b(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=ov(u.type==="pointercancel"?this.lastMoveEventInfo:sv(C,this.transformPagePoint),this.history);this.startEvent&&h&&h(u,m),p&&p(u,m)},!CK(e))return;this.dragSnapToOrigin=o,this.handlers=t,this.transformPagePoint=i,this.contextWindow=s||window;const r=ry(e),a=sv(r,this.transformPagePoint),{point:l}=a,{timestamp:g}=Li;this.history=[{...l,timestamp:g}];const{onSessionStart:c}=t;c&&c(e,ov(a,this.history)),this.removeListeners=_a(La(this.contextWindow,"pointermove",this.handlePointerMove),La(this.contextWindow,"pointerup",this.handlePointerUp),La(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ig(this.updatePoint)}}function sv(n,e){return e?{point:e(n.point)}:n}function aN(n,e){return{x:n.x-e.x,y:n.y-e.y}}function ov({point:n},e){return{point:n,delta:aN(n,AK(e)),offset:aN(n,ate(e)),velocity:lte(e,.1)}}function ate(n){return n[0]}function AK(n){return n[n.length-1]}function lte(n,e){if(n.length<2)return{x:0,y:0};let t=n.length-1,i=null;const s=AK(n);for(;t>=0&&(i=n[t],!(s.timestamp-i.timestamp>Ya(e)));)t--;if(!i)return{x:0,y:0};const o=Ka(s.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const r={x:(s.x-i.x)/o,y:(s.y-i.y)/o};return r.x===1/0&&(r.x=0),r.y===1/0&&(r.y=0),r}function pK(n){let e=null;return()=>{const t=()=>{e=null};return e===null?(e=n,t):!1}}const lN=pK("dragHorizontal"),gN=pK("dragVertical");function mK(n){let e=!1;if(n==="y")e=gN();else if(n==="x")e=lN();else{const t=lN(),i=gN();t&&i?e=()=>{t(),i()}:(t&&t(),i&&i())}return e}function fK(){const n=mK(!0);return n?(n(),!1):!0}function fI(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}const bK=1e-4,gte=1-bK,cte=1+bK,yK=.01,ute=0-yK,Ite=0+yK;function So(n){return n.max-n.min}function dte(n,e,t){return Math.abs(n-e)<=t}function cN(n,e,t,i=.5){n.origin=i,n.originPoint=Dn(e.min,e.max,n.origin),n.scale=So(t)/So(e),n.translate=Dn(t.min,t.max,n.origin)-n.originPoint,(n.scale>=gte&&n.scale<=cte||isNaN(n.scale))&&(n.scale=1),(n.translate>=ute&&n.translate<=Ite||isNaN(n.translate))&&(n.translate=0)}function jC(n,e,t,i){cN(n.x,e.x,t.x,i?i.originX:void 0),cN(n.y,e.y,t.y,i?i.originY:void 0)}function uN(n,e,t){n.min=t.min+e.min,n.max=n.min+So(e)}function Cte(n,e,t){uN(n.x,e.x,t.x),uN(n.y,e.y,t.y)}function IN(n,e,t){n.min=e.min-t.min,n.max=n.min+So(e)}function qC(n,e,t){IN(n.x,e.x,t.x),IN(n.y,e.y,t.y)}function hte(n,{min:e,max:t},i){return e!==void 0&&n<e?n=i?Dn(e,n,i.min):Math.max(n,e):t!==void 0&&n>t&&(n=i?Dn(t,n,i.max):Math.min(n,t)),n}function dN(n,e,t){return{min:e!==void 0?n.min+e:void 0,max:t!==void 0?n.max+t-(n.max-n.min):void 0}}function Ate(n,{top:e,left:t,bottom:i,right:s}){return{x:dN(n.x,t,s),y:dN(n.y,e,i)}}function CN(n,e){let t=e.min-n.min,i=e.max-n.max;return e.max-e.min<n.max-n.min&&([t,i]=[i,t]),{min:t,max:i}}function pte(n,e){return{x:CN(n.x,e.x),y:CN(n.y,e.y)}}function mte(n,e){let t=.5;const i=So(n),s=So(e);return s>i?t=UI(e.min,e.max-i,n.min):i>s&&(t=UI(n.min,n.max-s,e.min)),sg(0,1,t)}function fte(n,e){const t={};return e.min!==void 0&&(t.min=e.min-n.min),e.max!==void 0&&(t.max=e.max-n.min),t}const j2=.35;function bte(n=j2){return n===!1?n=0:n===!0&&(n=j2),{x:hN(n,"left","right"),y:hN(n,"top","bottom")}}function hN(n,e,t){return{min:AN(n,e),max:AN(n,t)}}function AN(n,e){return typeof n=="number"?n:n[e]||0}const pN=()=>({translate:0,scale:1,origin:0,originPoint:0}),bI=()=>({x:pN(),y:pN()}),mN=()=>({min:0,max:0}),ci=()=>({x:mN(),y:mN()});function zo(n){return[n("x"),n("y")]}function BK({top:n,left:e,right:t,bottom:i}){return{x:{min:e,max:t},y:{min:n,max:i}}}function yte({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function Bte(n,e){if(!e)return n;const t=e({x:n.left,y:n.top}),i=e({x:n.right,y:n.bottom});return{top:t.y,left:t.x,bottom:i.y,right:i.x}}function rv(n){return n===void 0||n===1}function q2({scale:n,scaleX:e,scaleY:t}){return!rv(n)||!rv(e)||!rv(t)}function lc(n){return q2(n)||GK(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function GK(n){return fN(n.x)||fN(n.y)}function fN(n){return n&&n!=="0%"}function R0(n,e,t){const i=n-t,s=e*i;return t+s}function bN(n,e,t,i,s){return s!==void 0&&(n=R0(n,s,i)),R0(n,t,i)+e}function $2(n,e=0,t=1,i,s){n.min=bN(n.min,e,t,i,s),n.max=bN(n.max,e,t,i,s)}function vK(n,{x:e,y:t}){$2(n.x,e.translate,e.scale,e.originPoint),$2(n.y,t.translate,t.scale,t.originPoint)}const yN=.999999999999,BN=1.0000000000001;function Gte(n,e,t,i=!1){const s=t.length;if(!s)return;e.x=e.y=1;let o,r;for(let a=0;a<s;a++){o=t[a],r=o.projectionDelta;const{visualElement:l}=o.options;l&&l.props.style&&l.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&BI(n,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),r&&(e.x*=r.x.scale,e.y*=r.y.scale,vK(n,r)),i&&lc(o.latestValues)&&BI(n,o.latestValues))}e.x<BN&&e.x>yN&&(e.x=1),e.y<BN&&e.y>yN&&(e.y=1)}function yI(n,e){n.min=n.min+e,n.max=n.max+e}function GN(n,e,t,i,s=.5){const o=Dn(n.min,n.max,s);$2(n,e,t,o,i)}function BI(n,e){GN(n.x,e.x,e.scaleX,e.scale,e.originX),GN(n.y,e.y,e.scaleY,e.scale,e.originY)}function wK(n,e){return BK(Bte(n.getBoundingClientRect(),e))}function vte(n,e,t){const i=wK(n,t),{scroll:s}=e;return s&&(yI(i.x,s.offset.x),yI(i.y,s.offset.y)),i}const ZK=({current:n})=>n?n.ownerDocument.defaultView:null,wte=new WeakMap;class Zte{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ci(),this.visualElement=e}start(e,{snapToCursor:t=!1}={}){const{presenceContext:i}=this.visualElement;if(i&&i.isPresent===!1)return;const s=c=>{const{dragSnapToOrigin:u}=this.getProps();u?this.pauseAnimation():this.stopAnimation(),t&&this.snapToCursor(ry(c,"page").point)},o=(c,u)=>{const{drag:C,dragPropagation:h,onDragStart:p}=this.getProps();if(C&&!h&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=mK(C),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),zo(m=>{let A=this.getAxisMotionValue(m).get()||0;if(sa.test(A)){const{projection:B}=this.visualElement;if(B&&B.layout){const G=B.layout.layoutBox[m];G&&(A=So(G)*(parseFloat(A)/100))}}this.originPoint[m]=A}),p&&Gn.postRender(()=>p(c,u)),O2(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},r=(c,u)=>{const{dragPropagation:C,dragDirectionLock:h,onDirectionLock:p,onDrag:b}=this.getProps();if(!C&&!this.openGlobalLock)return;const{offset:m}=u;if(h&&this.currentDirection===null){this.currentDirection=Ste(m),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",u.point,m),this.updateAxis("y",u.point,m),this.visualElement.render(),b&&b(c,u)},a=(c,u)=>this.stop(c,u),l=()=>zo(c=>{var u;return this.getAnimationState(c)==="paused"&&((u=this.getAxisMotionValue(c).animation)===null||u===void 0?void 0:u.play())}),{dragSnapToOrigin:g}=this.getProps();this.panSession=new hK(e,{onSessionStart:s,onStart:o,onMove:r,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:g,contextWindow:ZK(this.visualElement)})}stop(e,t){const i=this.isDragging;if(this.cancel(),!i)return;const{velocity:s}=t;this.startAnimation(s);const{onDragEnd:o}=this.getProps();o&&Gn.postRender(()=>o(e,t))}cancel(){this.isDragging=!1;const{projection:e,animationState:t}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:i}=this.getProps();!i&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),t&&t.setActive("whileDrag",!1)}updateAxis(e,t,i){const{drag:s}=this.getProps();if(!i||!Vm(e,s,this.currentDirection))return;const o=this.getAxisMotionValue(e);let r=this.originPoint[e]+i[e];this.constraints&&this.constraints[e]&&(r=hte(r,this.constraints[e],this.elastic[e])),o.set(r)}resolveConstraints(){var e;const{dragConstraints:t,dragElastic:i}=this.getProps(),s=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,o=this.constraints;t&&fI(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&s?this.constraints=Ate(s.layoutBox,t):this.constraints=!1,this.elastic=bte(i),o!==this.constraints&&s&&this.constraints&&!this.hasMutatedConstraints&&zo(r=>{this.constraints!==!1&&this.getAxisMotionValue(r)&&(this.constraints[r]=fte(s.layoutBox[r],this.constraints[r]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:t}=this.getProps();if(!e||!fI(e))return!1;const i=e.current,{projection:s}=this.visualElement;if(!s||!s.layout)return!1;const o=vte(i,s.root,this.visualElement.getTransformPagePoint());let r=pte(s.layout.layoutBox,o);if(t){const a=t(yte(r));this.hasMutatedConstraints=!!a,a&&(r=BK(a))}return r}startAnimation(e){const{drag:t,dragMomentum:i,dragElastic:s,dragTransition:o,dragSnapToOrigin:r,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},g=zo(c=>{if(!Vm(c,t,this.currentDirection))return;let u=l&&l[c]||{};r&&(u={min:0,max:0});const C=s?200:1e6,h=s?40:1e7,p={type:"inertia",velocity:i?e[c]:0,bounceStiffness:C,bounceDamping:h,timeConstant:750,restDelta:1,restSpeed:10,...o,...u};return this.startAxisValueAnimation(c,p)});return Promise.all(g).then(a)}startAxisValueAnimation(e,t){const i=this.getAxisMotionValue(e);return O2(this.visualElement,e),i.start(NS(e,i,0,t,this.visualElement,!1))}stopAnimation(){zo(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){zo(e=>{var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.pause()})}getAnimationState(e){var t;return(t=this.getAxisMotionValue(e).animation)===null||t===void 0?void 0:t.state}getAxisMotionValue(e){const t=`_drag${e.toUpperCase()}`,i=this.visualElement.getProps(),s=i[t];return s||this.visualElement.getValue(e,(i.initial?i.initial[e]:void 0)||0)}snapToCursor(e){zo(t=>{const{drag:i}=this.getProps();if(!Vm(t,i,this.currentDirection))return;const{projection:s}=this.visualElement,o=this.getAxisMotionValue(t);if(s&&s.layout){const{min:r,max:a}=s.layout.layoutBox[t];o.set(e[t]-Dn(r,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:t}=this.getProps(),{projection:i}=this.visualElement;if(!fI(t)||!i||!this.constraints)return;this.stopAnimation();const s={x:0,y:0};zo(r=>{const a=this.getAxisMotionValue(r);if(a&&this.constraints!==!1){const l=a.get();s[r]=mte({min:l,max:l},this.constraints[r])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.resolveConstraints(),zo(r=>{if(!Vm(r,e,null))return;const a=this.getAxisMotionValue(r),{min:l,max:g}=this.constraints[r];a.set(Dn(l,g,s[r]))})}addListeners(){if(!this.visualElement.current)return;wte.set(this.visualElement,this);const e=this.visualElement.current,t=La(e,"pointerdown",l=>{const{drag:g,dragListener:c=!0}=this.getProps();g&&c&&this.start(l)}),i=()=>{const{dragConstraints:l}=this.getProps();fI(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:s}=this.visualElement,o=s.addEventListener("measure",i);s&&!s.layout&&(s.root&&s.root.updateScroll(),s.updateLayout()),Gn.read(i);const r=Xa(window,"resize",()=>this.scalePositionWithinConstraints()),a=s.addEventListener("didUpdate",({delta:l,hasLayoutChanged:g})=>{this.isDragging&&g&&(zo(c=>{const u=this.getAxisMotionValue(c);u&&(this.originPoint[c]+=l[c].translate,u.set(u.get()+l[c].translate))}),this.visualElement.render())});return()=>{r(),t(),o(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:t=!1,dragDirectionLock:i=!1,dragPropagation:s=!1,dragConstraints:o=!1,dragElastic:r=j2,dragMomentum:a=!0}=e;return{...e,drag:t,dragDirectionLock:i,dragPropagation:s,dragConstraints:o,dragElastic:r,dragMomentum:a}}}function Vm(n,e,t){return(e===!0||e===n)&&(t===null||t===n)}function Ste(n,e=10){let t=null;return Math.abs(n.y)>e?t="y":Math.abs(n.x)>e&&(t="x"),t}class Rte extends mg{constructor(e){super(e),this.removeGroupControls=ys,this.removeListeners=ys,this.controls=new Zte(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ys}unmount(){this.removeGroupControls(),this.removeListeners()}}const vN=n=>(e,t)=>{n&&Gn.postRender(()=>n(e,t))};class xte extends mg{constructor(){super(...arguments),this.removePointerDownListener=ys}onPointerDown(e){this.session=new hK(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ZK(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:t,onPan:i,onPanEnd:s}=this.node.getProps();return{onSessionStart:vN(e),onStart:vN(t),onMove:i,onEnd:(o,r)=>{delete this.session,s&&Gn.postRender(()=>s(o,r))}}}mount(){this.removePointerDownListener=La(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const TS=z.createContext(null);function Vte(){const n=z.useContext(TS);if(n===null)return[!0,null];const{isPresent:e,onExitComplete:t,register:i}=n,s=z.useId();z.useEffect(()=>i(s),[]);const o=z.useCallback(()=>t&&t(s),[s,t]);return!e&&t?[!1,o]:[!0]}const SK=z.createContext({}),RK=z.createContext({}),of={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function wN(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const fC={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Rt.test(n))n=parseFloat(n);else return n;const t=wN(n,e.target.x),i=wN(n,e.target.y);return`${t}% ${i}%`}},Wte={correct:(n,{treeScale:e,projectionDelta:t})=>{const i=n,s=og.parse(n);if(s.length>5)return i;const o=og.createTransformer(n),r=typeof s[0]!="number"?1:0,a=t.x.scale*e.x,l=t.y.scale*e.y;s[0+r]/=a,s[1+r]/=l;const g=Dn(a,l,.5);return typeof s[2+r]=="number"&&(s[2+r]/=g),typeof s[3+r]=="number"&&(s[3+r]/=g),o(s)}},x0={};function Mte(n){Object.assign(x0,n)}const{schedule:ES,cancel:Hge}=RY(queueMicrotask,!1);class Nte extends z.Component{componentDidMount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i,layoutId:s}=this.props,{projection:o}=e;Mte(Fte),o&&(t.group&&t.group.add(o),i&&i.register&&s&&i.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),of.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:t,visualElement:i,drag:s,isPresent:o}=this.props,r=i.projection;return r&&(r.isPresent=o,s||e.layoutDependency!==t||t===void 0?r.willUpdate():this.safeToRemove(),e.isPresent!==o&&(o?r.promote():r.relegate()||Gn.postRender(()=>{const a=r.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),ES.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:t,switchLayoutGroup:i}=this.props,{projection:s}=e;s&&(s.scheduleCheckAfterUnmount(),t&&t.group&&t.group.remove(s),i&&i.deregister&&i.deregister(s))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function xK(n){const[e,t]=Vte(),i=z.useContext(SK);return j.jsx(Nte,{...n,layoutGroup:i,switchLayoutGroup:z.useContext(RK),isPresent:e,safeToRemove:t})}const Fte={borderRadius:{...fC,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:fC,borderTopRightRadius:fC,borderBottomLeftRadius:fC,borderBottomRightRadius:fC,boxShadow:Wte},VK=["TopLeft","TopRight","BottomLeft","BottomRight"],Hte=VK.length,ZN=n=>typeof n=="string"?parseFloat(n):n,SN=n=>typeof n=="number"||Rt.test(n);function Xte(n,e,t,i,s,o){s?(n.opacity=Dn(0,t.opacity!==void 0?t.opacity:1,Tte(i)),n.opacityExit=Dn(e.opacity!==void 0?e.opacity:1,0,Ete(i))):o&&(n.opacity=Dn(e.opacity!==void 0?e.opacity:1,t.opacity!==void 0?t.opacity:1,i));for(let r=0;r<Hte;r++){const a=`border${VK[r]}Radius`;let l=RN(e,a),g=RN(t,a);if(l===void 0&&g===void 0)continue;l||(l=0),g||(g=0),l===0||g===0||SN(l)===SN(g)?(n[a]=Math.max(Dn(ZN(l),ZN(g),i),0),(sa.test(g)||sa.test(l))&&(n[a]+="%")):n[a]=g}(e.rotate||t.rotate)&&(n.rotate=Dn(e.rotate||0,t.rotate||0,i))}function RN(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const Tte=WK(0,.5,HY),Ete=WK(.5,.95,ys);function WK(n,e,t){return i=>i<n?0:i>e?1:t(UI(n,e,i))}function xN(n,e){n.min=e.min,n.max=e.max}function ko(n,e){xN(n.x,e.x),xN(n.y,e.y)}function VN(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function WN(n,e,t,i,s){return n-=e,n=R0(n,1/t,i),s!==void 0&&(n=R0(n,1/s,i)),n}function Yte(n,e=0,t=1,i=.5,s,o=n,r=n){if(sa.test(e)&&(e=parseFloat(e),e=Dn(r.min,r.max,e/100)-r.min),typeof e!="number")return;let a=Dn(o.min,o.max,i);n===o&&(a-=e),n.min=WN(n.min,e,t,a,s),n.max=WN(n.max,e,t,a,s)}function MN(n,e,[t,i,s],o,r){Yte(n,e[t],e[i],e[s],e.scale,o,r)}const Kte=["x","scaleX","originX"],_te=["y","scaleY","originY"];function NN(n,e,t,i){MN(n.x,e,Kte,t?t.x:void 0,i?i.x:void 0),MN(n.y,e,_te,t?t.y:void 0,i?i.y:void 0)}function FN(n){return n.translate===0&&n.scale===1}function MK(n){return FN(n.x)&&FN(n.y)}function HN(n,e){return n.min===e.min&&n.max===e.max}function Lte(n,e){return HN(n.x,e.x)&&HN(n.y,e.y)}function XN(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function NK(n,e){return XN(n.x,e.x)&&XN(n.y,e.y)}function TN(n){return So(n.x)/So(n.y)}function EN(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class kte{constructor(){this.members=[]}add(e){FS(this.members,e),e.scheduleRender()}remove(e){if(HS(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const t=this.members[this.members.length-1];t&&this.promote(t)}}relegate(e){const t=this.members.findIndex(s=>e===s);if(t===0)return!1;let i;for(let s=t;s>=0;s--){const o=this.members[s];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(e,t){const i=this.lead;if(e!==i&&(this.prevLead=i,this.lead=e,e.show(),i)){i.instance&&i.scheduleRender(),e.scheduleRender(),e.resumeFrom=i,t&&(e.resumeFrom.preserveOpacity=!0),i.snapshot&&(e.snapshot=i.snapshot,e.snapshot.latestValues=i.animationValues||i.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:s}=e.options;s===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:t,resumingFrom:i}=e;t.onExitComplete&&t.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function zte(n,e,t){let i="";const s=n.x.translate/e.x,o=n.y.translate/e.y,r=(t==null?void 0:t.z)||0;if((s||o||r)&&(i=`translate3d(${s}px, ${o}px, ${r}px) `),(e.x!==1||e.y!==1)&&(i+=`scale(${1/e.x}, ${1/e.y}) `),t){const{transformPerspective:g,rotate:c,rotateX:u,rotateY:C,skewX:h,skewY:p}=t;g&&(i=`perspective(${g}px) ${i}`),c&&(i+=`rotate(${c}deg) `),u&&(i+=`rotateX(${u}deg) `),C&&(i+=`rotateY(${C}deg) `),h&&(i+=`skewX(${h}deg) `),p&&(i+=`skewY(${p}deg) `)}const a=n.x.scale*e.x,l=n.y.scale*e.y;return(a!==1||l!==1)&&(i+=`scale(${a}, ${l})`),i||"none"}const Dte=(n,e)=>n.depth-e.depth;class Pte{constructor(){this.children=[],this.isDirty=!1}add(e){FS(this.children,e),this.isDirty=!0}remove(e){HS(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Dte),this.isDirty=!1,this.children.forEach(e)}}function rf(n){const e=bs(n)?n.get():n;return Tee(e)?e.toValue():e}function Ute(n,e){const t=oa.now(),i=({timestamp:s})=>{const o=s-t;o>=e&&(ig(i),n(o-e))};return Gn.read(i,!0),()=>ig(i)}function Jte(n){return n instanceof SVGElement&&n.tagName!=="svg"}function Ote(n,e,t){const i=bs(n)?n:_h(n);return i.start(NS("",i,e,t)),i.animation}const gc={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},VC=typeof window<"u"&&window.MotionDebug!==void 0,av=["","X","Y","Z"],Qte={visibility:"hidden"},YN=1e3;let jte=0;function lv(n,e,t,i){const{latestValues:s}=e;s[n]&&(t[n]=s[n],e.setStaticValue(n,0),i&&(i[n]=0))}function FK(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const t=uK(e);if(window.MotionHasOptimisedAnimation(t,"transform")){const{layout:s,layoutId:o}=n.options;window.MotionCancelOptimisedAnimation(t,"transform",Gn,!(s||o))}const{parent:i}=n;i&&!i.hasCheckedOptimisedAppear&&FK(i)}function HK({attachResizeListener:n,defaultParent:e,measureScroll:t,checkIsScrollRoot:i,resetTransform:s}){return class{constructor(r={},a=e==null?void 0:e()){this.id=jte++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,VC&&(gc.totalNodes=gc.resolvedTargetDeltas=gc.recalculatedProjection=0),this.nodes.forEach(ene),this.nodes.forEach(one),this.nodes.forEach(rne),this.nodes.forEach(tne),VC&&window.MotionDebug.record(gc)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=r,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Pte)}addEventListener(r,a){return this.eventHandlers.has(r)||this.eventHandlers.set(r,new XS),this.eventHandlers.get(r).add(a)}notifyListeners(r,...a){const l=this.eventHandlers.get(r);l&&l.notify(...a)}hasListeners(r){return this.eventHandlers.has(r)}mount(r,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Jte(r),this.instance=r;const{layoutId:l,layout:g,visualElement:c}=this.options;if(c&&!c.current&&c.mount(r),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(g||l)&&(this.isLayoutDirty=!0),n){let u;const C=()=>this.root.updateBlockedByResize=!1;n(r,()=>{this.root.updateBlockedByResize=!0,u&&u(),u=Ute(C,250),of.hasAnimatedSinceResize&&(of.hasAnimatedSinceResize=!1,this.nodes.forEach(_N))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&c&&(l||g)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:C,hasRelativeTargetChanged:h,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const b=this.options.transition||c.getDefaultTransition()||une,{onLayoutAnimationStart:m,onLayoutAnimationComplete:A}=c.getProps(),B=!this.targetLayout||!NK(this.targetLayout,p)||h,G=!C&&h;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||G||C&&(B||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(u,G);const w={...fS(b,"layout"),onPlay:m,onComplete:A};(c.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w)}else C||_N(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const r=this.getStack();r&&r.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ig(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(ane),this.animationId++)}getTransformTemplate(){const{visualElement:r}=this.options;return r&&r.getProps().transformTemplate}willUpdate(r=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&FK(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let c=0;c<this.path.length;c++){const u=this.path[c];u.shouldResetTransform=!0,u.updateScroll("snapshot"),u.options.layoutRoot&&u.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const g=this.getTransformTemplate();this.prevTransformTemplateValue=g?g(this.latestValues,""):void 0,this.updateSnapshot(),r&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(KN);return}this.isUpdating||this.nodes.forEach(ine),this.isUpdating=!1,this.nodes.forEach(sne),this.nodes.forEach(qte),this.nodes.forEach($te),this.clearAllSnapshots();const a=oa.now();Li.delta=sg(0,1e3/60,a-Li.timestamp),Li.timestamp=a,Li.isProcessing=!0,$G.update.process(Li),$G.preRender.process(Li),$G.render.process(Li),Li.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,ES.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(nne),this.sharedNodes.forEach(lne)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Gn.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Gn.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const r=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ci(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,r?r.layoutBox:void 0)}updateScroll(r="measure"){let a=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===r&&(a=!1),a){const l=i(this.instance);this.scroll={animationId:this.root.animationId,phase:r,isRoot:l,offset:t(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!s)return;const r=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,a=this.projectionDelta&&!MK(this.projectionDelta),l=this.getTransformTemplate(),g=l?l(this.latestValues,""):void 0,c=g!==this.prevTransformTemplateValue;r&&(a||lc(this.latestValues)||c)&&(s(this.instance,g),this.shouldResetTransform=!1,this.scheduleRender())}measure(r=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return r&&(l=this.removeTransform(l)),Ine(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){var r;const{visualElement:a}=this.options;if(!a)return ci();const l=a.measureViewportBox();if(!(((r=this.scroll)===null||r===void 0?void 0:r.wasRoot)||this.path.some(dne))){const{scroll:c}=this.root;c&&(yI(l.x,c.offset.x),yI(l.y,c.offset.y))}return l}removeElementScroll(r){var a;const l=ci();if(ko(l,r),!((a=this.scroll)===null||a===void 0)&&a.wasRoot)return l;for(let g=0;g<this.path.length;g++){const c=this.path[g],{scroll:u,options:C}=c;c!==this.root&&u&&C.layoutScroll&&(u.wasRoot&&ko(l,r),yI(l.x,u.offset.x),yI(l.y,u.offset.y))}return l}applyTransform(r,a=!1){const l=ci();ko(l,r);for(let g=0;g<this.path.length;g++){const c=this.path[g];!a&&c.options.layoutScroll&&c.scroll&&c!==c.root&&BI(l,{x:-c.scroll.offset.x,y:-c.scroll.offset.y}),lc(c.latestValues)&&BI(l,c.latestValues)}return lc(this.latestValues)&&BI(l,this.latestValues),l}removeTransform(r){const a=ci();ko(a,r);for(let l=0;l<this.path.length;l++){const g=this.path[l];if(!g.instance||!lc(g.latestValues))continue;q2(g.latestValues)&&g.updateSnapshot();const c=ci(),u=g.measurePageBox();ko(c,u),NN(a,g.latestValues,g.snapshot?g.snapshot.layoutBox:void 0,c)}return lc(this.latestValues)&&NN(a,this.latestValues),a}setTargetDelta(r){this.targetDelta=r,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(r){this.options={...this.options,...r,crossfade:r.crossfade!==void 0?r.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Li.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(r=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const g=!!this.resumingFrom||this!==l;if(!(r||g&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:C}=this.options;if(!(!this.layout||!(u||C))){if(this.resolvedRelativeTargetAt=Li.timestamp,!this.targetDelta&&!this.relativeTarget){const h=this.getClosestProjectingParent();h&&h.layout&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ci(),this.relativeTargetOrigin=ci(),qC(this.relativeTargetOrigin,this.layout.layoutBox,h.layout.layoutBox),ko(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ci(),this.targetWithTransforms=ci()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Cte(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ko(this.target,this.layout.layoutBox),vK(this.target,this.targetDelta)):ko(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const h=this.getClosestProjectingParent();h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?(this.relativeParent=h,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ci(),this.relativeTargetOrigin=ci(),qC(this.relativeTargetOrigin,this.target,h.target),ko(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}VC&&gc.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||q2(this.parent.latestValues)||GK(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var r;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let g=!0;if((this.isProjectionDirty||!((r=this.parent)===null||r===void 0)&&r.isProjectionDirty)&&(g=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(g=!1),this.resolvedRelativeTargetAt===Li.timestamp&&(g=!1),g)return;const{layout:c,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||u))return;ko(this.layoutCorrected,this.layout.layoutBox);const C=this.treeScale.x,h=this.treeScale.y;Gte(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=ci());const{target:p}=a;if(!p){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(VN(this.prevProjectionDelta.x,this.projectionDelta.x),VN(this.prevProjectionDelta.y,this.projectionDelta.y)),jC(this.projectionDelta,this.layoutCorrected,p,this.latestValues),(this.treeScale.x!==C||this.treeScale.y!==h||!EN(this.projectionDelta.x,this.prevProjectionDelta.x)||!EN(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p)),VC&&gc.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(r=!0){var a;if((a=this.options.visualElement)===null||a===void 0||a.scheduleRender(),r){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=bI(),this.projectionDelta=bI(),this.projectionDeltaWithTransform=bI()}setAnimationOrigin(r,a=!1){const l=this.snapshot,g=l?l.latestValues:{},c={...this.latestValues},u=bI();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const C=ci(),h=l?l.source:void 0,p=this.layout?this.layout.source:void 0,b=h!==p,m=this.getStack(),A=!m||m.members.length<=1,B=!!(b&&!A&&this.options.crossfade===!0&&!this.path.some(cne));this.animationProgress=0;let G;this.mixTargetDelta=w=>{const N=w/1e3;LN(u.x,r.x,N),LN(u.y,r.y,N),this.setTargetDelta(u),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(qC(C,this.layout.layoutBox,this.relativeParent.layout.layoutBox),gne(this.relativeTarget,this.relativeTargetOrigin,C,N),G&&Lte(this.relativeTarget,G)&&(this.isProjectionDirty=!1),G||(G=ci()),ko(G,this.relativeTarget)),b&&(this.animationValues=c,Xte(c,g,this.latestValues,N,B,A)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=N},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(r){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ig(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Gn.update(()=>{of.hasAnimatedSinceResize=!0,this.currentAnimation=Ote(0,YN,{...r,onUpdate:a=>{this.mixTargetDelta(a),r.onUpdate&&r.onUpdate(a)},onComplete:()=>{r.onComplete&&r.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const r=this.getStack();r&&r.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(YN),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const r=this.getLead();let{targetWithTransforms:a,target:l,layout:g,latestValues:c}=r;if(!(!a||!l||!g)){if(this!==r&&this.layout&&g&&XK(this.options.animationType,this.layout.layoutBox,g.layoutBox)){l=this.target||ci();const u=So(this.layout.layoutBox.x);l.x.min=r.target.x.min,l.x.max=l.x.min+u;const C=So(this.layout.layoutBox.y);l.y.min=r.target.y.min,l.y.max=l.y.min+C}ko(a,l),BI(a,c),jC(this.projectionDeltaWithTransform,this.layoutCorrected,a,c)}}registerSharedNode(r,a){this.sharedNodes.has(r)||this.sharedNodes.set(r,new kte),this.sharedNodes.get(r).add(a);const g=a.options.initialPromotionConfig;a.promote({transition:g?g.transition:void 0,preserveFollowOpacity:g&&g.shouldPreserveFollowOpacity?g.shouldPreserveFollowOpacity(a):void 0})}isLead(){const r=this.getStack();return r?r.lead===this:!0}getLead(){var r;const{layoutId:a}=this.options;return a?((r=this.getStack())===null||r===void 0?void 0:r.lead)||this:this}getPrevLead(){var r;const{layoutId:a}=this.options;return a?(r=this.getStack())===null||r===void 0?void 0:r.prevLead:void 0}getStack(){const{layoutId:r}=this.options;if(r)return this.root.sharedNodes.get(r)}promote({needsReset:r,transition:a,preserveFollowOpacity:l}={}){const g=this.getStack();g&&g.promote(this,l),r&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const r=this.getStack();return r?r.relegate(this):!1}resetSkewAndRotation(){const{visualElement:r}=this.options;if(!r)return;let a=!1;const{latestValues:l}=r;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(a=!0),!a)return;const g={};l.z&&lv("z",r,g,this.animationValues);for(let c=0;c<av.length;c++)lv(`rotate${av[c]}`,r,g,this.animationValues),lv(`skew${av[c]}`,r,g,this.animationValues);r.render();for(const c in g)r.setStaticValue(c,g[c]),this.animationValues&&(this.animationValues[c]=g[c]);r.scheduleRender()}getProjectionStyles(r){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Qte;const g={visibility:""},c=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,g.opacity="",g.pointerEvents=rf(r==null?void 0:r.pointerEvents)||"",g.transform=c?c(this.latestValues,""):"none",g;const u=this.getLead();if(!this.projectionDelta||!this.layout||!u.target){const b={};return this.options.layoutId&&(b.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,b.pointerEvents=rf(r==null?void 0:r.pointerEvents)||""),this.hasProjected&&!lc(this.latestValues)&&(b.transform=c?c({},""):"none",this.hasProjected=!1),b}const C=u.animationValues||u.latestValues;this.applyTransformsToTarget(),g.transform=zte(this.projectionDeltaWithTransform,this.treeScale,C),c&&(g.transform=c(C,g.transform));const{x:h,y:p}=this.projectionDelta;g.transformOrigin=`${h.origin*100}% ${p.origin*100}% 0`,u.animationValues?g.opacity=u===this?(l=(a=C.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:C.opacityExit:g.opacity=u===this?C.opacity!==void 0?C.opacity:"":C.opacityExit!==void 0?C.opacityExit:0;for(const b in x0){if(C[b]===void 0)continue;const{correct:m,applyTo:A}=x0[b],B=g.transform==="none"?C[b]:m(C[b],u);if(A){const G=A.length;for(let w=0;w<G;w++)g[A[w]]=B}else g[b]=B}return this.options.layoutId&&(g.pointerEvents=u===this?rf(r==null?void 0:r.pointerEvents)||"":"none"),g}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(r=>{var a;return(a=r.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(KN),this.root.sharedNodes.clear()}}}function qte(n){n.updateLayout()}function $te(n){var e;const t=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&t&&n.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:s}=n.layout,{animationType:o}=n.options,r=t.source!==n.layout.source;o==="size"?zo(u=>{const C=r?t.measuredBox[u]:t.layoutBox[u],h=So(C);C.min=i[u].min,C.max=C.min+h}):XK(o,t.layoutBox,i)&&zo(u=>{const C=r?t.measuredBox[u]:t.layoutBox[u],h=So(i[u]);C.max=C.min+h,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[u].max=n.relativeTarget[u].min+h)});const a=bI();jC(a,i,t.layoutBox);const l=bI();r?jC(l,n.applyTransform(s,!0),t.measuredBox):jC(l,i,t.layoutBox);const g=!MK(a);let c=!1;if(!n.resumeFrom){const u=n.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:C,layout:h}=u;if(C&&h){const p=ci();qC(p,t.layoutBox,C.layoutBox);const b=ci();qC(b,i,h.layoutBox),NK(p,b)||(c=!0),u.options.layoutRoot&&(n.relativeTarget=b,n.relativeTargetOrigin=p,n.relativeParent=u)}}}n.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:l,layoutDelta:a,hasLayoutChanged:g,hasRelativeTargetChanged:c})}else if(n.isLead()){const{onExitComplete:i}=n.options;i&&i()}n.options.transition=void 0}function ene(n){VC&&gc.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function tne(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function nne(n){n.clearSnapshot()}function KN(n){n.clearMeasurements()}function ine(n){n.isLayoutDirty=!1}function sne(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function _N(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function one(n){n.resolveTargetDelta()}function rne(n){n.calcProjection()}function ane(n){n.resetSkewAndRotation()}function lne(n){n.removeLeadSnapshot()}function LN(n,e,t){n.translate=Dn(e.translate,0,t),n.scale=Dn(e.scale,1,t),n.origin=e.origin,n.originPoint=e.originPoint}function kN(n,e,t,i){n.min=Dn(e.min,t.min,i),n.max=Dn(e.max,t.max,i)}function gne(n,e,t,i){kN(n.x,e.x,t.x,i),kN(n.y,e.y,t.y,i)}function cne(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const une={duration:.45,ease:[.4,0,.1,1]},zN=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),DN=zN("applewebkit/")&&!zN("chrome/")?Math.round:ys;function PN(n){n.min=DN(n.min),n.max=DN(n.max)}function Ine(n){PN(n.x),PN(n.y)}function XK(n,e,t){return n==="position"||n==="preserve-aspect"&&!dte(TN(e),TN(t),.2)}function dne(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const Cne=HK({attachResizeListener:(n,e)=>Xa(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),gv={current:void 0},TK=HK({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!gv.current){const n=new Cne({});n.mount(window),n.setOptions({layoutScroll:!0}),gv.current=n}return gv.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),hne={pan:{Feature:xte},drag:{Feature:Rte,ProjectionNode:TK,MeasureLayout:xK}};function UN(n,e){const t=e?"pointerenter":"pointerleave",i=e?"onHoverStart":"onHoverEnd",s=(o,r)=>{if(o.pointerType==="touch"||fK())return;const a=n.getProps();n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",e);const l=a[i];l&&Gn.postRender(()=>l(o,r))};return La(n.current,t,s,{passive:!n.getProps()[i]})}class Ane extends mg{mount(){this.unmount=_a(UN(this.node,!0),UN(this.node,!1))}unmount(){}}class pne extends mg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=_a(Xa(this.node.current,"focus",()=>this.onFocus()),Xa(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const EK=(n,e)=>e?n===e?!0:EK(n,e.parentElement):!1;function cv(n,e){if(!e)return;const t=new PointerEvent("pointer"+n);e(t,ry(t))}class mne extends mg{constructor(){super(...arguments),this.removeStartListeners=ys,this.removeEndListeners=ys,this.removeAccessibleListeners=ys,this.startPointerPress=(e,t)=>{if(this.isPressing)return;this.removeEndListeners();const i=this.node.getProps(),o=La(window,"pointerup",(a,l)=>{if(!this.checkPressEnd())return;const{onTap:g,onTapCancel:c,globalTapTarget:u}=this.node.getProps(),C=!u&&!EK(this.node.current,a.target)?c:g;C&&Gn.update(()=>C(a,l))},{passive:!(i.onTap||i.onPointerUp)}),r=La(window,"pointercancel",(a,l)=>this.cancelPress(a,l),{passive:!(i.onTapCancel||i.onPointerCancel)});this.removeEndListeners=_a(o,r),this.startPress(e,t)},this.startAccessiblePress=()=>{const e=o=>{if(o.key!=="Enter"||this.isPressing)return;const r=a=>{a.key!=="Enter"||!this.checkPressEnd()||cv("up",(l,g)=>{const{onTap:c}=this.node.getProps();c&&Gn.postRender(()=>c(l,g))})};this.removeEndListeners(),this.removeEndListeners=Xa(this.node.current,"keyup",r),cv("down",(a,l)=>{this.startPress(a,l)})},t=Xa(this.node.current,"keydown",e),i=()=>{this.isPressing&&cv("cancel",(o,r)=>this.cancelPress(o,r))},s=Xa(this.node.current,"blur",i);this.removeAccessibleListeners=_a(t,s)}}startPress(e,t){this.isPressing=!0;const{onTapStart:i,whileTap:s}=this.node.getProps();s&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),i&&Gn.postRender(()=>i(e,t))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!fK()}cancelPress(e,t){if(!this.checkPressEnd())return;const{onTapCancel:i}=this.node.getProps();i&&Gn.postRender(()=>i(e,t))}mount(){const e=this.node.getProps(),t=La(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),i=Xa(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=_a(t,i)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const ew=new WeakMap,uv=new WeakMap,fne=n=>{const e=ew.get(n.target);e&&e(n)},bne=n=>{n.forEach(fne)};function yne({root:n,...e}){const t=n||document;uv.has(t)||uv.set(t,{});const i=uv.get(t),s=JSON.stringify(e);return i[s]||(i[s]=new IntersectionObserver(bne,{root:n,...e})),i[s]}function Bne(n,e,t){const i=yne(e);return ew.set(n,t),i.observe(n),()=>{ew.delete(n),i.unobserve(n)}}const Gne={some:0,all:1};class vne extends mg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:t,margin:i,amount:s="some",once:o}=e,r={root:t?t.current:void 0,rootMargin:i,threshold:typeof s=="number"?s:Gne[s]},a=l=>{const{isIntersecting:g}=l;if(this.isInView===g||(this.isInView=g,o&&!g&&this.hasEnteredView))return;g&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",g);const{onViewportEnter:c,onViewportLeave:u}=this.node.getProps(),C=g?c:u;C&&C(l)};return Bne(this.node.current,r,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:t}=this.node;["amount","margin","root"].some(wne(e,t))&&this.startObserver()}unmount(){}}function wne({viewport:n={}},{viewport:e={}}={}){return t=>n[t]!==e[t]}const Zne={inView:{Feature:vne},tap:{Feature:mne},focus:{Feature:pne},hover:{Feature:Ane}},Sne={layout:{ProjectionNode:TK,MeasureLayout:xK}},YK=z.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"}),ay=z.createContext({}),YS=typeof window<"u",Rne=YS?z.useLayoutEffect:z.useEffect,KK=z.createContext({strict:!1});function xne(n,e,t,i,s){var o,r;const{visualElement:a}=z.useContext(ay),l=z.useContext(KK),g=z.useContext(TS),c=z.useContext(YK).reducedMotion,u=z.useRef();i=i||l.renderer,!u.current&&i&&(u.current=i(n,{visualState:e,parent:a,props:t,presenceContext:g,blockInitialAnimation:g?g.initial===!1:!1,reducedMotionConfig:c}));const C=u.current,h=z.useContext(RK);C&&!C.projection&&s&&(C.type==="html"||C.type==="svg")&&Vne(u.current,t,s,h),z.useInsertionEffect(()=>{C&&C.update(t,g)});const p=t[cK],b=z.useRef(!!p&&!(!((o=window.MotionHandoffIsComplete)===null||o===void 0)&&o.call(window,p))&&((r=window.MotionHasOptimisedAnimation)===null||r===void 0?void 0:r.call(window,p)));return Rne(()=>{C&&(window.MotionIsMounted=!0,C.updateFeatures(),ES.render(C.render),b.current&&C.animationState&&C.animationState.animateChanges())}),z.useEffect(()=>{C&&(!b.current&&C.animationState&&C.animationState.animateChanges(),b.current&&(queueMicrotask(()=>{var m;(m=window.MotionHandoffMarkAsComplete)===null||m===void 0||m.call(window,p)}),b.current=!1))}),C}function Vne(n,e,t,i){const{layoutId:s,layout:o,drag:r,dragConstraints:a,layoutScroll:l,layoutRoot:g}=e;n.projection=new t(n.latestValues,e["data-framer-portal-id"]?void 0:_K(n.parent)),n.projection.setOptions({layoutId:s,layout:o,alwaysMeasureLayout:!!r||a&&fI(a),visualElement:n,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,layoutScroll:l,layoutRoot:g})}function _K(n){if(n)return n.options.allowProjection!==!1?n.projection:_K(n.parent)}function Wne(n,e,t){return z.useCallback(i=>{i&&n.mount&&n.mount(i),e&&(i?e.mount(i):e.unmount()),t&&(typeof t=="function"?t(i):fI(t)&&(t.current=i))},[e])}function ly(n){return Th(n.animate)||mS.some(e=>Eh(n[e]))}function LK(n){return!!(ly(n)||n.variants)}function Mne(n,e){if(ly(n)){const{initial:t,animate:i}=n;return{initial:t===!1||Eh(t)?t:void 0,animate:Eh(i)?i:void 0}}return n.inherit!==!1?e:{}}function Nne(n){const{initial:e,animate:t}=Mne(n,z.useContext(ay));return z.useMemo(()=>({initial:e,animate:t}),[JN(e),JN(t)])}function JN(n){return Array.isArray(n)?n.join(" "):n}const ON={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},JI={};for(const n in ON)JI[n]={isEnabled:e=>ON[n].some(t=>!!e[t])};function Fne(n){for(const e in n)JI[e]={...JI[e],...n[e]}}const Hne=Symbol.for("motionComponentSymbol");function Xne({preloadedFeatures:n,createVisualElement:e,useRender:t,useVisualState:i,Component:s}){n&&Fne(n);function o(a,l){let g;const c={...z.useContext(YK),...a,layoutId:Tne(a)},{isStatic:u}=c,C=Nne(a),h=i(a,u);if(!u&&YS){Ene();const p=Yne(c);g=p.MeasureLayout,C.visualElement=xne(s,h,c,e,p.ProjectionNode)}return j.jsxs(ay.Provider,{value:C,children:[g&&C.visualElement?j.jsx(g,{visualElement:C.visualElement,...c}):null,t(s,a,Wne(h,C.visualElement,l),h,u,C.visualElement)]})}const r=z.forwardRef(o);return r[Hne]=s,r}function Tne({layoutId:n}){const e=z.useContext(SK).id;return e&&n!==void 0?e+"-"+n:n}function Ene(n,e){z.useContext(KK).strict}function Yne(n){const{drag:e,layout:t}=JI;if(!e&&!t)return{};const i={...e,...t};return{MeasureLayout:e!=null&&e.isEnabled(n)||t!=null&&t.isEnabled(n)?i.MeasureLayout:void 0,ProjectionNode:i.ProjectionNode}}const Kne=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function KS(n){return typeof n!="string"||n.includes("-")?!1:!!(Kne.indexOf(n)>-1||/[A-Z]/u.test(n))}function kK(n,{style:e,vars:t},i,s){Object.assign(n.style,e,s&&s.getProjectionStyles(i));for(const o in t)n.style.setProperty(o,t[o])}const zK=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function DK(n,e,t,i){kK(n,e,void 0,i);for(const s in e.attrs)n.setAttribute(zK.has(s)?s:oy(s),e.attrs[s])}function PK(n,{layout:e,layoutId:t}){return pg.has(n)||n.startsWith("origin")||(e||t!==void 0)&&(!!x0[n]||n==="opacity")}function _S(n,e,t){var i;const{style:s}=n,o={};for(const r in s)(bs(s[r])||e.style&&bs(e.style[r])||PK(r,n)||((i=t==null?void 0:t.getValue(r))===null||i===void 0?void 0:i.liveStyle)!==void 0)&&(o[r]=s[r]);return t&&s&&typeof s.willChange=="string"&&(t.applyWillChange=!1),o}function UK(n,e,t){const i=_S(n,e,t);for(const s in n)if(bs(n[s])||bs(e[s])){const o=hA.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;i[o]=n[s]}return i}function _ne(n){const e=z.useRef(null);return e.current===null&&(e.current=n()),e.current}function Lne(n){if(pg.has(n))return"transform";if(rK.has(n))return oy(n)}function kne({applyWillChange:n=!1,scrapeMotionValuesFromProps:e,createRenderState:t,onMount:i},s,o,r,a){const l={latestValues:zne(s,o,r,a?!1:n,e),renderState:t()};return i&&(l.mount=g=>i(s,g,l)),l}const JK=n=>(e,t)=>{const i=z.useContext(ay),s=z.useContext(TS),o=()=>kne(n,e,i,s,t);return t?o():_ne(o)};function QN(n,e,t){const i=Array.isArray(e)?e:[e];for(let s=0;s<i.length;s++){const o=AS(n,i[s]);if(o){const{transitionEnd:r,transition:a,...l}=o;t(l,r)}}}function zne(n,e,t,i,s){var o;const r={},a=new Set,l=i&&((o=n.style)===null||o===void 0?void 0:o.willChange)===void 0,g=s(n,{});for(const m in g)r[m]=rf(g[m]);let{initial:c,animate:u}=n;const C=ly(n),h=LK(n);e&&h&&!C&&n.inherit!==!1&&(c===void 0&&(c=e.initial),u===void 0&&(u=e.animate));let p=t?t.initial===!1:!1;p=p||c===!1;const b=p?u:c;return b&&typeof b!="boolean"&&!Th(b)&&QN(n,b,(m,A)=>{for(const B in m){let G=m[B];if(Array.isArray(G)){const w=p?G.length-1:0;G=G[w]}G!==null&&(r[B]=G)}for(const B in A)r[B]=A[B]}),l&&(u&&c!==!1&&!Th(u)&&QN(n,u,m=>{for(const A in m){const B=Lne(A);B&&a.add(B)}}),a.size&&(r.willChange=Array.from(a).join(","))),r}const LS=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),OK=()=>({...LS(),attrs:{}}),QK=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Dne={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Pne=hA.length;function Une(n,e,t){let i="",s=!0;for(let o=0;o<Pne;o++){const r=hA[o],a=n[r];if(a===void 0)continue;let l=!0;if(typeof a=="number"?l=a===(r.startsWith("scale")?1:0):l=parseFloat(a)===0,!l||t){const g=QK(a,ZS[r]);if(!l){s=!1;const c=Dne[r]||r;i+=`${c}(${g}) `}t&&(e[r]=g)}}return i=i.trim(),t?i=t(e,s?"":i):s&&(i="none"),i}function kS(n,e,t){const{style:i,vars:s,transformOrigin:o}=n;let r=!1,a=!1;for(const l in e){const g=e[l];if(pg.has(l)){r=!0;continue}else if(KY(l)){s[l]=g;continue}else{const c=QK(g,ZS[l]);l.startsWith("origin")?(a=!0,o[l]=c):i[l]=c}}if(e.transform||(r||t?i.transform=Une(e,n.transform,t):i.transform&&(i.transform="none")),a){const{originX:l="50%",originY:g="50%",originZ:c=0}=o;i.transformOrigin=`${l} ${g} ${c}`}}function jN(n,e,t){return typeof n=="string"?n:Rt.transform(e+t*n)}function Jne(n,e,t){const i=jN(e,n.x,n.width),s=jN(t,n.y,n.height);return`${i} ${s}`}const One={offset:"stroke-dashoffset",array:"stroke-dasharray"},Qne={offset:"strokeDashoffset",array:"strokeDasharray"};function jne(n,e,t=1,i=0,s=!0){n.pathLength=1;const o=s?One:Qne;n[o.offset]=Rt.transform(-i);const r=Rt.transform(e),a=Rt.transform(t);n[o.array]=`${r} ${a}`}function zS(n,{attrX:e,attrY:t,attrScale:i,originX:s,originY:o,pathLength:r,pathSpacing:a=1,pathOffset:l=0,...g},c,u){if(kS(n,g,u),c){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:C,style:h,dimensions:p}=n;C.transform&&(p&&(h.transform=C.transform),delete C.transform),p&&(s!==void 0||o!==void 0||h.transform)&&(h.transformOrigin=Jne(p,s!==void 0?s:.5,o!==void 0?o:.5)),e!==void 0&&(C.x=e),t!==void 0&&(C.y=t),i!==void 0&&(C.scale=i),r!==void 0&&jne(C,r,a,l,!1)}const DS=n=>typeof n=="string"&&n.toLowerCase()==="svg",qne={useVisualState:JK({scrapeMotionValuesFromProps:UK,createRenderState:OK,onMount:(n,e,{renderState:t,latestValues:i})=>{Gn.read(()=>{try{t.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}),Gn.render(()=>{zS(t,i,DS(e.tagName),n.transformTemplate),DK(e,t)})}})},$ne={useVisualState:JK({applyWillChange:!0,scrapeMotionValuesFromProps:_S,createRenderState:LS})};function jK(n,e,t){for(const i in e)!bs(e[i])&&!PK(i,t)&&(n[i]=e[i])}function eie({transformTemplate:n},e){return z.useMemo(()=>{const t=LS();return kS(t,e,n),Object.assign({},t.vars,t.style)},[e])}function tie(n,e){const t=n.style||{},i={};return jK(i,t,n),Object.assign(i,eie(n,e)),i}function nie(n,e){const t={},i=tie(n,e);return n.drag&&n.dragListener!==!1&&(t.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(t.tabIndex=0),t.style=i,t}const iie=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function V0(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||iie.has(n)}let qK=n=>!V0(n);function sie(n){n&&(qK=e=>e.startsWith("on")?!V0(e):n(e))}try{sie(require("@emotion/is-prop-valid").default)}catch{}function oie(n,e,t){const i={};for(const s in n)s==="values"&&typeof n.values=="object"||(qK(s)||t===!0&&V0(s)||!e&&!V0(s)||n.draggable&&s.startsWith("onDrag"))&&(i[s]=n[s]);return i}function rie(n,e,t,i){const s=z.useMemo(()=>{const o=OK();return zS(o,e,DS(i),n.transformTemplate),{...o.attrs,style:{...o.style}}},[e]);if(n.style){const o={};jK(o,n.style,n),s.style={...o,...s.style}}return s}function aie(n=!1){return(t,i,s,{latestValues:o},r)=>{const l=(KS(t)?rie:nie)(i,o,r,t),g=oie(i,typeof t=="string",n),c=t!==z.Fragment?{...g,...l,ref:s}:{},{children:u}=i,C=z.useMemo(()=>bs(u)?u.get():u,[u]);return z.createElement(t,{...c,children:C})}}function lie(n,e){return function(i,{forwardMotionProps:s}={forwardMotionProps:!1}){const r={...KS(i)?qne:$ne,preloadedFeatures:n,useRender:aie(s),createVisualElement:e,Component:i};return Xne(r)}}const tw={current:null},$K={current:!1};function gie(){if($K.current=!0,!!YS)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>tw.current=n.matches;n.addListener(e),e()}else tw.current=!1}function cie(n,e,t){for(const i in e){const s=e[i],o=t[i];if(bs(s))n.addValue(i,s);else if(bs(o))n.addValue(i,_h(s,{owner:n}));else if(o!==s)if(n.hasValue(i)){const r=n.getValue(i);r.liveStyle===!0?r.jump(s):r.hasAnimated||r.set(s)}else{const r=n.getStaticValue(i);n.addValue(i,_h(r!==void 0?r:s,{owner:n}))}}for(const i in t)e[i]===void 0&&n.removeValue(i);return e}const qN=new WeakMap,uie=[...kY,ds,og],Iie=n=>uie.find(LY(n)),$N=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class die{scrapeMotionValuesFromProps(e,t,i){return{}}constructor({parent:e,props:t,presenceContext:i,reducedMotionConfig:s,blockInitialAnimation:o,visualState:r},a={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=GS,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const C=oa.now();this.renderScheduledAt<C&&(this.renderScheduledAt=C,Gn.render(this.render,!1,!0))};const{latestValues:l,renderState:g}=r;this.latestValues=l,this.baseTarget={...l},this.initialValues=t.initial?{...l}:{},this.renderState=g,this.parent=e,this.props=t,this.presenceContext=i,this.depth=e?e.depth+1:0,this.reducedMotionConfig=s,this.options=a,this.blockInitialAnimation=!!o,this.isControllingVariants=ly(t),this.isVariantNode=LK(t),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(t,{},this);for(const C in u){const h=u[C];l[C]!==void 0&&bs(h)&&h.set(l[C],!1)}}mount(e){this.current=e,qN.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((t,i)=>this.bindToMotionValue(i,t)),$K.current||gie(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:tw.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){qN.delete(this.current),this.projection&&this.projection.unmount(),ig(this.notifyUpdate),ig(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const t=this.features[e];t&&(t.unmount(),t.isMounted=!1)}this.current=null}bindToMotionValue(e,t){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const i=pg.has(e),s=t.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Gn.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0)}),o=t.on("renderRequest",this.scheduleRender);let r;window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,e,t)),this.valueSubscriptions.set(e,()=>{s(),o(),r&&r(),t.owner&&t.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in JI){const t=JI[e];if(!t)continue;const{isEnabled:i,Feature:s}=t;if(!this.features[e]&&s&&i(this.props)&&(this.features[e]=new s(this)),this.features[e]){const o=this.features[e];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ci()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,t){this.latestValues[e]=t}update(e,t){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=t;for(let i=0;i<$N.length;i++){const s=$N[i];this.propEventSubscriptions[s]&&(this.propEventSubscriptions[s](),delete this.propEventSubscriptions[s]);const o="on"+s,r=e[o];r&&(this.propEventSubscriptions[s]=this.on(s,r))}this.prevMotionValues=cie(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const t=this.getClosestVariantNode();if(t)return t.variantChildren&&t.variantChildren.add(e),()=>t.variantChildren.delete(e)}addValue(e,t){const i=this.values.get(e);t!==i&&(i&&this.removeValue(e),this.bindToMotionValue(e,t),this.values.set(e,t),this.latestValues[e]=t.get())}removeValue(e){this.values.delete(e);const t=this.valueSubscriptions.get(e);t&&(t(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,t){if(this.props.values&&this.props.values[e])return this.props.values[e];let i=this.values.get(e);return i===void 0&&t!==void 0&&(i=_h(t===null?void 0:t,{owner:this}),this.addValue(e,i)),i}readValue(e,t){var i;let s=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(i=this.getBaseTargetFromProps(this.props,e))!==null&&i!==void 0?i:this.readValueFromInstance(this.current,e,this.options);return s!=null&&(typeof s=="string"&&(EY(s)||TY(s))?s=parseFloat(s):!Iie(s)&&og.test(t)&&(s=jY(e,t)),this.setBaseTarget(e,bs(s)?s.get():s)),bs(s)?s.get():s}setBaseTarget(e,t){this.baseTarget[e]=t}getBaseTarget(e){var t;const{initial:i}=this.props;let s;if(typeof i=="string"||typeof i=="object"){const r=AS(this.props,i,(t=this.presenceContext)===null||t===void 0?void 0:t.custom);r&&(s=r[e])}if(i&&s!==void 0)return s;const o=this.getBaseTargetFromProps(this.props,e);return o!==void 0&&!bs(o)?o:this.initialValues[e]!==void 0&&s===void 0?void 0:this.baseTarget[e]}on(e,t){return this.events[e]||(this.events[e]=new XS),this.events[e].add(t)}notify(e,...t){this.events[e]&&this.events[e].notify(...t)}}class e3 extends die{constructor(){super(...arguments),this.KeyframeResolver=qY}sortInstanceNodePosition(e,t){return e.compareDocumentPosition(t)&2?1:-1}getBaseTargetFromProps(e,t){return e.style?e.style[t]:void 0}removeValueFromRenderState(e,{vars:t,style:i}){delete t[e],delete i[e]}}function Cie(n){return window.getComputedStyle(n)}class hie extends e3{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=kK}readValueFromInstance(e,t){if(pg.has(t)){const i=SS(t);return i&&i.default||0}else{const i=Cie(e),s=(KY(t)?i.getPropertyValue(t):i[t])||0;return typeof s=="string"?s.trim():s}}measureInstanceViewportBox(e,{transformPagePoint:t}){return wK(e,t)}build(e,t,i){kS(e,t,i.transformTemplate)}scrapeMotionValuesFromProps(e,t,i){return _S(e,t,i)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;bs(e)&&(this.childSubscription=e.on("change",t=>{this.current&&(this.current.textContent=`${t}`)}))}}class Aie extends e3{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ci}getBaseTargetFromProps(e,t){return e[t]}readValueFromInstance(e,t){if(pg.has(t)){const i=SS(t);return i&&i.default||0}return t=zK.has(t)?t:oy(t),e.getAttribute(t)}scrapeMotionValuesFromProps(e,t,i){return UK(e,t,i)}build(e,t,i){zS(e,t,this.isSVGTag,i.transformTemplate)}renderInstance(e,t,i,s){DK(e,t,i,s)}mount(e){this.isSVGTag=DS(e.tagName),super.mount(e)}}const pie=(n,e)=>KS(n)?new Aie(e):new hie(e,{allowProjection:n!==z.Fragment}),mie=lie({...ste,...Zne,...hne,...Sne},pie),Wr=Qq(mie),wo={paddingX:"sm:px-16 px-6",paddingY:"sm:py-16 py-6",padding:"sm:px-16 px-6 sm:py-16 py-10",heroHeadText:"font-black text-white lg:text-[80px] sm:text-[60px] xs:text-[50px] text-[40px] lg:leading-[98px] mt-2",heroSubText:"text-[#dfd9ff] font-medium lg:text-[30px] sm:text-[26px] xs:text-[20px] text-[16px] lg:leading-[40px]",sectionHeadText:"text-white font-black md:text-[60px] sm:text-[50px] xs:text-[40px] text-[30px]",sectionSubText:"sm:text-[18px] text-[14px] text-secondary uppercase tracking-wider"},fie=()=>j.jsxs("section",{className:"relative w-full h-screen mx-auto",children:[j.jsxs("div",{className:`absolute inset-0 top-[120px]  max-w-7xl mx-auto ${wo.paddingX} flex flex-row items-start gap-5`,children:[j.jsxs("div",{className:"flex flex-col justify-center items-center mt-5",children:[j.jsx("div",{className:"w-5 h-5 rounded-full bg-[#915EFF]"}),j.jsx("div",{className:"w-1 sm:h-80 h-40 violet-gradient"})]}),j.jsxs("div",{children:[j.jsxs("h1",{className:`${wo.heroHeadText} text-white`,children:["Hi, I'm ",j.jsx("span",{className:"text-[#915EFF]",children:"Adam"})]}),j.jsxs("p",{className:`${wo.heroSubText} mt-2 text-white-100`,children:["I create  user experiences, ",j.jsx("br",{className:"sm:block hidden"})," interactive visuals, and robust applications."]})]})]}),j.jsx(Jq,{}),j.jsx(ZY,{}),j.jsx("div",{className:"absolute xs:bottom-10 bottom-32 w-full flex justify-center items-center",children:j.jsx("a",{href:"#about",children:j.jsx("div",{className:"w-[35px] h-[64px] rounded-3xl border-4 border-secondary flex justify-center items-start p-2",children:j.jsx(Wr.div,{animate:{y:[0,24,0]},transition:{duration:1.5,repeat:1/0,repeatType:"loop"},className:"w-3 h-3 rounded-full bg-secondary mb-1"})})})})]}),bie=""+new URL("logo-C-JpNIKM.svg",import.meta.url).href,yie=""+new URL("web-08ko_qNY.png",import.meta.url).href,t3=""+new URL("angular-DPcvixvh.png",import.meta.url).href,Bie=""+new URL("github-BUfx7uqA.png",import.meta.url).href,Gie="data:image/svg+xml,%3csvg%20width='20'%20height='12'%20viewBox='0%200%2020%2012'%20fill='%23FFF'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M9%202L19%202C19.2652%202%2019.5196%201.89464%2019.7071%201.70711C19.8946%201.51957%2020%201.26522%2020%201C20%200.734784%2019.8946%200.480429%2019.7071%200.292892C19.5196%200.105356%2019.2652%200%2019%200L9%200C8.73478%200%208.48043%200.105356%208.29289%200.292892C8.10536%200.480429%208%200.734784%208%201C8%201.26522%208.10536%201.51957%208.29289%201.70711C8.48043%201.89464%208.73478%202%209%202ZM19%2010L1%2010C0.734784%2010%200.480429%2010.1054%200.292892%2010.2929C0.105356%2010.4804%200%2010.7348%200%2011C0%2011.2652%200.105356%2011.5196%200.292892%2011.7071C0.480429%2011.8946%200.734784%2012%201%2012L19%2012C19.2652%2012%2019.5196%2011.8946%2019.7071%2011.7071C19.8946%2011.5196%2020%2011.2652%2020%2011C20%2010.7348%2019.8946%2010.4804%2019.7071%2010.2929C19.5196%2010.1054%2019.2652%2010%2019%2010V10ZM1%207L19%207C19.2652%207%2019.5196%206.89464%2019.7071%206.70711C19.8946%206.51957%2020%206.26522%2020%206C20%205.73478%2019.8946%205.48043%2019.7071%205.29289C19.5196%205.10536%2019.2652%205%2019%205L1%205C0.734784%205%200.480429%205.10536%200.292892%205.29289C0.105356%205.48043%200%205.73478%200%206C0%206.26522%200.105356%206.51957%200.292892%206.70711C0.480429%206.89464%200.734784%207%201%207Z'%20fill='%23FFFFFF'/%3e%3c/svg%3e",vie="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='%23FFF'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M10.4099%209L16.7099%202.71C16.8982%202.5217%2017.004%202.2663%2017.004%202C17.004%201.7337%2016.8982%201.47831%2016.7099%201.29C16.5216%201.1017%2016.2662%200.995911%2015.9999%200.995911C15.7336%200.995911%2015.4782%201.1017%2015.2899%201.29L8.99994%207.59L2.70994%201.29C2.52164%201.1017%202.26624%200.995911%201.99994%200.995911C1.73364%200.995911%201.47824%201.1017%201.28994%201.29C1.10164%201.47831%200.995847%201.7337%200.995847%202C0.995847%202.2663%201.10164%202.5217%201.28994%202.71L7.58994%209L1.28994%2015.29C1.19621%2015.383%201.12182%2015.4936%201.07105%2015.6154C1.02028%2015.7373%200.994141%2015.868%200.994141%2016C0.994141%2016.132%201.02028%2016.2627%201.07105%2016.3846C1.12182%2016.5064%201.19621%2016.617%201.28994%2016.71C1.3829%2016.8037%201.4935%2016.8781%201.61536%2016.9289C1.73722%2016.9797%201.86793%2017.0058%201.99994%2017.0058C2.13195%2017.0058%202.26266%2016.9797%202.38452%2016.9289C2.50638%2016.8781%202.61698%2016.8037%202.70994%2016.71L8.99994%2010.41L15.2899%2016.71C15.3829%2016.8037%2015.4935%2016.8781%2015.6154%2016.9289C15.7372%2016.9797%2015.8679%2017.0058%2015.9999%2017.0058C16.132%2017.0058%2016.2627%2016.9797%2016.3845%2016.9289C16.5064%2016.8781%2016.617%2016.8037%2016.7099%2016.71C16.8037%2016.617%2016.8781%2016.5064%2016.9288%2016.3846C16.9796%2016.2627%2017.0057%2016.132%2017.0057%2016C17.0057%2015.868%2016.9796%2015.7373%2016.9288%2015.6154C16.8781%2015.4936%2016.8037%2015.383%2016.7099%2015.29L10.4099%209Z'%20fill='%23FFFFFF'/%3e%3c/svg%3e",n3=""+new URL("java-BiA37Tvy.png",import.meta.url).href,wie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPAAAADwCAYAAAA+VemSAAAACXBIWXMAAAsTAAALEwEAmpwYAAAOgElEQVR4nO2dCdCVZRXHz8Pnwi4groElmijuK6m4YCqJpZmJqJla40qGWjgYZZQL5p4GJZlboKKTGzoouWSAiQsuqONY42Q1LVrZYlpZnebcy51B6uO7977LeZ/7/H4z/wGGmfve5zznf577vu+ziAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtIW+JIqIQafkgKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyBKQQUAmUEJgkoBHHngKSGd8ARMVAMjIEpBBQCZQQmCSgEceeApIZ3wBExUAyMgSkEFAJlBCYJKARx54CkhnfAETFQDIyB/Sp+yKQJHwmlft+3l4kumiN62dmixx8WdJ9dg246LOjggUH79A4aQv3v79sg6Oab1P//pAlBL50iev9s0b8tq3bBkdTwDnjsisHA7zwj+v1viB62f9C+vbN9395rBx03JuhV00TfXFrF/kgM74DHriob+A8/EZ16YtChg7N9x+40oF/QyccGfXVhlfojMbwDHruqaOB3l4teMkV00IBijLuq1loz6PRJov94rgr9kRjeAY9dVTPwy/eJ7rZtOcZdVVtvHvSp2737IzG8DRC7qmTghdeWN+p2p769g94zEwNj4AqYMyYDz7tcdI0uX/PKCtn3mP01r/5IDG8DxK4qGPjumdUxr6yQvY6aezEGxsAVMGmVDWz3vAP7+xtWunnltGRu2f2RGN4GiF2eBranvttu4W9UWY3WHxL0tYcwMAaugFmrZuDzJ2e/fhkaN6a82WaSGt4GiF1eBv79Y6L9+/qbs1ndcCEGxsAVMGxVDDztZH9TtqIh64Ra0Sm+PxLD2wCxy8PANtNqw6H+pmxWgwcGvWZ6Wf2RGN4GiF0eBr732/nd+24/MugVU0WfuUP09cX11Ub259J5oldPE917l/oroXY//9hDgr6xpMz+SAxvA8QuDwNPOjq7cfv1qd+X/ufFnq9nr4J22LK1z990WKgtPyy/PxLD2wCxy8PANuc46/vZR29qfR3xxPE9f3ZXV9Azjwv61tNe/ZEY3gaIXWUb+O/PSs0kWa553ufba+u/losefuDqf44/eZt3fySGtwFiV9kGfnF+tmvarht/far99trIOmqz//3MGWeK/vP5KvRHYngHPHaVbeAHr8t2zQP2yD6pwh54NeZejx0d9JUFVeqPxPAOeOwq28C2cCHL9T57eD6zor46SfTa85p7CKal9kdieAc8dpVt4NuvzHZN28ius/sjMbwDHrvKNnDWd8AH7omBOwpvA8Susg38yA2S+f2v7VLZuf2RGN4Bj11lG9geGGW95qxzO7k/EsM74LGrbAPb6NmrV7Zrrjso6E/v79T+SAzvgMeusg1s2nJEtmuaRgwPtd08Oq8/EsM74LHLw8C2QCDrdU22Fc+NM6r3Kkgz9UdieAc8dnkY+KaL8t2Jw1YcPXZzp/RHYngHPHZ5GNiOTFlzjfwM3JAdZLZgduz9kRjeAY9dHgY2fXI1iwqyasetgt5yaTXmNmvL/ZEY3gGPXV4GtuWARRm4ITti1FYu/XZRTP2RGN4Bj11eBjbZrKqiTWxae62gnz406LN3xtAfieEd8NjlaeDn75LayYBlmHjl1UwPfLe6T64lNbwDHrs8DWz6+uk+e0NvNzLozZeI/vsF/z54b38khnfAY5e3gc1AB+9TvoEbsu19bruiSv2RGN4Bj13eBja9uVRqI6KXiUWCfvhD/mcDY+AKGCI2VcHApt8tzr7ZXVZ1dQX94gm+q50kNbwNELuqYmDTHx+X2mQMTxOLBN1qRNAnnDa3k9TwNkDsqpKBGycW2iiYdcVSVq3RFfSCM8p/Wi2p4W2A2FU1Azf0w+9JbSKG92h81MGhthUuBsbA7maNycAmO0zshMP8R+OD9irvvlhSw9sAsavKBl55G9j9Rvua+JCxobYxPAbGwO6mjc3ADc2fJbrLNn4mPuv44tsqqeFtgNgVk4EbWjRH9KP7Zjt1sB2FEGq7ahbbH4nhbYDYFaOBG3ruzvo9sh12VpaJN14/29EuPfdHYngbIHbFbOCVZ3JdeY7o+zcux8TnnlZcmyU1vJMndnWCgRt6d7norZeJ7jSqWAMP7B/0z08U1R+J4Z00sauTDLyyFl4rtfnNRZn4m18qqj8SwztRYlenGrghO+93/93zN/Do7Yppt6SGd4LErk43cEN3Xi26wbr5GbhXr6C/frSI/kgM78SIXakY2GR7Y+21c34mnnd5Ef2RGN5JEbtSMrDpradF99gxHwN/4YT82y6p4Z0QMcvm96ZmYNNrD0ntlMOsbT94HwyMgR0T+fXF1TSwLWIouu02LTJr27f5IAbGwE0m3M8flNrWqLboPa8kthP+sibxkQeFXN/jXnhGfXRcOq9YAy+Zm73t6w3BwBi4h0Sz0wVmnCnat3c9aU6ekF/S3Ped7El83Mfz+T7L737vQoVRmxW7DtemQ2Zte78+GBgD93CavW3vsuqE+rtn5pPENtplTeJTJ4bMo+75k6W2+fqqn33OScXeX2e9D+7qwsAYuJvXHXYEZ3erbQYPDPri/OwJvOdO2e8Dp3wm28buq5v2aNva2ESMIsxra3vt87O0vX9fDIyBV9kjeda5UjNoT8lj281kOaX+hXvy2VDdFhG0c1tgG7o3cyrDpsOCvrEkfwO/ujB7+zdaDwNj4BUJZXsS79riYvWhg4P+6Mb2Rp8xOYy+pjuuau3adj6RnR7YyjXGjs7/fvjqadkNvN1IDJy8gf+0VPRzx9Tvp9qd0jfp6FA7c7eZxH17mdQ2asvDvCZbk9vsqDt9UvvnAo/fO799qexzNt8ke9uPGIeBkzbw3ItFNxyaj5HsKfVJE0LtyfJfnnzvdWxr1JfvE71iqtR+kuZlXrumPYTqqZ3LfiC6fQ4nL9i+WLYBfNa4n35MddcFS2p4m7Bd/eyB7A9RVie7jx4xPOjwDetGK+Ia9hCsmbbuvkN+17T7zgWz24u5/QyffGx+3+XB6/LPC0kNbyNmkY2YRRm4DH3l1OYMvHiO5L5/1d671I8JbWanSNss/pZLpfZuOa/r9+1dzHtqSQ1vE2aRLUfLY06ul1o5DGzi+OJ+adi9qE12ue4CqW06d89M0RtnSO1khUP3C7ruoPyvO3E864GTN7Al9mVn+5yPm1X287yVY0dsAYFtReP9vfPSw9cXU9QlNbxH0awyE4wb45+QrcoKT6tttZ+x3t87D+00qrXihYE72MCm3/xYdP0h/onZrGwktddf7bT1xCP8v38VH17pCklqeJsvz3nPZe5vnEUXndV+O+09dB6vlLw0oeD1z5Ia3sbLU3d9q9hXS3nIJkBkffpqvzi2+IB/W1rVsA3yXc6JgTvMwCZ7elr2kSHNymZR5bVO95cP5zuppGj171vOod+SGt6GK0L2sKdPQZMvsuiqafkvKLCn2d7tkh5kSx3vb3PyCAZO0MAmq/Z2Do938jY07eRi7v1spZFNyvBun3SjQQPaWzCCgRMegRv61SP5rNnNIvs5bxMiimynzaf+8intL+goStuPDPrSveX2uaSGt8nKWCN8zfTm1gjnLZvBZBuil9XWx28t/lyjZrTWmkGnnljslj4YOBEDr7xLx6c+Vl8+WMaoa69L7Jplt9PmNl9/gc+9ca9eQT9xQNBXFvj1s6SGt7HKlu2kYdvt/L89pLLKfsIeMra1Oc5FydYP28O8Mu6P1xkQ9JQjQ23JpXe7JTW8A+4l2zvZTsjbd7f63lFZRh3bCcS2uPnFw/7t6u5p9SVT6mbOa7KLvdO1bXptR5F3ctooIA9JangHvAqyA65tIf9XJ4kefmDQnbcOtamZNrJYstpobffQm2xUX8NrezmbYefPqm/u7v39W5GZbdGc+t5hpx1VPx1hhy1DbWMEa2OjmA3oV//3ZsNDbfsgWz1kC/Bvv7K+Ftu7HdqNJDW8A46IgWJgDEwhoBAoIzBJQCGIOwckNbwDjoiBYmAMTCGgECgjMElAIYg7ByQ1vAOOiIFiYAxMIaAQKCMwSUAhiDsHJDW8A46IgWJgDEwhoBAoIzBJQCGIOwckNbwDjoiBYmAMTCGgECgjMElAIYg7ByQ1vAOOiIFiYAxMIaAQKCMwSUAhiDsHJDW8A46IgWJgDEwhoBBoiiMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEg+/BceiofdqS/+vQAAAABJRU5ErkJggg==",Zie=""+new URL("nodejs-BctxLIqp.png",import.meta.url).href,Sie=""+new URL("reactjs-LYxsbuPE.png",import.meta.url).href,Rie=""+new URL("three-DHRvKCfE.png",import.meta.url).href,i3=""+new URL("Spring_Boot-D6jBbsRz.png",import.meta.url).href,xie="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='2500'%20height='1897'%20viewBox='0%200%201000%20758.994'%3e%3cpath%20fill='%23E669A2'%20d='M1000%20325.903H636.264v-93.1H1000v93.1z'/%3e%3cpath%20fill='%23F3BE26'%20d='M952.755%20325.903H636.264V93.051h316.491v232.852z'/%3e%3cpath%20fill='%23EE9C34'%20d='M821.998%20325.903H636.264V0h185.734v325.903z'/%3e%3cpath%20fill='%23F3BC87'%20d='M858.538%20325.903H636.264V36.365h222.274v289.538z'/%3e%3cpath%20fill='%23E3721C'%20d='M636.213%2036.42v289.453h185.765V36.42H636.213z'/%3e%3cpath%20fill='%23AD1B02'%20d='M450.016%20325.903h186.248v46.555H450.016v-46.555z'/%3e%3cpath%20fill='%23E88D14'%20d='M636.213%2093v232.873h222.432V93H636.213z'/%3e%3cpath%20fill='%23D85604'%20d='M636.213%2093v232.873h185.765V93H636.213z'/%3e%3cpath%20fill='%23C14303'%20d='M752.413%20325.903H636.264V186.142h116.149v139.761z'/%3e%3cpath%20fill='%23DB4E18'%20d='M636.213%20232.869v93.004h316.649v-93.004H636.213z'/%3e%3cpath%20fill='%23D1390D'%20d='M636.213%20232.869v93.004h222.432v-93.004H636.213z'/%3e%3cpath%20fill='%23C22303'%20d='M636.213%20232.869v93.004h185.765v-93.004H636.213z'/%3e%3cpath%20fill='%23AD1B02'%20d='M636.213%20232.869v93.004h116.315v-93.004H636.213z'/%3e%3cpath%20d='M676.76%20501.249c-31.689%205.634-48.59%2029.577-48.59%2071.126%200%2042.254%2022.534%2070.423%2055.633%2070.423%2016.197%200%2030.281-5.634%2059.858-20.423v34.508c-35.915%2016.9-57.042%2021.126-85.21%2021.126-31.69%200-54.227-7.746-71.832-26.76-18.31-18.311-28.169-42.254-28.169-69.72%200-59.858%2045.07-101.407%20110.563-101.407%2042.958%200%2073.24%2020.423%2073.24%2049.296%200%2019.014-14.086%2032.395-34.508%2032.395-10.563%200-19.015-3.521-30.986-9.86M518.31%20581.53c28.873-35.915%2039.437-50.704%2039.437-68.31s-14.085-33.1-33.803-33.1c-11.268%200-21.83%206.339-26.76%2011.973v73.943L450%20629.416V485.756h-45.07l-74.649%20123.24v-123.24h-25.353l-68.31%2015.494v17.605l37.324%203.52v152.818h47.183l71.831-118.31v118.31h52.817M93.662%20651.249h10.563c38.027%200%2059.154-23.24%2059.154-69.72%200-38.731-16.9-59.858-48.592-59.858-4.225%200-10.563.704-21.126%202.817v126.76h.001zm0%2083.098l30.985%207.042v17.605H2.817v-17.605l28.168-7.042V521.67H0v-17.605l73.943-22.535h19.72v25.353c34.506-21.127%2046.478-24.648%2064.787-24.648%2040.846%200%2071.831%2038.028%2071.831%2090.846%200%2060.563-41.549%20102.112-104.93%20102.112-7.042%200-19.014-.704-31.689-1.408'/%3e%3c/svg%3e",Vie=""+new URL("cyss-Dg4LTHlS.png",import.meta.url).href,Wm=""+new URL("MEDTECH-CuE1BcCw.png",import.meta.url).href,Wie=""+new URL("ECO--WbooDhd.png",import.meta.url).href,Mie=""+new URL("HUNTER-CSB8kWVl.png",import.meta.url).href,Nie=""+new URL("NETWORK-BxnxPMwC.png",import.meta.url).href,Fie=""+new URL("python-BIwUd1eo.png",import.meta.url).href,Hie=""+new URL("pg-Cm8fmS27.png",import.meta.url).href,Xie=""+new URL("c-C10NtfF9.png",import.meta.url).href,Tie=""+new URL("mysql-logo-BQqVCOl5.svg",import.meta.url).href,Eie=""+new URL("vue-CPmPqqKk.png",import.meta.url).href,eF=[{id:"about",title:"About"},{id:"work",title:"Work"},{id:"contact",title:"Contact"}],Yie=[{title:"Web Developer",icon:yie},{title:"Java Developer",icon:n3},{title:"Spring-Boot Developer",icon:i3},{title:"Angular Developer",icon:t3}],Kie=[{name:"JavaScript",icon:wie},{name:"React JS",icon:Sie},{name:"Node JS",icon:Zie},{name:"Three JS",icon:Rie},{name:"Vue.js",icon:Eie},{name:"Angular",icon:t3},{name:"Spring Boot",icon:i3},{name:"Java",icon:n3},{name:"PostgreSQL",icon:Hie},{name:"MySQL",icon:Tie},{name:"Python",icon:Fie},{name:"C Programming",icon:Xie}],_ie=[{title:"Intern - PwC",company_name:"PwC (PricewaterhouseCoopers), Tunis",icon:xie,iconBg:"#E6DEDD",date:"June 2024 - July 2024",points:["Developed an internal social network using Angular, Spring Boot, and PostgreSQL.","Enabled real-time communication and collaboration for employees, boosting team engagement.","Enhanced problem-solving, time management, and web development skills through hands-on experience."]},{title:"Intern - CLINISYS",company_name:"CLINISYS (Hospital Management System), Sfax",icon:Vie,iconBg:"#383E56",date:"June 2023 - July 2023",points:["Created a website for managing post-operative patients using HTML, CSS, JavaScript, and Spring Boot.","Provided features for patients to access receipts, track items, and view arrival and departure details."]},{title:"Project - MEDTECH",company_name:"MEDTECH, Tunis",icon:Wm,iconBg:"#E6DEDD",date:"February 2023 - May 2023",points:["Won 1st place award at MEDTECH for best student project.","Built a C-based game application using SDL2 with three levels and a final boss.","Enhanced programming and game development skills through real-world application."]},{title:"Project - MEDTECH",company_name:"MEDTECH, Tunis",icon:Wm,iconBg:"#383E56",date:"February 2024 - May 2024",points:["Developed a fleet management system with Vue.js 3.","Enabled users to select electric scooters, while administrators managed the fleet."]},{title:"Project - MEDTECH",company_name:"MEDTECH, Tunis",icon:Wm,iconBg:"#E6DEDD",date:"September 2024 - December 2024",points:["Developed an eSports game management system with React and Express.","Enabled administrators to manage players, teams, and matches.","Integrated JWT authentication for secure, role-based access control.","Implemented real-time updates for scores, player stats, and schedules.","Utilized MongoDB for efficient data storage and retrieval."]},{title:"Project - MEDTECH",company_name:"MEDTECH, Tunis",icon:Wm,iconBg:"#E6DEDD",date:"January 2025 - May 2025",points:["Developed a smart marketplace platform enabling users to buy and sell products.","Built the mobile application using React Native.","Created the admin dashboard using React.","Integrated Ollama Mistral AI, fine-tuned with the RAG method, to enhance recommendations and intelligent search.","Implemented a custom blockchain system for secure transactions, based on Ethereum."]}],Lie=[{name:"Electric Scooter Fleet Management",description:"A Vue.js application for selecting electric scooters, with an admin interface for fleet management, enabling users and administrators to streamline fleet operations.",tags:[{name:"vue",color:"blue-text-gradient"},{name:"javascript",color:"green-text-gradient"},{name:"css",color:"pink-text-gradient"}],image:Wie,source_code_link:"https://github.com/adam12bT/Ecoride"},{name:"Internal Social Network for PwC",description:"A real-time social networking platform for PwC employees, allowing for messaging, posting, and private communication, built with Angular, Spring Boot, and PostgreSQL.",tags:[{name:"angular",color:"blue-text-gradient"},{name:"springboot",color:"green-text-gradient"},{name:"postgresql",color:"pink-text-gradient"}],image:Nie,source_code_link:"https://github.com/adam12bT/PWC_Internship"},{name:"SDL2 Game Application",description:"A C-based game with three levels of increasing difficulty, where players progress through challenges to face a final boss, built using SDL2.",tags:[{name:"c",color:"blue-text-gradient"},{name:"sdl2",color:"green-text-gradient"}],image:Mie,source_code_link:"https://github.com/adam12bT/Treasure-Hunter"}],kie=()=>{const[n,e]=z.useState(""),[t,i]=z.useState(!1),[s,o]=z.useState(!1);return z.useEffect(()=>{const r=()=>{window.scrollY>100?o(!0):o(!1)};return window.addEventListener("scroll",r),()=>window.removeEventListener("scroll",r)},[]),j.jsx("nav",{className:`${wo.paddingX} w-full flex items-center py-5 fixed top-0 z-20 ${s?"bg-primary":"bg-transparent"}`,children:j.jsxs("div",{className:"w-full flex justify-between items-center max-w-7xl mx-auto",children:[j.jsxs(cz,{to:"/",className:"flex items-center gap-2",onClick:()=>{e(""),window.scrollTo(0,0)},children:[j.jsx("img",{src:bie,alt:"logo",className:"w-9 h-9 object-contain"}),j.jsxs("p",{className:"text-white text-[18px] font-bold cursor-pointer flex ",children:["Adam ",j.jsx("span",{className:"sm:block hidden",children:" software engineering student"})]})]}),j.jsx("ul",{className:"list-none hidden sm:flex flex-row gap-10",children:eF.map(r=>j.jsx("li",{className:`${n===r.title?"text-white":"text-secondary"} hover:text-white text-[18px] font-medium cursor-pointer`,onClick:()=>e(r.title),children:j.jsx("a",{href:`#${r.id}`,children:r.title})},r.id))}),j.jsxs("div",{className:"sm:hidden flex flex-1 justify-end items-center",children:[j.jsx("img",{src:t?vie:Gie,alt:"menu",className:"w-[28px] h-[28px] object-contain",onClick:()=>i(!t)}),j.jsx("div",{className:`${t?"flex":"hidden"} p-6 black-gradient absolute top-20 right-0 mx-4 my-2 min-w-[140px] z-10 rounded-xl`,children:j.jsx("ul",{className:"list-none flex justify-end items-start flex-1 flex-col gap-4",children:eF.map(r=>j.jsx("li",{className:`font-poppins font-medium cursor-pointer text-[16px] ${n===r.title?"text-white":"text-secondary"}`,onClick:()=>{i(!t),e(r.title)},children:j.jsx("a",{href:`#${r.id}`,children:r.title})},r.id))})})]})]})})};var zie=Object.defineProperty,Die=Object.defineProperties,Pie=Object.getOwnPropertyDescriptors,tF=Object.getOwnPropertySymbols,Uie=Object.prototype.hasOwnProperty,Jie=Object.prototype.propertyIsEnumerable,nF=(n,e,t)=>e in n?zie(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,bC=(n,e)=>{for(var t in e||(e={}))Uie.call(e,t)&&nF(n,t,e[t]);if(tF)for(var t of tF(e))Jie.call(e,t)&&nF(n,t,e[t]);return n},yC=(n,e)=>Die(n,Pie(e)),s3=class extends z.Component{constructor(n){super(n),this.ref=uf.createRef(),this.state={style:{}};const e={reverse:!1,max:35,perspective:1e3,easing:"cubic-bezier(.03,.98,.52,.99)",scale:"1.1",speed:"1000",transition:!0,axis:null,reset:!0};this.width=null,this.height=null,this.left=null,this.top=null,this.transitionTimeout=null,this.updateCall=null,this.element=null,this.settings=Object.assign({},e,this.props.options),this.reverse=this.settings.reverse?-1:1,this.onMouseEnter=this.onMouseEnter.bind(this,this.props.onMouseEnter),this.onMouseMove=this.onMouseMove.bind(this,this.props.onMouseMove),this.onMouseLeave=this.onMouseLeave.bind(this,this.props.onMouseLeave)}componentDidMount(){this.element=this.ref.current,setTimeout(()=>{this.element.parentElement.querySelector(":hover")===this.element&&this.onMouseEnter()},0)}componentWillUnmount(){clearTimeout(this.transitionTimeout),cancelAnimationFrame(this.updateCall)}onMouseEnter(n=()=>{},e){return this.updateElementPosition(),this.setState(Object.assign({},this.state,{style:yC(bC({},this.state.style),{willChange:"transform"})})),this.setTransition(),n(e)}reset(){window.requestAnimationFrame(()=>{this.setState(Object.assign({},this.state,{style:yC(bC({},this.state.style),{transform:`perspective(${this.settings.perspective}px) rotateX(0deg) rotateY(0deg) scale3d(1, 1, 1)`})}))})}onMouseMove(n=()=>{},e){return e.persist(),this.updateCall!==null&&window.cancelAnimationFrame(this.updateCall),this.event=e,this.updateCall=requestAnimationFrame(this.update.bind(this,e)),n(e)}setTransition(){clearTimeout(this.transitionTimeout),this.setState(Object.assign({},this.state,{style:yC(bC({},this.state.style),{transition:`${this.settings.speed}ms ${this.settings.easing}`})})),this.transitionTimeout=setTimeout(()=>{this.setState(Object.assign({},this.state,{style:yC(bC({},this.state.style),{transition:""})}))},this.settings.speed)}onMouseLeave(n=()=>{},e){return this.setTransition(),this.settings.reset&&this.reset(),n(e)}getValues(n){const e=(n.nativeEvent.clientX-this.left)/this.width,t=(n.nativeEvent.clientY-this.top)/this.height,i=Math.min(Math.max(e,0),1),s=Math.min(Math.max(t,0),1),o=(this.reverse*(this.settings.max/2-i*this.settings.max)).toFixed(2),r=(this.reverse*(s*this.settings.max-this.settings.max/2)).toFixed(2),a=i*100,l=s*100;return{tiltX:o,tiltY:r,percentageX:a,percentageY:l}}updateElementPosition(){const n=this.element.getBoundingClientRect();this.width=this.element.offsetWidth,this.height=this.element.offsetHeight,this.left=n.left,this.top=n.top}update(n){const e=this.getValues(n);this.setState(Object.assign({},this.state,{style:yC(bC({},this.state.style),{transform:`perspective(${this.settings.perspective}px) rotateX(${this.settings.axis==="x"?0:e.tiltY}deg) rotateY(${this.settings.axis==="y"?0:e.tiltX}deg) scale3d(${this.settings.scale}, ${this.settings.scale}, ${this.settings.scale})`})})),this.updateCall=null}render(){const n=Object.assign({},this.props.style,this.state.style);return j.jsx("div",{style:n,ref:this.ref,className:this.props.className,onMouseEnter:this.onMouseEnter,onMouseMove:this.onMouseMove,onMouseLeave:this.onMouseLeave,children:this.props.children})}};const PS=n=>({hidden:{y:-50,opacity:0},show:{y:0,opacity:1,transition:{type:"spring",duration:1.25,delay:n}}}),gy=(n,e,t,i)=>({hidden:{x:n==="left"?100:n==="right"?-100:0,y:n==="up"?100:n==="down"?-100:0,opacity:0},show:{x:0,y:0,opacity:1,transition:{type:e,delay:t,duration:i,ease:"easeOut"}}}),iF=(n,e,t,i)=>({hidden:{x:n==="left"?"-100%":n==="right"?"100%":0,y:n==="up"||n==="down"?"100%":0},show:{x:0,y:0,transition:{type:e,delay:t,duration:i,ease:"easeOut"}}}),Oie=(n,e)=>({hidden:{},show:{transition:{staggerChildren:n,delayChildren:e||0}}}),mA=(n,e)=>function(){return j.jsxs(Wr.section,{variants:Oie(),initial:"hidden",whileInView:"show",viewport:{once:!0,amount:.25},className:`${wo.padding} max-w-7xl mx-auto relative z-0`,children:[j.jsx("span",{className:"hash-span",id:e,children:""}),j.jsx(n,{})]})},Qie=({index:n,title:e,icon:t})=>j.jsx(s3,{className:"xs:w-[250px] w-full",children:j.jsx(Wr.div,{variants:gy("right","spring",n*.5,.75),className:"w-full green-pink-gradient p-[1px] rounded-[20px] shadow-card",children:j.jsxs("div",{options:{max:45,scale:1,speed:450},className:"bg-tertiary rounded-[20px] py-5 px-12 min-h-[280px] flex justify-evenly items-center flex-col",children:[j.jsx("img",{src:t,alt:"web-development",className:"w-16 h-16 object-contain"}),j.jsx("h3",{className:"text-white text-[20px] font-bold text-center",children:e})]})})}),jie=()=>j.jsxs(j.Fragment,{children:[j.jsxs(Wr.div,{variants:PS(),children:[j.jsx("p",{className:wo.sectionSubText,children:"Introduction"}),j.jsx("h2",{className:wo.sectionHeadText,children:"Overview."})]}),j.jsx(Wr.p,{variants:gy("","",.1,1),className:"mt-4 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"I am a dedicated software engineering student with experience in web development, game design, and real-time communication platforms. Skilled in C, Python, Java, HTML, CSS, JavaScript, and SQL, I've developed applications like an internal social network for PwC using Angular and Spring Boot, and a game using SDL2. Proficient with tools like IntelliJ, SQL Workbench, and React, Im eager to apply my technical abilities to impactful tech projects. Thriving in diverse environments, I am always open to new challenges and learning opportunities      "}),j.jsx("div",{className:"mt-20 flex flex-wrap gap-10",children:Yie.map((n,e)=>j.jsx(Qie,{index:e,...n},n.title))})]}),qie=mA(jie,"about"),$ie=()=>j.jsx("div",{className:"flex flex-row flex-wrap justify-center gap-10",children:Kie.map(n=>j.jsx("div",{className:"w-28 h-28 ",children:j.jsx(Pq,{icon:n.icon})},n.name))}),ese=mA($ie,"");var cy={},o3={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var o="",r=0;r<arguments.length;r++){var a=arguments[r];a&&(o=s(o,i(a)))}return o}function i(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var r="";for(var a in o)e.call(o,a)&&o[a]&&(r=s(r,a));return r}function s(o,r){return r?o?o+" "+r:o+r:o}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(o3);var r3=o3.exports;cy.__esModule=!0;cy.default=void 0;var tse=US(z),Sl=US(QE),nse=US(r3);function US(n){return n&&n.__esModule?n:{default:n}}const a3=({animate:n=!0,className:e="",layout:t="2-columns",lineColor:i="#FFF",children:s})=>(typeof window=="object"&&document.documentElement.style.setProperty("--line-color",i),tse.default.createElement("div",{className:(0,nse.default)(e,"vertical-timeline",{"vertical-timeline--animate":n,"vertical-timeline--two-columns":t==="2-columns","vertical-timeline--one-column-left":t==="1-column"||t==="1-column-left","vertical-timeline--one-column-right":t==="1-column-right"})},s));a3.propTypes={children:Sl.default.oneOfType([Sl.default.arrayOf(Sl.default.node),Sl.default.node]).isRequired,className:Sl.default.string,animate:Sl.default.bool,layout:Sl.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:Sl.default.string};var ise=a3;cy.default=ise;var uy={};function nw(){return nw=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},nw.apply(this,arguments)}function sse(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,iw(n,e)}function iw(n,e){return iw=Object.setPrototypeOf||function(i,s){return i.__proto__=s,i},iw(n,e)}function ose(n,e){if(n==null)return{};var t={},i=Object.keys(n),s,o;for(o=0;o<i.length;o++)s=i[o],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}var sw=new Map,Mm=new WeakMap,sF=0,l3=void 0;function rse(n){l3=n}function ase(n){return n?(Mm.has(n)||(sF+=1,Mm.set(n,sF.toString())),Mm.get(n)):"0"}function lse(n){return Object.keys(n).sort().filter(function(e){return n[e]!==void 0}).map(function(e){return e+"_"+(e==="root"?ase(n.root):n[e])}).toString()}function gse(n){var e=lse(n),t=sw.get(e);if(!t){var i=new Map,s,o=new IntersectionObserver(function(r){r.forEach(function(a){var l,g=a.isIntersecting&&s.some(function(c){return a.intersectionRatio>=c});n.trackVisibility&&typeof a.isVisible>"u"&&(a.isVisible=g),(l=i.get(a.target))==null||l.forEach(function(c){c(g,a)})})},n);s=o.thresholds||(Array.isArray(n.threshold)?n.threshold:[n.threshold||0]),t={id:e,observer:o,elements:i},sw.set(e,t)}return t}function JS(n,e,t,i){if(t===void 0&&(t={}),i===void 0&&(i=l3),typeof window.IntersectionObserver>"u"&&i!==void 0){var s=n.getBoundingClientRect();return e(i,{isIntersecting:i,target:n,intersectionRatio:typeof t.threshold=="number"?t.threshold:0,time:0,boundingClientRect:s,intersectionRect:s,rootBounds:s}),function(){}}var o=gse(t),r=o.id,a=o.observer,l=o.elements,g=l.get(n)||[];return l.has(n)||l.set(n,g),g.push(e),a.observe(n),function(){g.splice(g.indexOf(e),1),g.length===0&&(l.delete(n),a.unobserve(n)),l.size===0&&(a.disconnect(),sw.delete(r))}}var cse=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function oF(n){return typeof n.children!="function"}var W0=function(n){sse(e,n);function e(i){var s;return s=n.call(this,i)||this,s.node=null,s._unobserveCb=null,s.handleNode=function(o){s.node&&(s.unobserve(),!o&&!s.props.triggerOnce&&!s.props.skip&&s.setState({inView:!!s.props.initialInView,entry:void 0})),s.node=o||null,s.observeNode()},s.handleChange=function(o,r){o&&s.props.triggerOnce&&s.unobserve(),oF(s.props)||s.setState({inView:o,entry:r}),s.props.onChange&&s.props.onChange(o,r)},s.state={inView:!!i.initialInView,entry:void 0},s}var t=e.prototype;return t.componentDidUpdate=function(s){(s.rootMargin!==this.props.rootMargin||s.root!==this.props.root||s.threshold!==this.props.threshold||s.skip!==this.props.skip||s.trackVisibility!==this.props.trackVisibility||s.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())},t.componentWillUnmount=function(){this.unobserve(),this.node=null},t.observeNode=function(){if(!(!this.node||this.props.skip)){var s=this.props,o=s.threshold,r=s.root,a=s.rootMargin,l=s.trackVisibility,g=s.delay,c=s.fallbackInView;this._unobserveCb=JS(this.node,this.handleChange,{threshold:o,root:r,rootMargin:a,trackVisibility:l,delay:g},c)}},t.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},t.render=function(){if(!oF(this.props)){var s=this.state,o=s.inView,r=s.entry;return this.props.children({inView:o,entry:r,ref:this.handleNode})}var a=this.props,l=a.children,g=a.as,c=ose(a,cse);return z.createElement(g||"div",nw({ref:this.handleNode},c),l)},e}(z.Component);W0.displayName="InView";W0.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1};function use(n){var e=n===void 0?{}:n,t=e.threshold,i=e.delay,s=e.trackVisibility,o=e.rootMargin,r=e.root,a=e.triggerOnce,l=e.skip,g=e.initialInView,c=e.fallbackInView,u=z.useRef(),C=z.useState({inView:!!g}),h=C[0],p=C[1],b=z.useCallback(function(A){u.current!==void 0&&(u.current(),u.current=void 0),!l&&A&&(u.current=JS(A,function(B,G){p({inView:B,entry:G}),G.isIntersecting&&a&&u.current&&(u.current(),u.current=void 0)},{root:r,rootMargin:o,threshold:t,trackVisibility:s,delay:i},c))},[Array.isArray(t)?t.toString():t,r,o,a,l,s,c,i]);z.useEffect(function(){!u.current&&h.entry&&!a&&!l&&p({inView:!!g})});var m=[b,h.inView,h.entry];return m.ref=m[0],m.inView=m[1],m.entry=m[2],m}const Ise=Object.freeze(Object.defineProperty({__proto__:null,InView:W0,default:W0,defaultFallbackInView:rse,observe:JS,useInView:use},Symbol.toStringTag,{value:"Module"})),dse=c_(Ise);uy.__esModule=!0;uy.default=void 0;var Rl=OS(z),En=OS(QE),Nm=OS(r3),Cse=dse;function OS(n){return n&&n.__esModule?n:{default:n}}const g3=({children:n="",className:e="",contentArrowStyle:t=null,contentStyle:i=null,date:s="",dateClassName:o="",icon:r=null,iconClassName:a="",iconOnClick:l=null,onTimelineElementClick:g=null,iconStyle:c=null,id:u="",position:C="",style:h=null,textClassName:p="",intersectionObserverProps:b={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:m=!1})=>Rl.default.createElement(Cse.InView,b,({inView:A,ref:B})=>Rl.default.createElement("div",{ref:B,id:u,className:(0,Nm.default)(e,"vertical-timeline-element",{"vertical-timeline-element--left":C==="left","vertical-timeline-element--right":C==="right","vertical-timeline-element--no-children":n===""}),style:h},Rl.default.createElement(Rl.default.Fragment,null,Rl.default.createElement("span",{style:c,onClick:l,className:(0,Nm.default)(a,"vertical-timeline-element-icon",{"bounce-in":A||m,"is-hidden":!(A||m)})},r),Rl.default.createElement("div",{style:i,onClick:g,className:(0,Nm.default)(p,"vertical-timeline-element-content",{"bounce-in":A||m,"is-hidden":!(A||m)})},Rl.default.createElement("div",{style:t,className:"vertical-timeline-element-content-arrow"}),n,Rl.default.createElement("span",{className:(0,Nm.default)(o,"vertical-timeline-element-date")},s)))));g3.propTypes={children:En.default.oneOfType([En.default.arrayOf(En.default.node),En.default.node]),className:En.default.string,contentArrowStyle:En.default.shape({}),contentStyle:En.default.shape({}),date:En.default.node,dateClassName:En.default.string,icon:En.default.element,iconClassName:En.default.string,iconStyle:En.default.shape({}),iconOnClick:En.default.func,onTimelineElementClick:En.default.func,id:En.default.string,position:En.default.string,style:En.default.shape({}),textClassName:En.default.string,visible:En.default.bool,intersectionObserverProps:En.default.shape({root:En.default.object,rootMargin:En.default.string,threshold:En.default.number,triggerOnce:En.default.bool})};var hse=g3;uy.default=hse;var c3={VerticalTimeline:cy.default,VerticalTimelineElement:uy.default};const Ase=({experience:n})=>j.jsxs(c3.VerticalTimelineElement,{contentStyle:{background:"#1d1836",color:"#fff"},contentArrowStyle:{borderRight:"7px solid #236631"},date:n.date,iconStyle:{background:n.iconBg},icon:j.jsx("div",{className:"flex justify-center items-center w-full h-full",children:j.jsx("img",{src:n.icon,alt:n.company_name,className:"w-[60%] h-[60%] object-contain"})}),children:[j.jsxs("div",{children:[j.jsx("h3",{className:"text-white text-[24px] font-bold",children:n.title}),j.jsx("p",{className:"text-secondary text-[16px] font-semibold",style:{margin:0},children:n.company_name})]}),j.jsx("ul",{className:"mt-5 list-disc ml-5 space-y-2",children:n.points.map((e,t)=>j.jsx("li",{className:"text-white text-[14px] pl-1 tracking-wider",children:e},`experience-point-${t}`))})]}),pse=()=>j.jsxs(j.Fragment,{children:[j.jsxs(Wr.div,{variants:PS(),children:[j.jsx("p",{className:wo.sectionSubText,children:"What I have done"}),j.jsx("h2",{className:wo.sectionHeadText,children:"Work Experience"})]}),j.jsx("div",{className:"mt-20 flex flex-col",children:j.jsx(c3.VerticalTimeline,{children:_ie.map((n,e)=>j.jsx(Ase,{experience:n},e))})})]}),mse=mA(pse,"work"),fse=({index:n,name:e,description:t,tags:i,image:s,source_code_link:o})=>j.jsx(Wr.div,{variants:gy("up","spring",n*.5,.75),children:j.jsxs(s3,{options:{max:45,scale:1,speed:450},className:"bg-tertiary p-5 rounded-2xl sm:w-[360px] w-full",children:[j.jsxs("div",{className:"relative w-full h-[230px]",children:[j.jsx("img",{src:s,alt:"project_image",className:"w-full h-full object-cover rounded-2xl"}),j.jsx("div",{className:"absolute inset-0 flex justify-end m-3 card-img_hover",children:j.jsx("div",{onClick:()=>window.open(o,"_blank"),className:"black-gradient w-10 h-10 rounded-full flex justify-center items-center cursor-pointer",children:j.jsx("img",{src:Bie,alt:"source code",className:"w-1/2 h-1/2 object-contain"})})})]}),j.jsxs("div",{className:"mt-5",children:[j.jsx("h3",{className:"text-white font-bold text-[24px]",children:e}),j.jsx("p",{className:"mt-2 text-secondary text-[14px]",children:t})]}),j.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:i.map(r=>j.jsxs("p",{className:`text-[14px] ${r.color}`,children:["#",r.name]},`${e}-${r.name}`))})]})}),bse=()=>j.jsxs(j.Fragment,{children:[j.jsxs(Wr.div,{variants:PS(),children:[j.jsx("p",{className:`${wo.sectionSubText} `,children:"My work"}),j.jsx("h2",{className:`${wo.sectionHeadText}`,children:"Projects."})]}),j.jsx("div",{className:"w-full flex",children:j.jsx(Wr.p,{variants:gy("","",.1,1),className:"mt-3 text-secondary text-[17px] max-w-3xl leading-[30px]",children:"Following projects showcases my skills and experience through real-world examples of my work. Each project is briefly described with links to code repositories and live demos in it. It reflects my ability to solve complex problems, work with different technologies, and manage projects effectively."})}),j.jsx("div",{className:"mt-20 flex flex-wrap gap-7",children:Lie.map((n,e)=>j.jsx(fse,{index:e,...n},`project-${e}`))})]}),yse=mA(bse,""),Bse=()=>{};var rF={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u3=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Gse=function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[t++];e[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[t++],r=n[t++],a=n[t++],l=((s&7)<<18|(o&63)<<12|(r&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(l&1023))}else{const o=n[t++],r=n[t++];e[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return e.join("")},I3={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const o=n[s],r=s+1<n.length,a=r?n[s+1]:0,l=s+2<n.length,g=l?n[s+2]:0,c=o>>2,u=(o&3)<<4|a>>4;let C=(a&15)<<2|g>>6,h=g&63;l||(h=64,r||(C=64)),i.push(t[c],t[u],t[C],t[h])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(u3(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Gse(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const o=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const g=s<n.length?t[n.charAt(s)]:64;++s;const u=s<n.length?t[n.charAt(s)]:64;if(++s,o==null||a==null||g==null||u==null)throw new vse;const C=o<<2|a>>4;if(i.push(C),g!==64){const h=a<<4&240|g>>2;if(i.push(h),u!==64){const p=g<<6&192|u;i.push(p)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vse extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wse=function(n){const e=u3(n);return I3.encodeByteArray(e,!0)},M0=function(n){return wse(n).replace(/\./g,"")},Zse=function(n){try{return I3.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sse(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rse=()=>Sse().__FIREBASE_DEFAULTS__,xse=()=>{if(typeof process>"u"||typeof rF>"u")return;const n=rF.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Vse=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Zse(n[1]);return e&&JSON.parse(e)},QS=()=>{try{return Bse()||Rse()||xse()||Vse()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Wse=n=>{var e,t;return(t=(e=QS())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Mse=n=>{const e=Wse(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},d3=()=>{var n;return(n=QS())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nse{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(n){return n.endsWith(".cloudworkstations.dev")}async function Fse(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hse(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},i=e||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},n);return[M0(JSON.stringify(t)),M0(JSON.stringify(r)),""].join(".")}const $C={};function Xse(){const n={prod:[],emulator:[]};for(const e of Object.keys($C))$C[e]?n.emulator.push(e):n.prod.push(e);return n}function Tse(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let aF=!1;function Ese(n,e){if(typeof window>"u"||typeof document>"u"||!jS(window.location.host)||$C[n]===e||$C[n]||aF)return;$C[n]=e;function t(C){return`__firebase__banner__${C}`}const i="__firebase__banner",o=Xse().prod.length>0;function r(){const C=document.getElementById(i);C&&C.remove()}function a(C){C.style.display="flex",C.style.background="#7faaf0",C.style.position="fixed",C.style.bottom="5px",C.style.left="5px",C.style.padding=".5em",C.style.borderRadius="5px",C.style.alignItems="center"}function l(C,h){C.setAttribute("width","24"),C.setAttribute("id",h),C.setAttribute("height","24"),C.setAttribute("viewBox","0 0 24 24"),C.setAttribute("fill","none"),C.style.marginLeft="-6px"}function g(){const C=document.createElement("span");return C.style.cursor="pointer",C.style.marginLeft="16px",C.style.fontSize="24px",C.innerHTML=" &times;",C.onclick=()=>{aF=!0,r()},C}function c(C,h){C.setAttribute("id",h),C.innerText="Learn more",C.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",C.setAttribute("target","__blank"),C.style.paddingLeft="5px",C.style.textDecoration="underline"}function u(){const C=Tse(i),h=t("text"),p=document.getElementById(h)||document.createElement("span"),b=t("learnmore"),m=document.getElementById(b)||document.createElement("a"),A=t("preprendIcon"),B=document.getElementById(A)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(C.created){const G=C.element;a(G),c(m,b);const w=g();l(B,A),G.append(B,p,m,w),document.body.appendChild(G)}o?(p.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,p.innerText="Preview backend running in this workspace."),p.setAttribute("id",h)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",u):u()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yse(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Kse(){var n;const e=(n=QS())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _se(){return!Kse()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Lse(){try{return typeof indexedDB=="object"}catch{return!1}}function kse(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var o;e(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zse="FirebaseError";class hd extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=zse,Object.setPrototypeOf(this,hd.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C3.prototype.create)}}class C3{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],r=o?Dse(o,i):"Error",a=`${this.serviceName}: ${r} (${s}).`;return new hd(s,a,i)}}function Dse(n,e){return n.replace(Pse,(t,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const Pse=/\{\$([^}]+)}/g;function N0(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const o=n[s],r=e[s];if(lF(o)&&lF(r)){if(!N0(o,r))return!1}else if(o!==r)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function lF(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lh(n){return n&&n._delegate?n._delegate:n}class kh{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Use{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Nse;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(o){if(s)return null;throw o}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Ose(e))try{this.getOrInitializeService({instanceIdentifier:cc})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const o=this.getOrInitializeService({instanceIdentifier:s});i.resolve(o)}catch{}}}}clearInstance(e=cc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=cc){return this.instances.has(e)}getOptions(e=cc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[o,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(o);i===a&&r.resolve(s)}return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),o=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;o.add(e),this.onInitCallbacks.set(s,o);const r=this.instances.get(s);return r&&e(r,s),()=>{o.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:Jse(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=cc){return this.component?this.component.multipleInstances?e:cc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Jse(n){return n===cc?void 0:n}function Ose(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qse{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Use(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var un;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(un||(un={}));const jse={debug:un.DEBUG,verbose:un.VERBOSE,info:un.INFO,warn:un.WARN,error:un.ERROR,silent:un.SILENT},qse=un.INFO,$se={[un.DEBUG]:"log",[un.VERBOSE]:"log",[un.INFO]:"info",[un.WARN]:"warn",[un.ERROR]:"error"},eoe=(n,e,...t)=>{if(e<n.logLevel)return;const i=new Date().toISOString(),s=$se[e];if(s)console[s](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class h3{constructor(e){this.name=e,this._logLevel=qse,this._logHandler=eoe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in un))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?jse[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,un.DEBUG,...e),this._logHandler(this,un.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,un.VERBOSE,...e),this._logHandler(this,un.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,un.INFO,...e),this._logHandler(this,un.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,un.WARN,...e),this._logHandler(this,un.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,un.ERROR,...e),this._logHandler(this,un.ERROR,...e)}}const toe=(n,e)=>e.some(t=>n instanceof t);let gF,cF;function noe(){return gF||(gF=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function ioe(){return cF||(cF=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const A3=new WeakMap,ow=new WeakMap,p3=new WeakMap,Iv=new WeakMap,qS=new WeakMap;function soe(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",r)},o=()=>{t(Ol(n.result)),s()},r=()=>{i(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",r)});return e.then(t=>{t instanceof IDBCursor&&A3.set(t,n)}).catch(()=>{}),qS.set(e,n),e}function ooe(n){if(ow.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",r),n.removeEventListener("abort",r)},o=()=>{t(),s()},r=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",r),n.addEventListener("abort",r)});ow.set(n,e)}let rw={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ow.get(n);if(e==="objectStoreNames")return n.objectStoreNames||p3.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Ol(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function roe(n){rw=n(rw)}function aoe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const i=n.call(dv(this),e,...t);return p3.set(i,e.sort?e.sort():[e]),Ol(i)}:ioe().includes(n)?function(...e){return n.apply(dv(this),e),Ol(A3.get(this))}:function(...e){return Ol(n.apply(dv(this),e))}}function loe(n){return typeof n=="function"?aoe(n):(n instanceof IDBTransaction&&ooe(n),toe(n,noe())?new Proxy(n,rw):n)}function Ol(n){if(n instanceof IDBRequest)return soe(n);if(Iv.has(n))return Iv.get(n);const e=loe(n);return e!==n&&(Iv.set(n,e),qS.set(e,n)),e}const dv=n=>qS.get(n);function goe(n,e,{blocked:t,upgrade:i,blocking:s,terminated:o}={}){const r=indexedDB.open(n,e),a=Ol(r);return i&&r.addEventListener("upgradeneeded",l=>{i(Ol(r.result),l.oldVersion,l.newVersion,Ol(r.transaction),l)}),t&&r.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",g=>s(g.oldVersion,g.newVersion,g))}).catch(()=>{}),a}const coe=["get","getKey","getAll","getAllKeys","count"],uoe=["put","add","delete","clear"],Cv=new Map;function uF(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Cv.get(e))return Cv.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=uoe.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(s||coe.includes(t)))return;const o=async function(r,...a){const l=this.transaction(r,s?"readwrite":"readonly");let g=l.store;return i&&(g=g.index(a.shift())),(await Promise.all([g[t](...a),s&&l.done]))[0]};return Cv.set(e,o),o}roe(n=>({...n,get:(e,t,i)=>uF(e,t)||n.get(e,t,i),has:(e,t)=>!!uF(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ioe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(doe(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}}function doe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const aw="@firebase/app",IF="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl=new h3("@firebase/app"),Coe="@firebase/app-compat",hoe="@firebase/analytics-compat",Aoe="@firebase/analytics",poe="@firebase/app-check-compat",moe="@firebase/app-check",foe="@firebase/auth",boe="@firebase/auth-compat",yoe="@firebase/database",Boe="@firebase/data-connect",Goe="@firebase/database-compat",voe="@firebase/functions",woe="@firebase/functions-compat",Zoe="@firebase/installations",Soe="@firebase/installations-compat",Roe="@firebase/messaging",xoe="@firebase/messaging-compat",Voe="@firebase/performance",Woe="@firebase/performance-compat",Moe="@firebase/remote-config",Noe="@firebase/remote-config-compat",Foe="@firebase/storage",Hoe="@firebase/storage-compat",Xoe="@firebase/firestore",Toe="@firebase/ai",Eoe="@firebase/firestore-compat",Yoe="firebase",Koe="11.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lw="[DEFAULT]",_oe={[aw]:"fire-core",[Coe]:"fire-core-compat",[Aoe]:"fire-analytics",[hoe]:"fire-analytics-compat",[moe]:"fire-app-check",[poe]:"fire-app-check-compat",[foe]:"fire-auth",[boe]:"fire-auth-compat",[yoe]:"fire-rtdb",[Boe]:"fire-data-connect",[Goe]:"fire-rtdb-compat",[voe]:"fire-fn",[woe]:"fire-fn-compat",[Zoe]:"fire-iid",[Soe]:"fire-iid-compat",[Roe]:"fire-fcm",[xoe]:"fire-fcm-compat",[Voe]:"fire-perf",[Woe]:"fire-perf-compat",[Moe]:"fire-rc",[Noe]:"fire-rc-compat",[Foe]:"fire-gcs",[Hoe]:"fire-gcs-compat",[Xoe]:"fire-fst",[Eoe]:"fire-fst-compat",[Toe]:"fire-vertex","fire-js":"fire-js",[Yoe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F0=new Map,Loe=new Map,gw=new Map;function dF(n,e){try{n.container.addComponent(e)}catch(t){tl.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function H0(n){const e=n.name;if(gw.has(e))return tl.debug(`There were multiple attempts to register component ${e}.`),!1;gw.set(e,n);for(const t of F0.values())dF(t,n);for(const t of Loe.values())dF(t,n);return!0}function koe(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function zoe(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Doe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ql=new C3("app","Firebase",Doe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Poe{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new kh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ql.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uoe=Koe;function m3(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const i=Object.assign({name:lw,automaticDataCollectionEnabled:!0},e),s=i.name;if(typeof s!="string"||!s)throw Ql.create("bad-app-name",{appName:String(s)});if(t||(t=d3()),!t)throw Ql.create("no-options");const o=F0.get(s);if(o){if(N0(t,o.options)&&N0(i,o.config))return o;throw Ql.create("duplicate-app",{appName:s})}const r=new Qse(s);for(const l of gw.values())r.addComponent(l);const a=new Poe(t,i,r);return F0.set(s,a),a}function Joe(n=lw){const e=F0.get(n);if(!e&&n===lw&&d3())return m3();if(!e)throw Ql.create("no-app",{appName:n});return e}function FI(n,e,t){var i;let s=(i=_oe[n])!==null&&i!==void 0?i:n;t&&(s+=`-${t}`);const o=s.match(/\s|\//),r=e.match(/\s|\//);if(o||r){const a=[`Unable to register library "${s}" with version "${e}":`];o&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&r&&a.push("and"),r&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tl.warn(a.join(" "));return}H0(new kh(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ooe="firebase-heartbeat-database",Qoe=1,zh="firebase-heartbeat-store";let hv=null;function f3(){return hv||(hv=goe(Ooe,Qoe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(zh)}catch(t){console.warn(t)}}}}).catch(n=>{throw Ql.create("idb-open",{originalErrorMessage:n.message})})),hv}async function joe(n){try{const t=(await f3()).transaction(zh),i=await t.objectStore(zh).get(b3(n));return await t.done,i}catch(e){if(e instanceof hd)tl.warn(e.message);else{const t=Ql.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});tl.warn(t.message)}}}async function CF(n,e){try{const i=(await f3()).transaction(zh,"readwrite");await i.objectStore(zh).put(e,b3(n)),await i.done}catch(t){if(t instanceof hd)tl.warn(t.message);else{const i=Ql.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});tl.warn(i.message)}}}function b3(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qoe=1024,$oe=30;class ere{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new nre(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=hF();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(r=>r.date===o))return;if(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats.length>$oe){const r=ire(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(r,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){tl.warn(i)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=hF(),{heartbeatsToSend:i,unsentEntries:s}=tre(this._heartbeatsCache.heartbeats),o=M0(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(t){return tl.warn(t),""}}}function hF(){return new Date().toISOString().substring(0,10)}function tre(n,e=qoe){const t=[];let i=n.slice();for(const s of n){const o=t.find(r=>r.agent===s.agent);if(o){if(o.dates.push(s.date),AF(t)>e){o.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),AF(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}class nre{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Lse()?kse().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await joe(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return CF(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return CF(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function AF(n){return M0(JSON.stringify({version:2,heartbeats:n})).length}function ire(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sre(n){H0(new kh("platform-logger",e=>new Ioe(e),"PRIVATE")),H0(new kh("heartbeat",e=>new ere(e),"PRIVATE")),FI(aw,IF,n),FI(aw,IF,"esm2017"),FI("fire-js","")}sre("");var ore="firebase",rre="11.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */FI(ore,rre,"app");var pF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var $S;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(R,S){function F(){}F.prototype=S.prototype,R.D=S.prototype,R.prototype=new F,R.prototype.constructor=R,R.C=function(Z,x,Y){for(var T=Array(arguments.length-2),ne=2;ne<arguments.length;ne++)T[ne-2]=arguments[ne];return S.prototype[x].apply(Z,T)}}function t(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(i,t),i.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(R,S,F){F||(F=0);var Z=Array(16);if(typeof S=="string")for(var x=0;16>x;++x)Z[x]=S.charCodeAt(F++)|S.charCodeAt(F++)<<8|S.charCodeAt(F++)<<16|S.charCodeAt(F++)<<24;else for(x=0;16>x;++x)Z[x]=S[F++]|S[F++]<<8|S[F++]<<16|S[F++]<<24;S=R.g[0],F=R.g[1],x=R.g[2];var Y=R.g[3],T=S+(Y^F&(x^Y))+Z[0]+3614090360&4294967295;S=F+(T<<7&4294967295|T>>>25),T=Y+(x^S&(F^x))+Z[1]+3905402710&4294967295,Y=S+(T<<12&4294967295|T>>>20),T=x+(F^Y&(S^F))+Z[2]+606105819&4294967295,x=Y+(T<<17&4294967295|T>>>15),T=F+(S^x&(Y^S))+Z[3]+3250441966&4294967295,F=x+(T<<22&4294967295|T>>>10),T=S+(Y^F&(x^Y))+Z[4]+4118548399&4294967295,S=F+(T<<7&4294967295|T>>>25),T=Y+(x^S&(F^x))+Z[5]+1200080426&4294967295,Y=S+(T<<12&4294967295|T>>>20),T=x+(F^Y&(S^F))+Z[6]+2821735955&4294967295,x=Y+(T<<17&4294967295|T>>>15),T=F+(S^x&(Y^S))+Z[7]+4249261313&4294967295,F=x+(T<<22&4294967295|T>>>10),T=S+(Y^F&(x^Y))+Z[8]+1770035416&4294967295,S=F+(T<<7&4294967295|T>>>25),T=Y+(x^S&(F^x))+Z[9]+2336552879&4294967295,Y=S+(T<<12&4294967295|T>>>20),T=x+(F^Y&(S^F))+Z[10]+4294925233&4294967295,x=Y+(T<<17&4294967295|T>>>15),T=F+(S^x&(Y^S))+Z[11]+2304563134&4294967295,F=x+(T<<22&4294967295|T>>>10),T=S+(Y^F&(x^Y))+Z[12]+1804603682&4294967295,S=F+(T<<7&4294967295|T>>>25),T=Y+(x^S&(F^x))+Z[13]+4254626195&4294967295,Y=S+(T<<12&4294967295|T>>>20),T=x+(F^Y&(S^F))+Z[14]+2792965006&4294967295,x=Y+(T<<17&4294967295|T>>>15),T=F+(S^x&(Y^S))+Z[15]+1236535329&4294967295,F=x+(T<<22&4294967295|T>>>10),T=S+(x^Y&(F^x))+Z[1]+4129170786&4294967295,S=F+(T<<5&4294967295|T>>>27),T=Y+(F^x&(S^F))+Z[6]+3225465664&4294967295,Y=S+(T<<9&4294967295|T>>>23),T=x+(S^F&(Y^S))+Z[11]+643717713&4294967295,x=Y+(T<<14&4294967295|T>>>18),T=F+(Y^S&(x^Y))+Z[0]+3921069994&4294967295,F=x+(T<<20&4294967295|T>>>12),T=S+(x^Y&(F^x))+Z[5]+3593408605&4294967295,S=F+(T<<5&4294967295|T>>>27),T=Y+(F^x&(S^F))+Z[10]+38016083&4294967295,Y=S+(T<<9&4294967295|T>>>23),T=x+(S^F&(Y^S))+Z[15]+3634488961&4294967295,x=Y+(T<<14&4294967295|T>>>18),T=F+(Y^S&(x^Y))+Z[4]+3889429448&4294967295,F=x+(T<<20&4294967295|T>>>12),T=S+(x^Y&(F^x))+Z[9]+568446438&4294967295,S=F+(T<<5&4294967295|T>>>27),T=Y+(F^x&(S^F))+Z[14]+3275163606&4294967295,Y=S+(T<<9&4294967295|T>>>23),T=x+(S^F&(Y^S))+Z[3]+4107603335&4294967295,x=Y+(T<<14&4294967295|T>>>18),T=F+(Y^S&(x^Y))+Z[8]+1163531501&4294967295,F=x+(T<<20&4294967295|T>>>12),T=S+(x^Y&(F^x))+Z[13]+2850285829&4294967295,S=F+(T<<5&4294967295|T>>>27),T=Y+(F^x&(S^F))+Z[2]+4243563512&4294967295,Y=S+(T<<9&4294967295|T>>>23),T=x+(S^F&(Y^S))+Z[7]+1735328473&4294967295,x=Y+(T<<14&4294967295|T>>>18),T=F+(Y^S&(x^Y))+Z[12]+2368359562&4294967295,F=x+(T<<20&4294967295|T>>>12),T=S+(F^x^Y)+Z[5]+4294588738&4294967295,S=F+(T<<4&4294967295|T>>>28),T=Y+(S^F^x)+Z[8]+2272392833&4294967295,Y=S+(T<<11&4294967295|T>>>21),T=x+(Y^S^F)+Z[11]+1839030562&4294967295,x=Y+(T<<16&4294967295|T>>>16),T=F+(x^Y^S)+Z[14]+4259657740&4294967295,F=x+(T<<23&4294967295|T>>>9),T=S+(F^x^Y)+Z[1]+2763975236&4294967295,S=F+(T<<4&4294967295|T>>>28),T=Y+(S^F^x)+Z[4]+1272893353&4294967295,Y=S+(T<<11&4294967295|T>>>21),T=x+(Y^S^F)+Z[7]+4139469664&4294967295,x=Y+(T<<16&4294967295|T>>>16),T=F+(x^Y^S)+Z[10]+3200236656&4294967295,F=x+(T<<23&4294967295|T>>>9),T=S+(F^x^Y)+Z[13]+681279174&4294967295,S=F+(T<<4&4294967295|T>>>28),T=Y+(S^F^x)+Z[0]+3936430074&4294967295,Y=S+(T<<11&4294967295|T>>>21),T=x+(Y^S^F)+Z[3]+3572445317&4294967295,x=Y+(T<<16&4294967295|T>>>16),T=F+(x^Y^S)+Z[6]+76029189&4294967295,F=x+(T<<23&4294967295|T>>>9),T=S+(F^x^Y)+Z[9]+3654602809&4294967295,S=F+(T<<4&4294967295|T>>>28),T=Y+(S^F^x)+Z[12]+3873151461&4294967295,Y=S+(T<<11&4294967295|T>>>21),T=x+(Y^S^F)+Z[15]+530742520&4294967295,x=Y+(T<<16&4294967295|T>>>16),T=F+(x^Y^S)+Z[2]+3299628645&4294967295,F=x+(T<<23&4294967295|T>>>9),T=S+(x^(F|~Y))+Z[0]+4096336452&4294967295,S=F+(T<<6&4294967295|T>>>26),T=Y+(F^(S|~x))+Z[7]+1126891415&4294967295,Y=S+(T<<10&4294967295|T>>>22),T=x+(S^(Y|~F))+Z[14]+2878612391&4294967295,x=Y+(T<<15&4294967295|T>>>17),T=F+(Y^(x|~S))+Z[5]+4237533241&4294967295,F=x+(T<<21&4294967295|T>>>11),T=S+(x^(F|~Y))+Z[12]+1700485571&4294967295,S=F+(T<<6&4294967295|T>>>26),T=Y+(F^(S|~x))+Z[3]+2399980690&4294967295,Y=S+(T<<10&4294967295|T>>>22),T=x+(S^(Y|~F))+Z[10]+4293915773&4294967295,x=Y+(T<<15&4294967295|T>>>17),T=F+(Y^(x|~S))+Z[1]+2240044497&4294967295,F=x+(T<<21&4294967295|T>>>11),T=S+(x^(F|~Y))+Z[8]+1873313359&4294967295,S=F+(T<<6&4294967295|T>>>26),T=Y+(F^(S|~x))+Z[15]+4264355552&4294967295,Y=S+(T<<10&4294967295|T>>>22),T=x+(S^(Y|~F))+Z[6]+2734768916&4294967295,x=Y+(T<<15&4294967295|T>>>17),T=F+(Y^(x|~S))+Z[13]+1309151649&4294967295,F=x+(T<<21&4294967295|T>>>11),T=S+(x^(F|~Y))+Z[4]+4149444226&4294967295,S=F+(T<<6&4294967295|T>>>26),T=Y+(F^(S|~x))+Z[11]+3174756917&4294967295,Y=S+(T<<10&4294967295|T>>>22),T=x+(S^(Y|~F))+Z[2]+718787259&4294967295,x=Y+(T<<15&4294967295|T>>>17),T=F+(Y^(x|~S))+Z[9]+3951481745&4294967295,R.g[0]=R.g[0]+S&4294967295,R.g[1]=R.g[1]+(x+(T<<21&4294967295|T>>>11))&4294967295,R.g[2]=R.g[2]+x&4294967295,R.g[3]=R.g[3]+Y&4294967295}i.prototype.u=function(R,S){S===void 0&&(S=R.length);for(var F=S-this.blockSize,Z=this.B,x=this.h,Y=0;Y<S;){if(x==0)for(;Y<=F;)s(this,R,Y),Y+=this.blockSize;if(typeof R=="string"){for(;Y<S;)if(Z[x++]=R.charCodeAt(Y++),x==this.blockSize){s(this,Z),x=0;break}}else for(;Y<S;)if(Z[x++]=R[Y++],x==this.blockSize){s(this,Z),x=0;break}}this.h=x,this.o+=S},i.prototype.v=function(){var R=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);R[0]=128;for(var S=1;S<R.length-8;++S)R[S]=0;var F=8*this.o;for(S=R.length-8;S<R.length;++S)R[S]=F&255,F/=256;for(this.u(R),R=Array(16),S=F=0;4>S;++S)for(var Z=0;32>Z;Z+=8)R[F++]=this.g[S]>>>Z&255;return R};function o(R,S){var F=a;return Object.prototype.hasOwnProperty.call(F,R)?F[R]:F[R]=S(R)}function r(R,S){this.h=S;for(var F=[],Z=!0,x=R.length-1;0<=x;x--){var Y=R[x]|0;Z&&Y==S||(F[x]=Y,Z=!1)}this.g=F}var a={};function l(R){return-128<=R&&128>R?o(R,function(S){return new r([S|0],0>S?-1:0)}):new r([R|0],0>R?-1:0)}function g(R){if(isNaN(R)||!isFinite(R))return u;if(0>R)return m(g(-R));for(var S=[],F=1,Z=0;R>=F;Z++)S[Z]=R/F|0,F*=4294967296;return new r(S,0)}function c(R,S){if(R.length==0)throw Error("number format error: empty string");if(S=S||10,2>S||36<S)throw Error("radix out of range: "+S);if(R.charAt(0)=="-")return m(c(R.substring(1),S));if(0<=R.indexOf("-"))throw Error('number format error: interior "-" character');for(var F=g(Math.pow(S,8)),Z=u,x=0;x<R.length;x+=8){var Y=Math.min(8,R.length-x),T=parseInt(R.substring(x,x+Y),S);8>Y?(Y=g(Math.pow(S,Y)),Z=Z.j(Y).add(g(T))):(Z=Z.j(F),Z=Z.add(g(T)))}return Z}var u=l(0),C=l(1),h=l(16777216);n=r.prototype,n.m=function(){if(b(this))return-m(this).m();for(var R=0,S=1,F=0;F<this.g.length;F++){var Z=this.i(F);R+=(0<=Z?Z:4294967296+Z)*S,S*=4294967296}return R},n.toString=function(R){if(R=R||10,2>R||36<R)throw Error("radix out of range: "+R);if(p(this))return"0";if(b(this))return"-"+m(this).toString(R);for(var S=g(Math.pow(R,6)),F=this,Z="";;){var x=w(F,S).g;F=A(F,x.j(S));var Y=((0<F.g.length?F.g[0]:F.h)>>>0).toString(R);if(F=x,p(F))return Y+Z;for(;6>Y.length;)Y="0"+Y;Z=Y+Z}},n.i=function(R){return 0>R?0:R<this.g.length?this.g[R]:this.h};function p(R){if(R.h!=0)return!1;for(var S=0;S<R.g.length;S++)if(R.g[S]!=0)return!1;return!0}function b(R){return R.h==-1}n.l=function(R){return R=A(this,R),b(R)?-1:p(R)?0:1};function m(R){for(var S=R.g.length,F=[],Z=0;Z<S;Z++)F[Z]=~R.g[Z];return new r(F,~R.h).add(C)}n.abs=function(){return b(this)?m(this):this},n.add=function(R){for(var S=Math.max(this.g.length,R.g.length),F=[],Z=0,x=0;x<=S;x++){var Y=Z+(this.i(x)&65535)+(R.i(x)&65535),T=(Y>>>16)+(this.i(x)>>>16)+(R.i(x)>>>16);Z=T>>>16,Y&=65535,T&=65535,F[x]=T<<16|Y}return new r(F,F[F.length-1]&-2147483648?-1:0)};function A(R,S){return R.add(m(S))}n.j=function(R){if(p(this)||p(R))return u;if(b(this))return b(R)?m(this).j(m(R)):m(m(this).j(R));if(b(R))return m(this.j(m(R)));if(0>this.l(h)&&0>R.l(h))return g(this.m()*R.m());for(var S=this.g.length+R.g.length,F=[],Z=0;Z<2*S;Z++)F[Z]=0;for(Z=0;Z<this.g.length;Z++)for(var x=0;x<R.g.length;x++){var Y=this.i(Z)>>>16,T=this.i(Z)&65535,ne=R.i(x)>>>16,ue=R.i(x)&65535;F[2*Z+2*x]+=T*ue,B(F,2*Z+2*x),F[2*Z+2*x+1]+=Y*ue,B(F,2*Z+2*x+1),F[2*Z+2*x+1]+=T*ne,B(F,2*Z+2*x+1),F[2*Z+2*x+2]+=Y*ne,B(F,2*Z+2*x+2)}for(Z=0;Z<S;Z++)F[Z]=F[2*Z+1]<<16|F[2*Z];for(Z=S;Z<2*S;Z++)F[Z]=0;return new r(F,0)};function B(R,S){for(;(R[S]&65535)!=R[S];)R[S+1]+=R[S]>>>16,R[S]&=65535,S++}function G(R,S){this.g=R,this.h=S}function w(R,S){if(p(S))throw Error("division by zero");if(p(R))return new G(u,u);if(b(R))return S=w(m(R),S),new G(m(S.g),m(S.h));if(b(S))return S=w(R,m(S)),new G(m(S.g),S.h);if(30<R.g.length){if(b(R)||b(S))throw Error("slowDivide_ only works with positive integers.");for(var F=C,Z=S;0>=Z.l(R);)F=N(F),Z=N(Z);var x=M(F,1),Y=M(Z,1);for(Z=M(Z,2),F=M(F,2);!p(Z);){var T=Y.add(Z);0>=T.l(R)&&(x=x.add(F),Y=T),Z=M(Z,1),F=M(F,1)}return S=A(R,x.j(S)),new G(x,S)}for(x=u;0<=R.l(S);){for(F=Math.max(1,Math.floor(R.m()/S.m())),Z=Math.ceil(Math.log(F)/Math.LN2),Z=48>=Z?1:Math.pow(2,Z-48),Y=g(F),T=Y.j(S);b(T)||0<T.l(R);)F-=Z,Y=g(F),T=Y.j(S);p(Y)&&(Y=C),x=x.add(Y),R=A(R,T)}return new G(x,R)}n.A=function(R){return w(this,R).h},n.and=function(R){for(var S=Math.max(this.g.length,R.g.length),F=[],Z=0;Z<S;Z++)F[Z]=this.i(Z)&R.i(Z);return new r(F,this.h&R.h)},n.or=function(R){for(var S=Math.max(this.g.length,R.g.length),F=[],Z=0;Z<S;Z++)F[Z]=this.i(Z)|R.i(Z);return new r(F,this.h|R.h)},n.xor=function(R){for(var S=Math.max(this.g.length,R.g.length),F=[],Z=0;Z<S;Z++)F[Z]=this.i(Z)^R.i(Z);return new r(F,this.h^R.h)};function N(R){for(var S=R.g.length+1,F=[],Z=0;Z<S;Z++)F[Z]=R.i(Z)<<1|R.i(Z-1)>>>31;return new r(F,R.h)}function M(R,S){var F=S>>5;S%=32;for(var Z=R.g.length-F,x=[],Y=0;Y<Z;Y++)x[Y]=0<S?R.i(Y+F)>>>S|R.i(Y+F+1)<<32-S:R.i(Y+F);return new r(x,R.h)}i.prototype.digest=i.prototype.v,i.prototype.reset=i.prototype.s,i.prototype.update=i.prototype.u,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=g,r.fromString=c,$S=r}).apply(typeof pF<"u"?pF:typeof self<"u"?self:typeof window<"u"?window:{});var Fm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var y3,WC,B3,af,cw,G3,v3,w3;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(f,W,H){return f==Array.prototype||f==Object.prototype||(f[W]=H.value),f};function t(f){f=[typeof globalThis=="object"&&globalThis,f,typeof window=="object"&&window,typeof self=="object"&&self,typeof Fm=="object"&&Fm];for(var W=0;W<f.length;++W){var H=f[W];if(H&&H.Math==Math)return H}throw Error("Cannot find global object")}var i=t(this);function s(f,W){if(W)e:{var H=i;f=f.split(".");for(var K=0;K<f.length-1;K++){var le=f[K];if(!(le in H))break e;H=H[le]}f=f[f.length-1],K=H[f],W=W(K),W!=K&&W!=null&&e(H,f,{configurable:!0,writable:!0,value:W})}}function o(f,W){f instanceof String&&(f+="");var H=0,K=!1,le={next:function(){if(!K&&H<f.length){var pe=H++;return{value:W(pe,f[pe]),done:!1}}return K=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}s("Array.prototype.values",function(f){return f||function(){return o(this,function(W,H){return H})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var r=r||{},a=this||self;function l(f){var W=typeof f;return W=W!="object"?W:f?Array.isArray(f)?"array":W:"null",W=="array"||W=="object"&&typeof f.length=="number"}function g(f){var W=typeof f;return W=="object"&&f!=null||W=="function"}function c(f,W,H){return f.call.apply(f.bind,arguments)}function u(f,W,H){if(!f)throw Error();if(2<arguments.length){var K=Array.prototype.slice.call(arguments,2);return function(){var le=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(le,K),f.apply(W,le)}}return function(){return f.apply(W,arguments)}}function C(f,W,H){return C=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?c:u,C.apply(null,arguments)}function h(f,W){var H=Array.prototype.slice.call(arguments,1);return function(){var K=H.slice();return K.push.apply(K,arguments),f.apply(this,K)}}function p(f,W){function H(){}H.prototype=W.prototype,f.aa=W.prototype,f.prototype=new H,f.prototype.constructor=f,f.Qb=function(K,le,pe){for(var Le=Array(arguments.length-2),sn=2;sn<arguments.length;sn++)Le[sn-2]=arguments[sn];return W.prototype[le].apply(K,Le)}}function b(f){const W=f.length;if(0<W){const H=Array(W);for(let K=0;K<W;K++)H[K]=f[K];return H}return[]}function m(f,W){for(let H=1;H<arguments.length;H++){const K=arguments[H];if(l(K)){const le=f.length||0,pe=K.length||0;f.length=le+pe;for(let Le=0;Le<pe;Le++)f[le+Le]=K[Le]}else f.push(K)}}class A{constructor(W,H){this.i=W,this.j=H,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function B(f){return/^[\s\xa0]*$/.test(f)}function G(){var f=a.navigator;return f&&(f=f.userAgent)?f:""}function w(f){return w[" "](f),f}w[" "]=function(){};var N=G().indexOf("Gecko")!=-1&&!(G().toLowerCase().indexOf("webkit")!=-1&&G().indexOf("Edge")==-1)&&!(G().indexOf("Trident")!=-1||G().indexOf("MSIE")!=-1)&&G().indexOf("Edge")==-1;function M(f,W,H){for(const K in f)W.call(H,f[K],K,f)}function R(f,W){for(const H in f)W.call(void 0,f[H],H,f)}function S(f){const W={};for(const H in f)W[H]=f[H];return W}const F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(f,W){let H,K;for(let le=1;le<arguments.length;le++){K=arguments[le];for(H in K)f[H]=K[H];for(let pe=0;pe<F.length;pe++)H=F[pe],Object.prototype.hasOwnProperty.call(K,H)&&(f[H]=K[H])}}function x(f){var W=1;f=f.split(":");const H=[];for(;0<W&&f.length;)H.push(f.shift()),W--;return f.length&&H.push(f.join(":")),H}function Y(f){a.setTimeout(()=>{throw f},0)}function T(){var f=ee;let W=null;return f.g&&(W=f.g,f.g=f.g.next,f.g||(f.h=null),W.next=null),W}class ne{constructor(){this.h=this.g=null}add(W,H){const K=ue.get();K.set(W,H),this.h?this.h.next=K:this.g=K,this.h=K}}var ue=new A(()=>new se,f=>f.reset());class se{constructor(){this.next=this.g=this.h=null}set(W,H){this.h=W,this.g=H,this.next=null}reset(){this.next=this.g=this.h=null}}let Ie,k=!1,ee=new ne,$=()=>{const f=a.Promise.resolve(void 0);Ie=()=>{f.then(ae)}};var ae=()=>{for(var f;f=T();){try{f.h.call(f.g)}catch(H){Y(H)}var W=ue;W.j(f),100>W.h&&(W.h++,f.next=W.g,W.g=f)}k=!1};function be(){this.s=this.s,this.C=this.C}be.prototype.s=!1,be.prototype.ma=function(){this.s||(this.s=!0,this.N())},be.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function me(f,W){this.type=f,this.g=this.target=W,this.defaultPrevented=!1}me.prototype.h=function(){this.defaultPrevented=!0};var ce=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var f=!1,W=Object.defineProperty({},"passive",{get:function(){f=!0}});try{const H=()=>{};a.addEventListener("test",H,W),a.removeEventListener("test",H,W)}catch{}return f}();function Be(f,W){if(me.call(this,f?f.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,f){var H=this.type=f.type,K=f.changedTouches&&f.changedTouches.length?f.changedTouches[0]:null;if(this.target=f.target||f.srcElement,this.g=W,W=f.relatedTarget){if(N){e:{try{w(W.nodeName);var le=!0;break e}catch{}le=!1}le||(W=null)}}else H=="mouseover"?W=f.fromElement:H=="mouseout"&&(W=f.toElement);this.relatedTarget=W,K?(this.clientX=K.clientX!==void 0?K.clientX:K.pageX,this.clientY=K.clientY!==void 0?K.clientY:K.pageY,this.screenX=K.screenX||0,this.screenY=K.screenY||0):(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0),this.button=f.button,this.key=f.key||"",this.ctrlKey=f.ctrlKey,this.altKey=f.altKey,this.shiftKey=f.shiftKey,this.metaKey=f.metaKey,this.pointerId=f.pointerId||0,this.pointerType=typeof f.pointerType=="string"?f.pointerType:He[f.pointerType]||"",this.state=f.state,this.i=f,f.defaultPrevented&&Be.aa.h.call(this)}}p(Be,me);var He={2:"touch",3:"pen",4:"mouse"};Be.prototype.h=function(){Be.aa.h.call(this);var f=this.i;f.preventDefault?f.preventDefault():f.returnValue=!1};var Fe="closure_listenable_"+(1e6*Math.random()|0),Ct=0;function pt(f,W,H,K,le){this.listener=f,this.proxy=null,this.src=W,this.type=H,this.capture=!!K,this.ha=le,this.key=++Ct,this.da=this.fa=!1}function ot(f){f.da=!0,f.listener=null,f.proxy=null,f.src=null,f.ha=null}function Ue(f){this.src=f,this.g={},this.h=0}Ue.prototype.add=function(f,W,H,K,le){var pe=f.toString();f=this.g[pe],f||(f=this.g[pe]=[],this.h++);var Le=D(f,W,K,le);return-1<Le?(W=f[Le],H||(W.fa=!1)):(W=new pt(W,this.src,pe,!!K,le),W.fa=H,f.push(W)),W};function we(f,W){var H=W.type;if(H in f.g){var K=f.g[H],le=Array.prototype.indexOf.call(K,W,void 0),pe;(pe=0<=le)&&Array.prototype.splice.call(K,le,1),pe&&(ot(W),f.g[H].length==0&&(delete f.g[H],f.h--))}}function D(f,W,H,K){for(var le=0;le<f.length;++le){var pe=f[le];if(!pe.da&&pe.listener==W&&pe.capture==!!H&&pe.ha==K)return le}return-1}var Ee="closure_lm_"+(1e6*Math.random()|0),Ye={};function Ne(f,W,H,K,le){if(Array.isArray(W)){for(var pe=0;pe<W.length;pe++)Ne(f,W[pe],H,K,le);return null}return H=Ze(H),f&&f[Fe]?f.K(W,H,g(K)?!!K.capture:!!K,le):_e(f,W,H,!1,K,le)}function _e(f,W,H,K,le,pe){if(!W)throw Error("Invalid event type");var Le=g(le)?!!le.capture:!!le,sn=ve(f);if(sn||(f[Ee]=sn=new Ue(f)),H=sn.add(W,H,K,Le,pe),H.proxy)return H;if(K=ut(),H.proxy=K,K.src=f,K.listener=H,f.addEventListener)ce||(le=Le),le===void 0&&(le=!1),f.addEventListener(W.toString(),K,le);else if(f.attachEvent)f.attachEvent(E(W.toString()),K);else if(f.addListener&&f.removeListener)f.addListener(K);else throw Error("addEventListener and attachEvent are unavailable.");return H}function ut(){function f(H){return W.call(f.src,f.listener,H)}const W=ge;return f}function Oe(f,W,H,K,le){if(Array.isArray(W))for(var pe=0;pe<W.length;pe++)Oe(f,W[pe],H,K,le);else K=g(K)?!!K.capture:!!K,H=Ze(H),f&&f[Fe]?(f=f.i,W=String(W).toString(),W in f.g&&(pe=f.g[W],H=D(pe,H,K,le),-1<H&&(ot(pe[H]),Array.prototype.splice.call(pe,H,1),pe.length==0&&(delete f.g[W],f.h--)))):f&&(f=ve(f))&&(W=f.g[W.toString()],f=-1,W&&(f=D(W,H,K,le)),(H=-1<f?W[f]:null)&&P(H))}function P(f){if(typeof f!="number"&&f&&!f.da){var W=f.src;if(W&&W[Fe])we(W.i,f);else{var H=f.type,K=f.proxy;W.removeEventListener?W.removeEventListener(H,K,f.capture):W.detachEvent?W.detachEvent(E(H),K):W.addListener&&W.removeListener&&W.removeListener(K),(H=ve(W))?(we(H,f),H.h==0&&(H.src=null,W[Ee]=null)):ot(f)}}}function E(f){return f in Ye?Ye[f]:Ye[f]="on"+f}function ge(f,W){if(f.da)f=!0;else{W=new Be(W,this);var H=f.listener,K=f.ha||f.src;f.fa&&P(f),f=H.call(K,W)}return f}function ve(f){return f=f[Ee],f instanceof Ue?f:null}var Se="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ze(f){return typeof f=="function"?f:(f[Se]||(f[Se]=function(W){return f.handleEvent(W)}),f[Se])}function Je(){be.call(this),this.i=new Ue(this),this.M=this,this.F=null}p(Je,be),Je.prototype[Fe]=!0,Je.prototype.removeEventListener=function(f,W,H,K){Oe(this,f,W,H,K)};function We(f,W){var H,K=f.F;if(K)for(H=[];K;K=K.F)H.push(K);if(f=f.M,K=W.type||W,typeof W=="string")W=new me(W,f);else if(W instanceof me)W.target=W.target||f;else{var le=W;W=new me(K,f),Z(W,le)}if(le=!0,H)for(var pe=H.length-1;0<=pe;pe--){var Le=W.g=H[pe];le=Qe(Le,K,!0,W)&&le}if(Le=W.g=f,le=Qe(Le,K,!0,W)&&le,le=Qe(Le,K,!1,W)&&le,H)for(pe=0;pe<H.length;pe++)Le=W.g=H[pe],le=Qe(Le,K,!1,W)&&le}Je.prototype.N=function(){if(Je.aa.N.call(this),this.i){var f=this.i,W;for(W in f.g){for(var H=f.g[W],K=0;K<H.length;K++)ot(H[K]);delete f.g[W],f.h--}}this.F=null},Je.prototype.K=function(f,W,H,K){return this.i.add(String(f),W,!1,H,K)},Je.prototype.L=function(f,W,H,K){return this.i.add(String(f),W,!0,H,K)};function Qe(f,W,H,K){if(W=f.i.g[String(W)],!W)return!0;W=W.concat();for(var le=!0,pe=0;pe<W.length;++pe){var Le=W[pe];if(Le&&!Le.da&&Le.capture==H){var sn=Le.listener,Ci=Le.ha||Le.src;Le.fa&&we(f.i,Le),le=sn.call(Ci,K)!==!1&&le}}return le&&!K.defaultPrevented}function Kt(f,W,H){if(typeof f=="function")H&&(f=C(f,H));else if(f&&typeof f.handleEvent=="function")f=C(f.handleEvent,f);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:a.setTimeout(f,W||0)}function Xe(f){f.g=Kt(()=>{f.g=null,f.i&&(f.i=!1,Xe(f))},f.l);const W=f.h;f.h=null,f.m.apply(null,W)}class et extends be{constructor(W,H){super(),this.m=W,this.l=H,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:Xe(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Gt(f){be.call(this),this.h=f,this.g={}}p(Gt,be);var wt=[];function it(f){M(f.g,function(W,H){this.g.hasOwnProperty(H)&&P(W)},f),f.g={}}Gt.prototype.N=function(){Gt.aa.N.call(this),it(this)},Gt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Nt=a.JSON.stringify,q=a.JSON.parse,xe=class{stringify(f){return a.JSON.stringify(f,void 0)}parse(f){return a.JSON.parse(f,void 0)}};function Q(){}Q.prototype.h=null;function Me(f){return f.h||(f.h=f.i())}function Ce(){}var Re={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function De(){me.call(this,"d")}p(De,me);function qe(){me.call(this,"c")}p(qe,me);var Wt={},$t=null;function An(){return $t=$t||new Je}Wt.La="serverreachability";function Ft(f){me.call(this,Wt.La,f)}p(Ft,me);function bn(f){const W=An();We(W,new Ft(W))}Wt.STAT_EVENT="statevent";function ri(f,W){me.call(this,Wt.STAT_EVENT,f),this.stat=W}p(ri,me);function Fn(f){const W=An();We(W,new ri(W,f))}Wt.Ma="timingevent";function fg(f,W){me.call(this,Wt.Ma,f),this.size=W}p(fg,me);function vs(f,W){if(typeof f!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){f()},W)}function Wo(){this.g=!0}Wo.prototype.xa=function(){this.g=!1};function sl(f,W,H,K,le,pe){f.info(function(){if(f.g)if(pe)for(var Le="",sn=pe.split("&"),Ci=0;Ci<sn.length;Ci++){var en=sn[Ci].split("=");if(1<en.length){var hi=en[0];en=en[1];var mn=hi.split("_");Le=2<=mn.length&&mn[1]=="type"?Le+(hi+"="+en+"&"):Le+(hi+"=redacted&")}}else Le=null;else Le=pe;return"XMLHTTP REQ ("+K+") [attempt "+le+"]: "+W+`
`+H+`
`+Le})}function uu(f,W,H,K,le,pe,Le){f.info(function(){return"XMLHTTP RESP ("+K+") [ attempt "+le+"]: "+W+`
`+H+`
`+pe+" "+Le})}function Yi(f,W,H,K){f.info(function(){return"XMLHTTP TEXT ("+W+"): "+ol(f,H)+(K?" "+K:"")})}function Iu(f,W){f.info(function(){return"TIMEOUT: "+W})}Wo.prototype.info=function(){};function ol(f,W){if(!f.g)return W;if(!W)return null;try{var H=JSON.parse(W);if(H){for(f=0;f<H.length;f++)if(Array.isArray(H[f])){var K=H[f];if(!(2>K.length)){var le=K[1];if(Array.isArray(le)&&!(1>le.length)){var pe=le[0];if(pe!="noop"&&pe!="stop"&&pe!="close")for(var Le=1;Le<le.length;Le++)le[Le]=""}}}}return Nt(H)}catch{return W}}var ca={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},bg={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},yg;function rl(){}p(rl,Q),rl.prototype.g=function(){return new XMLHttpRequest},rl.prototype.i=function(){return{}},yg=new rl;function Mo(f,W,H,K){this.j=f,this.i=W,this.l=H,this.R=K||1,this.U=new Gt(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new L}function L(){this.i=null,this.g="",this.h=!1}var ie={},de={};function Ae(f,W,H){f.L=1,f.v=ua(Hn(W)),f.m=H,f.P=!0,re(f,null)}function re(f,W){f.F=Date.now(),st(f),f.A=Hn(f.v);var H=f.A,K=f.R;Array.isArray(K)||(K=[String(K)]),Cu(H.i,"t",K),f.C=0,H=f.j.J,f.h=new L,f.g=Wg(f.j,H?W:null,!f.m),0<f.O&&(f.M=new et(C(f.Y,f,f.g),f.O)),W=f.U,H=f.g,K=f.ca;var le="readystatechange";Array.isArray(le)||(le&&(wt[0]=le.toString()),le=wt);for(var pe=0;pe<le.length;pe++){var Le=Ne(H,le[pe],K||W.handleEvent,!1,W.h||W);if(!Le)break;W.g[Le.key]=Le}W=f.H?S(f.H):{},f.m?(f.u||(f.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",f.g.ea(f.A,f.u,f.m,W)):(f.u="GET",f.g.ea(f.A,f.u,null,W)),bn(),sl(f.i,f.u,f.A,f.l,f.R,f.m)}Mo.prototype.ca=function(f){f=f.target;const W=this.M;W&&ai(f)==3?W.j():this.Y(f)},Mo.prototype.Y=function(f){try{if(f==this.g)e:{const mn=ai(this.g);var W=this.g.Ba();const Ai=this.g.Z();if(!(3>mn)&&(mn!=3||this.g&&(this.h.h||this.g.oa()||Sg(this.g)))){this.J||mn!=4||W==7||(W==8||0>=Ai?bn(3):bn(2)),vt(this);var H=this.g.Z();this.X=H;t:if(ke(this)){var K=Sg(this.g);f="";var le=K.length,pe=ai(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){lt(this),Bt(this);var Le="";break t}this.h.i=new a.TextDecoder}for(W=0;W<le;W++)this.h.h=!0,f+=this.h.i.decode(K[W],{stream:!(pe&&W==le-1)});K.length=0,this.h.g+=f,this.C=0,Le=this.h.g}else Le=this.g.oa();if(this.o=H==200,uu(this.i,this.u,this.A,this.l,this.R,mn,H),this.o){if(this.T&&!this.K){t:{if(this.g){var sn,Ci=this.g;if((sn=Ci.g?Ci.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(sn)){var en=sn;break t}}en=null}if(H=en)Yi(this.i,this.l,H,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ot(this,H);else{this.o=!1,this.s=3,Fn(12),lt(this),Bt(this);break e}}if(this.P){H=!0;let tn;for(;!this.J&&this.C<Le.length;)if(tn=tt(this,Le),tn==de){mn==4&&(this.s=4,Fn(14),H=!1),Yi(this.i,this.l,null,"[Incomplete Response]");break}else if(tn==ie){this.s=4,Fn(15),Yi(this.i,this.l,Le,"[Invalid Chunk]"),H=!1;break}else Yi(this.i,this.l,tn,null),Ot(this,tn);if(ke(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),mn!=4||Le.length!=0||this.h.h||(this.s=1,Fn(16),H=!1),this.o=this.o&&H,!H)Yi(this.i,this.l,Le,"[Invalid Chunked Response]"),lt(this),Bt(this);else if(0<Le.length&&!this.W){this.W=!0;var hi=this.j;hi.g==this&&hi.ba&&!hi.M&&(hi.j.info("Great, no buffering proxy detected. Bytes received: "+Le.length),Io(hi),hi.M=!0,Fn(11))}}else Yi(this.i,this.l,Le,null),Ot(this,Le);mn==4&&lt(this),this.o&&!this.J&&(mn==4?Gd(this.j,this):(this.o=!1,st(this)))}else Au(this.g),H==400&&0<Le.indexOf("Unknown SID")?(this.s=3,Fn(12)):(this.s=0,Fn(13)),lt(this),Bt(this)}}}catch{}finally{}};function ke(f){return f.g?f.u=="GET"&&f.L!=2&&f.j.Ca:!1}function tt(f,W){var H=f.C,K=W.indexOf(`
`,H);return K==-1?de:(H=Number(W.substring(H,K)),isNaN(H)?ie:(K+=1,K+H>W.length?de:(W=W.slice(K,K+H),f.C=K+H,W)))}Mo.prototype.cancel=function(){this.J=!0,lt(this)};function st(f){f.S=Date.now()+f.I,rt(f,f.I)}function rt(f,W){if(f.B!=null)throw Error("WatchDog timer not null");f.B=vs(C(f.ba,f),W)}function vt(f){f.B&&(a.clearTimeout(f.B),f.B=null)}Mo.prototype.ba=function(){this.B=null;const f=Date.now();0<=f-this.S?(Iu(this.i,this.A),this.L!=2&&(bn(),Fn(17)),lt(this),this.s=2,Bt(this)):rt(this,this.S-f)};function Bt(f){f.j.G==0||f.J||Gd(f.j,f)}function lt(f){vt(f);var W=f.M;W&&typeof W.ma=="function"&&W.ma(),f.M=null,it(f.U),f.g&&(W=f.g,f.g=null,W.abort(),W.ma())}function Ot(f,W){try{var H=f.j;if(H.G!=0&&(H.g==f||at(H.h,f))){if(!f.K&&at(H.h,f)&&H.G==3){try{var K=H.Da.g.parse(W)}catch{K=null}if(Array.isArray(K)&&K.length==3){var le=K;if(le[0]==0){e:if(!H.u){if(H.g)if(H.g.F+3e3<f.F)ha(H),xg(H);else break e;bu(H),Fn(18)}}else H.za=le[1],0<H.za-H.T&&37500>le[2]&&H.F&&H.v==0&&!H.C&&(H.C=vs(C(H.Za,H),6e3));if(1>=At(H.h)&&H.ca){try{H.ca()}catch{}H.ca=void 0}}else Xr(H,11)}else if((f.K||H.g==f)&&ha(H),!B(W))for(le=H.Da.g.parse(W),W=0;W<le.length;W++){let en=le[W];if(H.T=en[0],en=en[1],H.G==2)if(en[0]=="c"){H.K=en[1],H.ia=en[2];const hi=en[3];hi!=null&&(H.la=hi,H.j.info("VER="+H.la));const mn=en[4];mn!=null&&(H.Aa=mn,H.j.info("SVER="+H.Aa));const Ai=en[5];Ai!=null&&typeof Ai=="number"&&0<Ai&&(K=1.5*Ai,H.L=K,H.j.info("backChannelRequestTimeoutMs_="+K)),K=H;const tn=f.g;if(tn){const Tr=tn.g?tn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Tr){var pe=K.h;pe.g||Tr.indexOf("spdy")==-1&&Tr.indexOf("quic")==-1&&Tr.indexOf("h2")==-1||(pe.j=pe.l,pe.g=new Set,pe.h&&(Ut(pe,pe.h),pe.h=null))}if(K.D){const Ss=tn.g?tn.g.getResponseHeader("X-HTTP-Session-Id"):null;Ss&&(K.ya=Ss,Zn(K.I,K.D,Ss))}}H.G=3,H.l&&H.l.ua(),H.ba&&(H.R=Date.now()-f.F,H.j.info("Handshake RTT: "+H.R+"ms")),K=H;var Le=f;if(K.qa=yu(K,K.J?K.ia:null,K.W),Le.K){xt(K.h,Le);var sn=Le,Ci=K.L;Ci&&(sn.I=Ci),sn.B&&(vt(sn),st(sn)),K.g=Le}else fu(K);0<H.i.length&&ll(H)}else en[0]!="stop"&&en[0]!="close"||Xr(H,7);else H.G==3&&(en[0]=="stop"||en[0]=="close"?en[0]=="stop"?Xr(H,7):Rg(H):en[0]!="noop"&&H.l&&H.l.ta(en),H.v=0)}}bn(4)}catch{}}var an=class{constructor(f,W){this.g=f,this.map=W}};function ln(f){this.l=f||10,a.PerformanceNavigationTiming?(f=a.performance.getEntriesByType("navigation"),f=0<f.length&&(f[0].nextHopProtocol=="hq"||f[0].nextHopProtocol=="h2")):f=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=f?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Tt(f){return f.h?!0:f.g?f.g.size>=f.j:!1}function At(f){return f.h?1:f.g?f.g.size:0}function at(f,W){return f.h?f.h==W:f.g?f.g.has(W):!1}function Ut(f,W){f.g?f.g.add(W):f.h=W}function xt(f,W){f.h&&f.h==W?f.h=null:f.g&&f.g.has(W)&&f.g.delete(W)}ln.prototype.cancel=function(){if(this.i=On(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const f of this.g.values())f.cancel();this.g.clear()}};function On(f){if(f.h!=null)return f.i.concat(f.h.D);if(f.g!=null&&f.g.size!==0){let W=f.i;for(const H of f.g.values())W=W.concat(H.D);return W}return b(f.i)}function ws(f){if(f.V&&typeof f.V=="function")return f.V();if(typeof Map<"u"&&f instanceof Map||typeof Set<"u"&&f instanceof Set)return Array.from(f.values());if(typeof f=="string")return f.split("");if(l(f)){for(var W=[],H=f.length,K=0;K<H;K++)W.push(f[K]);return W}W=[],H=0;for(K in f)W[H++]=f[K];return W}function pn(f){if(f.na&&typeof f.na=="function")return f.na();if(!f.V||typeof f.V!="function"){if(typeof Map<"u"&&f instanceof Map)return Array.from(f.keys());if(!(typeof Set<"u"&&f instanceof Set)){if(l(f)||typeof f=="string"){var W=[];f=f.length;for(var H=0;H<f;H++)W.push(H);return W}W=[],H=0;for(const K in f)W[H++]=K;return W}}}function rr(f,W){if(f.forEach&&typeof f.forEach=="function")f.forEach(W,void 0);else if(l(f)||typeof f=="string")Array.prototype.forEach.call(f,W,void 0);else for(var H=pn(f),K=ws(f),le=K.length,pe=0;pe<le;pe++)W.call(void 0,K[pe],H&&H[pe],f)}var wn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ao(f,W){if(f){f=f.split("&");for(var H=0;H<f.length;H++){var K=f[H].indexOf("="),le=null;if(0<=K){var pe=f[H].substring(0,K);le=f[H].substring(K+1)}else pe=f[H];W(pe,le?decodeURIComponent(le.replace(/\+/g," ")):"")}}}function $i(f){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,f instanceof $i){this.h=f.h,Ii(this,f.j),this.o=f.o,this.g=f.g,al(this,f.s),this.l=f.l;var W=f.i,H=new vg;H.i=W.i,W.g&&(H.g=new Map(W.g),H.h=W.h),Bg(this,H),this.m=f.m}else f&&(W=String(f).match(wn))?(this.h=!1,Ii(this,W[1]||"",!0),this.o=Hr(W[2]||""),this.g=Hr(W[3]||"",!0),al(this,W[4]),this.l=Hr(W[5]||"",!0),Bg(this,W[6]||"",!0),this.m=Hr(W[7]||"")):(this.h=!1,this.i=new vg(null,this.h))}$i.prototype.toString=function(){var f=[],W=this.j;W&&f.push(ar(W,vA,!0),":");var H=this.g;return(H||W=="file")&&(f.push("//"),(W=this.o)&&f.push(ar(W,vA,!0),"@"),f.push(encodeURIComponent(String(H)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),H=this.s,H!=null&&f.push(":",String(H))),(H=this.l)&&(this.g&&H.charAt(0)!="/"&&f.push("/"),f.push(ar(H,H.charAt(0)=="/"?md:yy,!0))),(H=this.i.toString())&&f.push("?",H),(H=this.m)&&f.push("#",ar(H,Gg)),f.join("")};function Hn(f){return new $i(f)}function Ii(f,W,H){f.j=H?Hr(W,!0):W,f.j&&(f.j=f.j.replace(/:$/,""))}function al(f,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);f.s=W}else f.s=null}function Bg(f,W,H){W instanceof vg?(f.i=W,By(f.i,f.h)):(H||(W=ar(W,fd)),f.i=new vg(W,f.h))}function Zn(f,W,H){f.i.set(W,H)}function ua(f){return Zn(f,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),f}function Hr(f,W){return f?W?decodeURI(f.replace(/%25/g,"%2525")):decodeURIComponent(f):""}function ar(f,W,H){return typeof f=="string"?(f=encodeURI(f).replace(W,du),H&&(f=f.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f):null}function du(f){return f=f.charCodeAt(0),"%"+(f>>4&15).toString(16)+(f&15).toString(16)}var vA=/[#\/\?@]/g,yy=/[#\?:]/g,md=/[#\?]/g,fd=/[#\?@]/g,Gg=/#/g;function vg(f,W){this.h=this.g=null,this.i=f||null,this.j=!!W}function No(f){f.g||(f.g=new Map,f.h=0,f.i&&ao(f.i,function(W,H){f.add(decodeURIComponent(W.replace(/\+/g," ")),H)}))}n=vg.prototype,n.add=function(f,W){No(this),this.i=null,f=Ia(this,f);var H=this.g.get(f);return H||this.g.set(f,H=[]),H.push(W),this.h+=1,this};function nn(f,W){No(f),W=Ia(f,W),f.g.has(W)&&(f.i=null,f.h-=f.g.get(W).length,f.g.delete(W))}function bd(f,W){return No(f),W=Ia(f,W),f.g.has(W)}n.forEach=function(f,W){No(this),this.g.forEach(function(H,K){H.forEach(function(le){f.call(W,le,K,this)},this)},this)},n.na=function(){No(this);const f=Array.from(this.g.values()),W=Array.from(this.g.keys()),H=[];for(let K=0;K<W.length;K++){const le=f[K];for(let pe=0;pe<le.length;pe++)H.push(W[K])}return H},n.V=function(f){No(this);let W=[];if(typeof f=="string")bd(this,f)&&(W=W.concat(this.g.get(Ia(this,f))));else{f=Array.from(this.g.values());for(let H=0;H<f.length;H++)W=W.concat(f[H])}return W},n.set=function(f,W){return No(this),this.i=null,f=Ia(this,f),bd(this,f)&&(this.h-=this.g.get(f).length),this.g.set(f,[W]),this.h+=1,this},n.get=function(f,W){return f?(f=this.V(f),0<f.length?String(f[0]):W):W};function Cu(f,W,H){nn(f,W),0<H.length&&(f.i=null,f.g.set(Ia(f,W),b(H)),f.h+=H.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const f=[],W=Array.from(this.g.keys());for(var H=0;H<W.length;H++){var K=W[H];const pe=encodeURIComponent(String(K)),Le=this.V(K);for(K=0;K<Le.length;K++){var le=pe;Le[K]!==""&&(le+="="+encodeURIComponent(String(Le[K]))),f.push(le)}}return this.i=f.join("&")};function Ia(f,W){return W=String(W),f.j&&(W=W.toLowerCase()),W}function By(f,W){W&&!f.j&&(No(f),f.i=null,f.g.forEach(function(H,K){var le=K.toLowerCase();K!=le&&(nn(this,K),Cu(this,le,H))},f)),f.j=W}function Gy(f,W){const H=new Wo;if(a.Image){const K=new Image;K.onload=h(Fo,H,"TestLoadImage: loaded",!0,W,K),K.onerror=h(Fo,H,"TestLoadImage: error",!1,W,K),K.onabort=h(Fo,H,"TestLoadImage: abort",!1,W,K),K.ontimeout=h(Fo,H,"TestLoadImage: timeout",!1,W,K),a.setTimeout(function(){K.ontimeout&&K.ontimeout()},1e4),K.src=f}else W(!1)}function di(f,W){const H=new Wo,K=new AbortController,le=setTimeout(()=>{K.abort(),Fo(H,"TestPingServer: timeout",!1,W)},1e4);fetch(f,{signal:K.signal}).then(pe=>{clearTimeout(le),pe.ok?Fo(H,"TestPingServer: ok",!0,W):Fo(H,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(le),Fo(H,"TestPingServer: error",!1,W)})}function Fo(f,W,H,K,le){try{le&&(le.onload=null,le.onerror=null,le.onabort=null,le.ontimeout=null),K(H)}catch{}}function vy(){this.g=new xe}function yd(f,W,H){const K=H||"";try{rr(f,function(le,pe){let Le=le;g(le)&&(Le=Nt(le)),W.push(K+pe+"="+encodeURIComponent(Le))})}catch(le){throw W.push(K+"type="+encodeURIComponent("_badmap")),le}}function hu(f){this.l=f.Ub||null,this.j=f.eb||!1}p(hu,Q),hu.prototype.g=function(){return new da(this.l,this.j)},hu.prototype.i=function(f){return function(){return f}}({});function da(f,W){Je.call(this),this.D=f,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}p(da,Je),n=da.prototype,n.open=function(f,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=f,this.A=W,this.readyState=1,Zg(this)},n.send=function(f){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};f&&(W.body=f),(this.D||a).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,wg(this)),this.readyState=0},n.Sa=function(f){if(this.g&&(this.l=f,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=f.headers,this.readyState=2,Zg(this)),this.g&&(this.readyState=3,Zg(this),this.g)))if(this.responseType==="arraybuffer")f.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in f){if(this.j=f.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;lo(this)}else f.text().then(this.Ra.bind(this),this.ga.bind(this))};function lo(f){f.j.read().then(f.Pa.bind(f)).catch(f.ga.bind(f))}n.Pa=function(f){if(this.g){if(this.o&&f.value)this.response.push(f.value);else if(!this.o){var W=f.value?f.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!f.done}))&&(this.response=this.responseText+=W)}f.done?wg(this):Zg(this),this.readyState==3&&lo(this)}},n.Ra=function(f){this.g&&(this.response=this.responseText=f,wg(this))},n.Qa=function(f){this.g&&(this.response=f,wg(this))},n.ga=function(){this.g&&wg(this)};function wg(f){f.readyState=4,f.l=null,f.j=null,f.v=null,Zg(f)}n.setRequestHeader=function(f,W){this.u.append(f,W)},n.getResponseHeader=function(f){return this.h&&this.h.get(f.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const f=[],W=this.h.entries();for(var H=W.next();!H.done;)H=H.value,f.push(H[0]+": "+H[1]),H=W.next();return f.join(`\r
`)};function Zg(f){f.onreadystatechange&&f.onreadystatechange.call(f)}Object.defineProperty(da.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(f){this.m=f?"include":"same-origin"}});function go(f){let W="";return M(f,function(H,K){W+=K,W+=":",W+=H,W+=`\r
`}),W}function co(f,W,H){e:{for(K in H){var K=!1;break e}K=!0}K||(H=go(H),typeof f=="string"?H!=null&&encodeURIComponent(String(H)):Zn(f,W,H))}function Sn(f){Je.call(this),this.headers=new Map,this.o=f||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}p(Sn,Je);var Bd=/^https?$/i,wA=["POST","PUT"];n=Sn.prototype,n.Ha=function(f){this.J=f},n.ea=function(f,W,H,K){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+f);W=W?W.toUpperCase():"GET",this.D=f,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yg.g(),this.v=this.o?Me(this.o):Me(yg),this.g.onreadystatechange=C(this.Ea,this);try{this.B=!0,this.g.open(W,String(f),!0),this.B=!1}catch(pe){ZA(this,pe);return}if(f=H||"",H=new Map(this.headers),K)if(Object.getPrototypeOf(K)===Object.prototype)for(var le in K)H.set(le,K[le]);else if(typeof K.keys=="function"&&typeof K.get=="function")for(const pe of K.keys())H.set(pe,K.get(pe));else throw Error("Unknown input type for opt_headers: "+String(K));K=Array.from(H.keys()).find(pe=>pe.toLowerCase()=="content-type"),le=a.FormData&&f instanceof a.FormData,!(0<=Array.prototype.indexOf.call(wA,W,void 0))||K||le||H.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[pe,Le]of H)this.g.setRequestHeader(pe,Le);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{RA(this),this.u=!0,this.g.send(f),this.u=!1}catch(pe){ZA(this,pe)}};function ZA(f,W){f.h=!1,f.g&&(f.j=!0,f.g.abort(),f.j=!1),f.l=W,f.m=5,uo(f),Ca(f)}function uo(f){f.A||(f.A=!0,We(f,"complete"),We(f,"error"))}n.abort=function(f){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=f||7,We(this,"complete"),We(this,"abort"),Ca(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ca(this,!0)),Sn.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?SA(this):this.bb())},n.bb=function(){SA(this)};function SA(f){if(f.h&&typeof r<"u"&&(!f.v[1]||ai(f)!=4||f.Z()!=2)){if(f.u&&ai(f)==4)Kt(f.Ea,0,f);else if(We(f,"readystatechange"),ai(f)==4){f.h=!1;try{const Le=f.Z();e:switch(Le){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var H;if(!(H=W)){var K;if(K=Le===0){var le=String(f.D).match(wn)[1]||null;!le&&a.self&&a.self.location&&(le=a.self.location.protocol.slice(0,-1)),K=!Bd.test(le?le.toLowerCase():"")}H=K}if(H)We(f,"complete"),We(f,"success");else{f.m=6;try{var pe=2<ai(f)?f.g.statusText:""}catch{pe=""}f.l=pe+" ["+f.Z()+"]",uo(f)}}finally{Ca(f)}}}}function Ca(f,W){if(f.g){RA(f);const H=f.g,K=f.v[0]?()=>{}:null;f.g=null,f.v=null,W||We(f,"ready");try{H.onreadystatechange=K}catch{}}}function RA(f){f.I&&(a.clearTimeout(f.I),f.I=null)}n.isActive=function(){return!!this.g};function ai(f){return f.g?f.g.readyState:0}n.Z=function(){try{return 2<ai(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(f){if(this.g){var W=this.g.responseText;return f&&W.indexOf(f)==0&&(W=W.substring(f.length)),q(W)}};function Sg(f){try{if(!f.g)return null;if("response"in f.g)return f.g.response;switch(f.H){case"":case"text":return f.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in f.g)return f.g.mozResponseArrayBuffer}return null}catch{return null}}function Au(f){const W={};f=(f.g&&2<=ai(f)&&f.g.getAllResponseHeaders()||"").split(`\r
`);for(let K=0;K<f.length;K++){if(B(f[K]))continue;var H=x(f[K]);const le=H[0];if(H=H[1],typeof H!="string")continue;H=H.trim();const pe=W[le]||[];W[le]=pe,pe.push(H)}R(W,function(K){return K.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ho(f,W,H){return H&&H.internalChannelParams&&H.internalChannelParams[f]||W}function pu(f){this.Aa=0,this.i=[],this.j=new Wo,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ho("failFast",!1,f),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ho("baseRetryDelayMs",5e3,f),this.cb=Ho("retryDelaySeedMs",1e4,f),this.Wa=Ho("forwardChannelMaxRetries",2,f),this.wa=Ho("forwardChannelRequestTimeoutMs",2e4,f),this.pa=f&&f.xmlHttpFactory||void 0,this.Xa=f&&f.Tb||void 0,this.Ca=f&&f.useFetchStreams||!1,this.L=void 0,this.J=f&&f.supportsCrossDomainXhr||!1,this.K="",this.h=new ln(f&&f.concurrentRequestLimit),this.Da=new vy,this.P=f&&f.fastHandshake||!1,this.O=f&&f.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=f&&f.Rb||!1,f&&f.xa&&this.j.xa(),f&&f.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&f&&f.detectBufferingProxy||!1,this.ja=void 0,f&&f.longPollingTimeout&&0<f.longPollingTimeout&&(this.ja=f.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=pu.prototype,n.la=8,n.G=1,n.connect=function(f,W,H,K){Fn(0),this.W=f,this.H=W||{},H&&K!==void 0&&(this.H.OSID=H,this.H.OAID=K),this.F=this.X,this.I=yu(this,null,this.W),ll(this)};function Rg(f){if(mu(f),f.G==3){var W=f.U++,H=Hn(f.I);if(Zn(H,"SID",f.K),Zn(H,"RID",W),Zn(H,"TYPE","terminate"),es(f,H),W=new Mo(f,f.j,W),W.L=2,W.v=ua(Hn(H)),H=!1,a.navigator&&a.navigator.sendBeacon)try{H=a.navigator.sendBeacon(W.v.toString(),"")}catch{}!H&&a.Image&&(new Image().src=W.v,H=!0),H||(W.g=Wg(W.j,null),W.g.ea(W.v)),W.F=Date.now(),st(W)}vd(f)}function xg(f){f.g&&(Io(f),f.g.cancel(),f.g=null)}function mu(f){xg(f),f.u&&(a.clearTimeout(f.u),f.u=null),ha(f),f.h.cancel(),f.s&&(typeof f.s=="number"&&a.clearTimeout(f.s),f.s=null)}function ll(f){if(!Tt(f.h)&&!f.s){f.s=!0;var W=f.Ga;Ie||$(),k||(Ie(),k=!0),ee.add(W,f),f.B=0}}function gl(f,W){return At(f.h)>=f.h.j-(f.s?1:0)?!1:f.s?(f.i=W.D.concat(f.i),!0):f.G==1||f.G==2||f.B>=(f.Va?0:f.Wa)?!1:(f.s=vs(C(f.Ga,f,W),Vg(f,f.B)),f.B++,!0)}n.Ga=function(f){if(this.s)if(this.s=null,this.G==1){if(!f){this.U=Math.floor(1e5*Math.random()),f=this.U++;const le=new Mo(this,this.j,f);let pe=this.o;if(this.S&&(pe?(pe=S(pe),Z(pe,this.S)):pe=this.S),this.m!==null||this.O||(le.H=pe,pe=null),this.P)e:{for(var W=0,H=0;H<this.i.length;H++){t:{var K=this.i[H];if("__data__"in K.map&&(K=K.map.__data__,typeof K=="string")){K=K.length;break t}K=void 0}if(K===void 0)break;if(W+=K,4096<W){W=H;break e}if(W===4096||H===this.i.length-1){W=H+1;break e}}W=1e3}else W=1e3;W=lr(this,le,W),H=Hn(this.I),Zn(H,"RID",f),Zn(H,"CVER",22),this.D&&Zn(H,"X-HTTP-Session-Id",this.D),es(this,H),pe&&(this.O?W="headers="+encodeURIComponent(String(go(pe)))+"&"+W:this.m&&co(H,this.m,pe)),Ut(this.h,le),this.Ua&&Zn(H,"TYPE","init"),this.P?(Zn(H,"$req",W),Zn(H,"SID","null"),le.T=!0,Ae(le,H,null)):Ae(le,H,W),this.G=2}}else this.G==3&&(f?Zs(this,f):this.i.length==0||Tt(this.h)||Zs(this))};function Zs(f,W){var H;W?H=W.l:H=f.U++;const K=Hn(f.I);Zn(K,"SID",f.K),Zn(K,"RID",H),Zn(K,"AID",f.T),es(f,K),f.m&&f.o&&co(K,f.m,f.o),H=new Mo(f,f.j,H,f.B+1),f.m===null&&(H.H=f.o),W&&(f.i=W.D.concat(f.i)),W=lr(f,H,1e3),H.I=Math.round(.5*f.wa)+Math.round(.5*f.wa*Math.random()),Ut(f.h,H),Ae(H,K,W)}function es(f,W){f.H&&M(f.H,function(H,K){Zn(W,K,H)}),f.l&&rr({},function(H,K){Zn(W,K,H)})}function lr(f,W,H){H=Math.min(f.i.length,H);var K=f.l?C(f.l.Na,f.l,f):null;e:{var le=f.i;let pe=-1;for(;;){const Le=["count="+H];pe==-1?0<H?(pe=le[0].g,Le.push("ofs="+pe)):pe=0:Le.push("ofs="+pe);let sn=!0;for(let Ci=0;Ci<H;Ci++){let en=le[Ci].g;const hi=le[Ci].map;if(en-=pe,0>en)pe=Math.max(0,le[Ci].g-100),sn=!1;else try{yd(hi,Le,"req"+en+"_")}catch{K&&K(hi)}}if(sn){K=Le.join("&");break e}}}return f=f.i.splice(0,H),W.D=f,K}function fu(f){if(!f.g&&!f.u){f.Y=1;var W=f.Fa;Ie||$(),k||(Ie(),k=!0),ee.add(W,f),f.v=0}}function bu(f){return f.g||f.u||3<=f.v?!1:(f.Y++,f.u=vs(C(f.Fa,f),Vg(f,f.v)),f.v++,!0)}n.Fa=function(){if(this.u=null,gr(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var f=2*this.R;this.j.info("BP detection timer enabled: "+f),this.A=vs(C(this.ab,this),f)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Fn(10),xg(this),gr(this))};function Io(f){f.A!=null&&(a.clearTimeout(f.A),f.A=null)}function gr(f){f.g=new Mo(f,f.j,"rpc",f.Y),f.m===null&&(f.g.H=f.o),f.g.O=0;var W=Hn(f.qa);Zn(W,"RID","rpc"),Zn(W,"SID",f.K),Zn(W,"AID",f.T),Zn(W,"CI",f.F?"0":"1"),!f.F&&f.ja&&Zn(W,"TO",f.ja),Zn(W,"TYPE","xmlhttp"),es(f,W),f.m&&f.o&&co(W,f.m,f.o),f.L&&(f.g.I=f.L);var H=f.g;f=f.ia,H.L=1,H.v=ua(Hn(W)),H.m=null,H.P=!0,re(H,f)}n.Za=function(){this.C!=null&&(this.C=null,xg(this),bu(this),Fn(19))};function ha(f){f.C!=null&&(a.clearTimeout(f.C),f.C=null)}function Gd(f,W){var H=null;if(f.g==W){ha(f),Io(f),f.g=null;var K=2}else if(at(f.h,W))H=W.D,xt(f.h,W),K=1;else return;if(f.G!=0){if(W.o)if(K==1){H=W.m?W.m.length:0,W=Date.now()-W.F;var le=f.B;K=An(),We(K,new fg(K,H)),ll(f)}else fu(f);else if(le=W.s,le==3||le==0&&0<W.X||!(K==1&&gl(f,W)||K==2&&bu(f)))switch(H&&0<H.length&&(W=f.h,W.i=W.i.concat(H)),le){case 1:Xr(f,5);break;case 4:Xr(f,10);break;case 3:Xr(f,6);break;default:Xr(f,2)}}}function Vg(f,W){let H=f.Ta+Math.floor(Math.random()*f.cb);return f.isActive()||(H*=2),H*W}function Xr(f,W){if(f.j.info("Error code "+W),W==2){var H=C(f.fb,f),K=f.Xa;const le=!K;K=new $i(K||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Ii(K,"https"),ua(K),le?Gy(K.toString(),H):di(K.toString(),H)}else Fn(2);f.G=0,f.l&&f.l.sa(W),vd(f),mu(f)}n.fb=function(f){f?(this.j.info("Successfully pinged google.com"),Fn(2)):(this.j.info("Failed to ping google.com"),Fn(1))};function vd(f){if(f.G=0,f.ka=[],f.l){const W=On(f.h);(W.length!=0||f.i.length!=0)&&(m(f.ka,W),m(f.ka,f.i),f.h.i.length=0,b(f.i),f.i.length=0),f.l.ra()}}function yu(f,W,H){var K=H instanceof $i?Hn(H):new $i(H);if(K.g!="")W&&(K.g=W+"."+K.g),al(K,K.s);else{var le=a.location;K=le.protocol,W=W?W+"."+le.hostname:le.hostname,le=+le.port;var pe=new $i(null);K&&Ii(pe,K),W&&(pe.g=W),le&&al(pe,le),H&&(pe.l=H),K=pe}return H=f.D,W=f.ya,H&&W&&Zn(K,H,W),Zn(K,"VER",f.la),es(f,K),K}function Wg(f,W,H){if(W&&!f.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=f.Ca&&!f.pa?new Sn(new hu({eb:H})):new Sn(f.pa),W.Ha(f.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wd(){}n=wd.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Mg(){}Mg.prototype.g=function(f,W){return new ts(f,W)};function ts(f,W){Je.call(this),this.g=new pu(W),this.l=f,this.h=W&&W.messageUrlParams||null,f=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(f?f["X-Client-Protocol"]="webchannel":f={"X-Client-Protocol":"webchannel"}),this.g.o=f,f=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(f?f["X-WebChannel-Content-Type"]=W.messageContentType:f={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(f?f["X-WebChannel-Client-Profile"]=W.va:f={"X-WebChannel-Client-Profile":W.va}),this.g.S=f,(f=W&&W.Sb)&&!B(f)&&(this.g.m=f),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!B(W)&&(this.g.D=W,f=this.h,f!==null&&W in f&&(f=this.h,W in f&&delete f[W])),this.j=new Co(this)}p(ts,Je),ts.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ts.prototype.close=function(){Rg(this.g)},ts.prototype.o=function(f){var W=this.g;if(typeof f=="string"){var H={};H.__data__=f,f=H}else this.u&&(H={},H.__data__=Nt(f),f=H);W.i.push(new an(W.Ya++,f)),W.G==3&&ll(W)},ts.prototype.N=function(){this.g.l=null,delete this.j,Rg(this.g),delete this.g,ts.aa.N.call(this)};function Bu(f){De.call(this),f.__headers__&&(this.headers=f.__headers__,this.statusCode=f.__status__,delete f.__headers__,delete f.__status__);var W=f.__sm__;if(W){e:{for(const H in W){f=H;break e}f=void 0}(this.i=f)&&(f=this.i,W=W!==null&&f in W?W[f]:void 0),this.data=W}else this.data=f}p(Bu,De);function Aa(){qe.call(this),this.status=1}p(Aa,qe);function Co(f){this.g=f}p(Co,wd),Co.prototype.ua=function(){We(this.g,"a")},Co.prototype.ta=function(f){We(this.g,new Bu(f))},Co.prototype.sa=function(f){We(this.g,new Aa)},Co.prototype.ra=function(){We(this.g,"b")},Mg.prototype.createWebChannel=Mg.prototype.g,ts.prototype.send=ts.prototype.o,ts.prototype.open=ts.prototype.m,ts.prototype.close=ts.prototype.close,w3=function(){return new Mg},v3=function(){return An()},G3=Wt,cw={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ca.NO_ERROR=0,ca.TIMEOUT=8,ca.HTTP_ERROR=6,af=ca,bg.COMPLETE="complete",B3=bg,Ce.EventType=Re,Re.OPEN="a",Re.CLOSE="b",Re.ERROR="c",Re.MESSAGE="d",Je.prototype.listen=Je.prototype.K,WC=Ce,Sn.prototype.listenOnce=Sn.prototype.L,Sn.prototype.getLastError=Sn.prototype.Ka,Sn.prototype.getLastErrorCode=Sn.prototype.Ba,Sn.prototype.getStatus=Sn.prototype.Z,Sn.prototype.getResponseJson=Sn.prototype.Oa,Sn.prototype.getResponseText=Sn.prototype.oa,Sn.prototype.send=Sn.prototype.ea,Sn.prototype.setWithCredentials=Sn.prototype.Ha,y3=Sn}).apply(typeof Fm<"u"?Fm:typeof self<"u"?self:typeof window<"u"?window:{});const mF="@firebase/firestore",fF="4.7.16";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}As.UNAUTHENTICATED=new As(null),As.GOOGLE_CREDENTIALS=new As("google-credentials-uid"),As.FIRST_PARTY=new As("first-party-uid"),As.MOCK_USER=new As("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ad="11.8.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qc=new h3("@firebase/firestore");function $u(){return Qc.logLevel}function ht(n,...e){if(Qc.logLevel<=un.DEBUG){const t=e.map(eR);Qc.debug(`Firestore (${Ad}): ${n}`,...t)}}function jc(n,...e){if(Qc.logLevel<=un.ERROR){const t=e.map(eR);Qc.error(`Firestore (${Ad}): ${n}`,...t)}}function Iy(n,...e){if(Qc.logLevel<=un.WARN){const t=e.map(eR);Qc.warn(`Firestore (${Ad}): ${n}`,...t)}}function eR(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jt(n,e,t){let i="Unexpected state";typeof e=="string"?i=e:t=e,Z3(n,i,t)}function Z3(n,e,t){let i=`FIRESTORE (${Ad}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{i+=" CONTEXT: "+JSON.stringify(t)}catch{i+=" CONTEXT: "+t}throw jc(i),new Error(i)}function si(n,e,t,i){let s="Unexpected state";typeof t=="string"?s=t:i=t,n||Z3(e,s,i)}function Nn(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ke={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Vt extends hd{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class are{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(As.UNAUTHENTICATED))}shutdown(){}}class lre{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class gre{constructor(e){this.t=e,this.currentUser=As.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){si(this.o===void 0,42304);let i=this.i;const s=l=>this.i!==i?(i=this.i,t(l)):Promise.resolve();let o=new Fc;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new Fc,e.enqueueRetryable(()=>s(this.currentUser))};const r=()=>{const l=o;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{ht("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(ht("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new Fc)}},0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(ht("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(si(typeof i.accessToken=="string",31837,{l:i}),new S3(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return si(e===null||typeof e=="string",2055,{h:e}),new As(e)}}class cre{constructor(e,t,i){this.P=e,this.T=t,this.I=i,this.type="FirstParty",this.user=As.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ure{constructor(e,t,i){this.P=e,this.T=t,this.I=i}getToken(){return Promise.resolve(new cre(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(As.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class bF{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ire{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,zoe(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){si(this.o===void 0,3512);const i=o=>{o.error!=null&&ht("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const r=o.token!==this.m;return this.m=o.token,ht("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(o.token):Promise.resolve()};this.o=o=>{e.enqueueRetryable(()=>i(o))};const s=o=>{ht("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(o=>s(o)),setTimeout(()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):ht("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new bF(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(si(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new bF(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dre(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cre(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R3{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=dre(40);for(let o=0;o<s.length;++o)i.length<20&&s[o]<t&&(i+=e.charAt(s[o]%62))}return i}}function In(n,e){return n<e?-1:n>e?1:0}function uw(n,e){let t=0;for(;t<n.length&&t<e.length;){const i=n.codePointAt(t),s=e.codePointAt(t);if(i!==s){if(i<128&&s<128)return In(i,s);{const o=Cre(),r=hre(o.encode(yF(n,t)),o.encode(yF(e,t)));return r!==0?r:In(i,s)}}t+=i>65535?2:1}return In(n.length,e.length)}function yF(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function hre(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return In(n[t],e[t]);return In(n.length,e.length)}function OI(n,e,t){return n.length===e.length&&n.every((i,s)=>t(i,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BF=-62135596800,GF=1e6;class Zi{static now(){return Zi.fromMillis(Date.now())}static fromDate(e){return Zi.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor((e-1e3*t)*GF);return new Zi(t,i)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Vt(Ke.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Vt(Ke.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<BF)throw new Vt(Ke.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Vt(Ke.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/GF}_compareTo(e){return this.seconds===e.seconds?In(this.nanoseconds,e.nanoseconds):In(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-BF;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yn{static fromTimestamp(e){return new Yn(e)}static min(){return new Yn(new Zi(0,0))}static max(){return new Yn(new Zi(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vF="__name__";class Ur{constructor(e,t,i){t===void 0?t=0:t>e.length&&Jt(637,{offset:t,range:e.length}),i===void 0?i=e.length-t:i>e.length-t&&Jt(1746,{length:i,range:e.length-t}),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Ur.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ur?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const o=Ur.compareSegments(e.get(s),t.get(s));if(o!==0)return o}return In(e.length,t.length)}static compareSegments(e,t){const i=Ur.isNumericId(e),s=Ur.isNumericId(t);return i&&!s?-1:!i&&s?1:i&&s?Ur.extractNumericId(e).compare(Ur.extractNumericId(t)):uw(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return $S.fromString(e.substring(4,e.length-2))}}class ni extends Ur{construct(e,t,i){return new ni(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new Vt(Ke.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(s=>s.length>0))}return new ni(t)}static emptyPath(){return new ni([])}}const Are=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pi extends Ur{construct(e,t,i){return new Pi(e,t,i)}static isValidIdentifier(e){return Are.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pi.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===vF}static keyField(){return new Pi([vF])}static fromServerFormat(e){const t=[];let i="",s=0;const o=()=>{if(i.length===0)throw new Vt(Ke.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let r=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new Vt(Ke.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new Vt(Ke.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=l,s+=2}else a==="`"?(r=!r,s++):a!=="."||r?(i+=a,s++):(o(),s++)}if(o(),r)throw new Vt(Ke.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Pi(t)}static emptyPath(){return new Pi([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e){this.path=e}static fromPath(e){return new zt(ni.fromString(e))}static fromName(e){return new zt(ni.fromString(e).popFirst(5))}static empty(){return new zt(ni.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ni.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ni.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new zt(new ni(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dh=-1;function pre(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=Yn.fromTimestamp(i===1e9?new Zi(t+1,0):new Zi(t,i));return new rg(s,zt.empty(),e)}function mre(n){return new rg(n.readTime,n.key,Dh)}class rg{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new rg(Yn.min(),zt.empty(),Dh)}static max(){return new rg(Yn.max(),zt.empty(),Dh)}}function fre(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=zt.comparator(n.documentKey,e.documentKey),t!==0?t:In(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bre="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class yre{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR(n){if(n.code!==Ke.FAILED_PRECONDITION||n.message!==bre)throw n;ht("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ve{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Jt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ve((i,s)=>{this.nextCallback=o=>{this.wrapSuccess(e,o).next(i,s)},this.catchCallback=o=>{this.wrapFailure(t,o).next(i,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Ve?t:Ve.resolve(t)}catch(t){return Ve.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Ve.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Ve.reject(t)}static resolve(e){return new Ve((t,i)=>{t(e)})}static reject(e){return new Ve((t,i)=>{i(e)})}static waitFor(e){return new Ve((t,i)=>{let s=0,o=0,r=!1;e.forEach(a=>{++s,a.next(()=>{++o,r&&o===s&&t()},l=>i(l))}),r=!0,o===s&&t()})}static or(e){let t=Ve.resolve(!1);for(const i of e)t=t.next(s=>s?Ve.resolve(s):i());return t}static forEach(e,t){const i=[];return e.forEach((s,o)=>{i.push(t.call(this,s,o))}),this.waitFor(i)}static mapArray(e,t){return new Ve((i,s)=>{const o=e.length,r=new Array(o);let a=0;for(let l=0;l<o;l++){const g=l;t(e[g]).next(c=>{r[g]=c,++a,a===o&&i(r)},c=>s(c))}})}static doWhile(e,t){return new Ve((i,s)=>{const o=()=>{e()===!0?t().next(()=>{o()},s):i()};o()})}}function Bre(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function fA(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ue(i),this.ce=i=>t.writeSequenceNumber(i))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}nR.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iR=-1;function sR(n){return n==null}function X0(n){return n===0&&1/n==-1/0}function Gre(n){return typeof n=="number"&&Number.isInteger(n)&&!X0(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3="";function vre(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=wF(e)),e=wre(n.get(t),e);return wF(e)}function wre(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const o=n.charAt(s);switch(o){case"\0":t+="";break;case x3:t+="";break;default:t+=o}}return t}function wF(n){return n+x3+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function pd(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function V3(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e,t){this.comparator=e,this.root=t||ki.EMPTY}insert(e,t){return new ro(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ki.BLACK,null,null))}remove(e){return new ro(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ki.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Hm(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Hm(this.root,e,this.comparator,!1)}getReverseIterator(){return new Hm(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Hm(this.root,e,this.comparator,!0)}}class Hm{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,t&&s&&(o*=-1),o<0)e=this.isReverse?e.left:e.right;else{if(o===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ki{constructor(e,t,i,s,o){this.key=e,this.value=t,this.color=i??ki.RED,this.left=s??ki.EMPTY,this.right=o??ki.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,o){return new ki(e??this.key,t??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const o=i(e,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(e,t,i),null):o===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ki.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return ki.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ki.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ki.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Jt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Jt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Jt(27949);return e+(this.isRed()?0:1)}}ki.EMPTY=null,ki.RED=!0,ki.BLACK=!1;ki.EMPTY=new class{constructor(){this.size=0}get key(){throw Jt(57766)}get value(){throw Jt(16141)}get color(){throw Jt(16727)}get left(){throw Jt(29726)}get right(){throw Jt(36894)}copy(e,t,i,s,o){return this}insert(e,t,i){return new ki(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e){this.comparator=e,this.data=new ro(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new SF(this.data.getIterator())}getIteratorFrom(e){return new SF(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Oi)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,o=i.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Oi(this.comparator);return t.data=e,t}}class SF{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gr{constructor(e){this.fields=e,e.sort(Pi.comparator)}static empty(){return new Gr([])}unionWith(e){let t=new Oi(Pi.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new Gr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return OI(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zre extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aa{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Zre("Invalid base64 string: "+o):o}}(e);return new aa(t)}static fromUint8Array(e){const t=function(s){let o="";for(let r=0;r<s.length;++r)o+=String.fromCharCode(s[r]);return o}(e);return new aa(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return In(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}aa.EMPTY_BYTE_STRING=new aa("");const Sre=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qc(n){if(si(!!n,39018),typeof n=="string"){let e=0;const t=Sre.exec(n);if(si(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:zi(n.seconds),nanos:zi(n.nanos)}}function zi(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function QI(n){return typeof n=="string"?aa.fromBase64String(n):aa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W3="server_timestamp",M3="__type__",N3="__previous_value__",F3="__local_write_time__";function oR(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[M3])===null||t===void 0?void 0:t.stringValue)===W3}function rR(n){const e=n.mapValue.fields[N3];return oR(e)?rR(e):e}function T0(n){const e=qc(n.mapValue.fields[F3].timestampValue);return new Zi(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rre{constructor(e,t,i,s,o,r,a,l,g,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=o,this.forceLongPolling=r,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=g,this.isUsingEmulator=c}}const E0="(default)";class Y0{constructor(e,t){this.projectId=e,this.database=t||E0}static empty(){return new Y0("","")}get isDefaultDatabase(){return this.database===E0}isEqual(e){return e instanceof Y0&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H3="__type__",X3="__max__",Xm={mapValue:{fields:{__type__:{stringValue:X3}}}},T3="__vector__",Iw="value";function $c(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?oR(n)?4:Vre(n)?9007199254740991:xre(n)?10:11:Jt(28295,{value:n})}function la(n,e){if(n===e)return!0;const t=$c(n);if(t!==$c(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return T0(n).isEqual(T0(e));case 3:return function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const r=qc(s.timestampValue),a=qc(o.timestampValue);return r.seconds===a.seconds&&r.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(s,o){return QI(s.bytesValue).isEqual(QI(o.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(s,o){return zi(s.geoPointValue.latitude)===zi(o.geoPointValue.latitude)&&zi(s.geoPointValue.longitude)===zi(o.geoPointValue.longitude)}(n,e);case 2:return function(s,o){if("integerValue"in s&&"integerValue"in o)return zi(s.integerValue)===zi(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const r=zi(s.doubleValue),a=zi(o.doubleValue);return r===a?X0(r)===X0(a):isNaN(r)&&isNaN(a)}return!1}(n,e);case 9:return OI(n.arrayValue.values||[],e.arrayValue.values||[],la);case 10:case 11:return function(s,o){const r=s.mapValue.fields||{},a=o.mapValue.fields||{};if(ZF(r)!==ZF(a))return!1;for(const l in r)if(r.hasOwnProperty(l)&&(a[l]===void 0||!la(r[l],a[l])))return!1;return!0}(n,e);default:return Jt(52216,{left:n})}}function Ph(n,e){return(n.values||[]).find(t=>la(t,e))!==void 0}function jI(n,e){if(n===e)return 0;const t=$c(n),i=$c(e);if(t!==i)return In(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return In(n.booleanValue,e.booleanValue);case 2:return function(o,r){const a=zi(o.integerValue||o.doubleValue),l=zi(r.integerValue||r.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(n,e);case 3:return RF(n.timestampValue,e.timestampValue);case 4:return RF(T0(n),T0(e));case 5:return uw(n.stringValue,e.stringValue);case 6:return function(o,r){const a=QI(o),l=QI(r);return a.compareTo(l)}(n.bytesValue,e.bytesValue);case 7:return function(o,r){const a=o.split("/"),l=r.split("/");for(let g=0;g<a.length&&g<l.length;g++){const c=In(a[g],l[g]);if(c!==0)return c}return In(a.length,l.length)}(n.referenceValue,e.referenceValue);case 8:return function(o,r){const a=In(zi(o.latitude),zi(r.latitude));return a!==0?a:In(zi(o.longitude),zi(r.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return xF(n.arrayValue,e.arrayValue);case 10:return function(o,r){var a,l,g,c;const u=o.fields||{},C=r.fields||{},h=(a=u[Iw])===null||a===void 0?void 0:a.arrayValue,p=(l=C[Iw])===null||l===void 0?void 0:l.arrayValue,b=In(((g=h==null?void 0:h.values)===null||g===void 0?void 0:g.length)||0,((c=p==null?void 0:p.values)===null||c===void 0?void 0:c.length)||0);return b!==0?b:xF(h,p)}(n.mapValue,e.mapValue);case 11:return function(o,r){if(o===Xm.mapValue&&r===Xm.mapValue)return 0;if(o===Xm.mapValue)return 1;if(r===Xm.mapValue)return-1;const a=o.fields||{},l=Object.keys(a),g=r.fields||{},c=Object.keys(g);l.sort(),c.sort();for(let u=0;u<l.length&&u<c.length;++u){const C=uw(l[u],c[u]);if(C!==0)return C;const h=jI(a[l[u]],g[c[u]]);if(h!==0)return h}return In(l.length,c.length)}(n.mapValue,e.mapValue);default:throw Jt(23264,{Pe:t})}}function RF(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return In(n,e);const t=qc(n),i=qc(e),s=In(t.seconds,i.seconds);return s!==0?s:In(t.nanos,i.nanos)}function xF(n,e){const t=n.values||[],i=e.values||[];for(let s=0;s<t.length&&s<i.length;++s){const o=jI(t[s],i[s]);if(o)return o}return In(t.length,i.length)}function qI(n){return dw(n)}function dw(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const i=qc(t);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return QI(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return zt.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let i="[",s=!0;for(const o of t.values||[])s?s=!1:i+=",",i+=dw(o);return i+"]"}(n.arrayValue):"mapValue"in n?function(t){const i=Object.keys(t.fields||{}).sort();let s="{",o=!0;for(const r of i)o?o=!1:s+=",",s+=`${r}:${dw(t.fields[r])}`;return s+"}"}(n.mapValue):Jt(61005,{value:n})}function lf(n){switch($c(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=rR(n);return e?16+lf(e):16;case 5:return 2*n.stringValue.length;case 6:return QI(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(i){return(i.values||[]).reduce((s,o)=>s+lf(o),0)}(n.arrayValue);case 10:case 11:return function(i){let s=0;return pd(i.fields,(o,r)=>{s+=o.length+lf(r)}),s}(n.mapValue);default:throw Jt(13486,{value:n})}}function Cw(n){return!!n&&"integerValue"in n}function aR(n){return!!n&&"arrayValue"in n}function gf(n){return!!n&&"mapValue"in n}function xre(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[H3])===null||t===void 0?void 0:t.stringValue)===T3}function eh(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return pd(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=eh(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=eh(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Vre(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===X3}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Br{constructor(e){this.value=e}static empty(){return new Br({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!gf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=eh(t)}setAll(e){let t=Pi.emptyPath(),i={},s=[];e.forEach((r,a)=>{if(!t.isImmediateParentOf(a)){const l=this.getFieldsMap(t);this.applyChanges(l,i,s),i={},s=[],t=a.popLast()}r?i[a.lastSegment()]=eh(r):s.push(a.lastSegment())});const o=this.getFieldsMap(t);this.applyChanges(o,i,s)}delete(e){const t=this.field(e.popLast());gf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return la(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];gf(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){pd(t,(s,o)=>e[s]=o);for(const s of i)delete e[s]}clone(){return new Br(eh(this.value))}}function E3(n){const e=[];return pd(n.fields,(t,i)=>{const s=new Pi([t]);if(gf(i)){const o=E3(i.mapValue).fields;if(o.length===0)e.push(s);else for(const r of o)e.push(s.child(r))}else e.push(s)}),new Gr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr{constructor(e,t,i,s,o,r,a){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=o,this.data=r,this.documentState=a}static newInvalidDocument(e){return new yr(e,0,Yn.min(),Yn.min(),Yn.min(),Br.empty(),0)}static newFoundDocument(e,t,i,s){return new yr(e,1,t,Yn.min(),i,s,0)}static newNoDocument(e,t){return new yr(e,2,t,Yn.min(),Yn.min(),Br.empty(),0)}static newUnknownDocument(e,t){return new yr(e,3,t,Yn.min(),Yn.min(),Br.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Yn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Br.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Br.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Yn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof yr&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new yr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K0{constructor(e,t){this.position=e,this.inclusive=t}}function VF(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const o=e[s],r=n.position[s];if(o.field.isKeyField()?i=zt.comparator(zt.fromName(r.referenceValue),t.key):i=jI(r,t.data.field(o.field)),o.dir==="desc"&&(i*=-1),i!==0)break}return i}function WF(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!la(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(e,t="asc"){this.field=e,this.dir=t}}function Wre(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y3{}class Fi extends Y3{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new Nre(e,t,i):t==="array-contains"?new Xre(e,i):t==="in"?new Tre(e,i):t==="not-in"?new Ere(e,i):t==="array-contains-any"?new Yre(e,i):new Fi(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Fre(e,i):new Hre(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(jI(t,this.value)):t!==null&&$c(this.value)===$c(t)&&this.matchesComparison(jI(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Jt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ag extends Y3{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new ag(e,t)}matches(e){return K3(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function K3(n){return n.op==="and"}function _3(n){return Mre(n)&&K3(n)}function Mre(n){for(const e of n.filters)if(e instanceof ag)return!1;return!0}function hw(n){if(n instanceof Fi)return n.field.canonicalString()+n.op.toString()+qI(n.value);if(_3(n))return n.filters.map(e=>hw(e)).join(",");{const e=n.filters.map(t=>hw(t)).join(",");return`${n.op}(${e})`}}function L3(n,e){return n instanceof Fi?function(i,s){return s instanceof Fi&&i.op===s.op&&i.field.isEqual(s.field)&&la(i.value,s.value)}(n,e):n instanceof ag?function(i,s){return s instanceof ag&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce((o,r,a)=>o&&L3(r,s.filters[a]),!0):!1}(n,e):void Jt(19439)}function k3(n){return n instanceof Fi?function(t){return`${t.field.canonicalString()} ${t.op} ${qI(t.value)}`}(n):n instanceof ag?function(t){return t.op.toString()+" {"+t.getFilters().map(k3).join(" ,")+"}"}(n):"Filter"}class Nre extends Fi{constructor(e,t,i){super(e,t,i),this.key=zt.fromName(i.referenceValue)}matches(e){const t=zt.comparator(e.key,this.key);return this.matchesComparison(t)}}class Fre extends Fi{constructor(e,t){super(e,"in",t),this.keys=z3("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Hre extends Fi{constructor(e,t){super(e,"not-in",t),this.keys=z3("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function z3(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>zt.fromName(i.referenceValue))}class Xre extends Fi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return aR(t)&&Ph(t.arrayValue,this.value)}}class Tre extends Fi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ph(this.value.arrayValue,t)}}class Ere extends Fi{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ph(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!Ph(this.value.arrayValue,t)}}class Yre extends Fi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!aR(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Ph(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kre{constructor(e,t=null,i=[],s=[],o=null,r=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=o,this.startAt=r,this.endAt=a,this.Ie=null}}function MF(n,e=null,t=[],i=[],s=null,o=null,r=null){return new Kre(n,e,t,i,s,o,r)}function lR(n){const e=Nn(n);if(e.Ie===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>hw(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(o){return o.field.canonicalString()+o.dir}(i)).join(","),sR(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>qI(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>qI(i)).join(",")),e.Ie=t}return e.Ie}function gR(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Wre(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!L3(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!WF(n.startAt,e.startAt)&&WF(n.endAt,e.endAt)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(e,t=null,i=[],s=[],o=null,r="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=o,this.limitType=r,this.startAt=a,this.endAt=l,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function _re(n,e,t,i,s,o,r,a){return new dy(n,e,t,i,s,o,r,a)}function Lre(n){return new dy(n)}function NF(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function kre(n){return n.collectionGroup!==null}function th(n){const e=Nn(n);if(e.Ee===null){e.Ee=[];const t=new Set;for(const o of e.explicitOrderBy)e.Ee.push(o),t.add(o.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(r){let a=new Oi(Pi.comparator);return r.filters.forEach(l=>{l.getFlattenedFilters().forEach(g=>{g.isInequality()&&(a=a.add(g.field))})}),a})(e).forEach(o=>{t.has(o.canonicalString())||o.isKeyField()||e.Ee.push(new _0(o,i))}),t.has(Pi.keyField().canonicalString())||e.Ee.push(new _0(Pi.keyField(),i))}return e.Ee}function Hc(n){const e=Nn(n);return e.de||(e.de=zre(e,th(n))),e.de}function zre(n,e){if(n.limitType==="F")return MF(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(s=>{const o=s.dir==="desc"?"asc":"desc";return new _0(s.field,o)});const t=n.endAt?new K0(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new K0(n.startAt.position,n.startAt.inclusive):null;return MF(n.path,n.collectionGroup,e,n.filters,n.limit,t,i)}}function Aw(n,e,t){return new dy(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function D3(n,e){return gR(Hc(n),Hc(e))&&n.limitType===e.limitType}function P3(n){return`${lR(Hc(n))}|lt:${n.limitType}`}function BC(n){return`Query(target=${function(t){let i=t.path.canonicalString();return t.collectionGroup!==null&&(i+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(i+=`, filters: [${t.filters.map(s=>k3(s)).join(", ")}]`),sR(t.limit)||(i+=", limit: "+t.limit),t.orderBy.length>0&&(i+=`, orderBy: [${t.orderBy.map(s=>function(r){return`${r.field.canonicalString()} (${r.dir})`}(s)).join(", ")}]`),t.startAt&&(i+=", startAt: ",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(s=>qI(s)).join(",")),t.endAt&&(i+=", endAt: ",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(s=>qI(s)).join(",")),`Target(${i})`}(Hc(n))}; limitType=${n.limitType})`}function cR(n,e){return e.isFoundDocument()&&function(i,s){const o=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(o):zt.isDocumentKey(i.path)?i.path.isEqual(o):i.path.isImmediateParentOf(o)}(n,e)&&function(i,s){for(const o of th(i))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0}(n,e)&&function(i,s){for(const o of i.filters)if(!o.matches(s))return!1;return!0}(n,e)&&function(i,s){return!(i.startAt&&!function(r,a,l){const g=VF(r,a,l);return r.inclusive?g<=0:g<0}(i.startAt,th(i),s)||i.endAt&&!function(r,a,l){const g=VF(r,a,l);return r.inclusive?g>=0:g>0}(i.endAt,th(i),s))}(n,e)}function Dre(n){return(e,t)=>{let i=!1;for(const s of th(n)){const o=Pre(s,e,t);if(o!==0)return o;i=i||s.field.isKeyField()}return 0}}function Pre(n,e,t){const i=n.field.isKeyField()?zt.comparator(e.key,t.key):function(o,r,a){const l=r.data.field(o),g=a.data.field(o);return l!==null&&g!==null?jI(l,g):Jt(42886)}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return Jt(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,o]of i)if(this.equalsFn(s,e))return o}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],e))return void(s[o]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){pd(this.inner,(t,i)=>{for(const[s,o]of i)e(s,o)})}isEmpty(){return V3(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ure=new ro(zt.comparator);function L0(){return Ure}const U3=new ro(zt.comparator);function Tm(...n){let e=U3;for(const t of n)e=e.insert(t.key,t);return e}function J3(n){let e=U3;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function wc(){return nh()}function O3(){return nh()}function nh(){return new gu(n=>n.toString(),(n,e)=>n.isEqual(e))}const Jre=new ro(zt.comparator),Ore=new Oi(zt.comparator);function ms(...n){let e=Ore;for(const t of n)e=e.add(t);return e}const Qre=new Oi(In);function jre(){return Qre}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uR(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:X0(e)?"-0":e}}function Q3(n){return{integerValue:""+n}}function qre(n,e){return Gre(e)?Q3(e):uR(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{constructor(){this._=void 0}}function $re(n,e,t){return n instanceof k0?function(s,o){const r={fields:{[M3]:{stringValue:W3},[F3]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&oR(o)&&(o=rR(o)),o&&(r.fields[N3]=o),{mapValue:r}}(t,e):n instanceof Uh?q3(n,e):n instanceof Jh?$3(n,e):function(s,o){const r=j3(s,o),a=FF(r)+FF(s.Re);return Cw(r)&&Cw(s.Re)?Q3(a):uR(s.serializer,a)}(n,e)}function eae(n,e,t){return n instanceof Uh?q3(n,e):n instanceof Jh?$3(n,e):t}function j3(n,e){return n instanceof z0?function(i){return Cw(i)||function(o){return!!o&&"doubleValue"in o}(i)}(e)?e:{integerValue:0}:null}class k0 extends Cy{}class Uh extends Cy{constructor(e){super(),this.elements=e}}function q3(n,e){const t=e5(e);for(const i of n.elements)t.some(s=>la(s,i))||t.push(i);return{arrayValue:{values:t}}}class Jh extends Cy{constructor(e){super(),this.elements=e}}function $3(n,e){let t=e5(e);for(const i of n.elements)t=t.filter(s=>!la(s,i));return{arrayValue:{values:t}}}class z0 extends Cy{constructor(e,t){super(),this.serializer=e,this.Re=t}}function FF(n){return zi(n.integerValue||n.doubleValue)}function e5(n){return aR(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function tae(n,e){return n.field.isEqual(e.field)&&function(i,s){return i instanceof Uh&&s instanceof Uh||i instanceof Jh&&s instanceof Jh?OI(i.elements,s.elements,la):i instanceof z0&&s instanceof z0?la(i.Re,s.Re):i instanceof k0&&s instanceof k0}(n.transform,e.transform)}class nae{constructor(e,t){this.version=e,this.transformResults=t}}class ka{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ka}static exists(e){return new ka(void 0,e)}static updateTime(e){return new ka(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class hy{}function t5(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new i5(n.key,ka.none()):new bA(n.key,n.data,ka.none());{const t=n.data,i=Br.empty();let s=new Oi(Pi.comparator);for(let o of e.fields)if(!s.has(o)){let r=t.field(o);r===null&&o.length>1&&(o=o.popLast(),r=t.field(o)),r===null?i.delete(o):i.set(o,r),s=s.add(o)}return new cu(n.key,i,new Gr(s.toArray()),ka.none())}}function iae(n,e,t){n instanceof bA?function(s,o,r){const a=s.value.clone(),l=XF(s.fieldTransforms,o,r.transformResults);a.setAll(l),o.convertToFoundDocument(r.version,a).setHasCommittedMutations()}(n,e,t):n instanceof cu?function(s,o,r){if(!cf(s.precondition,o))return void o.convertToUnknownDocument(r.version);const a=XF(s.fieldTransforms,o,r.transformResults),l=o.data;l.setAll(n5(s)),l.setAll(a),o.convertToFoundDocument(r.version,l).setHasCommittedMutations()}(n,e,t):function(s,o,r){o.convertToNoDocument(r.version).setHasCommittedMutations()}(0,e,t)}function ih(n,e,t,i){return n instanceof bA?function(o,r,a,l){if(!cf(o.precondition,r))return a;const g=o.value.clone(),c=TF(o.fieldTransforms,l,r);return g.setAll(c),r.convertToFoundDocument(r.version,g).setHasLocalMutations(),null}(n,e,t,i):n instanceof cu?function(o,r,a,l){if(!cf(o.precondition,r))return a;const g=TF(o.fieldTransforms,l,r),c=r.data;return c.setAll(n5(o)),c.setAll(g),r.convertToFoundDocument(r.version,c).setHasLocalMutations(),a===null?null:a.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map(u=>u.field))}(n,e,t,i):function(o,r,a){return cf(o.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):a}(n,e,t)}function sae(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),o=j3(i.transform,s||null);o!=null&&(t===null&&(t=Br.empty()),t.set(i.field,o))}return t||null}function HF(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&OI(i,s,(o,r)=>tae(o,r))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class bA extends hy{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class cu extends hy{constructor(e,t,i,s,o=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function n5(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function XF(n,e,t){const i=new Map;si(n.length===t.length,32656,{Ve:t.length,me:n.length});for(let s=0;s<t.length;s++){const o=n[s],r=o.transform,a=e.data.field(o.field);i.set(o.field,eae(r,a,t[s]))}return i}function TF(n,e,t){const i=new Map;for(const s of n){const o=s.transform,r=t.data.field(s.field);i.set(s.field,$re(o,r,e))}return i}class i5 extends hy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class oae extends hy{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rae{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(e.key)&&iae(o,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=ih(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=ih(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=O3();return this.mutations.forEach(s=>{const o=e.get(s.key),r=o.overlayedDocument;let a=this.applyToLocalView(r,o.mutatedFields);a=t.has(s.key)?null:a;const l=t5(r,a);l!==null&&i.set(s.key,l),r.isValidDocument()||r.convertToNoDocument(Yn.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),ms())}isEqual(e){return this.batchId===e.batchId&&OI(this.mutations,e.mutations,(t,i)=>HF(t,i))&&OI(this.baseMutations,e.baseMutations,(t,i)=>HF(t,i))}}class IR{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){si(e.mutations.length===i.length,58842,{fe:e.mutations.length,ge:i.length});let s=function(){return Jre}();const o=e.mutations;for(let r=0;r<o.length;r++)s=s.insert(o[r].key,i[r].version);return new IR(e,t,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aae{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var bi,gn;function lae(n){switch(n){case Ke.OK:return Jt(64938);case Ke.CANCELLED:case Ke.UNKNOWN:case Ke.DEADLINE_EXCEEDED:case Ke.RESOURCE_EXHAUSTED:case Ke.INTERNAL:case Ke.UNAVAILABLE:case Ke.UNAUTHENTICATED:return!1;case Ke.INVALID_ARGUMENT:case Ke.NOT_FOUND:case Ke.ALREADY_EXISTS:case Ke.PERMISSION_DENIED:case Ke.FAILED_PRECONDITION:case Ke.ABORTED:case Ke.OUT_OF_RANGE:case Ke.UNIMPLEMENTED:case Ke.DATA_LOSS:return!0;default:return Jt(15467,{code:n})}}function gae(n){if(n===void 0)return jc("GRPC error has no .code"),Ke.UNKNOWN;switch(n){case bi.OK:return Ke.OK;case bi.CANCELLED:return Ke.CANCELLED;case bi.UNKNOWN:return Ke.UNKNOWN;case bi.DEADLINE_EXCEEDED:return Ke.DEADLINE_EXCEEDED;case bi.RESOURCE_EXHAUSTED:return Ke.RESOURCE_EXHAUSTED;case bi.INTERNAL:return Ke.INTERNAL;case bi.UNAVAILABLE:return Ke.UNAVAILABLE;case bi.UNAUTHENTICATED:return Ke.UNAUTHENTICATED;case bi.INVALID_ARGUMENT:return Ke.INVALID_ARGUMENT;case bi.NOT_FOUND:return Ke.NOT_FOUND;case bi.ALREADY_EXISTS:return Ke.ALREADY_EXISTS;case bi.PERMISSION_DENIED:return Ke.PERMISSION_DENIED;case bi.FAILED_PRECONDITION:return Ke.FAILED_PRECONDITION;case bi.ABORTED:return Ke.ABORTED;case bi.OUT_OF_RANGE:return Ke.OUT_OF_RANGE;case bi.UNIMPLEMENTED:return Ke.UNIMPLEMENTED;case bi.DATA_LOSS:return Ke.DATA_LOSS;default:return Jt(39323,{code:n})}}(gn=bi||(bi={}))[gn.OK=0]="OK",gn[gn.CANCELLED=1]="CANCELLED",gn[gn.UNKNOWN=2]="UNKNOWN",gn[gn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gn[gn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gn[gn.NOT_FOUND=5]="NOT_FOUND",gn[gn.ALREADY_EXISTS=6]="ALREADY_EXISTS",gn[gn.PERMISSION_DENIED=7]="PERMISSION_DENIED",gn[gn.UNAUTHENTICATED=16]="UNAUTHENTICATED",gn[gn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gn[gn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gn[gn.ABORTED=10]="ABORTED",gn[gn.OUT_OF_RANGE=11]="OUT_OF_RANGE",gn[gn.UNIMPLEMENTED=12]="UNIMPLEMENTED",gn[gn.INTERNAL=13]="INTERNAL",gn[gn.UNAVAILABLE=14]="UNAVAILABLE",gn[gn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new $S([4294967295,4294967295],0);class cae{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pw(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function uae(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Iae(n,e){return pw(n,e.toTimestamp())}function HI(n){return si(!!n,49232),Yn.fromTimestamp(function(t){const i=qc(t);return new Zi(i.seconds,i.nanos)}(n))}function s5(n,e){return mw(n,e).canonicalString()}function mw(n,e){const t=function(s){return new ni(["projects",s.projectId,"databases",s.database])}(n).child("documents");return e===void 0?t:t.child(e)}function dae(n){const e=ni.fromString(n);return si(yae(e),10190,{key:e.toString()}),e}function fw(n,e){return s5(n.databaseId,e.path)}function Cae(n){const e=dae(n);return e.length===4?ni.emptyPath():Aae(e)}function hae(n){return new ni(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Aae(n){return si(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function EF(n,e,t){return{name:fw(n,e),fields:t.value.mapValue.fields}}function pae(n,e){let t;if(e instanceof bA)t={update:EF(n,e.key,e.value)};else if(e instanceof i5)t={delete:fw(n,e.key)};else if(e instanceof cu)t={update:EF(n,e.key,e.data),updateMask:bae(e.fieldMask)};else{if(!(e instanceof oae))return Jt(16599,{ft:e.type});t={verify:fw(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(o,r){const a=r.transform;if(a instanceof k0)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Uh)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Jh)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof z0)return{fieldPath:r.field.canonicalString(),increment:a.Re};throw Jt(20930,{transform:r.transform})}(0,i))),e.precondition.isNone||(t.currentDocument=function(s,o){return o.updateTime!==void 0?{updateTime:Iae(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:Jt(27497)}(n,e.precondition)),t}function mae(n,e){return n&&n.length>0?(si(e!==void 0,14353),n.map(t=>function(s,o){let r=s.updateTime?HI(s.updateTime):HI(o);return r.isEqual(Yn.min())&&(r=HI(o)),new nae(r,s.transformResults||[])}(t,e))):[]}function fae(n){let e=Cae(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){si(i===1,65062);const c=t.from[0];c.allDescendants?s=c.collectionId:e=e.child(c.collectionId)}let o=[];t.where&&(o=function(u){const C=o5(u);return C instanceof ag&&_3(C)?C.getFilters():[C]}(t.where));let r=[];t.orderBy&&(r=function(u){return u.map(C=>function(p){return new _0(eI(p.field),function(m){switch(m){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(p.direction))}(C))}(t.orderBy));let a=null;t.limit&&(a=function(u){let C;return C=typeof u=="object"?u.value:u,sR(C)?null:C}(t.limit));let l=null;t.startAt&&(l=function(u){const C=!!u.before,h=u.values||[];return new K0(h,C)}(t.startAt));let g=null;return t.endAt&&(g=function(u){const C=!u.before,h=u.values||[];return new K0(h,C)}(t.endAt)),_re(e,s,r,o,a,"F",l,g)}function o5(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const i=eI(t.unaryFilter.field);return Fi.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=eI(t.unaryFilter.field);return Fi.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=eI(t.unaryFilter.field);return Fi.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=eI(t.unaryFilter.field);return Fi.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Jt(61313);default:return Jt(60726)}}(n):n.fieldFilter!==void 0?function(t){return Fi.create(eI(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Jt(58110);default:return Jt(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return ag.create(t.compositeFilter.filters.map(i=>o5(i)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return Jt(1026)}}(t.compositeFilter.op))}(n):Jt(30097,{filter:n})}function eI(n){return Pi.fromServerFormat(n.fieldPath)}function bae(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function yae(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bae{constructor(e){this.wt=e}}function Gae(n){const e=fae({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Aw(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vae{constructor(){this.Cn=new wae}addToCollectionParentIndex(e,t){return this.Cn.add(t),Ve.resolve()}getCollectionParents(e,t){return Ve.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Ve.resolve()}deleteFieldIndex(e,t){return Ve.resolve()}deleteAllFieldIndexes(e){return Ve.resolve()}createTargetIndexes(e,t){return Ve.resolve()}getDocumentsMatchingTarget(e,t){return Ve.resolve(null)}getIndexType(e,t){return Ve.resolve(0)}getFieldIndexes(e,t){return Ve.resolve([])}getNextCollectionGroupToUpdate(e){return Ve.resolve(null)}getMinOffset(e,t){return Ve.resolve(rg.min())}getMinOffsetFromCollectionGroup(e,t){return Ve.resolve(rg.min())}updateCollectionGroup(e,t,i){return Ve.resolve()}updateIndexEntries(e,t){return Ve.resolve()}}class wae{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new Oi(ni.comparator),o=!s.has(i);return this.index[t]=s.add(i),o}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new Oi(ni.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YF={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},r5=41943040;class js{static withCacheSize(e){return new js(e,js.DEFAULT_COLLECTION_PERCENTILE,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */js.DEFAULT_COLLECTION_PERCENTILE=10,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,js.DEFAULT=new js(r5,js.DEFAULT_COLLECTION_PERCENTILE,js.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),js.DISABLED=new js(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $I{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new $I(0)}static lr(){return new $I(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KF="LruGarbageCollector",Zae=1048576;function _F([n,e],[t,i]){const s=In(n,t);return s===0?In(e,i):s}class Sae{constructor(e){this.Er=e,this.buffer=new Oi(_F),this.dr=0}Ar(){return++this.dr}Rr(e){const t=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();_F(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Rae{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){ht(KF,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){fA(t)?ht(KF,"Ignoring IndexedDB error during garbage collection: ",t):await tR(t)}await this.mr(3e5)})}}class xae{constructor(e,t){this.gr=e,this.params=t}calculateTargetCount(e,t){return this.gr.pr(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return Ve.resolve(nR.le);const i=new Sae(t);return this.gr.forEachTarget(e,s=>i.Rr(s.sequenceNumber)).next(()=>this.gr.yr(e,s=>i.Rr(s))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.gr.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.gr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(ht("LruGarbageCollector","Garbage collection skipped; disabled"),Ve.resolve(YF)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(ht("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),YF):this.wr(e,t))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,t){let i,s,o,r,a,l,g;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(u=>(u>this.params.maximumSequenceNumbersToCollect?(ht("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${u}`),s=this.params.maximumSequenceNumbersToCollect):s=u,r=Date.now(),this.nthSequenceNumber(e,s))).next(u=>(i=u,a=Date.now(),this.removeTargets(e,i,t))).next(u=>(o=u,l=Date.now(),this.removeOrphanedDocuments(e,i))).next(u=>(g=Date.now(),$u()<=un.DEBUG&&ht("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${r-c}ms
	Determined least recently used ${s} in `+(a-r)+`ms
	Removed ${o} targets in `+(l-a)+`ms
	Removed ${u} documents in `+(g-l)+`ms
Total Duration: ${g-c}ms`),Ve.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:u})))}}function Vae(n,e){return new xae(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wae{constructor(){this.changes=new gu(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,yr.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?Ve.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mae{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nae{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(i=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(i!==null&&ih(i.mutation,s,Gr.empty(),Zi.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,ms()).next(()=>i))}getLocalViewOfDocuments(e,t,i=ms()){const s=wc();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,i).next(o=>{let r=Tm();return o.forEach((a,l)=>{r=r.insert(a,l.overlayedDocument)}),r}))}getOverlayedDocuments(e,t){const i=wc();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,ms()))}populateOverlays(e,t,i){const s=[];return i.forEach(o=>{t.has(o)||s.push(o)}),this.documentOverlayCache.getOverlays(e,s).next(o=>{o.forEach((r,a)=>{t.set(r,a)})})}computeViews(e,t,i,s){let o=L0();const r=nh(),a=function(){return nh()}();return t.forEach((l,g)=>{const c=i.get(g.key);s.has(g.key)&&(c===void 0||c.mutation instanceof cu)?o=o.insert(g.key,g):c!==void 0?(r.set(g.key,c.mutation.getFieldMask()),ih(c.mutation,g,c.mutation.getFieldMask(),Zi.now())):r.set(g.key,Gr.empty())}),this.recalculateAndSaveOverlays(e,o).next(l=>(l.forEach((g,c)=>r.set(g,c)),t.forEach((g,c)=>{var u;return a.set(g,new Mae(c,(u=r.get(g))!==null&&u!==void 0?u:null))}),a))}recalculateAndSaveOverlays(e,t){const i=nh();let s=new ro((r,a)=>r-a),o=ms();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(r=>{for(const a of r)a.keys().forEach(l=>{const g=t.get(l);if(g===null)return;let c=i.get(l)||Gr.empty();c=a.applyToLocalView(g,c),i.set(l,c);const u=(s.get(a.batchId)||ms()).add(l);s=s.insert(a.batchId,u)})}).next(()=>{const r=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),g=l.key,c=l.value,u=O3();c.forEach(C=>{if(!o.has(C)){const h=t5(t.get(C),i.get(C));h!==null&&u.set(C,h),o=o.add(C)}}),r.push(this.documentOverlayCache.saveOverlays(e,g,u))}return Ve.waitFor(r)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i,s){return function(r){return zt.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):kre(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i,s):this.getDocumentsMatchingCollectionQuery(e,t,i,s)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next(o=>{const r=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-o.size):Ve.resolve(wc());let a=Dh,l=o;return r.next(g=>Ve.forEach(g,(c,u)=>(a<u.largestBatchId&&(a=u.largestBatchId),o.get(c)?Ve.resolve():this.remoteDocumentCache.getEntry(e,c).next(C=>{l=l.insert(c,C)}))).next(()=>this.populateOverlays(e,g,o)).next(()=>this.computeViews(e,l,g,ms())).next(c=>({batchId:a,changes:J3(c)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new zt(t)).next(i=>{let s=Tm();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,i,s){const o=t.collectionGroup;let r=Tm();return this.indexManager.getCollectionParents(e,o).next(a=>Ve.forEach(a,l=>{const g=function(u,C){return new dy(C,null,u.explicitOrderBy.slice(),u.filters.slice(),u.limit,u.limitType,u.startAt,u.endAt)}(t,l.child(o));return this.getDocumentsMatchingCollectionQuery(e,g,i,s).next(c=>{c.forEach((u,C)=>{r=r.insert(u,C)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,i,s){let o;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(r=>(o=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,o,s))).next(r=>{o.forEach((l,g)=>{const c=g.getKey();r.get(c)===null&&(r=r.insert(c,yr.newInvalidDocument(c)))});let a=Tm();return r.forEach((l,g)=>{const c=o.get(l);c!==void 0&&ih(c.mutation,g,Gr.empty(),Zi.now()),cR(t,g)&&(a=a.insert(l,g))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fae{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,t){return Ve.resolve(this.kr.get(t))}saveBundleMetadata(e,t){return this.kr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:HI(s.createTime)}}(t)),Ve.resolve()}getNamedQuery(e,t){return Ve.resolve(this.qr.get(t))}saveNamedQuery(e,t){return this.qr.set(t.name,function(s){return{name:s.name,query:Gae(s.bundledQuery),readTime:HI(s.readTime)}}(t)),Ve.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hae{constructor(){this.overlays=new ro(zt.comparator),this.Qr=new Map}getOverlay(e,t){return Ve.resolve(this.overlays.get(t))}getOverlays(e,t){const i=wc();return Ve.forEach(t,s=>this.getOverlay(e,s).next(o=>{o!==null&&i.set(s,o)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((s,o)=>{this.bt(e,t,o)}),Ve.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.Qr.get(i);return s!==void 0&&(s.forEach(o=>this.overlays=this.overlays.remove(o)),this.Qr.delete(i)),Ve.resolve()}getOverlaysForCollection(e,t,i){const s=wc(),o=t.length+1,r=new zt(t.child("")),a=this.overlays.getIteratorFrom(r);for(;a.hasNext();){const l=a.getNext().value,g=l.getKey();if(!t.isPrefixOf(g.path))break;g.path.length===o&&l.largestBatchId>i&&s.set(l.getKey(),l)}return Ve.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let o=new ro((g,c)=>g-c);const r=this.overlays.getIterator();for(;r.hasNext();){const g=r.getNext().value;if(g.getKey().getCollectionGroup()===t&&g.largestBatchId>i){let c=o.get(g.largestBatchId);c===null&&(c=wc(),o=o.insert(g.largestBatchId,c)),c.set(g.getKey(),g)}}const a=wc(),l=o.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((g,c)=>a.set(g,c)),!(a.size()>=s)););return Ve.resolve(a)}bt(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const r=this.Qr.get(s.largestBatchId).delete(i.key);this.Qr.set(s.largestBatchId,r)}this.overlays=this.overlays.insert(i.key,new aae(t,i));let o=this.Qr.get(t);o===void 0&&(o=ms(),this.Qr.set(t,o)),this.Qr.set(t,o.add(i.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xae{constructor(){this.sessionToken=aa.EMPTY_BYTE_STRING}getSessionToken(e){return Ve.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ve.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(){this.$r=new Oi(Mi.Ur),this.Kr=new Oi(Mi.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,t){const i=new Mi(e,t);this.$r=this.$r.add(i),this.Kr=this.Kr.add(i)}Gr(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.zr(new Mi(e,t))}jr(e,t){e.forEach(i=>this.removeReference(i,t))}Hr(e){const t=new zt(new ni([])),i=new Mi(t,e),s=new Mi(t,e+1),o=[];return this.Kr.forEachInRange([i,s],r=>{this.zr(r),o.push(r.key)}),o}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const t=new zt(new ni([])),i=new Mi(t,e),s=new Mi(t,e+1);let o=ms();return this.Kr.forEachInRange([i,s],r=>{o=o.add(r.key)}),o}containsKey(e){const t=new Mi(e,0),i=this.$r.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Mi{constructor(e,t){this.key=e,this.Zr=t}static Ur(e,t){return zt.comparator(e.key,t.key)||In(e.Zr,t.Zr)}static Wr(e,t){return In(e.Zr,t.Zr)||zt.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tae{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nr=1,this.Xr=new Oi(Mi.Ur)}checkEmpty(e){return Ve.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const o=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new rae(o,t,i,s);this.mutationQueue.push(r);for(const a of s)this.Xr=this.Xr.add(new Mi(a.key,o)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Ve.resolve(r)}lookupMutationBatch(e,t){return Ve.resolve(this.ei(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.ti(i),o=s<0?0:s;return Ve.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return Ve.resolve(this.mutationQueue.length===0?iR:this.nr-1)}getAllMutationBatches(e){return Ve.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Mi(t,0),s=new Mi(t,Number.POSITIVE_INFINITY),o=[];return this.Xr.forEachInRange([i,s],r=>{const a=this.ei(r.Zr);o.push(a)}),Ve.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Oi(In);return t.forEach(s=>{const o=new Mi(s,0),r=new Mi(s,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([o,r],a=>{i=i.add(a.Zr)})}),Ve.resolve(this.ni(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let o=i;zt.isDocumentKey(o)||(o=o.child(""));const r=new Mi(new zt(o),0);let a=new Oi(In);return this.Xr.forEachWhile(l=>{const g=l.key.path;return!!i.isPrefixOf(g)&&(g.length===s&&(a=a.add(l.Zr)),!0)},r),Ve.resolve(this.ni(a))}ni(e){const t=[];return e.forEach(i=>{const s=this.ei(i);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){si(this.ri(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Xr;return Ve.forEach(t.mutations,s=>{const o=new Mi(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Xr=i})}sr(e){}containsKey(e,t){const i=new Mi(t,0),s=this.Xr.firstAfterOrEqual(i);return Ve.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ve.resolve()}ri(e,t){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const t=this.ti(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eae{constructor(e){this.ii=e,this.docs=function(){return new ro(zt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),o=s?s.size:0,r=this.ii(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:r}),this.size+=r-o,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return Ve.resolve(i?i.document.mutableCopy():yr.newInvalidDocument(t))}getEntries(e,t){let i=L0();return t.forEach(s=>{const o=this.docs.get(s);i=i.insert(s,o?o.document.mutableCopy():yr.newInvalidDocument(s))}),Ve.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let o=L0();const r=t.path,a=new zt(r.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:g,value:{document:c}}=l.getNext();if(!r.isPrefixOf(g.path))break;g.path.length>r.length+1||fre(mre(c),i)<=0||(s.has(c.key)||cR(t,c))&&(o=o.insert(c.key,c.mutableCopy()))}return Ve.resolve(o)}getAllFromCollectionGroup(e,t,i,s){Jt(9500)}si(e,t){return Ve.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Yae(this)}getSize(e){return Ve.resolve(this.size)}}class Yae extends Wae{constructor(e){super(),this.Br=e}applyChanges(e){const t=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?t.push(this.Br.addEntry(e,s)):this.Br.removeEntry(i)}),Ve.waitFor(t)}getFromCache(e,t){return this.Br.getEntry(e,t)}getAllFromCache(e,t){return this.Br.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kae{constructor(e){this.persistence=e,this.oi=new gu(t=>lR(t),gR),this.lastRemoteSnapshotVersion=Yn.min(),this.highestTargetId=0,this._i=0,this.ai=new dR,this.targetCount=0,this.ui=$I.cr()}forEachTarget(e,t){return this.oi.forEach((i,s)=>t(s)),Ve.resolve()}getLastRemoteSnapshotVersion(e){return Ve.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ve.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),Ve.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this._i&&(this._i=t),Ve.resolve()}Tr(e){this.oi.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ui=new $I(t),this.highestTargetId=t),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,t){return this.Tr(t),this.targetCount+=1,Ve.resolve()}updateTargetData(e,t){return this.Tr(t),Ve.resolve()}removeTargetData(e,t){return this.oi.delete(t.target),this.ai.Hr(t.targetId),this.targetCount-=1,Ve.resolve()}removeTargets(e,t,i){let s=0;const o=[];return this.oi.forEach((r,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.oi.delete(r),o.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),Ve.waitFor(o).next(()=>s)}getTargetCount(e){return Ve.resolve(this.targetCount)}getTargetData(e,t){const i=this.oi.get(t)||null;return Ve.resolve(i)}addMatchingKeys(e,t,i){return this.ai.Gr(t,i),Ve.resolve()}removeMatchingKeys(e,t,i){this.ai.jr(t,i);const s=this.persistence.referenceDelegate,o=[];return s&&t.forEach(r=>{o.push(s.markPotentiallyOrphaned(e,r))}),Ve.waitFor(o)}removeMatchingKeysForTargetId(e,t){return this.ai.Hr(t),Ve.resolve()}getMatchingKeysForTargetId(e,t){const i=this.ai.Yr(t);return Ve.resolve(i)}containsKey(e,t){return Ve.resolve(this.ai.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a5{constructor(e,t){this.ci={},this.overlays={},this.li=new nR(0),this.hi=!1,this.hi=!0,this.Pi=new Xae,this.referenceDelegate=e(this),this.Ti=new Kae(this),this.indexManager=new vae,this.remoteDocumentCache=function(s){return new Eae(s)}(i=>this.referenceDelegate.Ii(i)),this.serializer=new Bae(t),this.Ei=new Fae(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Hae,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.ci[e.toKey()];return i||(i=new Tae(t,this.referenceDelegate),this.ci[e.toKey()]=i),i}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,t,i){ht("MemoryPersistence","Starting transaction:",e);const s=new _ae(this.li.next());return this.referenceDelegate.di(),i(s).next(o=>this.referenceDelegate.Ai(s).next(()=>o)).toPromise().then(o=>(s.raiseOnCommittedEvent(),o))}Ri(e,t){return Ve.or(Object.values(this.ci).map(i=>()=>i.containsKey(e,t)))}}class _ae extends yre{constructor(e){super(),this.currentSequenceNumber=e}}class CR{constructor(e){this.persistence=e,this.Vi=new dR,this.mi=null}static fi(e){return new CR(e)}get gi(){if(this.mi)return this.mi;throw Jt(60996)}addReference(e,t,i){return this.Vi.addReference(i,t),this.gi.delete(i.toString()),Ve.resolve()}removeReference(e,t,i){return this.Vi.removeReference(i,t),this.gi.add(i.toString()),Ve.resolve()}markPotentiallyOrphaned(e,t){return this.gi.add(t.toString()),Ve.resolve()}removeTarget(e,t){this.Vi.Hr(t.targetId).forEach(s=>this.gi.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.gi.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}di(){this.mi=new Set}Ai(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ve.forEach(this.gi,i=>{const s=zt.fromPath(i);return this.pi(e,s).next(o=>{o||t.removeEntry(s,Yn.min())})}).next(()=>(this.mi=null,t.apply(e)))}updateLimboDocument(e,t){return this.pi(e,t).next(i=>{i?this.gi.delete(t.toString()):this.gi.add(t.toString())})}Ii(e){return 0}pi(e,t){return Ve.or([()=>Ve.resolve(this.Vi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ri(e,t)])}}class D0{constructor(e,t){this.persistence=e,this.yi=new gu(i=>vre(i.path),(i,s)=>i.isEqual(s)),this.garbageCollector=Vae(this,t)}static fi(e,t){return new D0(e,t)}di(){}Ai(e){return Ve.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}pr(e){const t=this.Sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}Sr(e){let t=0;return this.yr(e,i=>{t++}).next(()=>t)}yr(e,t){return Ve.forEach(this.yi,(i,s)=>this.Dr(e,i,s).next(o=>o?Ve.resolve():t(s)))}removeTargets(e,t,i){return this.persistence.getTargetCache().removeTargets(e,t,i)}removeOrphanedDocuments(e,t){let i=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.si(e,r=>this.Dr(e,r,t).next(a=>{a||(i++,o.removeEntry(r,Yn.min()))})).next(()=>o.apply(e)).next(()=>i)}markPotentiallyOrphaned(e,t){return this.yi.set(t,e.currentSequenceNumber),Ve.resolve()}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,t,i){return this.yi.set(i,e.currentSequenceNumber),Ve.resolve()}removeReference(e,t,i){return this.yi.set(i,e.currentSequenceNumber),Ve.resolve()}updateLimboDocument(e,t){return this.yi.set(t,e.currentSequenceNumber),Ve.resolve()}Ii(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=lf(e.data.value)),t}Dr(e,t,i){return Ve.or([()=>this.persistence.Ri(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.yi.get(t);return Ve.resolve(s!==void 0&&s>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.ds=i,this.As=s}static Rs(e,t){let i=ms(),s=ms();for(const o of t.docChanges)switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new hR(e,t.fromCache,i,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lae{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kae{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return _se()?8:Bre(Yse())>0?6:4}()}initialize(e,t){this.ys=e,this.indexManager=t,this.Vs=!0}getDocumentsMatchingQuery(e,t,i,s){const o={result:null};return this.ws(e,t).next(r=>{o.result=r}).next(()=>{if(!o.result)return this.Ss(e,t,s,i).next(r=>{o.result=r})}).next(()=>{if(o.result)return;const r=new Lae;return this.bs(e,t,r).next(a=>{if(o.result=a,this.fs)return this.Ds(e,t,r,a.size)})}).next(()=>o.result)}Ds(e,t,i,s){return i.documentReadCount<this.gs?($u()<=un.DEBUG&&ht("QueryEngine","SDK will not create cache indexes for query:",BC(t),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Ve.resolve()):($u()<=un.DEBUG&&ht("QueryEngine","Query:",BC(t),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.ps*s?($u()<=un.DEBUG&&ht("QueryEngine","The SDK decides to create cache indexes for query:",BC(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Hc(t))):Ve.resolve())}ws(e,t){if(NF(t))return Ve.resolve(null);let i=Hc(t);return this.indexManager.getIndexType(e,i).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Aw(t,null,"F"),i=Hc(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(o=>{const r=ms(...o);return this.ys.getDocuments(e,r).next(a=>this.indexManager.getMinOffset(e,i).next(l=>{const g=this.vs(t,a);return this.Cs(t,g,r,l.readTime)?this.ws(e,Aw(t,null,"F")):this.Fs(e,g,t,l)}))})))}Ss(e,t,i,s){return NF(t)||s.isEqual(Yn.min())?Ve.resolve(null):this.ys.getDocuments(e,i).next(o=>{const r=this.vs(t,o);return this.Cs(t,r,i,s)?Ve.resolve(null):($u()<=un.DEBUG&&ht("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),BC(t)),this.Fs(e,r,t,pre(s,Dh)).next(a=>a))})}vs(e,t){let i=new Oi(Dre(e));return t.forEach((s,o)=>{cR(e,o)&&(i=i.add(o))}),i}Cs(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const o=e.limitType==="F"?t.last():t.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}bs(e,t,i){return $u()<=un.DEBUG&&ht("QueryEngine","Using full collection scan to execute query:",BC(t)),this.ys.getDocumentsMatchingQuery(e,t,rg.min(),i)}Fs(e,t,i,s){return this.ys.getDocumentsMatchingQuery(e,i,s).next(o=>(t.forEach(r=>{o=o.insert(r.key,r)}),o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zae="LocalStore";class Dae{constructor(e,t,i,s){this.persistence=e,this.Ms=t,this.serializer=s,this.xs=new ro(In),this.Os=new gu(o=>lR(o),gR),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(i)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nae(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.xs))}}function Pae(n,e,t,i){return new Dae(n,e,t,i)}async function l5(n,e){const t=Nn(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.Ls(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{const r=[],a=[];let l=ms();for(const g of s){r.push(g.batchId);for(const c of g.mutations)l=l.add(c.key)}for(const g of o){a.push(g.batchId);for(const c of g.mutations)l=l.add(c.key)}return t.localDocuments.getDocuments(i,l).next(g=>({ks:g,removedBatchIds:r,addedBatchIds:a}))})})}function Uae(n,e){const t=Nn(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=e.batch.keys(),o=t.Bs.newChangeBuffer({trackRemovals:!0});return function(a,l,g,c){const u=g.batch,C=u.keys();let h=Ve.resolve();return C.forEach(p=>{h=h.next(()=>c.getEntry(l,p)).next(b=>{const m=g.docVersions.get(p);si(m!==null,48541),b.version.compareTo(m)<0&&(u.applyToRemoteDocument(b,g),b.isValidDocument()&&(b.setReadTime(g.commitVersion),c.addEntry(b)))})}),h.next(()=>a.mutationQueue.removeMutationBatch(l,u))}(t,i,e,o).next(()=>o.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(a){let l=ms();for(let g=0;g<a.mutationResults.length;++g)a.mutationResults[g].transformResults.length>0&&(l=l.add(a.batch.mutations[g].key));return l}(e))).next(()=>t.localDocuments.getDocuments(i,s))})}function Jae(n){const e=Nn(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function Oae(n,e){const t=Nn(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=iR),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}class LF{constructor(){this.activeTargetIds=jre()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Qae{constructor(){this.xo=new LF,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e,t=!0){return t&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,t,i){this.Oo[e]=t}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new LF,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jae{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kF="ConnectivityMonitor";class zF{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){ht(kF,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){ht(kF,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Em=null;function bw(){return Em===null?Em=function(){return 268435456+Math.round(2147483648*Math.random())}():Em++,"0x"+Em.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Av="RestConnection",qae={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $ae{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Ko=t+"://"+e.host,this.Wo=`projects/${i}/databases/${s}`,this.Go=this.databaseId.database===E0?`project_id=${i}`:`project_id=${i}&database_id=${s}`}zo(e,t,i,s,o){const r=bw(),a=this.jo(e,t.toUriEncodedString());ht(Av,`Sending RPC '${e}' ${r}:`,a,i);const l={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(l,s,o);const{host:g}=new URL(a),c=jS(g);return this.Jo(e,a,l,i,c).then(u=>(ht(Av,`Received RPC '${e}' ${r}: `,u),u),u=>{throw Iy(Av,`RPC '${e}' ${r} failed with error: `,u,"url: ",a,"request:",i),u})}Yo(e,t,i,s,o,r){return this.zo(e,t,i,s,o)}Ho(e,t,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ad}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,o)=>e[o]=s),i&&i.headers.forEach((s,o)=>e[o]=s)}jo(e,t){const i=qae[e];return`${this.Ko}/v1/${t}:${i}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ele{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const us="WebChannelConnection";class tle extends $ae{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,i,s,o){const r=bw();return new Promise((a,l)=>{const g=new y3;g.setWithCredentials(!0),g.listenOnce(B3.COMPLETE,()=>{try{switch(g.getLastErrorCode()){case af.NO_ERROR:const u=g.getResponseJson();ht(us,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(u)),a(u);break;case af.TIMEOUT:ht(us,`RPC '${e}' ${r} timed out`),l(new Vt(Ke.DEADLINE_EXCEEDED,"Request time out"));break;case af.HTTP_ERROR:const C=g.getStatus();if(ht(us,`RPC '${e}' ${r} failed with status:`,C,"response text:",g.getResponseText()),C>0){let h=g.getResponseJson();Array.isArray(h)&&(h=h[0]);const p=h==null?void 0:h.error;if(p&&p.status&&p.message){const b=function(A){const B=A.toLowerCase().replace(/_/g,"-");return Object.values(Ke).indexOf(B)>=0?B:Ke.UNKNOWN}(p.status);l(new Vt(b,p.message))}else l(new Vt(Ke.UNKNOWN,"Server responded with status "+g.getStatus()))}else l(new Vt(Ke.UNAVAILABLE,"Connection failed."));break;default:Jt(9055,{l_:e,streamId:r,h_:g.getLastErrorCode(),P_:g.getLastError()})}}finally{ht(us,`RPC '${e}' ${r} completed.`)}});const c=JSON.stringify(s);ht(us,`RPC '${e}' ${r} sending request:`,s),g.send(t,"POST",c,i,15)})}T_(e,t,i){const s=bw(),o=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=w3(),a=v3(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},g=this.longPollingOptions.timeoutSeconds;g!==void 0&&(l.longPollingTimeout=Math.round(1e3*g)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Ho(l.initMessageHeaders,t,i),l.encodeInitMessageHeaders=!0;const c=o.join("");ht(us,`Creating RPC '${e}' stream ${s}: ${c}`,l);const u=r.createWebChannel(c,l);let C=!1,h=!1;const p=new ele({Zo:m=>{h?ht(us,`Not sending because RPC '${e}' stream ${s} is closed:`,m):(C||(ht(us,`Opening RPC '${e}' stream ${s} transport.`),u.open(),C=!0),ht(us,`RPC '${e}' stream ${s} sending:`,m),u.send(m))},Xo:()=>u.close()}),b=(m,A,B)=>{m.listen(A,G=>{try{B(G)}catch(w){setTimeout(()=>{throw w},0)}})};return b(u,WC.EventType.OPEN,()=>{h||(ht(us,`RPC '${e}' stream ${s} transport opened.`),p.__())}),b(u,WC.EventType.CLOSE,()=>{h||(h=!0,ht(us,`RPC '${e}' stream ${s} transport closed`),p.u_())}),b(u,WC.EventType.ERROR,m=>{h||(h=!0,Iy(us,`RPC '${e}' stream ${s} transport errored. Name:`,m.name,"Message:",m.message),p.u_(new Vt(Ke.UNAVAILABLE,"The operation could not be completed")))}),b(u,WC.EventType.MESSAGE,m=>{var A;if(!h){const B=m.data[0];si(!!B,16349);const G=B,w=(G==null?void 0:G.error)||((A=G[0])===null||A===void 0?void 0:A.error);if(w){ht(us,`RPC '${e}' stream ${s} received error:`,w);const N=w.status;let M=function(F){const Z=bi[F];if(Z!==void 0)return gae(Z)}(N),R=w.message;M===void 0&&(M=Ke.INTERNAL,R="Unknown error status: "+N+" with message "+w.message),h=!0,p.u_(new Vt(M,R)),u.close()}else ht(us,`RPC '${e}' stream ${s} received:`,B),p.c_(B)}}),b(a,G3.STAT_EVENT,m=>{m.stat===cw.PROXY?ht(us,`RPC '${e}' stream ${s} detected buffering proxy`):m.stat===cw.NOPROXY&&ht(us,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{p.a_()},0),p}}function pv(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ay(n){return new cae(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5{constructor(e,t,i=1e3,s=1.5,o=6e4){this.xi=e,this.timerId=t,this.I_=i,this.E_=s,this.d_=o,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(e){this.cancel();const t=Math.floor(this.A_+this.g_()),i=Math.max(0,Date.now()-this.V_),s=Math.max(0,t-i);s>0&&ht("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.A_} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,s,()=>(this.V_=Date.now(),e())),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){this.R_!==null&&(this.R_.skipDelay(),this.R_=null)}cancel(){this.R_!==null&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DF="PersistentStream";class nle{constructor(e,t,i,s,o,r,a,l){this.xi=e,this.y_=i,this.w_=s,this.connection=o,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new g5(e,t)}F_(){return this.state===1||this.state===5||this.M_()}M_(){return this.state===2||this.state===3}start(){this.v_=0,this.state!==4?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&this.b_===null&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,()=>this.B_()))}L_(e){this.k_(),this.stream.send(e)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(e,t){this.k_(),this.q_(),this.C_.cancel(),this.S_++,e!==4?this.C_.reset():t&&t.code===Ke.RESOURCE_EXHAUSTED?(jc(t.toString()),jc("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):t&&t.code===Ke.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Q_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(t)}Q_(){}auth(){this.state=1;const e=this.U_(this.S_),t=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.S_===t&&this.K_(i,s)},i=>{e(()=>{const s=new Vt(Ke.UNKNOWN,"Fetching auth token failed: "+i.message);return this.W_(s)})})}K_(e,t){const i=this.U_(this.S_);this.stream=this.G_(e,t),this.stream.e_(()=>{i(()=>this.listener.e_())}),this.stream.n_(()=>{i(()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,()=>(this.M_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(s=>{i(()=>this.W_(s))}),this.stream.onMessage(s=>{i(()=>++this.v_==1?this.z_(s):this.onNext(s))})}x_(){this.state=5,this.C_.f_(async()=>{this.state=0,this.start()})}W_(e){return ht(DF,`close with error: ${e}`),this.stream=null,this.close(4,e)}U_(e){return t=>{this.xi.enqueueAndForget(()=>this.S_===e?t():(ht(DF,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class ile extends nle{constructor(e,t,i,s,o,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,r),this.serializer=o}get Y_(){return this.v_>0}start(){this.lastStreamToken=void 0,super.start()}Q_(){this.Y_&&this.Z_([])}G_(e,t){return this.connection.T_("Write",e,t)}z_(e){return si(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,si(!e.writeResults||e.writeResults.length===0,55816),this.listener.X_()}onNext(e){si(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.C_.reset();const t=mae(e.writeResults,e.commitTime),i=HI(e.commitTime);return this.listener.ea(i,t)}ta(){const e={};e.database=hae(this.serializer),this.L_(e)}Z_(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>pae(this.serializer,i))};this.L_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sle{}class ole extends sle{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.serializer=s,this.na=!1}ra(){if(this.na)throw new Vt(Ke.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,t,i,s){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,r])=>this.connection.zo(e,mw(t,i),s,o,r)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Ke.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new Vt(Ke.UNKNOWN,o.toString())})}Yo(e,t,i,s,o){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,a])=>this.connection.Yo(e,mw(t,i),s,r,a,o)).catch(r=>{throw r.name==="FirebaseError"?(r.code===Ke.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new Vt(Ke.UNKNOWN,r.toString())})}terminate(){this.na=!0,this.connection.terminate()}}class rle{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){this.ia===0&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve())))}ca(e){this.state==="Online"?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.aa("Offline")))}set(e){this.la(),this.ia=0,e==="Online"&&(this.oa=!1),this.aa(e)}aa(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ua(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(jc(t),this.oa=!1):ht("OnlineStateTracker",t)}la(){this.sa!==null&&(this.sa.cancel(),this.sa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yA="RemoteStore";class ale{constructor(e,t,i,s,o){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=o,this.Ea.No(r=>{i.enqueueAndForget(async()=>{GA(this)&&(ht(yA,"Restarting streams for network reachability change."),await async function(l){const g=Nn(l);g.Ta.add(4),await BA(g),g.da.set("Unknown"),g.Ta.delete(4),await py(g)}(this))})}),this.da=new rle(i,s)}}async function py(n){if(GA(n))for(const e of n.Ia)await e(!0)}async function BA(n){for(const e of n.Ia)await e(!1)}function GA(n){return Nn(n).Ta.size===0}async function c5(n,e,t){if(!fA(e))throw e;n.Ta.add(1),await BA(n),n.da.set("Offline"),t||(t=()=>Jae(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{ht(yA,"Retrying IndexedDB access"),await t(),n.Ta.delete(1),await py(n)})}function u5(n,e){return e().catch(t=>c5(n,t,e))}async function my(n){const e=Nn(n),t=lg(e);let i=e.ha.length>0?e.ha[e.ha.length-1].batchId:iR;for(;lle(e);)try{const s=await Oae(e.localStore,i);if(s===null){e.ha.length===0&&t.N_();break}i=s.batchId,gle(e,s)}catch(s){await c5(e,s)}I5(e)&&d5(e)}function lle(n){return GA(n)&&n.ha.length<10}function gle(n,e){n.ha.push(e);const t=lg(n);t.M_()&&t.Y_&&t.Z_(e.mutations)}function I5(n){return GA(n)&&!lg(n).F_()&&n.ha.length>0}function d5(n){lg(n).start()}async function cle(n){lg(n).ta()}async function ule(n){const e=lg(n);for(const t of n.ha)e.Z_(t.mutations)}async function Ile(n,e,t){const i=n.ha.shift(),s=IR.from(i,e,t);await u5(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await my(n)}async function dle(n,e){e&&lg(n).Y_&&await async function(i,s){if(function(r){return lae(r)&&r!==Ke.ABORTED}(s.code)){const o=i.ha.shift();lg(i).O_(),await u5(i,()=>i.remoteSyncer.rejectFailedWrite(o.batchId,s)),await my(i)}}(n,e),I5(n)&&d5(n)}async function PF(n,e){const t=Nn(n);t.asyncQueue.verifyOperationInProgress(),ht(yA,"RemoteStore received new credentials");const i=GA(t);t.Ta.add(3),await BA(t),i&&t.da.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ta.delete(3),await py(t)}async function Cle(n,e){const t=Nn(n);e?(t.Ta.delete(2),await py(t)):e||(t.Ta.add(2),await BA(t),t.da.set("Unknown"))}function lg(n){return n.Va||(n.Va=function(t,i,s){const o=Nn(t);return o.ra(),new ile(i,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)}(n.datastore,n.asyncQueue,{e_:()=>Promise.resolve(),n_:cle.bind(null,n),i_:dle.bind(null,n),X_:ule.bind(null,n),ea:Ile.bind(null,n)}),n.Ia.push(async e=>{e?(n.Va.O_(),await my(n)):(await n.Va.stop(),n.ha.length>0&&(ht(yA,`Stopping write stream with ${n.ha.length} pending writes`),n.ha=[]))})),n.Va}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AR{constructor(e,t,i,s,o){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=o,this.deferred=new Fc,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(r=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,i,s,o){const r=Date.now()+i,a=new AR(e,t,r,s,o);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Vt(Ke.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function C5(n,e){if(jc("AsyncQueue",`${e}: ${n}`),fA(n))return new Vt(Ke.UNAVAILABLE,`${e}: ${n}`);throw n}class hle{constructor(){this.queries=UF(),this.onlineState="Unknown",this.ba=new Set}terminate(){(function(t,i){const s=Nn(t),o=s.queries;s.queries=UF(),o.forEach((r,a)=>{for(const l of a.ya)l.onError(i)})})(this,new Vt(Ke.ABORTED,"Firestore shutting down"))}}function UF(){return new gu(n=>P3(n),D3)}function Ale(n){n.ba.forEach(e=>{e.next()})}var JF,OF;(OF=JF||(JF={})).Ca="default",OF.Cache="cache";const ple="SyncEngine";class mle{constructor(e,t,i,s,o,r){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=r,this.au={},this.uu=new gu(a=>P3(a),D3),this.cu=new Map,this.lu=new Set,this.hu=new ro(zt.comparator),this.Pu=new Map,this.Tu=new dR,this.Iu={},this.Eu=new Map,this.du=$I.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return this.Au===!0}}async function fle(n,e,t){const i=Gle(n);try{const s=await function(r,a){const l=Nn(r),g=Zi.now(),c=a.reduce((h,p)=>h.add(p.key),ms());let u,C;return l.persistence.runTransaction("Locally write mutations","readwrite",h=>{let p=L0(),b=ms();return l.Bs.getEntries(h,c).next(m=>{p=m,p.forEach((A,B)=>{B.isValidDocument()||(b=b.add(A))})}).next(()=>l.localDocuments.getOverlayedDocuments(h,p)).next(m=>{u=m;const A=[];for(const B of a){const G=sae(B,u.get(B.key).overlayedDocument);G!=null&&A.push(new cu(B.key,G,E3(G.value.mapValue),ka.exists(!0)))}return l.mutationQueue.addMutationBatch(h,g,A,a)}).next(m=>{C=m;const A=m.applyToLocalDocumentSet(u,b);return l.documentOverlayCache.saveOverlays(h,m.batchId,A)})}).then(()=>({batchId:C.batchId,changes:J3(u)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(r,a,l){let g=r.Iu[r.currentUser.toKey()];g||(g=new ro(In)),g=g.insert(a,l),r.Iu[r.currentUser.toKey()]=g}(i,s.batchId,t),await fy(i,s.changes),await my(i.remoteStore)}catch(s){const o=C5(s,"Failed to persist write");t.reject(o)}}function QF(n,e,t){const i=Nn(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.uu.forEach((o,r)=>{const a=r.view.Da(e);a.snapshot&&s.push(a.snapshot)}),function(r,a){const l=Nn(r);l.onlineState=a;let g=!1;l.queries.forEach((c,u)=>{for(const C of u.ya)C.Da(a)&&(g=!0)}),g&&Ale(l)}(i.eventManager,e),s.length&&i.au.j_(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function ble(n,e){const t=Nn(n),i=e.batch.batchId;try{const s=await Uae(t.localStore,e);A5(t,i,null),h5(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await fy(t,s)}catch(s){await tR(s)}}async function yle(n,e,t){const i=Nn(n);try{const s=await function(r,a){const l=Nn(r);return l.persistence.runTransaction("Reject batch","readwrite-primary",g=>{let c;return l.mutationQueue.lookupMutationBatch(g,a).next(u=>(si(u!==null,37113),c=u.keys(),l.mutationQueue.removeMutationBatch(g,u))).next(()=>l.mutationQueue.performConsistencyCheck(g)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(g,c,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(g,c)).next(()=>l.localDocuments.getDocuments(g,c))})}(i.localStore,e);A5(i,e,t),h5(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await fy(i,s)}catch(s){await tR(s)}}function h5(n,e){(n.Eu.get(e)||[]).forEach(t=>{t.resolve()}),n.Eu.delete(e)}function A5(n,e,t){const i=Nn(n);let s=i.Iu[i.currentUser.toKey()];if(s){const o=s.get(e);o&&(t?o.reject(t):o.resolve(),s=s.remove(e)),i.Iu[i.currentUser.toKey()]=s}}async function fy(n,e,t){const i=Nn(n),s=[],o=[],r=[];i.uu.isEmpty()||(i.uu.forEach((a,l)=>{r.push(i.Ru(l,e,t).then(g=>{var c;if((g||t)&&i.isPrimaryClient){const u=g?!g.fromCache:(c=void 0)===null||c===void 0?void 0:c.current;i.sharedClientState.updateQueryState(l.targetId,u?"current":"not-current")}if(g){s.push(g);const u=hR.Rs(l.targetId,g);o.push(u)}}))}),await Promise.all(r),i.au.j_(s),await async function(l,g){const c=Nn(l);try{await c.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>Ve.forEach(g,C=>Ve.forEach(C.ds,h=>c.persistence.referenceDelegate.addReference(u,C.targetId,h)).next(()=>Ve.forEach(C.As,h=>c.persistence.referenceDelegate.removeReference(u,C.targetId,h)))))}catch(u){if(!fA(u))throw u;ht(zae,"Failed to update sequence numbers: "+u)}for(const u of g){const C=u.targetId;if(!u.fromCache){const h=c.xs.get(C),p=h.snapshotVersion,b=h.withLastLimboFreeSnapshotVersion(p);c.xs=c.xs.insert(C,b)}}}(i.localStore,o))}async function Ble(n,e){const t=Nn(n);if(!t.currentUser.isEqual(e)){ht(ple,"User change. New user:",e.toKey());const i=await l5(t.localStore,e);t.currentUser=e,function(o,r){o.Eu.forEach(a=>{a.forEach(l=>{l.reject(new Vt(Ke.CANCELLED,r))})}),o.Eu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await fy(t,i.ks)}}function Gle(n){const e=Nn(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ble.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=yle.bind(null,e),e}class P0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ay(e.databaseInfo.databaseId),this.sharedClientState=this.pu(e),this.persistence=this.yu(e),await this.persistence.start(),this.localStore=this.wu(e),this.gcScheduler=this.Su(e,this.localStore),this.indexBackfillerScheduler=this.bu(e,this.localStore)}Su(e,t){return null}bu(e,t){return null}wu(e){return Pae(this.persistence,new kae,e.initialUser,this.serializer)}yu(e){return new a5(CR.fi,this.serializer)}pu(e){return new Qae}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}P0.provider={build:()=>new P0};class vle extends P0{constructor(e){super(),this.cacheSizeBytes=e}Su(e,t){si(this.persistence.referenceDelegate instanceof D0,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new Rae(i,e.asyncQueue,t)}yu(e){const t=this.cacheSizeBytes!==void 0?js.withCacheSize(this.cacheSizeBytes):js.DEFAULT;return new a5(i=>D0.fi(i,t),this.serializer)}}class yw{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>QF(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ble.bind(null,this.syncEngine),await Cle(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new hle}()}createDatastore(e){const t=Ay(e.databaseInfo.databaseId),i=function(o){return new tle(o)}(e.databaseInfo);return function(o,r,a,l){return new ole(o,r,a,l)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return function(i,s,o,r,a){return new ale(i,s,o,r,a)}(this.localStore,this.datastore,e.asyncQueue,t=>QF(this.syncEngine,t,0),function(){return zF.C()?new zF:new jae}())}createSyncEngine(e,t){return function(s,o,r,a,l,g,c){const u=new mle(s,o,r,a,l,g);return c&&(u.Au=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const o=Nn(s);ht(yA,"RemoteStore shutting down."),o.Ta.add(5),await BA(o),o.Ea.shutdown(),o.da.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}yw.provider={build:()=>new yw};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gg="FirestoreClient";class wle{constructor(e,t,i,s,o){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=As.UNAUTHENTICATED,this.clientId=R3.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(i,async r=>{ht(gg,"Received user=",r.uid),await this.authCredentialListener(r),this.user=r}),this.appCheckCredentials.start(i,r=>(ht(gg,"Received new app check token=",r),this.appCheckCredentialListener(r,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Fc;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=C5(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function mv(n,e){n.asyncQueue.verifyOperationInProgress(),ht(gg,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async s=>{i.isEqual(s)||(await l5(e.localStore,s),i=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function jF(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Zle(n);ht(gg,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(i=>PF(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>PF(e.remoteStore,s)),n._onlineComponents=e}async function Zle(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){ht(gg,"Using user provided OfflineComponentProvider");try{await mv(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===Ke.FAILED_PRECONDITION||s.code===Ke.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Iy("Error using user provided cache. Falling back to memory cache: "+t),await mv(n,new P0)}}else ht(gg,"Using default OfflineComponentProvider"),await mv(n,new vle(void 0));return n._offlineComponents}async function Sle(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(ht(gg,"Using user provided OnlineComponentProvider"),await jF(n,n._uninitializedComponentsProvider._online)):(ht(gg,"Using default OnlineComponentProvider"),await jF(n,new yw))),n._onlineComponents}function Rle(n){return Sle(n).then(e=>e.syncEngine)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p5(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qF=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m5(n,e,t){if(!t)throw new Vt(Ke.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function xle(n,e,t,i){if(e===!0&&i===!0)throw new Vt(Ke.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function $F(n){if(!zt.isDocumentKey(n))throw new Vt(Ke.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function e9(n){if(zt.isDocumentKey(n))throw new Vt(Ke.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function pR(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(i){return i.constructor?i.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Jt(12329,{type:typeof n})}function f5(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Vt(Ke.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=pR(n);throw new Vt(Ke.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b5="firestore.googleapis.com",t9=!0;class n9{constructor(e){var t,i;if(e.host===void 0){if(e.ssl!==void 0)throw new Vt(Ke.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=b5,this.ssl=t9}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:t9;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=r5;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Zae)throw new Vt(Ke.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}xle("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=p5((i=e.experimentalLongPollingOptions)!==null&&i!==void 0?i:{}),function(o){if(o.timeoutSeconds!==void 0){if(isNaN(o.timeoutSeconds))throw new Vt(Ke.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (must not be NaN)`);if(o.timeoutSeconds<5)throw new Vt(Ke.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (minimum allowed value is 5)`);if(o.timeoutSeconds>30)throw new Vt(Ke.INVALID_ARGUMENT,`invalid long polling timeout: ${o.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(i,s){return i.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class by{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new n9({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Vt(Ke.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Vt(Ke.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new n9(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(i){if(!i)return new are;switch(i.type){case"firstParty":return new ure(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new Vt(Ke.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const i=qF.get(t);i&&(ht("ComponentProvider","Removing Datastore"),qF.delete(t),i.terminate())}(this),Promise.resolve()}}function Vle(n,e,t,i={}){var s;n=f5(n,by);const o=jS(e),r=n._getSettings(),a=Object.assign(Object.assign({},r),{emulatorOptions:n._getEmulatorOptions()}),l=`${e}:${t}`;o&&(Fse(`https://${l}`),Ese("Firestore",!0)),r.host!==b5&&r.host!==l&&Iy("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const g=Object.assign(Object.assign({},r),{host:l,ssl:o,emulatorOptions:i});if(!N0(g,a)&&(n._setSettings(g),i.mockUserToken)){let c,u;if(typeof i.mockUserToken=="string")c=i.mockUserToken,u=As.MOCK_USER;else{c=Hse(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const C=i.mockUserToken.sub||i.mockUserToken.user_id;if(!C)throw new Vt(Ke.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new As(C)}n._authCredentials=new lre(new S3(c,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mR{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new mR(this.firestore,e,this._query)}}class za{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new jl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new za(this.firestore,e,this._key)}}class jl extends mR{constructor(e,t,i){super(e,t,Lre(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new za(this.firestore,null,new zt(e))}withConverter(e){return new jl(this.firestore,e,this._path)}}function Wle(n,e,...t){if(n=Lh(n),m5("collection","path",e),n instanceof by){const i=ni.fromString(e,...t);return e9(i),new jl(n,null,i)}{if(!(n instanceof za||n instanceof jl))throw new Vt(Ke.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ni.fromString(e,...t));return e9(i),new jl(n.firestore,null,i)}}function Mle(n,e,...t){if(n=Lh(n),arguments.length===1&&(e=R3.newId()),m5("doc","path",e),n instanceof by){const i=ni.fromString(e,...t);return $F(i),new za(n,null,new zt(i))}{if(!(n instanceof za||n instanceof jl))throw new Vt(Ke.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ni.fromString(e,...t));return $F(i),new za(n.firestore,n instanceof jl?n.converter:null,new zt(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i9="AsyncQueue";class s9{constructor(e=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new g5(this,"async_queue_retry"),this.ec=()=>{const i=pv();i&&ht(i9,"Visibility state changed to "+i.visibilityState),this.C_.p_()},this.tc=e;const t=pv();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.nc(),this.rc(e)}enterRestrictedMode(e){if(!this.ju){this.ju=!0,this.Zu=e||!1;const t=pv();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.ec)}}enqueue(e){if(this.nc(),this.ju)return new Promise(()=>{});const t=new Fc;return this.rc(()=>this.ju&&this.Zu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.zu.push(e),this.sc()))}async sc(){if(this.zu.length!==0){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(e){if(!fA(e))throw e;ht(i9,"Operation failed with retryable error: "+e)}this.zu.length>0&&this.C_.f_(()=>this.sc())}}rc(e){const t=this.tc.then(()=>(this.Yu=!0,e().catch(i=>{throw this.Ju=i,this.Yu=!1,jc("INTERNAL UNHANDLED ERROR: ",o9(i)),i}).then(i=>(this.Yu=!1,i))));return this.tc=t,t}enqueueAfterDelay(e,t,i){this.nc(),this.Xu.indexOf(e)>-1&&(t=0);const s=AR.createAndSchedule(this,e,t,i,o=>this.oc(o));return this.Hu.push(s),s}nc(){this.Ju&&Jt(47125,{_c:o9(this.Ju)})}verifyOperationInProgress(){}async ac(){let e;do e=this.tc,await e;while(e!==this.tc)}uc(e){for(const t of this.Hu)if(t.timerId===e)return!0;return!1}cc(e){return this.ac().then(()=>{this.Hu.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Hu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.ac()})}lc(e){this.Xu.push(e)}oc(e){const t=this.Hu.indexOf(e);this.Hu.splice(t,1)}}function o9(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class y5 extends by{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new s9,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new s9(e),this._firestoreClient=void 0,await e}}}function Nle(n,e){const t=typeof n=="object"?n:Joe(),i=typeof n=="string"?n:E0,s=koe(t,"firestore").getImmediate({identifier:i});if(!s._initialized){const o=Mse("firestore");o&&Vle(s,...o)}return s}function Fle(n){if(n._terminated)throw new Vt(Ke.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Hle(n),n._firestoreClient}function Hle(n){var e,t,i;const s=n._freezeSettings(),o=function(a,l,g,c){return new Rre(a,l,g,c.host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,p5(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,s);n._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((i=s.localCache)===null||i===void 0)&&i._onlineComponentProvider)&&(n._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),n._firestoreClient=new wle(n._authCredentials,n._appCheckCredentials,n._queue,o,n._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Oh(aa.fromBase64String(e))}catch(t){throw new Vt(Ke.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Oh(aa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B5{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Vt(Ke.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pi(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G5{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v5{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Vt(Ke.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Vt(Ke.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return In(this._lat,e._lat)||In(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w5{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(i,s){if(i.length!==s.length)return!1;for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xle=/^__.*__$/;class Tle{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new cu(e,this.data,this.fieldMask,t,this.fieldTransforms):new bA(e,this.data,t,this.fieldTransforms)}}function Z5(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Jt(40011,{hc:n})}}class fR{constructor(e,t,i,s,o,r){this.settings=e,this.databaseId=t,this.serializer=i,this.ignoreUndefinedProperties=s,o===void 0&&this.Pc(),this.fieldTransforms=o||[],this.fieldMask=r||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(e){return new fR(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Tc({path:i,Ec:!1});return s.dc(e),s}Ac(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Tc({path:i,Ec:!1});return s.Pc(),s}Rc(e){return this.Tc({path:void 0,Ec:!0})}Vc(e){return U0(e,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Pc(){if(this.path)for(let e=0;e<this.path.length;e++)this.dc(this.path.get(e))}dc(e){if(e.length===0)throw this.Vc("Document fields must not be empty");if(Z5(this.hc)&&Xle.test(e))throw this.Vc('Document fields cannot begin and end with "__"')}}class Ele{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=i||Ay(e)}gc(e,t,i,s=!1){return new fR({hc:e,methodName:t,fc:i,path:Pi.emptyPath(),Ec:!1,mc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Yle(n){const e=n._freezeSettings(),t=Ay(n._databaseId);return new Ele(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Kle(n,e,t,i,s,o={}){const r=n.gc(o.merge||o.mergeFields?2:0,e,t,s);V5("Data must be an object, but it was:",r,i);const a=R5(i,r);let l,g;if(o.merge)l=new Gr(r.fieldMask),g=r.fieldTransforms;else if(o.mergeFields){const c=[];for(const u of o.mergeFields){const C=_le(e,u,t);if(!r.contains(C))throw new Vt(Ke.INVALID_ARGUMENT,`Field '${C}' is specified in your field mask but missing from your input data.`);zle(c,C)||c.push(C)}l=new Gr(c),g=r.fieldTransforms.filter(u=>l.covers(u.field))}else l=null,g=r.fieldTransforms;return new Tle(new Br(a),l,g)}function S5(n,e){if(x5(n=Lh(n)))return V5("Unsupported field value:",e,n),R5(n,e);if(n instanceof G5)return function(i,s){if(!Z5(s.hc))throw s.Vc(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Vc(`${i._methodName}() is not currently supported inside arrays`);const o=i._toFieldTransform(s);o&&s.fieldTransforms.push(o)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Ec&&e.hc!==4)throw e.Vc("Nested arrays are not supported");return function(i,s){const o=[];let r=0;for(const a of i){let l=S5(a,s.Rc(r));l==null&&(l={nullValue:"NULL_VALUE"}),o.push(l),r++}return{arrayValue:{values:o}}}(n,e)}return function(i,s){if((i=Lh(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return qre(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const o=Zi.fromDate(i);return{timestampValue:pw(s.serializer,o)}}if(i instanceof Zi){const o=new Zi(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:pw(s.serializer,o)}}if(i instanceof v5)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Oh)return{bytesValue:uae(s.serializer,i._byteString)};if(i instanceof za){const o=s.databaseId,r=i.firestore._databaseId;if(!r.isEqual(o))throw s.Vc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:s5(i.firestore._databaseId||s.databaseId,i._key.path)}}if(i instanceof w5)return function(r,a){return{mapValue:{fields:{[H3]:{stringValue:T3},[Iw]:{arrayValue:{values:r.toArray().map(g=>{if(typeof g!="number")throw a.Vc("VectorValues must only contain numeric values.");return uR(a.serializer,g)})}}}}}}(i,s);throw s.Vc(`Unsupported field value: ${pR(i)}`)}(n,e)}function R5(n,e){const t={};return V3(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):pd(n,(i,s)=>{const o=S5(s,e.Ic(i));o!=null&&(t[i]=o)}),{mapValue:{fields:t}}}function x5(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Zi||n instanceof v5||n instanceof Oh||n instanceof za||n instanceof G5||n instanceof w5)}function V5(n,e,t){if(!x5(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const i=pR(t);throw i==="an object"?e.Vc(n+" a custom object"):e.Vc(n+" "+i)}}function _le(n,e,t){if((e=Lh(e))instanceof B5)return e._internalPath;if(typeof e=="string")return kle(n,e);throw U0("Field path arguments must be of type string or ",n,!1,void 0,t)}const Lle=new RegExp("[~\\*/\\[\\]]");function kle(n,e,t){if(e.search(Lle)>=0)throw U0(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new B5(...e.split("."))._internalPath}catch{throw U0(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function U0(n,e,t,i,s){const o=i&&!i.isEmpty(),r=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(o||r)&&(l+=" (found",o&&(l+=` in field ${i}`),r&&(l+=` in document ${s}`),l+=")"),new Vt(Ke.INVALID_ARGUMENT,a+n+l)}function zle(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dle(n,e,t){let i;return i=n?n.toFirestore(e):e,i}function Ple(n,e){const t=f5(n.firestore,y5),i=Mle(n),s=Dle(n.converter,e);return Ule(t,[Kle(Yle(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,ka.exists(!1))]).then(()=>i)}function Ule(n,e){return function(i,s){const o=new Fc;return i.asyncQueue.enqueueAndForget(async()=>fle(await Rle(i),s,o)),o.promise}(Fle(n),e)}(function(e,t=!0){(function(s){Ad=s})(Uoe),H0(new kh("firestore",(i,{instanceIdentifier:s,options:o})=>{const r=i.getProvider("app").getImmediate(),a=new y5(new gre(i.getProvider("auth-internal")),new Ire(r,i.getProvider("app-check-internal")),function(g,c){if(!Object.prototype.hasOwnProperty.apply(g.options,["projectId"]))throw new Vt(Ke.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Y0(g.options.projectId,c)}(r,s),r);return o=Object.assign({useFetchStreams:t},o),a._setSettings(o),a},"PUBLIC").setMultipleInstances(!0)),FI(mF,fF,e),FI(mF,fF,"esm2017")})();const Jle={apiKey:"AIzaSyDAC0tKQah4aP08lIsSrQ7fo3iANac5fG4",authDomain:"adam-dfe4e.firebaseapp.com",databaseURL:"https://adam-dfe4e-default-rtdb.firebaseio.com",projectId:"adam-dfe4e",storageBucket:"adam-dfe4e.firebasestorage.app",messagingSenderId:"41649038563",appId:"1:41649038563:web:48a5e2eb5b10ff966291d6",measurementId:"G-907RVW6D07"},Ole=m3(Jle),Qle=Nle(Ole),jle=()=>{const[n,e]=z.useState({firstName:"",lastName:"",email:"",link:"",message:""}),[t,i]=z.useState(!1),s=r=>{e({...n,[r.target.name]:r.target.value})},o=async r=>{r.preventDefault(),i(!0);try{await Ple(Wle(Qle,"contacts"),{...n,timestamp:Zi.now()}),alert("Message sent successfully!"),e({firstName:"",lastName:"",email:"",link:"",message:""})}catch(a){console.error("Error sending message:",a),alert("Failed to send message. Please try again.")}i(!1)};return j.jsxs("div",{className:"xl:mt-12 flex flex-col xl:flex-row gap-10 overflow-hidden w-full h-auto",children:[j.jsx("div",{className:"flex flex-col gap-10 w-full xl:w-[35%]",children:j.jsxs(Wr.div,{variants:iF("left","tween",.2,1),className:"bg-black-100 p-8 rounded-2xl w-full max-w-md",children:[j.jsx("p",{className:`${wo.sectionSubText}`,children:"Get in touch"}),j.jsx("h3",{className:`${wo.sectionHeadText} mb-6`,children:"Contact."}),j.jsxs("form",{onSubmit:o,className:"space-y-6",children:[j.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[j.jsxs("div",{children:[j.jsx("label",{htmlFor:"firstName",className:"block text-white text-sm font-semibold mb-2",children:"First Name"}),j.jsx("input",{type:"text",id:"firstName",name:"firstName",value:n.firstName,onChange:s,className:"w-full px-4 py-2 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-200",required:!0})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"lastName",className:"block text-white text-sm font-semibold mb-2",children:"Last Name"}),j.jsx("input",{type:"text",id:"lastName",name:"lastName",value:n.lastName,onChange:s,className:"w-full px-4 py-2 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-200",required:!0})]})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"email",className:"block text-white text-sm font-semibold mb-2",children:"Email"}),j.jsx("input",{type:"email",id:"email",name:"email",value:n.email,onChange:s,className:"w-full px-4 py-2 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-200",required:!0})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"link",className:"block text-white text-sm font-semibold mb-2",children:"Link"}),j.jsx("input",{type:"url",id:"link",name:"link",value:n.link,onChange:s,placeholder:"https://example.com",className:"w-full px-4 py-2 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-200"})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"message",className:"block text-white text-sm font-semibold mb-2",children:"Message"}),j.jsx("textarea",{id:"message",name:"message",value:n.message,onChange:s,rows:"4",className:"w-full px-4 py-2 rounded-md bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary transition duration-200 resize-none",required:!0})]}),j.jsx("button",{type:"submit",disabled:t,className:"w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-4 rounded-md shadow-md hover:shadow-lg transition duration-300 ease-in-out",children:t?"Sending...":"Send Message"})]})]})}),j.jsx(Wr.div,{variants:iF("right","tween",.2,1),className:"xl:flex-1 xl:h-auto md:h-[80vh] h-[60vh]",children:j.jsx(zq,{})})]})},qle=mA(jle,"contact"),$le=()=>j.jsx(az,{children:j.jsxs("div",{className:"relative z-0 bg-primary",children:[j.jsxs("div",{className:"bg-hero-pattern bg-cover bg-no-repeat bg-center",children:[j.jsx(kie,{}),j.jsx(fie,{})]}),j.jsx(qie,{}),j.jsx(mse,{}),j.jsx(ese,{}),j.jsx(yse,{}),j.jsxs("div",{className:"relative z-0",children:[j.jsx(qle,{}),j.jsx(ZY,{})]})]})});pZ(document.getElementById("root")).render(j.jsx(z.StrictMode,{children:j.jsx($le,{})}));
